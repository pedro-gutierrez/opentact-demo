!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Opentact",[],t):"object"==typeof exports?exports.Opentact=t():e.Opentact=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=70)}([function(e,t,n){e.exports={Namespace:n(333),MUC:n(332),PubSub:n(335),Jingle:n(331),Presence:n(334)}},function(e,t,n){"use strict";(function(e){function r(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=s.prototype):(null===e&&(e=new s(t)),e.length=t),e}function s(e,t,n){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return o(this,e,t,n)}function o(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?p(e,t,n,r):"string"==typeof t?l(e,t,n):f(e,t)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t,n,r){return a(t),t<=0?i(e,t):void 0!==n?"string"==typeof r?i(e,t).fill(n,r):i(e,t).fill(n):i(e,t)}function u(e,t){if(a(t),e=i(e,t<0?0:0|h(t)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function l(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(t,n);e=i(e,r);var o=e.write(t,n);return o!==r&&(e=e.slice(0,o)),e}function d(e,t){var n=t.length<0?0:0|h(t.length);e=i(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),s.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=s.prototype):e=d(e,t),e}function f(e,t){if(s.isBuffer(t)){var n=0|h(t.length);return e=i(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||z(t.length)?i(e,0):d(e,t);if("Buffer"===t.type&&Q(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function h(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),s.alloc(+e)}function g(e,t){if(s.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return J(e).length;default:if(r)return H(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return N(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function b(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t)return t&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){function s(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}var o=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}var u;if(i){var l=-1;for(u=n;u<a;u++)if(s(e,u)===s(t,-1===l?0:u-l)){if(-1===l&&(l=u),u-l+1===c)return l*o}else-1!==l&&(u-=u-l),l=-1}else for(n+c>a&&(n=a-c),u=n;u>=0;u--){for(var d=!0,p=0;p<c;p++)if(s(e,u+p)!==s(t,p)){d=!1;break}if(d)return u}return-1}function S(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[n+o]=a}return o}function T(e,t,n,r){return W(H(t,e.length-n),e,n,r)}function E(e,t,n,r){return W(G(t),e,n,r)}function w(e,t,n,r){return E(e,t,n,r)}function R(e,t,n,r){return W(J(t),e,n,r)}function C(e,t,n,r){return W(V(t,e.length-n),e,n,r)}function x(e,t,n){return 0===t&&n===e.length?K.fromByteArray(e):K.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s=e[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=n){var c,u,l,d;switch(a){case 1:s<128&&(o=s);break;case 2:c=e[i+1],128==(192&c)&&(d=(31&s)<<6|63&c)>127&&(o=d);break;case 3:c=e[i+1],u=e[i+2],128==(192&c)&&128==(192&u)&&(d=(15&s)<<12|(63&c)<<6|63&u)>2047&&(d<55296||d>57343)&&(o=d);break;case 4:c=e[i+1],u=e[i+2],l=e[i+3],128==(192&c)&&128==(192&u)&&128==(192&l)&&(d=(15&s)<<18|(63&c)<<12|(63&u)<<6|63&l)>65535&&d<1114112&&(o=d)}}null===o?(o=65533,a=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),i+=a}return I(r)}function I(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Z));return n}function N(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function D(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=F(e[s]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function U(e,t,n,r,i,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function k(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function j(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function L(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function $(e,t,n,r,i){return i||L(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Y.write(e,t,n,r,23,4),n+4}function X(e,t,n,r,i){return i||L(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Y.write(e,t,n,r,52,8),n+8}function q(e){if(e=B(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function B(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function G(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function V(e,t){for(var n,r,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}function J(e){return K.toByteArray(q(e))}function W(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function z(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var K=n(71),Y=n(83),Q=n(41);t.Buffer=s,t.SlowBuffer=m,t.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),s.poolSize=8192,s._augment=function(e){return e.__proto__=s.prototype,e},s.from=function(e,t,n){return o(null,e,t,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(e,t,n){return c(null,e,t,n)},s.allocUnsafe=function(e){return u(null,e)},s.allocUnsafeSlow=function(e){return u(null,e)},s.isBuffer=function(e){return!(null==e||!e._isBuffer)},s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Q(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=s.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},s.byteLength=g,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},s.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):v.apply(this,arguments)},s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,t,n,r,i){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,a=n-t,c=Math.min(o,a),u=this.slice(r,i),l=e.slice(t,n),d=0;d<c;++d)if(u[d]!==l[d]){o=u[d],a=l[d];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return S(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return R(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;s.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r;if(s.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=s.prototype;else{var i=t-e;r=new s(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},s.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},s.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},s.prototype.readUInt8=function(e,t){return t||M(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return t||M(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return t||M(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},s.prototype.readInt8=function(e,t){return t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return t||M(e,4,this.length),Y.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return t||M(e,4,this.length),Y.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return t||M(e,8,this.length),Y.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return t||M(e,8,this.length),Y.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){U(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},s.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){U(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},s.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,255,0),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):j(this,e,t,!0),t+4},s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,127,-128),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):j(this,e,t,!0),t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},s.prototype.writeFloatLE=function(e,t,n){return $(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return $(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return X(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return X(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!s.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var o;if("number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=s.isBuffer(e)?e:H(new s(e,r).toString()),c=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%c]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,n(3))},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";function r(e,t){return e?e+"@"+t:t}function i(e,t,n){return n?r(e,t)+"/"+n:r(e,t)}var s=n(336),o=/^[\x00-\x7F]*$/;t.prep=function(e){var n=e.local,o=e.domain,a=e.resource,c=n;return n&&(n=s.nodeprep(n),c=t.unescape(n)),a&&(a=s.resourceprep(a)),"."===o[o.length-1]&&(o=o.slice(0,o.length-1)),o=s.nameprep(o.split(".").map(s.toUnicode).join(".")),{prepped:e.prepped||s.available,local:n,domain:o,resource:a,bare:r(n,o),full:i(n,o,a),unescapedLocal:c,unescapedBare:r(c,o),unescapedFull:i(c,o,a)}},t.parse=function(e,n){var r="",i="",s="";n=n||o.test(e);var a=e.indexOf("/");a>0&&(s=e.slice(a+1),e=e.slice(0,a));var c=e.indexOf("@");c>0&&(r=e.slice(0,c),e=e.slice(c+1)),i=e;var u=t.prep({local:r,domain:i,resource:s});return u.prepped=u.prepped||n,u},t.equal=function(e,n,r){return e=new t.JID(e),n=new t.JID(n),2===arguments.length&&(r=!0),e.local===n.local&&e.domain===n.domain&&e.resource===n.resource&&(!r||e.prepped&&n.prepped)},t.equalBare=function(e,n,r){return e=new t.JID(e),n=new t.JID(n),2===arguments.length&&(r=!0),e.local===n.local&&e.domain===n.domain&&(!r||e.prepped&&n.prepped)},t.isBare=function(e){return e=new t.JID(e),!!!e.resource},t.isFull=function(e){return e=new t.JID(e),!!e.resource},t.escape=function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\5c/g,"\\5c5c").replace(/\\20/g,"\\5c20").replace(/\\22/g,"\\5c22").replace(/\\26/g,"\\5c26").replace(/\\27/g,"\\5c27").replace(/\\2f/g,"\\5c2f").replace(/\\3a/g,"\\5c3a").replace(/\\3c/g,"\\5c3c").replace(/\\3e/g,"\\5c3e").replace(/\\40/g,"\\5c40").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},t.unescape=function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},t.create=function(e,n,r){return new t.JID(e,n,r)},t.JID=function(e,n,r){var i={};if(!e||n||r)if(n){var s=o.test(e)&&o.test(n);r&&(s=s&&o.test(r)),i=t.prep({local:t.escape(e),domain:n,resource:r,prepped:s})}else i={};else if("string"==typeof e)i=t.parse(e);else{if(!(e._isJID||e instanceof t.JID))throw new Error("Invalid argument type");i=e}this._isJID=!0,this.local=i.local||"",this.domain=i.domain||"",this.resource=i.resource||"",this.bare=i.bare||"",this.full=i.full||"",this.unescapedLocal=i.unescapedLocal||"",this.unescapedBare=i.unescapedBare||"",this.unescapedFull=i.unescapedFull||"",this.prepped=i.prepped},t.JID.prototype.toString=function(){return this.full},t.JID.prototype.toJSON=function(){return this.full}},function(e,t,n){(function(e,r){function i(e,n){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),m(n)?r.showHidden=n:n&&t._extend(r,n),S(r.showHidden)&&(r.showHidden=!1),S(r.depth)&&(r.depth=2),S(r.colors)&&(r.colors=!1),S(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),c(r,e,r.depth)}function s(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function o(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function c(e,n,r){if(e.customInspect&&n&&C(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return y(i)||(i=c(e,i,r)),i}var s=u(e,n);if(s)return s;var o=Object.keys(n),m=a(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),R(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return l(n);if(0===o.length){if(C(n)){var g=n.name?": "+n.name:"";return e.stylize("[Function"+g+"]","special")}if(T(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(R(n))return l(n)}var v="",b=!1,_=["{","}"];if(h(n)&&(b=!0,_=["[","]"]),C(n)){v=" [Function"+(n.name?": "+n.name:"")+"]"}if(T(n)&&(v=" "+RegExp.prototype.toString.call(n)),w(n)&&(v=" "+Date.prototype.toUTCString.call(n)),R(n)&&(v=" "+l(n)),0===o.length&&(!b||0==n.length))return _[0]+v+_[1];if(r<0)return T(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special");e.seen.push(n);var S;return S=b?d(e,n,r,m,o):o.map(function(t){return p(e,n,r,m,t,b)}),e.seen.pop(),f(S,v,_)}function u(e,t){if(S(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return b(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i){for(var s=[],o=0,a=t.length;o<a;++o)O(t,String(o))?s.push(p(e,t,n,r,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(p(e,t,n,r,i,!0))}),s}function p(e,t,n,r,i,s){var o,a,u;if(u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),O(r,i)||(o="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=g(n)?c(e,u.value,null):c(e,u.value,n-1),a.indexOf("\n")>-1&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),S(o)){if(s&&i.match(/^\d+$/))return a;o=JSON.stringify(""+i),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function f(e,t,n){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function h(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function g(e){return null===e}function v(e){return null==e}function b(e){return"number"==typeof e}function y(e){return"string"==typeof e}function _(e){return"symbol"==typeof e}function S(e){return void 0===e}function T(e){return E(e)&&"[object RegExp]"===A(e)}function E(e){return"object"==typeof e&&null!==e}function w(e){return E(e)&&"[object Date]"===A(e)}function R(e){return E(e)&&("[object Error]"===A(e)||e instanceof Error)}function C(e){return"function"==typeof e}function x(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function A(e){return Object.prototype.toString.call(e)}function I(e){return e<10?"0"+e.toString(10):e.toString(10)}function N(){var e=new Date,t=[I(e.getHours()),I(e.getMinutes()),I(e.getSeconds())].join(":");return[e.getDate(),U[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var D=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,s=r.length,o=String(e).replace(D,function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),a=r[n];n<s;a=r[++n])g(a)||!E(a)?o+=" "+a:o+=" "+i(a);return o},t.deprecate=function(n,i){function s(){if(!o){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),o=!0}return n.apply(this,arguments)}if(S(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var o=!1;return s};var P,M={};t.debuglog=function(e){if(S(P)&&(P=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!M[e])if(new RegExp("\\b"+e+"\\b","i").test(P)){var n=r.pid;M[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else M[e]=function(){};return M[e]},t.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=m,t.isNull=g,t.isNullOrUndefined=v,t.isNumber=b,t.isString=y,t.isSymbol=_,t.isUndefined=S,t.isRegExp=T,t.isObject=E,t.isDate=w,t.isError=R,t.isFunction=C,t.isPrimitive=x,t.isBuffer=n(320);var U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){console.log("%s - %s",N(),t.format.apply(t,arguments))},t.inherits=n(319),t._extend=function(e,t){if(!t||!E(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(t,n(3),n(8))},function(e,t,n){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!navigator.mediaDevices||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return e},shimCreateObjectURL:function(){if("object"==typeof window&&window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){var e=URL.createObjectURL.bind(URL),t=URL.revokeObjectURL.bind(URL),n=new Map,r=0;URL.createObjectURL=function(t){if("getTracks"in t){var i="polyblob:"+ ++r;return n.set(i,t),console.log("URL.createObjectURL(stream) is deprecated! Use elem.srcObject = stream instead!"),i}return e(t)},URL.revokeObjectURL=function(e){t(e),n.delete(e)};var i=Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,"src");Object.defineProperty(window.HTMLMediaElement.prototype,"src",{get:function(){return i.get.apply(this)},set:function(e){return this.srcObject=n.get(e)||null,i.set.apply(this,[e])}});var s=HTMLMediaElement.prototype.setAttribute;HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=n.get(arguments[1])||null),s.apply(this,arguments)}}}};e.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion,shimCreateObjectURL:i.shimCreateObjectURL,detectBrowser:i.detectBrowser.bind(i)}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function s(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function o(){m&&f&&(m=!1,f.length?h=f.concat(h):g=-1,h.length&&a())}function a(){if(!m){var e=i(o);m=!0;for(var t=h.length;t;){for(f=h,h=[];++g<t;)f&&f[g].run();g=-1,t=h.length}f=null,m=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var l,d,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var f,h=[],m=!1,g=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new c(e,t)),1!==h.length||m||i(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){function n(){}e.exports=n,n.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var r=3===arguments.length,i=r?arguments[1]:void 0,s=r?arguments[2]:arguments[1];return s._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(s),this},t.once=function(e,t,n){function r(){i.off(e,r),a.apply(this,arguments)}var i=this,s=3===arguments.length,o=s?arguments[1]:void 0,a=s?arguments[2]:arguments[1];return this.on(e,o,r),this},t.releaseGroup=function(e){this.callbacks=this.callbacks||{};var t,n,r,i;for(t in this.callbacks)for(i=this.callbacks[t],n=0,r=i.length;n<r;n++)i[n]._groupName===e&&(i.splice(n,1),n--,r--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,r=this.callbacks[e];return r?1===arguments.length?(delete this.callbacks[e],this):(n=r.indexOf(t),r.splice(n,1),0===r.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,r,i=[].slice.call(arguments,1),s=this.callbacks[e],o=this.getWildcardCallbacks(e);if(s)for(r=s.slice(),t=0,n=r.length;t<n&&r[t];++t)r[t].apply(this,i);if(o)for(n=o.length,r=o.slice(),t=0,n=r.length;t<n&&r[t];++t)r[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,r=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(r=r.concat(this.callbacks[t]));return r}},n.mixin(n)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(s(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,c=0;c<i;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);u.call(this,e),l.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||a(s,this)}function s(e){e.end()}var o=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var a=n(31),c=n(16);c.inherits=n(2);var u=n(53),l=n(33);c.inherits(r,u);for(var d=o(l.prototype),p=0;p<d.length;p++){var f=d[p];r.prototype[f]||(r.prototype[f]=l.prototype[f])}},function(e,t,n){function r(e,t,n){for(var r=-1,i=o(t),s=i.length;++r<s;){var a=i[r],c=e[a],u=n(c,t[a],a,e,t);(u===u?u===c:c!==c)&&(void 0!==c||a in e)||(e[a]=u)}return e}var i=n(173),s=n(180),o=n(17),a=s(function(e,t,n){return n?r(e,t,n):i(e,t)});e.exports=a},function(e,t,n){var r=n(171),i=n(44),s=n(30),o=n(14),a=function(e,t){return function(n,r,i){return"function"==typeof r&&void 0===i&&o(n)?e(n,r):t(n,s(r,i,3))}}(r,i);e.exports=a},function(e,t){function n(e){return!!e&&"object"==typeof e}function r(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=m}function i(e){return s(e)&&p.call(e)==a}function s(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function o(e){return null!=e&&(i(e)?f.test(l.call(e)):n(e)&&c.test(e))}var a="[object Function]",c=/^\[object .+?Constructor\]$/,u=Object.prototype,l=Function.prototype.toString,d=u.hasOwnProperty,p=u.toString,f=RegExp("^"+l.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),h=function(e,t){var n=null==e?void 0:e[t];return o(n)?n:void 0}(Array,"isArray"),m=9007199254740991,g=h||function(e){return n(e)&&r(e.length)&&"[object Array]"==p.call(e)};e.exports=g},function(e,t,n){(function(t){function n(e,n){this._block=new t(e),this._finalSize=n,this._blockSize=e,this._len=0,this._s=0}n.prototype.update=function(e,n){"string"==typeof e&&(n=n||"utf8",e=new t(e,n));for(var r=this._len+=e.length,i=this._s||0,s=0,o=this._block;i<r;){for(var a=Math.min(e.length,s+this._blockSize-i%this._blockSize),c=a-s,u=0;u<c;u++)o[i%this._blockSize+u]=e[u+s];i+=c,s+=c,i%this._blockSize==0&&this._update(o)}return this._s=i,this},n.prototype.digest=function(e){var t=8*this._len;this._block[this._len%this._blockSize]=128,this._block.fill(0,this._len%this._blockSize+1),t%(8*this._blockSize)>=8*this._finalSize&&(this._update(this._block),this._block.fill(0)),this._block.writeInt32BE(t,this._blockSize-4);var n=this._update(this._block)||this._hash();return e?n.toString(e):n},n.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=n}).call(t,n(1).Buffer)},function(e,t,n){(function(e){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===g(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function s(e){return null==e}function o(e){return"number"==typeof e}function a(e){return"string"==typeof e}function c(e){return"symbol"==typeof e}function u(e){return void 0===e}function l(e){return"[object RegExp]"===g(e)}function d(e){return"object"==typeof e&&null!==e}function p(e){return"[object Date]"===g(e)}function f(e){return"[object Error]"===g(e)||e instanceof Error}function h(e){return"function"==typeof e}function m(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function g(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=i,t.isNullOrUndefined=s,t.isNumber=o,t.isString=a,t.isSymbol=c,t.isUndefined=u,t.isRegExp=l,t.isObject=d,t.isDate=p,t.isError=f,t.isFunction=h,t.isPrimitive=m,t.isBuffer=e.isBuffer}).call(t,n(1).Buffer)},function(e,t,n){function r(e){return null!=e&&s(v(e))}function i(e,t){return e="number"==typeof e||p.test(e)?+e:-1,t=null==t?g:t,e>-1&&e%1==0&&e<t}function s(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=g}function o(e){for(var t=c(e),n=t.length,r=n&&e.length,o=!!r&&s(r)&&(d(e)||l(e)),a=-1,u=[];++a<n;){var p=t[a];(o&&i(p,r)||h.call(e,p))&&u.push(p)}return u}function a(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function c(e){if(null==e)return[];a(e)||(e=Object(e));var t=e.length;t=t&&s(t)&&(d(e)||l(e))&&t||0;for(var n=e.constructor,r=-1,o="function"==typeof n&&n.prototype===e,c=Array(t),u=t>0;++r<t;)c[r]=r+"";for(var p in e)u&&i(p,t)||"constructor"==p&&(o||!h.call(e,p))||c.push(p);return c}var u=n(45),l=n(183),d=n(14),p=/^\d+$/,f=Object.prototype,h=f.hasOwnProperty,m=u(Object,"keys"),g=9007199254740991,v=function(e){return function(t){return null==t?void 0:t[e]}}("length"),b=m?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&r(e)?o(e):a(e)?m(e):[]}:o;e.exports=b},function(e,t,n){"use strict";function r(e,t){this.name=e,this.parent=null,this.children=[],this.attrs={},this.setAttrs(t)}var i=n(20),s=i.escapeXML,o=i.escapeXMLText,a=n(50),c=a.equal,u=a.name,l=a.attrs,d=a.children,p=n(49);r.prototype.is=function(e,t){return this.getName()===e&&(!t||this.getNS()===t)},r.prototype.getName=function(){return this.name.indexOf(":")>=0?this.name.substr(this.name.indexOf(":")+1):this.name},r.prototype.getNS=function(){if(this.name.indexOf(":")>=0){var e=this.name.substr(0,this.name.indexOf(":"));return this.findNS(e)}return this.findNS()},r.prototype.findNS=function(e){if(e){var t="xmlns:"+e;if(this.attrs[t])return this.attrs[t];if(this.parent)return this.parent.findNS(e)}else{if(this.attrs.xmlns)return this.attrs.xmlns;if(this.parent)return this.parent.findNS()}},r.prototype.getXmlns=function(){var e={};this.parent&&(e=this.parent.getXmlns());for(var t in this.attrs){var n=t.match("xmlns:?(.*)");this.attrs.hasOwnProperty(t)&&n&&(e[this.attrs[t]]=n[1])}return e},r.prototype.setAttrs=function(e){"string"==typeof e?this.attrs.xmlns=e:e&&Object.keys(e).forEach(function(t){this.attrs[t]=e[t]},this)},r.prototype.getAttr=function(e,t){if(!t)return this.attrs[e];var n=this.getXmlns();return n[t]?this.attrs[[n[t],e].join(":")]:null},r.prototype.getChild=function(e,t){return this.getChildren(e,t)[0]},r.prototype.getChildren=function(e,t){for(var n=[],r=0;r<this.children.length;r++){var i=this.children[r];!i.getName||i.getName()!==e||t&&i.getNS()!==t||n.push(i)}return n},r.prototype.getChildByAttr=function(e,t,n,r){return this.getChildrenByAttr(e,t,n,r)[0]},r.prototype.getChildrenByAttr=function(e,t,n,r){for(var i=[],s=0;s<this.children.length;s++){var o=this.children[s];!o.attrs||o.attrs[e]!==t||n&&o.getNS()!==n||i.push(o),r&&o.getChildrenByAttr&&i.push(o.getChildrenByAttr(e,t,n,!0))}return r&&(i=[].concat.apply([],i)),i},r.prototype.getChildrenByFilter=function(e,t){for(var n=[],r=0;r<this.children.length;r++){var i=this.children[r];e(i)&&n.push(i),t&&i.getChildrenByFilter&&n.push(i.getChildrenByFilter(e,!0))}return t&&(n=[].concat.apply([],n)),n},r.prototype.getText=function(){for(var e="",t=0;t<this.children.length;t++){var n=this.children[t];"string"!=typeof n&&"number"!=typeof n||(e+=n)}return e},r.prototype.getChildText=function(e,t){var n=this.getChild(e,t);return n?n.getText():null},r.prototype.getChildElements=function(){return this.getChildrenByFilter(function(e){return e instanceof r})},r.prototype.root=function(){return this.parent?this.parent.root():this},r.prototype.tree=r.prototype.root,r.prototype.up=function(){return this.parent?this.parent:this},r.prototype.c=function(e,t){return this.cnode(new r(e,t))},r.prototype.cnode=function(e){return this.children.push(e),"object"==typeof e&&(e.parent=this),e},r.prototype.t=function(e){return this.children.push(e),this},r.prototype.remove=function(e,t){var n;return n="string"==typeof e?function(n){return!(n.is&&n.is(e,t))}:function(t){return t!==e},this.children=this.children.filter(n),this},r.prototype.clone=function(){return p(this)},r.prototype.text=function(e){return e&&1===this.children.length?(this.children[0]=e,this):this.getText()},r.prototype.attr=function(e,t){return void 0!==t||null===t?(this.attrs||(this.attrs={}),this.attrs[e]=t,this):this.attrs[e]},r.prototype.toString=function(){var e="";return this.write(function(t){e+=t}),e},r.prototype.toJSON=function(){return{name:this.name,attrs:this.attrs,children:this.children.map(function(e){return e&&e.toJSON?e.toJSON():e})}},r.prototype._addChildren=function(e){e(">");for(var t=0;t<this.children.length;t++){var n=this.children[t];(n||0===n)&&(n.write?n.write(e):"string"==typeof n?e(o(n)):n.toString&&e(o(n.toString(10))))}e("</"),e(this.name),e(">")},r.prototype.write=function(e){e("<"),e(this.name);for(var t in this.attrs){var n=this.attrs[t];null!=n&&(e(" "),e(t),e('="'),"string"!=typeof n&&(n=n.toString()),e(s(n)),e('"'))}0===this.children.length?e("/>"):this._addChildren(e)},r.prototype.nameEquals=function(e){return u(this,e)},r.prototype.attrsEquals=function(e){return l(this,e)},r.prototype.childrenEquals=function(e){return d(this,e)},r.prototype.equals=function(e){return c(this,e)},e.exports=r},function(e,t,n){(function(n,r,i){var s,o;/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
!function(){function a(){}function c(e){return e}function u(e){return!!e}function l(e){return!e}function d(e){return function(){if(null===e)throw new Error("Callback was already called.");e.apply(this,arguments),e=null}}function p(e){return function(){null!==e&&(e.apply(this,arguments),e=null)}}function f(e){return F(e)||"number"==typeof e.length&&e.length>=0&&e.length%1==0}function h(e,t){for(var n=-1,r=e.length;++n<r;)t(e[n],n,e)}function m(e,t){for(var n=-1,r=e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function g(e){return m(Array(e),function(e,t){return t})}function v(e,t,n){return h(e,function(e,r,i){n=t(n,e,r,i)}),n}function b(e,t){h(G(e),function(n){t(e[n],n)})}function y(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function _(e){var t,n,r=-1;return f(e)?(t=e.length,function(){return r++,r<t?r:null}):(n=G(e),t=n.length,function(){return r++,r<t?n[r]:null})}function S(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r)}}}function T(e){return function(t,n,r){return e(t,r)}}function E(e){return function(t,n,r){r=p(r||a),t=t||[];var i=_(t);if(e<=0)return r(null);var s=!1,o=0,c=!1;!function a(){if(s&&o<=0)return r(null);for(;o<e&&!c;){var u=i();if(null===u)return s=!0,void(o<=0&&r(null));o+=1,n(t[u],u,d(function(e){o-=1,e?(r(e),c=!0):a()}))}}()}}function w(e){return function(t,n,r){return e(X.eachOf,t,n,r)}}function R(e){return function(t,n,r,i){return e(E(n),t,r,i)}}function C(e){return function(t,n,r){return e(X.eachOfSeries,t,n,r)}}function x(e,t,n,r){r=p(r||a),t=t||[];var i=f(t)?[]:{};e(t,function(e,t,r){n(e,function(e,n){i[t]=n,r(e)})},function(e){r(e,i)})}function A(e,t,n,r){var i=[];e(t,function(e,t,r){n(e,function(n){n&&i.push({index:t,value:e}),r()})},function(){r(m(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})}function I(e,t,n,r){A(e,t,function(e,t){n(e,function(e){t(!e)})},r)}function N(e,t,n){return function(r,i,s,o){function a(){o&&o(n(!1,void 0))}function c(e,r,i){if(!o)return i();s(e,function(r){o&&t(r)&&(o(n(!0,e)),o=s=!1),i()})}arguments.length>3?e(r,i,c,a):(o=s,s=i,e(r,c,a))}}function O(e,t){return t}function D(e,t,n){n=n||a;var r=f(t)?[]:{};e(t,function(e,t,n){e(S(function(e,i){i.length<=1&&(i=i[0]),r[t]=i,n(e)}))},function(e){n(e,r)})}function P(e,t,n,r){var i=[];e(t,function(e,t,r){n(e,function(e,t){i=i.concat(t||[]),r(e)})},function(e){r(e,i)})}function M(e,t,n){function r(e,t,n,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(e.started=!0,F(t)||(t=[t]),0===t.length&&e.idle())return X.setImmediate(function(){e.drain()});h(t,function(t){var i={data:t,callback:r||a};n?e.tasks.unshift(i):e.tasks.push(i),e.tasks.length===e.concurrency&&e.saturated()}),X.setImmediate(e.process)}function i(e,t){return function(){s-=1;var n=!1,r=arguments;h(t,function(e){h(o,function(t,r){t!==e||n||(o.splice(r,1),n=!0)}),e.callback.apply(e,r)}),e.tasks.length+s===0&&e.drain(),e.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var s=0,o=[],c={tasks:[],concurrency:t,payload:n,saturated:a,empty:a,drain:a,started:!1,paused:!1,push:function(e,t){r(c,e,!1,t)},kill:function(){c.drain=a,c.tasks=[]},unshift:function(e,t){r(c,e,!0,t)},process:function(){for(;!c.paused&&s<c.concurrency&&c.tasks.length;){var t=c.payload?c.tasks.splice(0,c.payload):c.tasks.splice(0,c.tasks.length),n=m(t,function(e){return e.data});0===c.tasks.length&&c.empty(),s+=1,o.push(t[0]);var r=d(i(c,t));e(n,r)}},length:function(){return c.tasks.length},running:function(){return s},workersList:function(){return o},idle:function(){return c.tasks.length+s===0},pause:function(){c.paused=!0},resume:function(){if(!1!==c.paused){c.paused=!1;for(var e=Math.min(c.concurrency,c.tasks.length),t=1;t<=e;t++)X.setImmediate(c.process)}}};return c}function U(e){return S(function(t,n){t.apply(null,n.concat([S(function(t,n){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&h(n,function(t){console[e](t)}))})]))})}function k(e){return function(t,n,r){e(g(t),n,r)}}function j(e){return S(function(t,n){var r=S(function(n){var r=this,i=n.pop();return e(t,function(e,t,i){e.apply(r,n.concat([i]))},i)});return n.length?r.apply(this,n):r})}function L(e){return S(function(t){var n=t.pop();t.push(function(){var e=arguments;r?X.setImmediate(function(){n.apply(null,e)}):n.apply(null,e)});var r=!0;e.apply(this,t),r=!1})}var $,X={},q="object"==typeof self&&self.self===self&&self||"object"==typeof n&&n.global===n&&n||this;null!=q&&($=q.async),X.noConflict=function(){return q.async=$,X};var B=Object.prototype.toString,F=Array.isArray||function(e){return"[object Array]"===B.call(e)},H=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},G=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},V="function"==typeof r&&r,J=V?function(e){V(e)}:function(e){setTimeout(e,0)};"object"==typeof i&&"function"==typeof i.nextTick?X.nextTick=i.nextTick:X.nextTick=J,X.setImmediate=V?J:X.nextTick,X.forEach=X.each=function(e,t,n){return X.eachOf(e,T(t),n)},X.forEachSeries=X.eachSeries=function(e,t,n){return X.eachOfSeries(e,T(t),n)},X.forEachLimit=X.eachLimit=function(e,t,n,r){return E(t)(e,T(n),r)},X.forEachOf=X.eachOf=function(e,t,n){function r(e){o--,e?n(e):null===i&&o<=0&&n(null)}n=p(n||a),e=e||[];for(var i,s=_(e),o=0;null!=(i=s());)o+=1,t(e[i],i,d(r));0===o&&n(null)},X.forEachOfSeries=X.eachOfSeries=function(e,t,n){function r(){var o=!0;if(null===s)return n(null);t(e[s],s,d(function(e){if(e)n(e);else{if(null===(s=i()))return n(null);o?X.setImmediate(r):r()}})),o=!1}n=p(n||a),e=e||[];var i=_(e),s=i();r()},X.forEachOfLimit=X.eachOfLimit=function(e,t,n,r){E(t)(e,n,r)},X.map=w(x),X.mapSeries=C(x),X.mapLimit=R(x),X.inject=X.foldl=X.reduce=function(e,t,n,r){X.eachOfSeries(e,function(e,r,i){n(t,e,function(e,n){t=n,i(e)})},function(e){r(e,t)})},X.foldr=X.reduceRight=function(e,t,n,r){var i=m(e,c).reverse();X.reduce(i,t,n,r)},X.transform=function(e,t,n,r){3===arguments.length&&(r=n,n=t,t=F(e)?[]:{}),X.eachOf(e,function(e,r,i){n(t,e,r,i)},function(e){r(e,t)})},X.select=X.filter=w(A),X.selectLimit=X.filterLimit=R(A),X.selectSeries=X.filterSeries=C(A),X.reject=w(I),X.rejectLimit=R(I),X.rejectSeries=C(I),X.any=X.some=N(X.eachOf,u,c),X.someLimit=N(X.eachOfLimit,u,c),X.all=X.every=N(X.eachOf,l,l),X.everyLimit=N(X.eachOfLimit,l,l),X.detect=N(X.eachOf,c,O),X.detectSeries=N(X.eachOfSeries,c,O),X.detectLimit=N(X.eachOfLimit,c,O),X.sortBy=function(e,t,n){function r(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}X.map(e,function(e,n){t(e,function(t,r){t?n(t):n(null,{value:e,criteria:r})})},function(e,t){if(e)return n(e);n(null,m(t.sort(r),function(e){return e.value}))})},X.auto=function(e,t,n){function r(e){f.unshift(e)}function i(e){var t=y(f,e);t>=0&&f.splice(t,1)}function s(){c--,h(f.slice(0),function(e){e()})}"function"==typeof arguments[1]&&(n=t,t=null),n=p(n||a);var o=G(e),c=o.length;if(!c)return n(null);t||(t=c);var u={},l=0,d=!1,f=[];r(function(){c||n(null,u)}),h(o,function(o){function a(){return l<t&&v(m,function(e,t){return e&&u.hasOwnProperty(t)},!0)&&!u.hasOwnProperty(o)}function c(){a()&&(l++,i(c),f[f.length-1](h,u))}if(!d){for(var p,f=F(e[o])?e[o]:[e[o]],h=S(function(e,t){if(l--,t.length<=1&&(t=t[0]),e){var r={};b(u,function(e,t){r[t]=e}),r[o]=t,d=!0,n(e,r)}else u[o]=t,X.setImmediate(s)}),m=f.slice(0,f.length-1),g=m.length;g--;){if(!(p=e[m[g]]))throw new Error("Has nonexistent dependency in "+m.join(", "));if(F(p)&&y(p,o)>=0)throw new Error("Has cyclic dependencies")}a()?(l++,f[f.length-1](h,u)):r(c)}})},X.retry=function(e,t,n){function r(e,t){for(;a.times;){var n=!(a.times-=1);o.push(function(e,n){return function(r){e(function(e,t){r(!e||n,{err:e,result:t})},t)}}(a.task,n)),!n&&a.interval>0&&o.push(function(e){return function(t){setTimeout(function(){t(null)},e)}}(a.interval))}X.series(o,function(t,n){n=n[n.length-1],(e||a.callback)(n.err,n.result)})}var i=5,s=0,o=[],a={times:i,interval:s},c=arguments.length;if(c<1||c>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return c<=2&&"function"==typeof e&&(n=t,t=e),"function"!=typeof e&&function(e,t){if("number"==typeof t)e.times=parseInt(t,10)||i;else{if("object"!=typeof t)throw new Error("Unsupported argument type for 'times': "+typeof t);e.times=parseInt(t.times,10)||i,e.interval=parseInt(t.interval,10)||s}}(a,e),a.callback=n,a.task=t,a.callback?r():r},X.waterfall=function(e,t){function n(e){return S(function(r,i){if(r)t.apply(null,[r].concat(i));else{var s=e.next();s?i.push(n(s)):i.push(t),L(e).apply(null,i)}})}if(t=p(t||a),!F(e)){var r=new Error("First argument to waterfall must be an array of functions");return t(r)}if(!e.length)return t();n(X.iterator(e))()},X.parallel=function(e,t){D(X.eachOf,e,t)},X.parallelLimit=function(e,t,n){D(E(t),e,n)},X.series=function(e,t){D(X.eachOfSeries,e,t)},X.iterator=function(e){function t(n){function r(){return e.length&&e[n].apply(null,arguments),r.next()}return r.next=function(){return n<e.length-1?t(n+1):null},r}return t(0)},X.apply=S(function(e,t){return S(function(n){return e.apply(null,t.concat(n))})}),X.concat=w(P),X.concatSeries=C(P),X.whilst=function(e,t,n){if(n=n||a,e()){var r=S(function(i,s){i?n(i):e.apply(this,s)?t(r):n.apply(null,[null].concat(s))});t(r)}else n(null)},X.doWhilst=function(e,t,n){var r=0;return X.whilst(function(){return++r<=1||t.apply(this,arguments)},e,n)},X.until=function(e,t,n){return X.whilst(function(){return!e.apply(this,arguments)},t,n)},X.doUntil=function(e,t,n){return X.doWhilst(e,function(){return!t.apply(this,arguments)},n)},X.during=function(e,t,n){n=n||a;var r=S(function(t,r){t?n(t):(r.push(i),e.apply(this,r))}),i=function(e,i){e?n(e):i?t(r):n(null)};e(i)},X.doDuring=function(e,t,n){var r=0;X.during(function(e){r++<1?e(null,!0):t.apply(this,arguments)},e,n)},X.queue=function(e,t){return M(function(t,n){e(t[0],n)},t,1)},X.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}function r(e,t,n){for(var r=-1,i=e.length-1;r<i;){var s=r+(i-r+1>>>1);n(t,e[s])>=0?r=s:i=s-1}return r}function i(e,t,i,s){if(null!=s&&"function"!=typeof s)throw new Error("task callback must be a function");if(e.started=!0,F(t)||(t=[t]),0===t.length)return X.setImmediate(function(){e.drain()});h(t,function(t){var o={data:t,priority:i,callback:"function"==typeof s?s:a};e.tasks.splice(r(e.tasks,o,n)+1,0,o),e.tasks.length===e.concurrency&&e.saturated(),X.setImmediate(e.process)})}var s=X.queue(e,t);return s.push=function(e,t,n){i(s,e,t,n)},delete s.unshift,s},X.cargo=function(e,t){return M(e,1,t)},X.log=U("log"),X.dir=U("dir"),X.memoize=function(e,t){var n={},r={},i=Object.prototype.hasOwnProperty;t=t||c;var s=S(function(s){var o=s.pop(),a=t.apply(null,s);i.call(n,a)?X.setImmediate(function(){o.apply(null,n[a])}):i.call(r,a)?r[a].push(o):(r[a]=[o],e.apply(null,s.concat([S(function(e){n[a]=e;var t=r[a];delete r[a];for(var i=0,s=t.length;i<s;i++)t[i].apply(null,e)})])))});return s.memo=n,s.unmemoized=e,s},X.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},X.times=k(X.map),X.timesSeries=k(X.mapSeries),X.timesLimit=function(e,t,n,r){return X.mapLimit(g(e),t,n,r)},X.seq=function(){var e=arguments;return S(function(t){var n=this,r=t[t.length-1];"function"==typeof r?t.pop():r=a,X.reduce(e,t,function(e,t,r){t.apply(n,e.concat([S(function(e,t){r(e,t)})]))},function(e,t){r.apply(n,[e].concat(t))})})},X.compose=function(){return X.seq.apply(null,Array.prototype.reverse.call(arguments))},X.applyEach=j(X.eachOf),X.applyEachSeries=j(X.eachOfSeries),X.forever=function(e,t){function n(e){if(e)return r(e);i(n)}var r=d(t||a),i=L(e);n()},X.ensureAsync=L,X.constant=S(function(e){var t=[null].concat(e);return function(e){return e.apply(this,t)}}),X.wrapSync=X.asyncify=function(e){return S(function(t){var n,r=t.pop();try{n=e.apply(this,t)}catch(e){return r(e)}H(n)&&"function"==typeof n.then?n.then(function(e){r(null,e)}).catch(function(e){r(e.message?e:new Error(e))}):r(null,n)})},"object"==typeof e&&e.exports?e.exports=X:(s=[],void 0!==(o=function(){return X}.apply(t,s))&&(e.exports=o))}()}).call(t,n(3),n(65).setImmediate,n(8))},function(e,t,n){"use strict";function r(e){return s[e]}function i(e){return o[e]}var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},o={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&quot;":'"',"&#34;":'"',"&apos;":"'","&#39;":"'"};t.escapeXML=function(e){return e.replace(/&|<|>|"|'/g,r)},t.unescapeXML=function(e){return e.replace(/&(amp|#38|lt|#60|gt|#62|quot|#34|apos|#39);/g,i)},t.escapeXMLText=function(e){return e.replace(/&|<|>/g,r)},t.unescapeXMLText=function(e){return e.replace(/&(amp|#38|lt|#60|gt|#62);/g,i)}},function(e,t,n){"use strict";(function(e){var r=n(1),i=r.Buffer,s=r.SlowBuffer,o=r.kMaxLength||2147483647;t.alloc=function(e,t,n){if("function"==typeof i.alloc)return i.alloc(e,t,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>o)throw new RangeError("size is too large");var r=n,s=t;void 0===s&&(r=void 0,s=0);var a=new i(e);if("string"==typeof s)for(var c=new i(s,r),u=c.length,l=-1;++l<e;)a[l]=c[l%u];else a.fill(s);return a},t.allocUnsafe=function(e){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>o)throw new RangeError("size is too large");return new i(e)},t.from=function(t,n,r){if("function"==typeof i.from&&(!e.Uint8Array||Uint8Array.from!==i.from))return i.from(t,n,r);if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("string"==typeof t)return new i(t,n);if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var s=n;if(1===arguments.length)return new i(t);void 0===s&&(s=0);var o=r;if(void 0===o&&(o=t.byteLength-s),s>=t.byteLength)throw new RangeError("'offset' is out of bounds");if(o>t.byteLength-s)throw new RangeError("'length' is out of bounds");return new i(t.slice(s,s+o))}if(i.isBuffer(t)){var a=new i(t.length);return t.copy(a,0,0,t.length),a}if(t){if(Array.isArray(t)||"undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return new i(t);if("Buffer"===t.type&&Array.isArray(t.data))return new i(t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},t.allocUnsafeSlow=function(e){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=o)throw new RangeError("size is too large");return new s(e)}}).call(t,n(3))},function(e,t,n){(function(t){function r(e){i.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._decoder=null,this._encoding=null}var i=n(64).Transform,s=n(2),o=n(35).StringDecoder;e.exports=r,s(r,i),r.prototype.update=function(e,n,r){"string"==typeof e&&(e=new t(e,n));var i=this._update(e);return this.hashMode?this:(r&&(i=this._toString(i,r)),i)},r.prototype.setAutoPadding=function(){},r.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},r.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},r.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},r.prototype._transform=function(e,t,n){var r;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){r=e}finally{n(r)}},r.prototype._flush=function(e){var t;try{this.push(this._final())}catch(e){t=e}finally{e(t)}},r.prototype._finalOrDigest=function(e){var n=this._final()||new t("");return e&&(n=this._toString(n,e,!0)),n},r.prototype._toString=function(e,t,n){if(this._decoder||(this._decoder=new o(t),this._encoding=t),this._encoding!==t)throw new Error("can't switch encodings");var r=this._decoder.write(e);return n&&(r+=this._decoder.end()),r}}).call(t,n(1).Buffer)},function(e,t,n){"use strict";(function(t){function r(e){u.call(this,"digest"),this._hash=e,this.buffers=[]}function i(e){u.call(this,"digest"),this._hash=e}var s=n(2),o=n(38),a=n(56),c=n(60),u=n(22);s(r,u),r.prototype._update=function(e){this.buffers.push(e)},r.prototype._final=function(){var e=t.concat(this.buffers),n=this._hash(e);return this.buffers=null,n},s(i,u),i.prototype._update=function(e){this._hash.update(e)},i.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return e=e.toLowerCase(),"md5"===e?new r(o):new i("rmd160"===e||"ripemd160"===e?new a:c(e))}}).call(t,n(1).Buffer)},function(e,t){var n=[],r=n.forEach,i=n.slice;e.exports=function(e){return r.call(i.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e}},function(e,t,n){var r=n(23),i=n(39),s=n(82),o={md2:"md2",md5:"md5","sha-1":"sha1","sha-224":"sha224","sha-256":"sha256","sha-384":"sha384","sha-512":"sha512"},a=Object.keys(o);t.getHashes=function(){for(var e=[],t=s(),n=0,r=a.length;n<r;n++)t.indexOf(o[a[n]])>=0&&e.push(a[n]);return e},t.createHash=function(e){return e=e.toLowerCase(),o[e]&&(e=o[e]),r(e)},t.createHmac=function(e,t){return e=e.toLowerCase(),o[e]&&(e=o[e]),i(e,t)}},function(e,t,n){function r(e){c.call(this);var t=this;this.sid=e.sid||s.v4(),this.peer=e.peer,this.peerID=e.peerID||this.peer.full||this.peer,this.isInitiator=e.initiator||!1,this.parent=e.parent,this.state="starting",this.connectionState="starting",this.pendingApplicationTypes=e.applicationTypes||[],this.pendingAction=!1,this.processingQueue=o.queue(function(e,n){if(t.ended)return n();var r=e.action,i=e.changes,s=e.cb;if(t._log("debug",r),!u[r])return t._log("error","Invalid action: "+r),s({condition:"bad-request"}),n();t[u[r]](i,function(e,t){return s(e,t),n()})})}var i=n(6),s=n(36),o=n(19),a=n(24),c=n(9),u={"content-accept":"onContentAccept","content-add":"onContentAdd","content-modify":"onContentModify","content-reject":"onContentReject","content-remove":"onContentRemove","description-info":"onDescriptionInfo","security-info":"onSecurityInfo","session-accept":"onSessionAccept","session-info":"onSessionInfo","session-initiate":"onSessionInitiate","session-terminate":"onSessionTerminate","transport-accept":"onTransportAccept","transport-info":"onTransportInfo","transport-reject":"onTransportReject","transport-replace":"onTransportReplace","source-add":"onSourceAdd","source-remove":"onSourceRemove"};i.inherits(r,c),Object.keys(u).forEach(function(e){var t=u[e];r.prototype[t]=function(t,n){this._log("error","Unsupported action: "+e),n()}}),Object.defineProperties(r.prototype,{state:{get:function(){return this._sessionState},set:function(e){if(e!==this._sessionState){var t=this._sessionState;this._log("info","Changing session state to: "+e),this._sessionState=e,this.emit("change:sessionState",this,e),this.emit("change:"+e,this,!0),t&&this.emit("change:"+t,this,!1)}}},connectionState:{get:function(){return this._connectionState},set:function(e){if(e!==this._connectionState){var t=this._connectionState;this._log("info","Changing connection state to: "+e),this._connectionState=e,this.emit("change:connectionState",this,e),this.emit("change:"+e,this,!0),t&&this.emit("change:"+t,this,!1)}}},starting:{get:function(){return"starting"===this._sessionState}},pending:{get:function(){return"pending"===this._sessionState}},active:{get:function(){return"active"===this._sessionState}},ended:{get:function(){return"ended"===this._sessionState}},connected:{get:function(){return"connected"===this._connectionState}},connecting:{get:function(){return"connecting"===this._connectionState}},disconnected:{get:function(){return"disconnected"===this._connectionState}},interrupted:{get:function(){return"interrupted"===this._connectionState}}}),r.prototype=a(r.prototype,{_log:function(e,t){t=this.sid+": "+t,this.emit("log:"+e,t)},send:function(e,t){t=t||{},t.sid=this.sid,t.action=e;var n={"session-inititate":!0,"session-accept":!0,"content-add":!0,"content-remove":!0,"content-reject":!0,"content-accept":!0,"content-modify":!0,"transport-replace":!0,"transport-reject":!0,"transport-accept":!0,"source-add":!0,"source-remove":!0};this.pendingAction=!!n[e]&&e,this.emit("send",{to:this.peer,id:s.v4(),type:"set",jingle:t})},process:function(e,t,n){this.processingQueue.push({action:e,changes:t,cb:n})},start:function(){this._log("error","Can not start base sessions"),this.end("unsupported-applications",!0)},accept:function(){this._log("error","Can not accept base sessions"),this.end("unsupported-applications")},cancel:function(){this.end("cancel")},decline:function(){this.end("decline")},end:function(e,t){this.state="ended",this.processingQueue.kill(),e||(e="success"),"string"==typeof e&&(e={condition:e}),t||this.send("session-terminate",{reason:e}),this.emit("terminated",this,e)},onSessionTerminate:function(e,t){this.end(e.reason,!0),t()},onSessionInfo:function(e,t){var n={sid:!0,action:!0,initiator:!0,responder:!0},r=!1;Object.keys(e).forEach(function(e){n[e]||(r=!0)}),r?t({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"}):t()},onDescriptionInfo:function(e,t){t({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})},onTransportInfo:function(e,t){t({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})},onContentAdd:function(e,t){t(),this.send("content-reject",{reason:{condition:"failed-application",text:"content-add is not supported"}})},onTransportReplace:function(e,t){t(),this.send("transport-reject",{reason:{condition:"failed-application",text:"transport-replace is not supported"}})}}),e.exports=r},function(e,t,n){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){"use strict";function r(){this._LOOKUP={},this._LOOKUP_EXT={},this._TAGS={},this._CB_DEFINITION={},this._CB_TAG={},this._ID=s.v4(),this.utils=i({},o,a)}var i=n(12),s=n(36),o=n(170),a=n(29),c=n(169);r.prototype.use=function(e){return e["__JXT_LOADED_"+this._ID]||e(this),e["__JXT_LOADED_"+this._ID]=!0,this},r.prototype.getDefinition=function(e,t,n){var r=this._LOOKUP[t+"|"+e];if(n&&!r)throw new Error("Could not find definition for <"+e+' xmlns="'+t+'" />');return r},r.prototype.getExtensions=function(e,t){return this._LOOKUP_EXT[t+"|"+e]||{}},r.prototype.withDefinition=function(e,t,n){var r=t+"|"+e;this._CB_DEFINITION[r]||(this._CB_DEFINITION[r]=[]),this._CB_DEFINITION[r].push(n),this._LOOKUP[r]&&n(this._LOOKUP[r])},r.prototype.withTag=function(e,t){this._CB_TAG[e]||(this._CB_TAG[e]=[]),this._CB_TAG[e].push(t),this.tagged(e).forEach(function(e){t(e)})},r.prototype.tagged=function(e){return this._TAGS[e]||[]},r.prototype.build=function(e){var t=this.getDefinition(e.localName,e.namespaceURI);if(t)return new t(null,e)},r.prototype.parse=function(e){var t=a.parse(e);if(t)return this.build(t)},r.prototype.extend=function(e,t,n,r){var i=e.prototype._NS+"|"+e.prototype._EL,s=t.prototype._name,a=t.prototype._NS+"|"+t.prototype._EL;this._LOOKUP[a]=t,this._LOOKUP_EXT[a]||(this._LOOKUP_EXT[a]={}),this._LOOKUP_EXT[i]||(this._LOOKUP_EXT[i]={}),this._LOOKUP_EXT[i][s]=t,(!n||n&&!r)&&this.add(e,s,o.extension(t)),n&&this.add(e,n,o.multiExtension(t))},r.prototype.add=function(e,t,n){n.enumerable=!0,Object.defineProperty(e.prototype,t,n)},r.prototype.define=function(e){var t=this,n=c(this,e),r=n.prototype._NS,i=n.prototype._EL,s=n.prototype._TAGS,o=r+"|"+i;return this._LOOKUP[o]=n,s.forEach(function(e){t._TAGS[e]||(t._TAGS[e]=[]),t._TAGS[e].push(n)}),Object.keys(e.fields||{}).forEach(function(r){t.add(n,r,e.fields[r])}),this._CB_DEFINITION[o]&&this._CB_DEFINITION[o].forEach(function(e){e(n)}),s.forEach(function(e){t._CB_TAG[e]&&t._CB_TAG[e].forEach(function(e){e(n)})}),n},r.createRegistry=function(){return new r},i(r,a),i(r,o);var u=new r;r.define=u.define.bind(u),r.extend=u.extend.bind(u),r.add=u.add.bind(u),r.parse=u.parse.bind(u),r.build=u.build.bind(u),r.getExtensions=u.getExtensions.bind(u),r.getDefinition=u.getDefinition.bind(u),r.withDefinition=u.withDefinition.bind(u),r.withTag=u.withTag.bind(u),r.tagged=u.tagged.bind(u),r.getGlobalJXT=function(){return u},e.exports=r},function(e,t,n){"use strict";var r=n(188),i=n(189),s=t.XML_NS="http://www.w3.org/XML/1998/namespace";t.parse=function(e){var t=r.parse(e,{Element:i});if(1===t.nodeType)return t},t.createElement=function(e,n,r){var s=new i(n);return r&&r===e||t.setAttribute(s,"xmlns",e),s};var o=t.find=function(e,t,n){for(var r=[],i=e.getElementsByTagName(n),s=0,o=i.length;s<o;s++){var a=i[s];a.namespaceURI===t&&a.parentNode===e&&r.push(a)}return r};t.findOrCreate=function(e,n,r){var i=t.find(e,n,r);if(i.length)return i[0];var s=t.createElement(n,r,e.namespaceURI);return e.appendChild(s),s},t.getAttribute=function(e,t,n){return e.getAttribute(t)||n||""},t.getAttributeNS=function(e,t,n,r){return e.getAttributeNS(t,n)||r||""},t.setAttribute=function(e,t,n,r){n||r?e.setAttribute(t,n):e.removeAttribute(t)},t.setAttributeNS=function(e,t,n,r,i){r||i?e.setAttributeNS(t,n,r):e.removeAttributeNS(t,n)},t.getBoolAttribute=function(e,t,n){var r=e.getAttribute(t)||n||"";return"true"===r||"1"===r},t.setBoolAttribute=function(e,t,n){n?e.setAttribute(t,"1"):e.removeAttribute(t)},t.getSubAttribute=function(e,t,n,r,i){var s=o(e,t,n);if(!s)return"";for(var a=0;a<s.length;a++)return s[a].getAttribute(r)||i||"";return""},t.setSubAttribute=function(e,n,r,i,s){var a=o(e,n,r);if(a.length)for(var c=0;c<a.length;c++){if(s)return void a[c].setAttribute(i,s);a[c].removeAttribute(i)}else s&&(r=t.createElement(n,r,e.namespaceURI),r.setAttribute(i,s),e.appendChild(r))},t.getBoolSubAttribute=function(e,t,n,r,i){var s=e.getSubAttribute(t,n,r)||i||"";return"true"===s||"1"===s},t.setBoolSubAttribute=function(e,n,r,i,s){s=s?"1":"",t.setSubAttribute(e,n,r,i,s)},t.getText=function(e){return e.textContent},t.setText=function(e,t){e.textContent=t},t.getSubText=t.getTextSub=function(e,t,n,r){var i=o(e,t,n);return r=r||"",i.length?i[0].textContent||r:r},t.setSubText=t.setTextSub=function(e,n,r,i){var s=o(e,n,r);if(s.length)for(var a=0;a<s.length;a++)e.removeChild(s[a]);if(i){var c=t.createElement(n,r,e.namespaceURI);!0!==i&&(c.textContent=i),e.appendChild(c)}},t.getMultiSubText=function(e,t,n,r){var i=o(e,t,n),s=[];r=r||function(e){return e.textContent||""};for(var a=0;a<i.length;a++)s.push(r(i[a]));return s},t.setMultiSubText=function(e,n,r,i,s){var a=o(e,n,r),c=[];s=s||function(i){if(i){var s=t.createElement(n,r,e.namespaceURI);s.textContent=i,e.appendChild(s)}},c="string"==typeof i?(i||"").split("\n"):i;var u,l;for(u=0,l=a.length;u<l;u++)e.removeChild(a[u]);for(u=0,l=c.length;u<l;u++)s(c[u])},t.getMultiSubAttribute=function(e,n,r,i){return t.getMultiSubText(e,n,r,function(e){return t.getAttribute(e,i)})},t.setMultiSubAttribute=function(e,n,r,i,s){t.setMultiSubText(e,n,r,s,function(s){var o=t.createElement(n,r,e.namespaceURI);t.setAttribute(o,i,s),e.appendChild(o)})},t.getSubLangText=function(e,t,n,r){var i=o(e,t,n);if(!i.length)return{};for(var a,c,u={},l=[],d=0;d<i.length;d++)c=i[d],a=c.getAttributeNS(s,"lang")||r,l.push(a),u[a]=c.textContent||"";return u},t.setSubLangText=function(e,n,r,i,a){var c,u,l=o(e,n,r);if(l.length)for(var d=0;d<l.length;d++)e.removeChild(l[d]);if("string"==typeof i)c=t.createElement(n,r,e.namespaceURI),c.textContent=i,e.appendChild(c);else if("object"==typeof i)for(u in i)i.hasOwnProperty(u)&&(c=t.createElement(n,r,e.namespaceURI),u!==a&&c.setAttributeNS(s,"lang",u),c.textContent=i[u],e.appendChild(c))},t.getBoolSub=function(e,t,n){return!!o(e,t,n).length},t.setBoolSub=function(e,n,r,i){var s=o(e,n,r);if(s.length)for(var a=0;a<s.length;a++){if(i)return;e.removeChild(s[a])}else if(i){var c=t.createElement(n,r,e.namespaceURI);e.appendChild(c)}}},function(e,t){function n(e,t,n){if("function"!=typeof e)return r;if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)};case 5:return function(n,r,i,s,o){return e.call(t,n,r,i,s,o)}}return function(){return e.apply(t,arguments)}}function r(e){return e}e.exports=n},function(e,t,n){"use strict";(function(t){function n(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,i)});default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return t.nextTick(function(){e.apply(null,s)})}}!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports=n:e.exports=t.nextTick}).call(t,n(8))},function(e,t,n){"use strict";(function(t,n,r){function i(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}function s(e,i){if(e>65536)throw new Error("requested too many random bytes");var s=new t.Uint8Array(e);e>0&&o.getRandomValues(s);var a=new n(s.buffer);return"function"==typeof i?r.nextTick(function(){i(null,a)}):a}var o=t.crypto||t.msCrypto;o&&o.getRandomValues?e.exports=s:e.exports=i}).call(t,n(3),n(1).Buffer,n(8))},function(e,t,n){"use strict";(function(t,r){function i(){}function s(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function o(e,t){w=w||n(11),e=e||{},this.objectMode=!!e.objectMode,t instanceof w&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var s=!1===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){m(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new E(this)}function a(e){if(w=w||n(11),!(D.call(a,this)||this instanceof w))return new a(e);this._writableState=new o(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),I.call(this)}function c(e,t){var n=new Error("write after end");e.emit("error",n),R(t,n)}function u(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),R(r,s),i=!1),i}function l(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=O.from(t,n)),t}function d(e,t,n,r,i,o){n||(r=l(t,r,i),N.isBuffer(r)&&(i="buffer"));var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new s(r,i,o),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else p(e,t,!1,a,r,i,o);return c}function p(e,t,n,r,i,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function f(e,t,n,r,i){--t.pendingcb,n?R(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function h(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function m(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(h(n),t)f(e,n,r,t,i);else{var s=y(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||b(e,n),r?C(g,e,n,s,i):g(e,n,s,i)}}function g(e,t,n,r){n||v(e,t),t.pendingcb--,r(),S(e,t)}function v(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function b(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var o=0;n;)i[o]=n,n=n.next,o+=1;p(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new E(t)}else{for(;n;){var a=n.chunk,c=n.encoding,u=n.callback;if(p(e,t,!1,t.objectMode?1:a.length,a,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function _(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function S(e,t){var n=y(t);return n&&(0===t.pendingcb?(_(e,t),t.finished=!0,e.emit("finish")):_(e,t)),n}function T(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?R(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function E(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}e.exports=a;var w,R=n(31),C=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:R;a.WritableState=o;var x=n(16);x.inherits=n(2);var A={deprecate:n(318)},I=n(55),N=n(1).Buffer,O=n(21);x.inherits(a,I),o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:A.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var D;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(D=Function.prototype[Symbol.hasInstance],Object.defineProperty(a,Symbol.hasInstance,{value:function(e){return!!D.call(this,e)||e&&e._writableState instanceof o}})):D=function(e){return e instanceof this},a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},a.prototype.write=function(e,t,n){var r=this._writableState,s=!1,o=N.isBuffer(e);return"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=i),r.ended?c(this,n):(o||u(this,r,e,n))&&(r.pendingcb++,s=d(this,r,o,e,t,n)),s},a.prototype.cork=function(){this._writableState.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||b(this,e))},a.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},a.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||T(this,r,n)}}).call(t,n(8),n(65).setImmediate)},function(e,t,n){t=e.exports=n(53),t.Stream=t,t.Readable=t,t.Writable=n(33),t.Duplex=n(11),t.Transform=n(54),t.PassThrough=n(198)},function(e,t,n){function r(e){if(e&&!c(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function s(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function o(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var a=n(1).Buffer,c=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=o;break;default:return void(this.write=i)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,i)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},function(e,t,n){function r(e,t,n){var r=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[r+i++]=u[e])});i<16;)t[r+i++]=0;return t}function i(e,t){var n=t||0,r=c;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function s(e,t,n){var r=t&&n||0,s=t||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:f,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:m+1,u=a-h+(c-m)/1e4;if(u<0&&void 0===e.clockseq&&(o=o+1&16383),(u<0||a>h)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=a,m=c,f=o,a+=122192928e5;var l=(1e4*(268435455&a)+c)%4294967296;s[r++]=l>>>24&255,s[r++]=l>>>16&255,s[r++]=l>>>8&255,s[r++]=255&l;var d=a/4294967296*1e4&268435455;s[r++]=d>>>8&255,s[r++]=255&d,s[r++]=d>>>24&15|16,s[r++]=d>>>16&255,s[r++]=o>>>8|128,s[r++]=255&o;for(var g=e.node||p,v=0;v<6;v++)s[r+v]=g[v];return t||i(s)}function o(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||a)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;o++)t[r+o]=s[o];return t||i(s)}for(var a=n(321),c=[],u={},l=0;l<256;l++)c[l]=(l+256).toString(16).substr(1),u[c[l]]=l;var d=a(),p=[1|d[0],d[1],d[2],d[3],d[4],d[5]],f=16383&(d[6]<<8|d[7]),h=0,m=0,g=o;g.v1=s,g.v4=o,g.parse=r,g.unparse=i,e.exports=g},function(e,t){},function(e,t,n){"use strict";function r(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,l=271733878,d=0;d<e.length;d+=16){var p=n,f=r,h=i,m=l;n=s(n,r,i,l,e[d+0],7,-680876936),l=s(l,n,r,i,e[d+1],12,-389564586),i=s(i,l,n,r,e[d+2],17,606105819),r=s(r,i,l,n,e[d+3],22,-1044525330),n=s(n,r,i,l,e[d+4],7,-176418897),l=s(l,n,r,i,e[d+5],12,1200080426),i=s(i,l,n,r,e[d+6],17,-1473231341),r=s(r,i,l,n,e[d+7],22,-45705983),n=s(n,r,i,l,e[d+8],7,1770035416),l=s(l,n,r,i,e[d+9],12,-1958414417),i=s(i,l,n,r,e[d+10],17,-42063),r=s(r,i,l,n,e[d+11],22,-1990404162),n=s(n,r,i,l,e[d+12],7,1804603682),l=s(l,n,r,i,e[d+13],12,-40341101),i=s(i,l,n,r,e[d+14],17,-1502002290),r=s(r,i,l,n,e[d+15],22,1236535329),n=o(n,r,i,l,e[d+1],5,-165796510),l=o(l,n,r,i,e[d+6],9,-1069501632),i=o(i,l,n,r,e[d+11],14,643717713),r=o(r,i,l,n,e[d+0],20,-373897302),n=o(n,r,i,l,e[d+5],5,-701558691),l=o(l,n,r,i,e[d+10],9,38016083),i=o(i,l,n,r,e[d+15],14,-660478335),r=o(r,i,l,n,e[d+4],20,-405537848),n=o(n,r,i,l,e[d+9],5,568446438),l=o(l,n,r,i,e[d+14],9,-1019803690),i=o(i,l,n,r,e[d+3],14,-187363961),r=o(r,i,l,n,e[d+8],20,1163531501),n=o(n,r,i,l,e[d+13],5,-1444681467),l=o(l,n,r,i,e[d+2],9,-51403784),i=o(i,l,n,r,e[d+7],14,1735328473),r=o(r,i,l,n,e[d+12],20,-1926607734),n=a(n,r,i,l,e[d+5],4,-378558),l=a(l,n,r,i,e[d+8],11,-2022574463),i=a(i,l,n,r,e[d+11],16,1839030562),r=a(r,i,l,n,e[d+14],23,-35309556),n=a(n,r,i,l,e[d+1],4,-1530992060),l=a(l,n,r,i,e[d+4],11,1272893353),i=a(i,l,n,r,e[d+7],16,-155497632),r=a(r,i,l,n,e[d+10],23,-1094730640),n=a(n,r,i,l,e[d+13],4,681279174),l=a(l,n,r,i,e[d+0],11,-358537222),i=a(i,l,n,r,e[d+3],16,-722521979),r=a(r,i,l,n,e[d+6],23,76029189),n=a(n,r,i,l,e[d+9],4,-640364487),l=a(l,n,r,i,e[d+12],11,-421815835),i=a(i,l,n,r,e[d+15],16,530742520),r=a(r,i,l,n,e[d+2],23,-995338651),n=c(n,r,i,l,e[d+0],6,-198630844),l=c(l,n,r,i,e[d+7],10,1126891415),i=c(i,l,n,r,e[d+14],15,-1416354905),r=c(r,i,l,n,e[d+5],21,-57434055),n=c(n,r,i,l,e[d+12],6,1700485571),l=c(l,n,r,i,e[d+3],10,-1894986606),i=c(i,l,n,r,e[d+10],15,-1051523),r=c(r,i,l,n,e[d+1],21,-2054922799),n=c(n,r,i,l,e[d+8],6,1873313359),l=c(l,n,r,i,e[d+15],10,-30611744),i=c(i,l,n,r,e[d+6],15,-1560198380),r=c(r,i,l,n,e[d+13],21,1309151649),n=c(n,r,i,l,e[d+4],6,-145523070),l=c(l,n,r,i,e[d+11],10,-1120210379),i=c(i,l,n,r,e[d+2],15,718787259),r=c(r,i,l,n,e[d+9],21,-343485551),n=u(n,p),r=u(r,f),i=u(i,h),l=u(l,m)}return[n,r,i,l]}function i(e,t,n,r,i,s){return u(l(u(u(t,e),u(r,s)),i),n)}function s(e,t,n,r,s,o,a){return i(t&n|~t&r,e,t,s,o,a)}function o(e,t,n,r,s,o,a){return i(t&r|n&~r,e,t,s,o,a)}function a(e,t,n,r,s,o,a){return i(t^n^r,e,t,s,o,a)}function c(e,t,n,r,s,o,a){return i(n^(t|~r),e,t,s,o,a)}function u(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function l(e,t){return e<<t|e>>>32-t}var d=n(73);e.exports=function(e){return d(e,r)}},function(e,t,n){"use strict";function r(e,t){o.call(this,"digest"),"string"==typeof t&&(t=a.from(t));var n="sha512"===e||"sha384"===e?128:64;if(this._alg=e,this._key=t,t.length>n){t=("rmd160"===e?new u:l(e)).update(t).digest()}else t.length<n&&(t=a.concat([t,d],n));for(var r=this._ipad=a.allocUnsafe(n),i=this._opad=a.allocUnsafe(n),s=0;s<n;s++)r[s]=54^t[s],i[s]=92^t[s];this._hash="rmd160"===e?new u:l(e),this._hash.update(r)}var i=n(2),s=n(74),o=n(22),a=n(58).Buffer,c=n(38),u=n(56),l=n(60),d=a.alloc(128);i(r,o),r.prototype._update=function(e){this._hash.update(e)},r.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new u:l(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return e=e.toLowerCase(),"rmd160"===e||"ripemd160"===e?new r("rmd160",t):"md5"===e?new s(c,t):new r(e,t)}},function(e,t){function n(e){var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}e.exports=n;var r=Object.prototype.toString},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){var n=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(e,t,n){function r(e){return null==e?"":e+""}function i(e,t,n){var r=typeof e;return"function"==r?void 0===t?e:T(e,t,n):null==e?y:"object"==r?a(e):void 0===t?_(e):c(e,t)}function s(e,t,n){if(null!=e){void 0!==n&&n in m(e)&&(t=[n]);for(var r=0,i=t.length;null!=e&&r<i;)e=e[t[r++]];return r&&r==i?e:void 0}}function o(e,t,n){var r=t.length,i=r,s=!n;if(null==e)return!i;for(e=m(e);r--;){var o=t[r];if(s&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++r<i;){o=t[r];var a=o[0],c=e[a],u=o[1];if(s&&o[2]){if(void 0===c&&!(a in e))return!1}else{var l=n?n(c,u,a):void 0;if(!(void 0===l?S(u,c,n,!0):l))return!1}}return!0}function a(e){var t=p(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null!=e&&(e[n]===r&&(void 0!==r||n in m(e)))}}return function(e){return o(e,t)}}function c(e,t){var n=E(e),r=f(e)&&h(t),i=e+"";return e=g(e),function(o){if(null==o)return!1;var a=i;if(o=m(o),(n||!r)&&!(a in o)){if(null==(o=1==e.length?o:s(o,d(e,0,-1))))return!1;a=v(e),o=m(o)}return o[a]===t?void 0!==t||a in o:S(t,o[a],void 0,!0)}}function u(e){return function(t){return null==t?void 0:t[e]}}function l(e){var t=e+"";return e=g(e),function(n){return s(n,e,t)}}function d(e,t,n){var r=-1,i=e.length;t=null==t?0:+t||0,t<0&&(t=-t>i?0:i+t),n=void 0===n||n>i?i:+n||0,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function p(e){for(var t=w(e),n=t.length;n--;)t[n][2]=h(t[n][1]);return t}function f(e,t){var n=typeof e;return!!("string"==n&&C.test(e)||"number"==n)||!E(e)&&(!R.test(e)||null!=t&&e in m(t))}function h(e){return e===e&&!b(e)}function m(e){return b(e)?e:Object(e)}function g(e){if(E(e))return e;var t=[];return r(e).replace(x,function(e,n,r,i){t.push(r?i.replace(A,"$1"):n||e)}),t}function v(e){var t=e?e.length:0;return t?e[t-1]:void 0}function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){return e}function _(e){return f(e)?u(e):l(e)}var S=n(177),T=n(30),E=n(14),w=n(185),R=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,C=/^\w*$/,x=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,A=/\\(\\)?/g;e.exports=i},function(e,t,n){function r(e,t){return l(e,t,a)}function i(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=c}function s(e){return o(e)?e:Object(e)}function o(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var a=n(17),c=9007199254740991,u=function(e,t){return function(n,r){var o=n?d(n):0;if(!i(o))return e(n,r);for(var a=t?o:-1,c=s(n);(t?a--:++a<o)&&!1!==r(c[a],a,c););return n}}(r),l=function(e){return function(t,n,r){for(var i=s(t),o=r(t),a=o.length,c=e?a:-1;e?c--:++c<a;){var u=o[c];if(!1===n(i[u],u,i))break}return t}}(),d=function(e){return function(t){return null==t?void 0:t[e]}}("length");e.exports=u},function(e,t){function n(e){return!!e&&"object"==typeof e}function r(e,t){var n=null==e?void 0:e[t];return o(n)?n:void 0}function i(e){return s(e)&&p.call(e)==a}function s(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function o(e){return null!=e&&(i(e)?f.test(l.call(e)):n(e)&&c.test(e))}var a="[object Function]",c=/^\[object .+?Constructor\]$/,u=Object.prototype,l=Function.prototype.toString,d=u.hasOwnProperty,p=u.toString,f=RegExp("^"+l.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},function(e,t){function n(e){return null!=e&&s(u(e))}function r(e,t){return e="number"==typeof e||a.test(e)?+e:-1,t=null==t?c:t,e>-1&&e%1==0&&e<t}function i(e,t,i){if(!o(i))return!1;var s=typeof t;if("number"==s?n(i)&&r(t,i.length):"string"==s&&t in i){var a=i[t];return e===e?e===a:a!==a}return!1}function s(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=c}function o(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var a=/^\d+$/,c=9007199254740991,u=function(e){return function(t){return null==t?void 0:t[e]}}("length");e.exports=i},function(e,t,n){function r(e,t,n){var r=a(e)?i:o;return t=s(t,n,3),r(e,t)}var i=n(172),s=n(43),o=n(175),a=n(14);e.exports=r},function(e,t,n){"use strict";var r=n(10).EventEmitter,i=n(2),s=n(18),o=n(192),a=function(e){r.call(this);var t=this.Parser=e&&e.Parser||this.DefaultParser,n=this.Element=e&&e.Element||this.DefaultElement;this.parser=new t;var i,s=this;this.parser.on("startElement",function(e,t){var r=new n(e,t);i=i?i.cnode(r):r}),this.parser.on("endElement",function(e){i&&e===i.name&&(i.parent?i=i.parent:s.tree||(s.tree=i,i=void 0))}),this.parser.on("text",function(e){i&&i.t(e)}),this.parser.on("error",function(e){s.error=e,s.emit("error",e)})};i(a,r),a.prototype.DefaultParser=o,a.prototype.DefaultElement=s,a.prototype.write=function(e){this.parser.write(e)},a.prototype.end=function(e){this.parser.end(e),this.error||(this.tree?this.emit("tree",this.tree):this.emit("error",new Error("Incomplete document")))},e.exports=a},function(e,t,n){"use strict";e.exports=function(e){for(var t=new e.constructor(e.name,e.attrs),n=0;n<e.children.length;n++){var r=e.children[n];t.cnode(r.clone?r.clone():r)}return t}},function(e,t,n){"use strict";function r(e,t){return e.name===t.name}function i(e,t){var n=e.attrs,r=Object.keys(n),i=r.length;if(i!==Object.keys(t.attrs).length)return!1;for(var s=0,o=i;s<o;s++){var a=r[s],c=n[a];if(null==c||null==t.attrs[a]){if(c!==t.attrs[a])return!1}else if(c.toString()!==t.attrs[a].toString())return!1}return!0}function s(e,t){var n=e.children,r=n.length;if(r!==t.children.length)return!1;for(var i=0,s=r;i<s;i++){var o=n[i];if("string"==typeof o){if(o!==t.children[i])return!1}else if(!o.equals(t.children[i]))return!1}return!0}function o(e,t){return!!r(e,t)&&(!!i(e,t)&&!!s(e,t))}e.exports.name=r,e.exports.attrs=i,e.exports.children=s,e.exports.equal=o},function(e,t,n){"use strict";var r=n(48);e.exports=function(e,t){var n;n="function"==typeof t?new t:new r(t);var i=null,s=null;if(n.on("tree",function(e){i=e}),n.on("error",function(e){s=e}),n.write(e),n.end(),s)throw s;return i}},function(e,t,n){"use strict";var r=n(20).escapeXML;e.exports=function(){for(var e=arguments[0],t="",n=1;n<arguments.length;n++)t+=e[n-1],t+=r(arguments[n]);return t+=e[e.length-1]}},function(e,t,n){"use strict";(function(t){function r(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?N(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}function i(e,t){A=A||n(11),e=e||{},this.objectMode=!!e.objectMode,t instanceof A&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new $,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(L||(L=n(35).StringDecoder),this.decoder=new L(e.encoding),this.encoding=e.encoding)}function s(e){if(A=A||n(11),!(this instanceof s))return new s(e);this._readableState=new i(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),D.call(this)}function o(e,t,n,r,i){var s=l(t,n);if(s)e.emit("error",s);else if(null===n)t.reading=!1,d(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var o=new Error("stream.push() after EOF");e.emit("error",o)}else if(t.endEmitted&&i){var c=new Error("stream.unshift() after end event");e.emit("error",c)}else{var u;!t.decoder||i||r||(n=t.decoder.write(n),u=!t.objectMode&&0===n.length),i||(t.reading=!1),u||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&p(e))),h(e,t)}else i||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function c(e){return e>=q?e=q:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function u(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=c(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function l(e,t){var n=null;return P.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function d(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,p(e)}}function p(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(j("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?I(f,e):f(e))}function f(e){j("emit readable"),e.emit("readable"),_(e)}function h(e,t){t.readingMore||(t.readingMore=!0,I(m,e,t))}function m(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(j("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function g(e){return function(){var t=e._readableState;j("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&O(e,"data")&&(t.flowing=!0,_(e))}}function v(e){j("readable nexttick read 0"),e.read(0)}function b(e,t){t.resumeScheduled||(t.resumeScheduled=!0,I(y,e,t))}function y(e,t){t.reading||(j("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),_(e),t.flowing&&!t.reading&&e.read(0)}function _(e){var t=e._readableState;for(j("flow",t.flowing);t.flowing&&null!==e.read(););}function S(e,t){if(0===t.length)return null;var n;return t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=T(e,t.buffer,t.decoder),n}function T(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?E(e,t):w(e,t),r}function E(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(o===s.length?i+=s:i+=s.slice(0,e),0===(e-=o)){o===s.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++r}return t.length-=r,i}function w(e,t){var n=M.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,o),0===(e-=o)){o===s.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(o));break}++i}return t.length-=i,n}function R(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,I(C,t,e))}function C(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function x(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=s;var A,I=n(31),N=n(41);s.ReadableState=i;var O=(n(10).EventEmitter,function(e,t){return e.listeners(t).length}),D=n(55),P=n(1).Buffer,M=n(21),U=n(16);U.inherits=n(2);var k=n(338),j=void 0;j=k&&k.debuglog?k.debuglog("stream"):function(){};var L,$=n(199);U.inherits(s,D);var X=["error","close","destroy","pause","resume"];s.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=M.from(e,t),t=""),o(this,n,e,t,!1)},s.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},s.prototype.isPaused=function(){return!1===this._readableState.flowing},s.prototype.setEncoding=function(e){return L||(L=n(35).StringDecoder),this._readableState.decoder=new L(e),this._readableState.encoding=e,this};var q=8388608;s.prototype.read=function(e){j("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return j("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?R(this):p(this),null;if(0===(e=u(e,t))&&t.ended)return 0===t.length&&R(this),null;var r=t.needReadable;j("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,j("length less than watermark",r)),t.ended||t.reading?(r=!1,j("reading or ended",r)):r&&(j("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=u(n,t)));var i;return i=e>0?S(e,t):null,null===i?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&R(this)),null!==i&&this.emit("data",i),i},s.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},s.prototype.pipe=function(e,n){function i(e){j("onunpipe"),e===p&&o()}function s(){j("onend"),e.end()}function o(){j("cleanup"),e.removeListener("close",u),e.removeListener("finish",l),e.removeListener("drain",v),e.removeListener("error",c),e.removeListener("unpipe",i),p.removeListener("end",s),p.removeListener("end",o),p.removeListener("data",a),b=!0,!f.awaitDrain||e._writableState&&!e._writableState.needDrain||v()}function a(t){j("ondata"),y=!1,!1!==e.write(t)||y||((1===f.pipesCount&&f.pipes===e||f.pipesCount>1&&-1!==x(f.pipes,e))&&!b&&(j("false write response, pause",p._readableState.awaitDrain),p._readableState.awaitDrain++,y=!0),p.pause())}function c(t){j("onerror",t),d(),e.removeListener("error",c),0===O(e,"error")&&e.emit("error",t)}function u(){e.removeListener("finish",l),d()}function l(){j("onfinish"),e.removeListener("close",u),d()}function d(){j("unpipe"),p.unpipe(e)}var p=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=e;break;case 1:f.pipes=[f.pipes,e];break;default:f.pipes.push(e)}f.pipesCount+=1,j("pipe count=%d opts=%j",f.pipesCount,n);var h=(!n||!1!==n.end)&&e!==t.stdout&&e!==t.stderr,m=h?s:o;f.endEmitted?I(m):p.once("end",m),e.on("unpipe",i);var v=g(p);e.on("drain",v);var b=!1,y=!1;return p.on("data",a),r(e,"error",c),e.once("close",u),e.once("finish",l),e.emit("pipe",p),f.flowing||(j("pipe resume"),p.resume()),e},s.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var s=x(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},s.prototype.on=function(e,t){var n=D.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&p(this):I(v,this))}return n},s.prototype.addListener=s.prototype.on,s.prototype.resume=function(){var e=this._readableState;return e.flowing||(j("resume"),e.flowing=!0,b(this,e)),this},s.prototype.pause=function(){return j("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(j("pause"),this._readableState.flowing=!1,this.emit("pause")),this},s.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(j("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(j("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){r.push(i)||(n=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<X.length;s++)e.on(X[s],r.emit.bind(r,X[s]));return r._read=function(t){j("wrapped _read",t),n&&(n=!1,e.resume())},r},s._fromList=S}).call(t,n(8))},function(e,t,n){"use strict";function r(e){this.afterTransform=function(t,n){return i(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&e.push(n),i(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);a.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,n){o(t,e,n)}):o(t)})}function o(e,t,n){if(t)return e.emit("error",t);null!==n&&void 0!==n&&e.push(n);var r=e._writableState,i=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=s;var a=n(11),c=n(16);c.inherits=n(2),c.inherits(s,a),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},function(e,t,n){e.exports=n(10).EventEmitter},function(e,t,n){"use strict";(function(t){function r(){d.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function i(e,t){return e<<t|e>>>32-t}function s(e,t,n,r,s,o,a,c){return i(e+(t^n^r)+o+a|0,c)+s|0}function o(e,t,n,r,s,o,a,c){return i(e+(t&n|~t&r)+o+a|0,c)+s|0}function a(e,t,n,r,s,o,a,c){return i(e+((t|~n)^r)+o+a|0,c)+s|0}function c(e,t,n,r,s,o,a,c){return i(e+(t&r|n&~r)+o+a|0,c)+s|0}function u(e,t,n,r,s,o,a,c){return i(e+(t^(n|~r))+o+a|0,c)+s|0}var l=n(2),d=n(79);l(r,d),r.prototype._update=function(){for(var e=new Array(16),t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var n=this._a,r=this._b,l=this._c,d=this._d,p=this._e;n=s(n,r,l,d,p,e[0],0,11),l=i(l,10),p=s(p,n,r,l,d,e[1],0,14),r=i(r,10),d=s(d,p,n,r,l,e[2],0,15),n=i(n,10),l=s(l,d,p,n,r,e[3],0,12),p=i(p,10),r=s(r,l,d,p,n,e[4],0,5),d=i(d,10),n=s(n,r,l,d,p,e[5],0,8),l=i(l,10),p=s(p,n,r,l,d,e[6],0,7),r=i(r,10),d=s(d,p,n,r,l,e[7],0,9),n=i(n,10),l=s(l,d,p,n,r,e[8],0,11),p=i(p,10),r=s(r,l,d,p,n,e[9],0,13),d=i(d,10),n=s(n,r,l,d,p,e[10],0,14),l=i(l,10),p=s(p,n,r,l,d,e[11],0,15),r=i(r,10),d=s(d,p,n,r,l,e[12],0,6),n=i(n,10),l=s(l,d,p,n,r,e[13],0,7),p=i(p,10),r=s(r,l,d,p,n,e[14],0,9),d=i(d,10),n=s(n,r,l,d,p,e[15],0,8),l=i(l,10),p=o(p,n,r,l,d,e[7],1518500249,7),r=i(r,10),d=o(d,p,n,r,l,e[4],1518500249,6),n=i(n,10),l=o(l,d,p,n,r,e[13],1518500249,8),p=i(p,10),r=o(r,l,d,p,n,e[1],1518500249,13),d=i(d,10),n=o(n,r,l,d,p,e[10],1518500249,11),l=i(l,10),p=o(p,n,r,l,d,e[6],1518500249,9),r=i(r,10),d=o(d,p,n,r,l,e[15],1518500249,7),n=i(n,10),l=o(l,d,p,n,r,e[3],1518500249,15),p=i(p,10),r=o(r,l,d,p,n,e[12],1518500249,7),d=i(d,10),n=o(n,r,l,d,p,e[0],1518500249,12),l=i(l,10),p=o(p,n,r,l,d,e[9],1518500249,15),r=i(r,10),d=o(d,p,n,r,l,e[5],1518500249,9),n=i(n,10),l=o(l,d,p,n,r,e[2],1518500249,11),p=i(p,10),r=o(r,l,d,p,n,e[14],1518500249,7),d=i(d,10),n=o(n,r,l,d,p,e[11],1518500249,13),l=i(l,10),p=o(p,n,r,l,d,e[8],1518500249,12),r=i(r,10),d=a(d,p,n,r,l,e[3],1859775393,11),n=i(n,10),l=a(l,d,p,n,r,e[10],1859775393,13),p=i(p,10),r=a(r,l,d,p,n,e[14],1859775393,6),d=i(d,10),n=a(n,r,l,d,p,e[4],1859775393,7),l=i(l,10),p=a(p,n,r,l,d,e[9],1859775393,14),r=i(r,10),d=a(d,p,n,r,l,e[15],1859775393,9),n=i(n,10),l=a(l,d,p,n,r,e[8],1859775393,13),p=i(p,10),r=a(r,l,d,p,n,e[1],1859775393,15),d=i(d,10),n=a(n,r,l,d,p,e[2],1859775393,14),l=i(l,10),p=a(p,n,r,l,d,e[7],1859775393,8),r=i(r,10),d=a(d,p,n,r,l,e[0],1859775393,13),n=i(n,10),l=a(l,d,p,n,r,e[6],1859775393,6),p=i(p,10),r=a(r,l,d,p,n,e[13],1859775393,5),d=i(d,10),n=a(n,r,l,d,p,e[11],1859775393,12),l=i(l,10),p=a(p,n,r,l,d,e[5],1859775393,7),r=i(r,10),d=a(d,p,n,r,l,e[12],1859775393,5),n=i(n,10),l=c(l,d,p,n,r,e[1],2400959708,11),p=i(p,10),r=c(r,l,d,p,n,e[9],2400959708,12),d=i(d,10),n=c(n,r,l,d,p,e[11],2400959708,14),l=i(l,10),p=c(p,n,r,l,d,e[10],2400959708,15),r=i(r,10),d=c(d,p,n,r,l,e[0],2400959708,14),n=i(n,10),l=c(l,d,p,n,r,e[8],2400959708,15),p=i(p,10),r=c(r,l,d,p,n,e[12],2400959708,9),d=i(d,10),n=c(n,r,l,d,p,e[4],2400959708,8),l=i(l,10),p=c(p,n,r,l,d,e[13],2400959708,9),r=i(r,10),d=c(d,p,n,r,l,e[3],2400959708,14),n=i(n,10),l=c(l,d,p,n,r,e[7],2400959708,5),p=i(p,10),r=c(r,l,d,p,n,e[15],2400959708,6),d=i(d,10),n=c(n,r,l,d,p,e[14],2400959708,8),l=i(l,10),p=c(p,n,r,l,d,e[5],2400959708,6),r=i(r,10),d=c(d,p,n,r,l,e[6],2400959708,5),n=i(n,10),l=c(l,d,p,n,r,e[2],2400959708,12),p=i(p,10),r=u(r,l,d,p,n,e[4],2840853838,9),d=i(d,10),n=u(n,r,l,d,p,e[0],2840853838,15),l=i(l,10),p=u(p,n,r,l,d,e[5],2840853838,5),r=i(r,10),d=u(d,p,n,r,l,e[9],2840853838,11),n=i(n,10),l=u(l,d,p,n,r,e[7],2840853838,6),p=i(p,10),r=u(r,l,d,p,n,e[12],2840853838,8),d=i(d,10),n=u(n,r,l,d,p,e[2],2840853838,13),l=i(l,10),p=u(p,n,r,l,d,e[10],2840853838,12),r=i(r,10),d=u(d,p,n,r,l,e[14],2840853838,5),n=i(n,10),l=u(l,d,p,n,r,e[1],2840853838,12),p=i(p,10),r=u(r,l,d,p,n,e[3],2840853838,13),d=i(d,10),n=u(n,r,l,d,p,e[8],2840853838,14),l=i(l,10),p=u(p,n,r,l,d,e[11],2840853838,11),r=i(r,10),d=u(d,p,n,r,l,e[6],2840853838,8),n=i(n,10),l=u(l,d,p,n,r,e[15],2840853838,5),p=i(p,10),r=u(r,l,d,p,n,e[13],2840853838,6),d=i(d,10);var f=this._a,h=this._b,m=this._c,g=this._d,v=this._e;f=u(f,h,m,g,v,e[5],1352829926,8),m=i(m,10),v=u(v,f,h,m,g,e[14],1352829926,9),h=i(h,10),g=u(g,v,f,h,m,e[7],1352829926,9),f=i(f,10),m=u(m,g,v,f,h,e[0],1352829926,11),v=i(v,10),h=u(h,m,g,v,f,e[9],1352829926,13),g=i(g,10),f=u(f,h,m,g,v,e[2],1352829926,15),m=i(m,10),v=u(v,f,h,m,g,e[11],1352829926,15),h=i(h,10),g=u(g,v,f,h,m,e[4],1352829926,5),f=i(f,10),m=u(m,g,v,f,h,e[13],1352829926,7),v=i(v,10),h=u(h,m,g,v,f,e[6],1352829926,7),g=i(g,10),f=u(f,h,m,g,v,e[15],1352829926,8),m=i(m,10),v=u(v,f,h,m,g,e[8],1352829926,11),h=i(h,10),g=u(g,v,f,h,m,e[1],1352829926,14),f=i(f,10),m=u(m,g,v,f,h,e[10],1352829926,14),v=i(v,10),h=u(h,m,g,v,f,e[3],1352829926,12),g=i(g,10),f=u(f,h,m,g,v,e[12],1352829926,6),m=i(m,10),v=c(v,f,h,m,g,e[6],1548603684,9),h=i(h,10),g=c(g,v,f,h,m,e[11],1548603684,13),f=i(f,10),m=c(m,g,v,f,h,e[3],1548603684,15),v=i(v,10),h=c(h,m,g,v,f,e[7],1548603684,7),g=i(g,10),f=c(f,h,m,g,v,e[0],1548603684,12),m=i(m,10),v=c(v,f,h,m,g,e[13],1548603684,8),h=i(h,10),g=c(g,v,f,h,m,e[5],1548603684,9),f=i(f,10),m=c(m,g,v,f,h,e[10],1548603684,11),v=i(v,10),h=c(h,m,g,v,f,e[14],1548603684,7),g=i(g,10),f=c(f,h,m,g,v,e[15],1548603684,7),m=i(m,10),v=c(v,f,h,m,g,e[8],1548603684,12),h=i(h,10),g=c(g,v,f,h,m,e[12],1548603684,7),f=i(f,10),m=c(m,g,v,f,h,e[4],1548603684,6),v=i(v,10),h=c(h,m,g,v,f,e[9],1548603684,15),g=i(g,10),f=c(f,h,m,g,v,e[1],1548603684,13),m=i(m,10),v=c(v,f,h,m,g,e[2],1548603684,11),h=i(h,10),g=a(g,v,f,h,m,e[15],1836072691,9),f=i(f,10),m=a(m,g,v,f,h,e[5],1836072691,7),v=i(v,10),h=a(h,m,g,v,f,e[1],1836072691,15),g=i(g,10),f=a(f,h,m,g,v,e[3],1836072691,11),m=i(m,10),v=a(v,f,h,m,g,e[7],1836072691,8),h=i(h,10),g=a(g,v,f,h,m,e[14],1836072691,6),f=i(f,10),m=a(m,g,v,f,h,e[6],1836072691,6),v=i(v,10),h=a(h,m,g,v,f,e[9],1836072691,14),g=i(g,10),f=a(f,h,m,g,v,e[11],1836072691,12),m=i(m,10),v=a(v,f,h,m,g,e[8],1836072691,13),h=i(h,10),g=a(g,v,f,h,m,e[12],1836072691,5),f=i(f,10),m=a(m,g,v,f,h,e[2],1836072691,14),v=i(v,10),h=a(h,m,g,v,f,e[10],1836072691,13),g=i(g,10),f=a(f,h,m,g,v,e[0],1836072691,13),m=i(m,10),v=a(v,f,h,m,g,e[4],1836072691,7),h=i(h,10),g=a(g,v,f,h,m,e[13],1836072691,5),f=i(f,10),m=o(m,g,v,f,h,e[8],2053994217,15),v=i(v,10),h=o(h,m,g,v,f,e[6],2053994217,5),g=i(g,10),f=o(f,h,m,g,v,e[4],2053994217,8),m=i(m,10),v=o(v,f,h,m,g,e[1],2053994217,11),h=i(h,10),g=o(g,v,f,h,m,e[3],2053994217,14),f=i(f,10),m=o(m,g,v,f,h,e[11],2053994217,14),v=i(v,10),h=o(h,m,g,v,f,e[15],2053994217,6),g=i(g,10),f=o(f,h,m,g,v,e[0],2053994217,14),m=i(m,10),v=o(v,f,h,m,g,e[5],2053994217,6),h=i(h,10),g=o(g,v,f,h,m,e[12],2053994217,9),f=i(f,10),m=o(m,g,v,f,h,e[2],2053994217,12),v=i(v,10),h=o(h,m,g,v,f,e[13],2053994217,9),g=i(g,10),f=o(f,h,m,g,v,e[9],2053994217,12),m=i(m,10),v=o(v,f,h,m,g,e[7],2053994217,5),h=i(h,10),g=o(g,v,f,h,m,e[10],2053994217,15),f=i(f,10),m=o(m,g,v,f,h,e[14],2053994217,8),v=i(v,10),h=s(h,m,g,v,f,e[12],0,8),g=i(g,10),f=s(f,h,m,g,v,e[15],0,5),m=i(m,10),v=s(v,f,h,m,g,e[10],0,12),h=i(h,10),g=s(g,v,f,h,m,e[4],0,9),f=i(f,10),m=s(m,g,v,f,h,e[1],0,12),v=i(v,10),h=s(h,m,g,v,f,e[5],0,5),g=i(g,10),f=s(f,h,m,g,v,e[8],0,14),m=i(m,10),v=s(v,f,h,m,g,e[7],0,6),h=i(h,10),g=s(g,v,f,h,m,e[6],0,8),f=i(f,10),m=s(m,g,v,f,h,e[2],0,13),v=i(v,10),h=s(h,m,g,v,f,e[13],0,6),g=i(g,10),f=s(f,h,m,g,v,e[14],0,5),m=i(m,10),v=s(v,f,h,m,g,e[0],0,15),h=i(h,10),g=s(g,v,f,h,m,e[3],0,13),f=i(f,10),m=s(m,g,v,f,h,e[9],0,11),v=i(v,10),h=s(h,m,g,v,f,e[11],0,11),g=i(g,10);var b=this._b+l+g|0;this._b=this._c+d+v|0,this._c=this._d+p+f|0,this._d=this._e+n+h|0,this._e=this._a+r+m|0,this._a=b},r.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=new t(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){function r(e,t){var n,r=this;o.call(this),e=e||{},e.iceServers=e.iceServers||[];var i=a.browserDetails.browser;this.enableChromeNativeSimulcast=!1,t&&t.optional&&"chrome"===i&&null===navigator.appVersion.match(/Chromium\//)&&t.optional.forEach(function(e){e.enableChromeNativeSimulcast&&(r.enableChromeNativeSimulcast=!0)}),this.enableMultiStreamHacks=!1,t&&t.optional&&"chrome"===i&&t.optional.forEach(function(e){e.enableMultiStreamHacks&&(r.enableMultiStreamHacks=!0)}),this.restrictBandwidth=0,t&&t.optional&&t.optional.forEach(function(e){e.andyetRestrictBandwidth&&(r.restrictBandwidth=e.andyetRestrictBandwidth)}),this.batchIceCandidates=0,t&&t.optional&&t.optional.forEach(function(e){e.andyetBatchIce&&(r.batchIceCandidates=e.andyetBatchIce)}),this.batchedIceCandidates=[],t&&t.optional&&"chrome"===i&&t.optional.forEach(function(e){e.andyetFasterICE&&(r.eliminateDuplicateCandidates=e.andyetFasterICE)}),t&&t.optional&&t.optional.forEach(function(e){e.andyetDontSignalCandidates&&(r.dontSignalCandidates=e.andyetDontSignalCandidates)}),this.assumeSetLocalSuccess=!1,t&&t.optional&&t.optional.forEach(function(e){e.andyetAssumeSetLocalSuccess&&(r.assumeSetLocalSuccess=e.andyetAssumeSetLocalSuccess)}),"firefox"===i&&t&&t.optional&&(this.wtFirefox=0,t.optional.forEach(function(e){e.andyetFirefoxMakesMeSad&&(r.wtFirefox=e.andyetFirefoxMakesMeSad,r.wtFirefox>0&&(r.firefoxcandidatebuffer=[]))})),this.pc=new RTCPeerConnection(e,t),"function"==typeof this.pc.getLocalStreams?this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc):this.getLocalStreams=function(){return[]},this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc),this.addStream=this.pc.addStream.bind(this.pc),this.removeStream=function(e){"function"==typeof r.pc.removeStream?r.pc.removeStream.apply(r.pc,arguments):"function"==typeof r.pc.removeTrack&&e.getTracks().forEach(function(e){r.pc.removeTrack(e)})},"function"==typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc)),this.pc.onremovestream=this.emit.bind(this,"removeStream"),this.pc.onremovetrack=this.emit.bind(this,"removeTrack"),this.pc.onaddstream=this.emit.bind(this,"addStream"),this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded"),this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange"),this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange"),this.pc.onicecandidate=this._onIce.bind(this),this.pc.ondatachannel=this._onDataChannel.bind(this),this.localDescription={contents:[]},this.remoteDescription={contents:[]},this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1},this.iceCredentials={local:{},remote:{}};for(n in e)this.config[n]=e[n];this.config.debug&&this.on("*",function(){(e.logger||console).log("PeerConnection event:",arguments)}),this.hadLocalStunCandidate=!1,this.hadRemoteStunCandidate=!1,this.hadLocalRelayCandidate=!1,this.hadRemoteRelayCandidate=!1,this.hadLocalIPv6Candidate=!1,this.hadRemoteIPv6Candidate=!1,this._remoteDataChannels=[],this._localDataChannels=[],this._candidateBuffer=[]}var i=n(6),s=n(216),o=n(9),a=n(322),c=n(182);i.inherits(r,o),Object.defineProperty(r.prototype,"signalingState",{get:function(){return this.pc.signalingState}}),Object.defineProperty(r.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}}),r.prototype._role=function(){return this.isInitiator?"initiator":"responder"},r.prototype.addStream=function(e){this.localStream=e,this.pc.addStream(e)},r.prototype._checkLocalCandidate=function(e){var t=s.toCandidateJSON(e);"srflx"==t.type?this.hadLocalStunCandidate=!0:"relay"==t.type&&(this.hadLocalRelayCandidate=!0),-1!=t.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)},r.prototype._checkRemoteCandidate=function(e){var t=s.toCandidateJSON(e);"srflx"==t.type?this.hadRemoteStunCandidate=!0:"relay"==t.type&&(this.hadRemoteRelayCandidate=!0),-1!=t.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)},r.prototype.processIce=function(e,t){t=t||function(){};var n=this;if("closed"===this.pc.signalingState)return t();if(e.contents||e.jingle&&e.jingle.contents){var r=this.remoteDescription.contents.map(function(e){return e.name});(e.contents||e.jingle.contents).forEach(function(e){var i=e.transport||{},o=i.candidates||[],a=r.indexOf(e.name),c=e.name,u=n.remoteDescription.contents.find(function(t){return t.name===e.name}),l=function(){o.forEach(function(e){var t=s.toCandidateSDP(e);n.pc.addIceCandidate(new RTCIceCandidate({candidate:t,sdpMLineIndex:a,sdpMid:c}),function(){},function(e){n.emit("error",e)}),n._checkRemoteCandidate(t)}),t()};if(n.iceCredentials.remote[e.name]&&i.ufrag&&n.iceCredentials.remote[e.name].ufrag!==i.ufrag)if(u){u.transport.ufrag=i.ufrag,u.transport.pwd=i.pwd;var d={type:"offer",jingle:n.remoteDescription};d.sdp=s.toSessionSDP(d.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"incoming"}),n.pc.setRemoteDescription(new RTCSessionDescription(d),function(){l()},function(e){n.emit("error",e)})}else n.emit("error","ice restart failed to find matching content");else l()})}else{if(e.candidate&&0!==e.candidate.candidate.indexOf("a=")&&(e.candidate.candidate="a="+e.candidate.candidate),this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(e.candidate),t();n.pc.addIceCandidate(new RTCIceCandidate(e.candidate),function(){},function(e){n.emit("error",e)}),n._checkRemoteCandidate(e.candidate.candidate),t()}},r.prototype.offer=function(e,t){var n=this,r=2===arguments.length,i=r&&e?e:{offerToReceiveAudio:1,offerToReceiveVideo:1};if(t=r?t:e,t=t||function(){},"closed"===this.pc.signalingState)return t("Already closed");this.pc.createOffer(function(e){var r={type:"offer",sdp:e.sdp};n.assumeSetLocalSuccess&&(n.emit("offer",r),t(null,r)),n._candidateBuffer=[],n.pc.setLocalDescription(e,function(){var i;n.config.useJingle&&(i=s.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"}),i.sid=n.config.sid,n.localDescription=i,i.contents.forEach(function(e){var t=e.transport||{};t.ufrag&&(n.iceCredentials.local[e.name]={ufrag:t.ufrag,pwd:t.pwd})}),r.jingle=i),r.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkLocalCandidate(e)}),n.assumeSetLocalSuccess||(n.emit("offer",r),t(null,r))},function(e){n.emit("error",e),t(e)})},function(e){n.emit("error",e),t(e)},i)},r.prototype.handleOffer=function(e,t){t=t||function(){};var n=this;if(e.type="offer",e.jingle){if(this.enableChromeNativeSimulcast&&e.jingle.contents.forEach(function(e){"video"===e.name&&(e.application.googConferenceFlag=!0)}),this.enableMultiStreamHacks&&e.jingle.contents.forEach(function(e){if("video"===e.name){var t=e.application.sources||[];0!==t.length&&"3735928559"===t[0].ssrc||(t.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),e.application.sources=t)}}),n.restrictBandwidth>0&&e.jingle.contents.length>=2&&"video"===e.jingle.contents[1].name){var r=e.jingle.contents[1];r.application&&r.application.bandwidth&&r.application.bandwidth.bandwidth||(e.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:n.restrictBandwidth.toString()},e.sdp=s.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"outgoing"}))}e.jingle.contents.forEach(function(e){var t=e.transport||{};t.ufrag&&(n.iceCredentials.remote[e.name]={ufrag:t.ufrag,pwd:t.pwd})}),e.sdp=s.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"incoming"}),n.remoteDescription=e.jingle}e.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkRemoteCandidate(e)}),n.pc.setRemoteDescription(new RTCSessionDescription(e),function(){t()},t)},r.prototype.answerAudioOnly=function(e){var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};this._answer(t,e)},r.prototype.answerBroadcastOnly=function(e){var t={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};this._answer(t,e)},r.prototype.answer=function(e,t){var n=2===arguments.length,r=n?t:e,i=n&&e?e:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};this._answer(i,r)},r.prototype.handleAnswer=function(e,t){t=t||function(){};var n=this;e.jingle&&(e.sdp=s.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"incoming"}),n.remoteDescription=e.jingle,e.jingle.contents.forEach(function(e){var t=e.transport||{};t.ufrag&&(n.iceCredentials.remote[e.name]={ufrag:t.ufrag,pwd:t.pwd})})),e.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkRemoteCandidate(e)}),n.pc.setRemoteDescription(new RTCSessionDescription(e),function(){n.wtFirefox&&window.setTimeout(function(){n.firefoxcandidatebuffer.forEach(function(e){n.pc.addIceCandidate(new RTCIceCandidate(e),function(){},function(e){n.emit("error",e)}),n._checkRemoteCandidate(e.candidate)}),n.firefoxcandidatebuffer=null},n.wtFirefox),t(null)},t)},r.prototype.close=function(){this.pc.close(),this._localDataChannels=[],this._remoteDataChannels=[],this.emit("close")},r.prototype._answer=function(e,t){t=t||function(){};var n=this;if(!this.pc.remoteDescription)throw new Error("remoteDescription not set");if("closed"===this.pc.signalingState)return t("Already closed");n.pc.createAnswer(function(e){var r=[];if(n.enableChromeNativeSimulcast&&(e.jingle=s.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"}),e.jingle.contents.length>=2&&"video"===e.jingle.contents[1].name)){var i=e.jingle.contents[1].application.sourceGroups||[],o=!1;if(i.forEach(function(e){"SIM"==e.semantics&&(o=!0)}),!o&&e.jingle.contents[1].application.sources.length){var a=JSON.parse(JSON.stringify(e.jingle.contents[1].application.sources[0]));a.ssrc=""+Math.floor(4294967295*Math.random()),e.jingle.contents[1].application.sources.push(a),r.push(e.jingle.contents[1].application.sources[0].ssrc),r.push(a.ssrc),i.push({semantics:"SIM",sources:r});var u=JSON.parse(JSON.stringify(a));u.ssrc=""+Math.floor(4294967295*Math.random()),e.jingle.contents[1].application.sources.push(u),i.push({semantics:"FID",sources:[a.ssrc,u.ssrc]}),e.jingle.contents[1].application.sourceGroups=i,e.sdp=s.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"outgoing"})}}var l={type:"answer",sdp:e.sdp};if(n.assumeSetLocalSuccess){var d=c(l);n.emit("answer",d),t(null,d)}n._candidateBuffer=[],n.pc.setLocalDescription(e,function(){if(n.config.useJingle){var r=s.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"});r.sid=n.config.sid,n.localDescription=r,l.jingle=r}if(n.enableChromeNativeSimulcast&&(l.jingle||(l.jingle=s.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"})),l.jingle.contents[1].application.sources.forEach(function(e,t){e.parameters=e.parameters.map(function(e){return"msid"===e.key&&(e.value+="-"+Math.floor(t/2)),e})}),l.sdp=s.toSessionSDP(l.jingle,{sid:n.sdpSessionID,role:n._role(),direction:"outgoing"})),l.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkLocalCandidate(e)}),!n.assumeSetLocalSuccess){var i=c(l);n.emit("answer",i),t(null,i)}},function(e){n.emit("error",e),t(e)})},function(e){n.emit("error",e),t(e)},e)},r.prototype._onIce=function(e){var t=this;if(e.candidate){if(this.dontSignalCandidates)return;var n=e.candidate,r={candidate:{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}};this._checkLocalCandidate(n.candidate);var i,o,a=s.toCandidateJSON(n.candidate);if(this.eliminateDuplicateCandidates&&"relay"===a.type&&(i=this._candidateBuffer.filter(function(e){return"relay"===e.type}).map(function(e){return e.foundation+":"+e.component}),(o=i.indexOf(a.foundation+":"+a.component))>-1&&a.priority>>24>=i[o].priority>>24))return;if("max-bundle"===this.config.bundlePolicy&&(i=this._candidateBuffer.filter(function(e){return a.type===e.type}).map(function(e){return e.address+":"+e.port}),(o=i.indexOf(a.address+":"+a.port))>-1))return;if("require"===this.config.rtcpMuxPolicy&&"2"===a.component)return;if(this._candidateBuffer.push(a),t.config.useJingle){if(n.sdpMid||(t.pc.remoteDescription&&"offer"===t.pc.remoteDescription.type?n.sdpMid=t.remoteDescription.contents[n.sdpMLineIndex].name:n.sdpMid=t.localDescription.contents[n.sdpMLineIndex].name),!t.iceCredentials.local[n.sdpMid]){s.toSessionJSON(t.pc.localDescription.sdp,{role:t._role(),direction:"outgoing"}).contents.forEach(function(e){var n=e.transport||{};n.ufrag&&(t.iceCredentials.local[e.name]={ufrag:n.ufrag,pwd:n.pwd})})}if(r.jingle={contents:[{name:n.sdpMid,creator:t._role(),transport:{transportType:"iceUdp",ufrag:t.iceCredentials.local[n.sdpMid].ufrag,pwd:t.iceCredentials.local[n.sdpMid].pwd,candidates:[a]}}]},t.batchIceCandidates>0)return 0===t.batchedIceCandidates.length&&window.setTimeout(function(){var e={};t.batchedIceCandidates.forEach(function(t){t=t.contents[0],e[t.name]||(e[t.name]=t),e[t.name].transport.candidates.push(t.transport.candidates[0])});var n={jingle:{contents:[]}};Object.keys(e).forEach(function(t){n.jingle.contents.push(e[t])}),t.batchedIceCandidates=[],t.emit("ice",n)},t.batchIceCandidates),void t.batchedIceCandidates.push(r.jingle)}this.emit("ice",r)}else this.emit("endOfCandidates")},r.prototype._onDataChannel=function(e){var t=e.channel;this._remoteDataChannels.push(t),this.emit("addChannel",t)},r.prototype.createDataChannel=function(e,t){var n=this.pc.createDataChannel(e,t);return this._localDataChannels.push(n),n},r.prototype.getStats=function(){if("function"!=typeof arguments[0])return this.pc.getStats.apply(this.pc,arguments);var e=arguments[0];this.pc.getStats().then(function(t){e(null,t)},function(t){e(t)})},e.exports=r},function(e,t,n){e.exports=n(1)},function(e,t){e.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},function(e,t,n){var t=e.exports=function(e){e=e.toLowerCase();var n=t[e];if(!n)throw new Error(e+" is not supported (we accept pull requests)");return new n};t.sha=n(222),t.sha1=n(223),t.sha224=n(224),t.sha256=n(61),t.sha384=n(225),t.sha512=n(62)},function(e,t,n){(function(t){function r(){this.init(),this._w=f,d.call(this,64,56)}function i(e,t,n){return n^e&(t^n)}function s(e,t,n){return e&t|n&(e|t)}function o(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function a(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function c(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function u(e){return(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10}var l=n(2),d=n(15),p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=new Array(64);l(r,d),r.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,l=0|this._c,d=0|this._d,f=0|this._e,h=0|this._f,m=0|this._g,g=0|this._h,v=0;v<16;++v)t[v]=e.readInt32BE(4*v);for(;v<64;++v)t[v]=u(t[v-2])+t[v-7]+c(t[v-15])+t[v-16]|0;for(var b=0;b<64;++b){var y=g+a(f)+i(f,h,m)+p[b]+t[b]|0,_=o(n)+s(n,r,l)|0;g=m,m=h,h=f,f=d+y|0,d=l,l=r,r=n,n=y+_|0}this._a=n+this._a|0,this._b=r+this._b|0,this._c=l+this._c|0,this._d=d+this._d|0,this._e=f+this._e|0,this._f=h+this._f|0,this._g=m+this._g|0,this._h=g+this._h|0},r.prototype._hash=function(){var e=new t(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){(function(t){function r(){this.init(),this._w=g,h.call(this,128,112)}function i(e,t,n){return n^e&(t^n)}function s(e,t,n){return e&t|n&(e|t)}function o(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function a(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function c(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function u(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function l(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function d(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function p(e,t){return e>>>0<t>>>0?1:0}var f=n(2),h=n(15),m=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],g=new Array(160);f(r,h),r.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._ah,r=0|this._bh,f=0|this._ch,h=0|this._dh,g=0|this._eh,v=0|this._fh,b=0|this._gh,y=0|this._hh,_=0|this._al,S=0|this._bl,T=0|this._cl,E=0|this._dl,w=0|this._el,R=0|this._fl,C=0|this._gl,x=0|this._hl,A=0;A<32;A+=2)t[A]=e.readInt32BE(4*A),t[A+1]=e.readInt32BE(4*A+4);for(;A<160;A+=2){var I=t[A-30],N=t[A-30+1],O=c(I,N),D=u(N,I);I=t[A-4],N=t[A-4+1];var P=l(I,N),M=d(N,I),U=t[A-14],k=t[A-14+1],j=t[A-32],L=t[A-32+1],$=D+k|0,X=O+U+p($,D)|0;$=$+M|0,X=X+P+p($,M)|0,$=$+L|0,X=X+j+p($,L)|0,t[A]=X,t[A+1]=$}for(var q=0;q<160;q+=2){X=t[q],$=t[q+1];var B=s(n,r,f),F=s(_,S,T),H=o(n,_),G=o(_,n),V=a(g,w),J=a(w,g),W=m[q],z=m[q+1],K=i(g,v,b),Y=i(w,R,C),Q=x+J|0,Z=y+V+p(Q,x)|0;Q=Q+Y|0,Z=Z+K+p(Q,Y)|0,Q=Q+z|0,Z=Z+W+p(Q,z)|0,Q=Q+$|0,Z=Z+X+p(Q,$)|0;var ee=G+F|0,te=H+B+p(ee,G)|0;y=b,x=C,b=v,C=R,v=g,R=w,w=E+Q|0,g=h+Z+p(w,E)|0,h=f,E=T,f=r,T=S,r=n,S=_,_=Q+ee|0,n=Z+te+p(_,Q)|0}this._al=this._al+_|0,this._bl=this._bl+S|0,this._cl=this._cl+T|0,this._dl=this._dl+E|0,this._el=this._el+w|0,this._fl=this._fl+R|0,this._gl=this._gl+C|0,this._hl=this._hl+x|0,this._ah=this._ah+n+p(this._al,_)|0,this._bh=this._bh+r+p(this._bl,S)|0,this._ch=this._ch+f+p(this._cl,T)|0,this._dh=this._dh+h+p(this._dl,E)|0,this._eh=this._eh+g+p(this._el,w)|0,this._fh=this._fh+v+p(this._fl,R)|0,this._gh=this._gh+b+p(this._gl,C)|0,this._hh=this._hh+y+p(this._hl,x)|0},r.prototype._hash=function(){function e(e,t,r){n.writeInt32BE(e,r),n.writeInt32BE(t,r+4)}var n=new t(64);return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),n},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){"use strict";(function(t){function r(e,n){var r=this;s.call(this),r.sm=e,r.closing=!1,r.stanzas={Open:n.getDefinition("open","urn:ietf:params:xml:ns:xmpp-framing",!0),Close:n.getDefinition("close","urn:ietf:params:xml:ns:xmpp-framing",!0),StreamError:n.getStreamError()},r.sendQueue=o.queue(function(e,n){r.conn&&("string"!=typeof e&&(e=e.toString()),e=new t(e,"utf8").toString(),r.emit("raw:outgoing",e),r.conn.readyState===c&&r.conn.send(e)),n()},1),r.on("connected",function(){r.send(r.startHeader())}),r.on("raw:incoming",function(e){var t,i;if(""!==(e=e.trim())){try{t=n.parse(e)}catch(e){return i=new r.stanzas.StreamError({condition:"invalid-xml"}),r.emit("stream:error",i,e),r.send(i),r.disconnect()}if("openStream"===t._name)return r.hasStream=!0,r.stream=t,r.emit("stream:start",t.toJSON());if("closeStream"===t._name)return r.emit("stream:end"),r.disconnect();!t.lang&&r.stream&&(t.lang=r.stream.lang),r.emit("stream:data",t)}})}var i=n(6),s=n(9),o=n(19),a=n(37)&&n(37).Client?n(37).Client:window.WebSocket,c=1;i.inherits(r,s),r.prototype.connect=function(e){var n=this;n.config=e,n.hasStream=!1,n.closing=!1,n.conn=new a(e.wsURL,"xmpp"),n.conn.onerror=function(e){e.preventDefault(),n.emit("disconnected",n)},n.conn.onclose=function(){n.emit("disconnected",n)},n.conn.onopen=function(){n.sm.started=!1,n.emit("connected",n)},n.conn.onmessage=function(e){n.emit("raw:incoming",new t(e.data,"utf8").toString())}},r.prototype.startHeader=function(){return new this.stanzas.Open({version:this.config.version||"1.0",lang:this.config.lang||"en",to:this.config.server})},r.prototype.closeHeader=function(){return new this.stanzas.Close},r.prototype.disconnect=function(){this.conn&&!this.closing&&this.hasStream?(this.closing=!0,this.send(this.closeHeader())):(this.hasStream=!1,this.stream=void 0,this.conn&&this.conn.readyState===c&&this.conn.close(),this.conn=void 0)},r.prototype.restart=function(){var e=this;e.hasStream=!1,e.send(this.startHeader())},r.prototype.send=function(e){this.sendQueue.push(e)},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){function r(){i.call(this)}e.exports=r;var i=n(10).EventEmitter;n(2)(r,i),r.Readable=n(34),r.Writable=n(202),r.Duplex=n(197),r.Transform=n(201),r.PassThrough=n(200),r.Stream=r,r.prototype.pipe=function(e,t){function n(t){e.writable&&!1===e.write(t)&&u.pause&&u.pause()}function r(){u.readable&&u.resume&&u.resume()}function s(){l||(l=!0,e.end())}function o(){l||(l=!0,"function"==typeof e.destroy&&e.destroy())}function a(e){if(c(),0===i.listenerCount(this,"error"))throw e}function c(){u.removeListener("data",n),e.removeListener("drain",r),u.removeListener("end",s),u.removeListener("close",o),u.removeListener("error",a),e.removeListener("error",a),u.removeListener("end",c),u.removeListener("close",c),e.removeListener("close",c)}var u=this;u.on("data",n),e.on("drain",r),e._isStdio||t&&!1===t.end||(u.on("end",s),u.on("close",o));var l=!1;return u.on("error",a),e.on("error",a),u.on("end",c),u.on("close",c),e.on("close",c),e.emit("pipe",u),e}},function(e,t,n){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(221),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){"use strict";function r(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function i(e,t,n){var r=e;return l(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=p(t,{uri:e}),r.callback=n,r}function s(e,t,n){return t=i(e,t,n),o(t)}function o(e){function t(){4===l.readyState&&setTimeout(o,0)}function n(){var e=void 0;if(e=l.response?l.response:l.responseText||a(l),_)try{e=JSON.parse(e)}catch(e){}return e}function i(e){return clearTimeout(h),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,u(e,S)}function o(){if(!f){var t;clearTimeout(h),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var r=S,i=null;return 0!==t?(r={body:n(),statusCode:t,method:g,headers:{},url:m,rawRequest:l},l.getAllResponseHeaders&&(r.headers=d(l.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),u(i,r,r.body)}}if(void 0===e.callback)throw new Error("callback argument missing");var c=!1,u=function(t,n,r){c||(c=!0,e.callback(t,n,r))},l=e.xhr||null;l||(l=e.cors||e.useXDR?new s.XDomainRequest:new s.XMLHttpRequest);var p,f,h,m=l.url=e.uri||e.url,g=l.method=e.method||"GET",v=e.body||e.data,b=l.headers=e.headers||{},y=!!e.sync,_=!1,S={body:void 0,headers:{},statusCode:0,method:g,url:m,rawRequest:l};if("json"in e&&!1!==e.json&&(_=!0,b.accept||b.Accept||(b.Accept="application/json"),"GET"!==g&&"HEAD"!==g&&(b["content-type"]||b["Content-Type"]||(b["Content-Type"]="application/json"),v=JSON.stringify(!0===e.json?v:e.json))),l.onreadystatechange=t,l.onload=o,l.onerror=i,l.onprogress=function(){},l.onabort=function(){f=!0},l.ontimeout=i,l.open(g,m,!y,e.username,e.password),y||(l.withCredentials=!!e.withCredentials),!y&&e.timeout>0&&(h=setTimeout(function(){if(!f){f=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}},e.timeout)),l.setRequestHeader)for(p in b)b.hasOwnProperty(p)&&l.setRequestHeader(p,b[p]);else if(e.headers&&!r(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(v||null),l}function a(e){if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}function c(){}var u=n(78),l=n(40),d=n(195),p=n(337);e.exports=s,s.XMLHttpRequest=u.XMLHttpRequest||c,s.XDomainRequest="withCredentials"in new s.XMLHttpRequest?s.XMLHttpRequest:u.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],function(e){s["delete"===e?"del":e]=function(t,n,r){return n=i(t,n,r),n.method=e.toUpperCase(),o(n)}})},function(e,t,n){"use strict";e.exports=n(243)(n(259))},function(e,t,n){"use strict";t.VERSION="__STANZAIO_VERSION__",t.JID=n(5).JID,t.Client=n(260),t.createClient=function(e){var r=new t.Client(e);return r.use(n(283)),r}},function(e,t,n){function r(e){for(var t={},n=e.split(/,(?=(?:[^"]|"[^"]*")*$)/),r=0,i=n.length;r<i;r++){var s=/(\w+)=["]?([^"]+)["]?$/.exec(n[r]);s&&(t[s[1]]=s[2])}return t}function i(){return o(16).toString("hex")}function s(e){e=e||{},this._genNonce=e.genNonce||i}var o=n(32),a=n(23);s.Mechanism=s,s.prototype.name="DIGEST-MD5",s.prototype.clientFirst=!1,s.prototype.response=function(e){if(!this._completed){var t=e.serviceType+"/"+e.host;e.serviceName&&e.host!==e.serviceName&&(t+="/"+e.serviceName);var n=e.realm||this._realm||"",r=this._genNonce(),i="00000001",s="auth",o="";o+='username="'+e.username+'"',n&&(o+=',realm="'+n+'"'),o+=',nonce="'+this._nonce+'"',o+=',cnonce="'+r+'"',o+=",nc="+i,o+=",qop=auth",o+=',digest-uri="'+t+'"';var c=a("md5").update(e.username).update(":").update(n).update(":").update(e.password).digest(),u=a("md5").update(c).update(":").update(this._nonce).update(":").update(r);e.authzid&&u.update(":").update(e.authzid),u=u.digest("hex");var l=a("md5").update("AUTHENTICATE:").update(t);l=l.digest("hex");return o+=",response="+a("md5").update(u).update(":").update(this._nonce).update(":").update(i).update(":").update(r).update(":").update(s).update(":").update(l).digest("hex"),"utf-8"===this._charset&&(o+=",charset=utf-8"),e.authzid&&(o+='authzid="'+e.authzid+'"'),o}},s.prototype.challenge=function(e){var t=r(e);return this._completed=!!t.rspauth,this._realm=t.realm,this._nonce=t.nonce,this._qop=(t.qop||"auth").split(","),this._stale=t.stale,this._maxbuf=parseInt(t.maxbuf)||65536,this._charset=t.charset,this._algo=t.algorithm,this._cipher=t.cipher,this._cipher&&this._cipher.split(","),this},e.exports=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t,n,r){var i=null;switch(void 0===t?"undefined":_(t)){case"string":e[t]?n(e[t]):r&&r();break;case"function":for(i in self.sessions)if(e.hasOwnProperty(i)&&t(e[i]))return void n(e[i]);r&&r();break;case"number":o(e,""+t,n,r);break;case"object":o(e,t.session,n,r);break;default:console.error("dont know how to look for a session using a",void 0===t?"undefined":_(t))}}function a(e,t,n){n.on("progress",function(t){switch(t.status_code){case 180:e.emit("call:ringing",{id:n.id});break;default:console.log("unhandled sip status code",t.status_code)}}),n.on("accepted",function(t){e.emit("call:started",{id:n.id})}),n.on("rejected",function(t,r){e.emit("call:rejected",{id:n.id})}),n.on("terminated",function(r,i){e.emit("call:terminated",{id:n.id,reason:r?r.status_code||i:"Hangup"}),delete t[n.id]})}function c(e,t,n){t.media={constraints:{audio:n.audio,video:n.video},render:{remote:document.getElementById(n.remoteVideo||"remoteVideo")}}}function u(e,t,n){t.extraHeaders=["X-Token: "+e.config.token]}function l(e,t,n){var r={};return n.forEach(function(n){n(e,r,t)}),r}function d(e){return!!e&&/\r\nm=audio /.test(e)}function p(e){return!!e&&/\r\nm=video/.test(e)}function f(e){e.connection.xmpp=!0,e.emit("connection",e.connection),e.xmpp.getRoster(function(t,n){t?e.emit("xmpp:error",t):n.items&&n.items.map(function(e){self.connection.roster[e.from.full]={remoteUser:e.from.full,presence:"unavailable"}}),e.xmpp.sendPresence()})}function h(e,t,n){e.emit("im:message",{from:n.from.local,to:n.to.local,id:n.id,body:n.body,session:t.id,state:n.type})}function m(e,t,n){e.emit("im:state",{from:n.from.local,to:n.to.local,id:n.id,session:t.id,state:n.chatState})}function g(e,t,n){e.emit("im:error",{from:n.from.local,to:n.to.local,id:n.id,session:t.id,state:"error",code:n.error.code,condition:n.error.condition})}function v(e,t,n,r,i){o(t,function(e){return e.remoteUser===n.from.local},function(t){(i||h)(e,t,n)},function(){var s=null;r&&(s={id:(new Date).getTime(),remoteUser:n.from.local,localUser:n.to.local,im:!0},t[s.id]=s,e.emit("im:started",s),(i||h)(e,s,n))})}function b(e,t){var n=null;n={to:t.to,from:e.config.identity,body:t.message,state:"pending"},n.id=e.xmpp.sendMessage({to:t.to+"@"+e.config.xmppHost,body:t.message,requestReceipt:!0}),e.emit("im:sending",n),e.connection.xmpp||(n.state="error",n.code=503,n.condition="not-connected",e.emit("im:error",n))}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=n(10),T=n(67),E=n(68),w=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.connection={sip:!1,xmpp:!1,roster:{}},n.sessions={},n.config=Object.assign({sipProxy:"sip.opentact.org",sipWsUrl:"wss://sip.opentact.org:8443",sipDebug:!1,xmppHost:"xmpp.opentact.org",xmppWsUrl:"wss://xmpp.opentact.org:5280/websocket",xmppDebug:!1,xmppAutoReconnect:!0},e),n}return s(t,e),y(t,[{key:"login",value:function(e){var t=this;Object.assign(this.config,e),this.xmpp=(0,E.createClient)({jid:this.config.identity+"@"+this.config.xmppHost,password:this.config.token,transport:"websocket",wsURL:this.config.xmppWsUrl,useStreamManagement:this.config.xmppAutoReconnect}),this.xmpp.on("session:started",function(){f(t)}),this.xmpp.on("stream:management:resumed",function(){f(t)}),this.xmpp.on("disconnected",function(){t.connection.xmpp=!1,t.emit("connection",t.connection)}),this.xmpp.on("presence",function(e){var n=e.from.bare,r=t.connection.roster[n]||{remoteUser:n};r.presence=e.type,t.connection.roster[n]=r,t.emit("im:presence",r)}),this.xmpp.on("subscribe",function(e){t.emit("im:subscription",{from:e.from.full}),t.xmpp.acceptSubscription(e.from.full)}),this.xmpp.on("subscribed",function(e){t.emit("im:subscribed",{from:e.from.full})}),this.xmpp.on("message",function(e){switch(e.type){case"chat":v(t,t.sessions,e,!1,m);break;case"error":v(t,t.sessions,e,!1,g);break;default:v(t,t.sessions,e,!0,h)}}),this.xmpp.on("receipt",function(e){o(t.sessions,function(t){return t.remoteUser===e.from.local},function(n){t.emit("im:receipt",{session:n.id,id:e.receipt,status:e.type})})}),this.xmpp.on("message:error",function(e,t){console.error("got error",e)}),this.config.xmppDebug&&(this.xmpp.on("raw:incoming",function(e){console.log("xmpp in",e)}),this.xmpp.on("raw:outgoing",function(e){console.log("xmpp out",e)})),this.sip=new T.UA({uri:this.config.identity+"@"+this.config.sipProxy,wsServers:[this.config.sipWsUrl],stunServers:["stun:stun.l.google.com:19302"],authorizationUser:this.config.identity,password:this.config.token,register:!1,traceSip:this.config.sipDebug}),this.sip.on("registered",function(){t.connection.sip=!0,t.emit("connection",t.connection)}),this.sip.on("unregistered",function(){t.connection.sip=!1,t.emit("connection",t.connection)}),this.sip.on("disconnected",function(){t.connection.sip=!1,t.emit("connection",t.connection)}),this.sip.on("invite",function(e){t.sessions[e.id]=e,a(t,t.sessions,e),t.emit("call:received",{id:e.id,remoteUser:e.remoteIdentity.uri.user,audio:d(e.request.body),video:p(e.request.body)})}),this.connect({xmpp:!0,sip:!0})}},{key:"connect",value:function(e){e.sip&&this.sip&&this.sip.register({extraHeaders:["X-Token: "+this.config.token]}),e.xmpp&&this.xmpp&&this.xmpp.connect()}},{key:"logout",value:function(){this.disconnect({xmpp:!0,sip:!0}),this.sip=null,this.xmpp=null,this.sessions={},this.connection={xmpp:!1,sip:!1,roster:{}}}},{key:"disconnect",value:function(e){e.xmpp&&this.xmpp&&this.xmpp.disconnect(),e.sip&&this.sip&&this.sip.unregister(l(this,e,[u]))}},{key:"call",value:function(e){var t,n,r=null;this.sip&&!0===this.connection.sip&&(t=l(this,e,[c,u]),n=e.pstn?"9"+e.to:e.to,r=this.sip.invite(n,t),this.sessions[r.id]=r,this.emit("call:starting",{id:r.id,remoteUser:e.to,audio:e.audio,video:e.video}),a(this,this.sessions,r))}},{key:"accept",value:function(e){var t=this;o(this.sessions,e.id,function(n){n.accept(l(t,e,[c,u]))})}},{key:"reject",value:function(e){o(this.sessions,e.id,function(e){e.reject()})}},{key:"hangup",value:function(e){o(this.sessions,e.id,function(e){e.bye()})}},{key:"im",value:function(e){var t=null;t={remoteUser:e.to,localUser:this.config.identity,id:(new Date).getTime(),im:!0},this.sessions[t.id]=t,this.emit("im:started",t)}},{key:"imMessage",value:function(e){var t=this;o(this.sessions,function(t){return t.remoteUser===e.to},function(n){t.imState({session:n.id,state:"paused"}),b(t,e)},function(){b(t,e)})}},{key:"imState",value:function(e){var t=this;o(this.sessions,e.session,function(n){t.xmpp.sendMessage({to:n.remoteUser+"@"+t.config.xmppHost,type:"chat",chatState:e.state})},function(){console.error("session not found",e)})}}]),t}(S.EventEmitter);t.default=w,e.exports=t.default},function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return 3*e.length/4-r(e)}function s(e){var t,n,i,s,o,a,c=e.length;o=r(e),a=new d(3*c/4-o),i=o>0?c-4:c;var u=0;for(t=0,n=0;t<i;t+=4,n+=3)s=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],a[u++]=s>>16&255,a[u++]=s>>8&255,a[u++]=255&s;return 2===o?(s=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,a[u++]=255&s):1===o&&(s=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,a[u++]=s>>8&255,a[u++]=255&s),a}function o(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}function a(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(o(r));return i.join("")}function c(e){for(var t,n=e.length,r=n%3,i="",s=[],o=0,c=n-r;o<c;o+=16383)s.push(a(e,o,o+16383>c?c:o+16383));return 1===r?(t=e[n-1],i+=u[t>>2],i+=u[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=u[t>>10],i+=u[t>>4&63],i+=u[t<<2&63],i+="="),s.push(i),s.join("")}t.byteLength=i,t.toByteArray=s,t.fromByteArray=c;for(var u=[],l=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,h=p.length;f<h;++f)u[f]=p[f],l[p.charCodeAt(f)]=f;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(e,t,n){(function(t){function n(e,n){t.isBuffer(e)||(e=new t(e)),t.isBuffer(n)||(n=new t(n));var r=[];if(e.length>n.length)for(var i=0;i<n.length;i++)r.push(e[i]^n[i]);else for(var i=0;i<e.length;i++)r.push(e[i]^n[i]);return new t(r)}e.exports=n}).call(t,n(1).Buffer)},function(e,t,n){"use strict";(function(t){function n(e){if(e.length%r!=0){var n=e.length+(r-e.length%r);e=t.concat([e,i],n)}for(var s=new Array(e.length>>>2),o=0,a=0;o<e.length;o+=r,a++)s[a]=e.readInt32LE(o);return s}var r=4,i=new t(r);i.fill(0);e.exports=function(e,r){var i=r(n(e),8*e.length);e=new t(16);for(var s=0;s<i.length;s++)e.writeInt32LE(i[s],s<<2,!0);return e}}).call(t,n(1).Buffer)},function(e,t,n){"use strict";function r(e,t){o.call(this,"digest"),"string"==typeof t&&(t=s.from(t)),this._alg=e,this._key=t,t.length>c?t=e(t):t.length<c&&(t=s.concat([t,a],c));for(var n=this._ipad=s.allocUnsafe(c),r=this._opad=s.allocUnsafe(c),i=0;i<c;i++)n[i]=54^t[i],r[i]=92^t[i];this._hash=[n]}var i=n(2),s=n(58).Buffer,o=n(22),a=s.alloc(128),c=64;i(r,o),r.prototype._update=function(e){this._hash.push(e)},r.prototype._final=function(){var e=this._alg(s.concat(this._hash));return this._alg(s.concat([this._opad,e]))},e.exports=r},function(e,t,n){function r(e){s.call(this);var t=e||{};this.config={chunksize:16384,pacing:0};var n;for(n in t)this.config[n]=t[n];this.file=null,this.channel=null}function i(){s.call(this),this.receiveBuffer=[],this.received=0,this.metadata={},this.channel=null}var s=n(9),o=n(6);o.inherits(r,s),r.prototype.send=function(e,t){var n=this;this.file=e,this.channel=t;var r="number"!=typeof t.bufferedAmountLowThreshold,i=0,s=function(){var o=new window.FileReader;o.onload=function(){return function(o){n.channel.send(o.target.result),n.emit("progress",i,e.size,o.target.result),e.size>i+o.target.result.byteLength?r?window.setTimeout(s,n.config.pacing):t.bufferedAmount<=t.bufferedAmountLowThreshold&&window.setTimeout(s,0):(n.emit("progress",e.size,e.size,null),n.emit("sentFile")),i+=n.config.chunksize}}();var a=e.slice(i,i+n.config.chunksize);o.readAsArrayBuffer(a)};r||(t.bufferedAmountLowThreshold=8*this.config.chunksize,t.addEventListener("bufferedamountlow",s)),window.setTimeout(s,0)},o.inherits(i,s),i.prototype.receive=function(e,t){var n=this;e&&(this.metadata=e),this.channel=t,t.binaryType="arraybuffer",this.channel.onmessage=function(e){var t=e.data.byteLength;n.received+=t,n.receiveBuffer.push(e.data),n.emit("progress",n.received,n.metadata.size,e.data),n.received===n.metadata.size?(n.emit("receivedFile",new window.Blob(n.receiveBuffer),n.metadata),n.receiveBuffer=[]):n.received>n.metadata.size&&(console.error("received more than expected, discarding..."),n.receiveBuffer=[])}},e.exports={},e.exports.support="undefined"!=typeof window&&window&&window.File&&window.FileReader&&window.Blob,e.exports.Sender=r,e.exports.Receiver=i},function(e,t,n){function r(e){s.call(this);var t=this;this.base=new c.Sender(e);var n=e||{};n.hash||(n.hash="sha-1"),this.hash=a.createHash(n.hash),this.base.on("progress",function(e,n,r){t.emit("progress",e,n,r),r&&t.hash.update(new Uint8Array(r))}),this.base.on("sentFile",function(){t.emit("sentFile",{hash:t.hash.digest("hex"),algo:n.hash})})}function i(e){s.call(this);var t=this;this.base=new c.Receiver(e);var n=e||{};n.hash||(n.hash="sha-1"),this.hash=a.createHash(n.hash),this.base.on("progress",function(e,n,r){t.emit("progress",e,n,r),r&&t.hash.update(new Uint8Array(r))}),this.base.on("receivedFile",function(e,n){n.actualhash=t.hash.digest("hex"),t.emit("receivedFile",e,n)})}var s=n(9),o=n(6),a=n(25),c=n(75);o.inherits(r,s),r.prototype.send=function(){this.base.send.apply(this.base,arguments)},o.inherits(i,s),i.prototype.receive=function(){this.base.receive.apply(this.base,arguments)},Object.defineProperty(i.prototype,"metadata",{get:function(){return this.base.metadata},set:function(e){this.base.metadata=e}}),e.exports={},e.exports.support=c.support,e.exports.Sender=r,e.exports.Receiver=i},function(e,t,n){function r(e,t,n){if(!a(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===c.call(e)?i(e,t,n):"string"==typeof e?s(e,t,n):o(e,t,n)}function i(e,t,n){for(var r=0,i=e.length;r<i;r++)u.call(e,r)&&t.call(n,e[r],r,e)}function s(e,t,n){for(var r=0,i=e.length;r<i;r++)t.call(n,e.charAt(r),r,e)}function o(e,t,n){for(var r in e)u.call(e,r)&&t.call(n,e[r],r,e)}var a=n(40);e.exports=r;var c=Object.prototype.toString,u=Object.prototype.hasOwnProperty},function(e,t,n){(function(t){var n;n="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=n}).call(t,n(3))},function(e,t,n){"use strict";(function(t){function r(e){i.call(this),this._block=new t(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}var i=n(64).Transform;n(2)(r,i),r.prototype._transform=function(e,n,r){var i=null;try{"buffer"!==n&&(e=new t(e,n)),this.update(e)}catch(e){i=e}r(i)},r.prototype._flush=function(e){var t=null;try{this.push(this._digest())}catch(e){t=e}e(t)},r.prototype.update=function(e,n){if(!t.isBuffer(e)&&"string"!=typeof e)throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Digest already called");t.isBuffer(e)||(e=new t(e,n||"binary"));for(var r=this._block,i=0;this._blockOffset+e.length-i>=this._blockSize;){for(var s=this._blockOffset;s<this._blockSize;)r[s++]=e[i++];this._update(),this._blockOffset=0}for(;i<e.length;)r[this._blockOffset++]=e[i++];for(var o=0,a=8*e.length;a>0;++o)this._length[o]+=a,(a=this._length[o]/4294967296|0)>0&&(this._length[o]-=4294967296*a);return this},r.prototype._update=function(e){throw new Error("_update is not implemented")},r.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();return void 0!==e&&(t=t.toString(e)),t},r.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){"use strict";var r=n(19),i=n(66),s=n(28).createRegistry();s.use(n(81)),e.exports=function(e,t){"string"==typeof e&&(e={host:e});var n={ssl:!0,json:!0,xrd:!0};for(var o in e)n[o]=e[o];var a=n.ssl?"https://":"http://";r.parallel([function(e){i(a+n.host+"/.well-known/host-meta.json",function(t,n,r){if(t)return e(null);var i;try{i=JSON.parse(r)}catch(e){i=null}return e(i)})},function(e){i(a+n.host+"/.well-known/host-meta",function(t,n,r){if(t)return e(null);var i=s.parse(r);return e(i.toJSON())})}],function(e){e?t(null,e):t("no-host-meta")})}},function(e,t,n){"use strict";var r=n(28),i="http://docs.oasis-open.org/ns/xri/xrd-1.0";e.exports=function(e){var t={get:function(){for(var e={},t=r.find(this.xml,i,"Property"),n=0,s=t.length;n<s;n++){var o=t[n];e[r.getAttribute(o,"type")]=o.textContent}return e}},n=e.define({name:"xrd",namespace:i,element:"XRD",fields:{subject:r.subText(i,"Subject"),expires:r.dateSub(i,"Expires"),aliases:r.multiSubText(i,"Alias"),properties:t}}),s=e.define({name:"_xrdlink",namespace:i,element:"Link",fields:{rel:r.attribute("rel"),href:r.attribute("href"),type:r.attribute("type"),template:r.attribute("template"),titles:r.subLangText(i,"Title","default"),properties:t}});return e.extend(n,s,"links"),n}},function(e,t){e.exports=function(){return["sha1","sha224","sha256","sha384","sha512","md5","rmd160"]}},function(e,t){t.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?i-1:0,p=n?-1:1,f=e[t+d];for(d+=p,s=f&(1<<-l)-1,f>>=-l,l+=a;l>0;s=256*s+e[t+d],d+=p,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=256*o+e[t+d],d+=p,l-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=u}return(f?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var o,a,c,u=8*s-i-1,l=(1<<u)-1,d=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),t+=o+d>=1?p/c:p*Math.pow(2,1-d),t*c>=2&&(o++,c/=2),o+d>=l?(a=0,o=l):o+d>=1?(a=(t*c-1)*Math.pow(2,i),o+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&a,f+=h,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+f]=255&o,f+=h,o/=256,u-=8);e[n+f-h]|=128*m}},function(e,t){function n(e,t){for(var n=[],i=0;i<e.length;i++)r(t,e[i])>-1&&n.push(e[i]);return n}function r(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}e.exports=n,n.big=function(e,t){for(var n=[],r={},i=0;i<t.length;i++)r[t[i]]=!0;for(var i=0;i<e.length;i++)r[e[i]]&&n.push(e[i]);return n}},function(e,t,n){function r(e){o.call(this,e),this.pc=new a({iceServers:e.iceServers||[],useJingle:!0},e.constraints||{}),this.pc.on("ice",this.onIceCandidate.bind(this)),this.pc.on("iceConnectionStateChange",this.onIceStateChange.bind(this)),this.pc.on("addChannel",this.onChannelAdded.bind(this)),this.sender=null,this.receiver=null}var i=n(6),s=n(24),o=n(26),a=n(57),c=n(76);i.inherits(r,o),r.prototype=s(r.prototype,{start:function(e){var t=this;this.state="pending",this.pc.isInitiator=!0,this.sender=new c.Sender,this.sender.on("progress",function(e,n){t._log("info","Send progress "+e+"/"+n)}),this.sender.on("sentFile",function(e){t._log("info","Sent file",e.name);var n=t.pc.localDescription.contents[0];delete n.transport,n.application={applicationType:"filetransfer",offer:{hash:{algo:e.algo,value:e.hash}}},t.send("description-info",{contents:[n]}),t.emit("sentFile",t,e)});var n=this.pc.createDataChannel("filetransfer");n.onopen=function(){t.sender.send(e,n)};var r={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};this.pc.offer(r,function(n,r){if(n)return t._log("error","Could not create WebRTC offer",n),t.end("failed-application",!0);r.jingle.contents[0].application={applicationType:"filetransfer",offer:{date:e.lastModifiedDate,name:e.name,size:e.size,hash:{algo:"sha-1",value:""}}},t.send("session-initiate",r.jingle)})},accept:function(){var e=this;this._log("info","Accepted incoming session"),this.state="active",this.pc.answer(function(t,n){if(t)return e._log("error","Could not create WebRTC answer",t),e.end("failed-application");e.send("session-accept",n.jingle)})},end:function(e,t){this.pc.close(),o.prototype.end.call(this,e,t)},maybeReceivedFile:function(){this.receiver.metadata.hash.value&&(this.receiver.metadata.hash.value===this.receiver.metadata.actualhash?(this._log("info","File hash matches"),this.emit("receivedFile",this,this.receivedFile,this.receiver.metadata),this.end("success")):(this._log("error","File hash does not match"),this.end("media-error")))},onIceCandidate:function(e){this._log("info","Discovered new ICE candidate",e.jingle),this.send("transport-info",e.jingle)},onIceStateChange:function(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected";break;case"disconnected":"stable"===this.pc.signalingState?this.connectionState="interrupted":this.connectionState="disconnected";break;case"failed":this.connectionState="failed",this.end("failed-transport");break;case"closed":this.connectionState="disconnected"}},onChannelAdded:function(e){this.receiver.receive(null,e)},onSessionInitiate:function(e,t){var n=this;this._log("info","Initiating incoming session"),this.state="pending",this.pc.isInitiator=!1;var r=e.contents[0].application;this.receiver=new c.Receiver({hash:r.offer.hash.algo}),this.receiver.on("progress",function(e,t){n._log("info","Receive progress "+e+"/"+t)}),this.receiver.on("receivedFile",function(e){n.receivedFile=e,n.maybeReceivedFile()}),this.receiver.metadata=r.offer,e.contents[0].application={applicationType:"datachannel"},this.pc.handleOffer({type:"offer",jingle:e},function(e){if(e)return n._log("error","Could not create WebRTC answer"),t({condition:"general-error"});t()})},onSessionAccept:function(e,t){var n=this;this.state="active",e.contents[0].application={applicationType:"datachannel"},this.pc.handleAnswer({type:"answer",jingle:e},function(e){if(e)return n._log("error","Could not process WebRTC answer"),t({condition:"general-error"});n.emit("accepted",n),t()})},onSessionTerminate:function(e,t){this._log("info","Terminating session"),this.pc.close(),o.prototype.end.call(this,e.reason,!0),t()},onDescriptionInfo:function(e,t){var n=e.contents[0].application.offer.hash;this.receiver.metadata.hash=n,this.receiver.metadata.actualhash&&this.maybeReceivedFile(),t()},onTransportInfo:function(e,t){this.pc.processIce(e,function(){t()})}}),e.exports=r},function(e,t,n){function r(e,t){"rtp"===e.application.applicationType&&(delete e.transport,delete e.application.payloads,delete e.application.headerExtensions,e.application.mux=!1,e.application.sources&&(e.application.sources=e.application.sources.filter(function(e){return t.id===e.parameters[1].value.split(" ")[0]})),e.application.sourceGroups&&(e.application.sourceGroups=e.application.sourceGroups.filter(function(t){for(var n=!1,r=0;r<e.application.sources.length;r++)if(e.application.sources[r].ssrc===t.sources[0]){n=!0;break}return n})))}function i(e){(e.application.sources||[]).forEach(function(e){e.parameters=e.parameters.filter(function(e){return!("mslabel"===e.key||"label"===e.key)})})}function s(e){c.call(this,e),this.pc=new u({iceServers:e.iceServers||[],useJingle:!0},e.constraints||{}),this.pc.on("ice",this.onIceCandidate.bind(this,e)),this.pc.on("endOfCandidates",this.onIceEndOfCandidates.bind(this,e)),this.pc.on("iceConnectionStateChange",this.onIceStateChange.bind(this)),this.pc.on("addStream",this.onAddStream.bind(this)),this.pc.on("removeStream",this.onRemoveStream.bind(this)),this.pc.on("addChannel",this.onAddChannel.bind(this)),e.stream&&this.addStream(e.stream),this._ringing=!1}var o=n(6),a=n(24),c=n(26),u=n(57);o.inherits(s,c),Object.defineProperties(s.prototype,{ringing:{get:function(){return this._ringing},set:function(e){e!==this._ringing&&(this._ringing=e,this.emit("change:ringing",e))}},streams:{get:function(){return"closed"!==this.pc.signalingState?this.pc.getRemoteStreams():[]}}}),s.prototype=a(s.prototype,{start:function(e,t){var n=this;this.state="pending",t=t||function(){},this.pc.isInitiator=!0,this.pc.offer(e,function(r,s){if(r)return n._log("error","Could not create WebRTC offer",r),n.end("failed-application",!0);e&&e.mandatory&&s.jingle.contents.forEach(function(t){var n=t.application.media;t.description&&"rtp"===t.application.applicationType&&(e.mandatory.OfferToReceiveAudio||"audio"!==n||(t.senders="initiator"),e.mandatory.OfferToReceiveVideo||"video"!==n||(t.senders="initiator"))}),s.jingle.contents.forEach(i),n.send("session-initiate",s.jingle),t()})},accept:function(e,t){var n=this;1===arguments.length&&"function"==typeof e&&(t=e,e={}),t=t||function(){},e=e||{},n.constraints=e.constraints||{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},this._log("info","Accepted incoming session"),this.state="active",this.pc.answer(n.constraints,function(e,r){if(e)return n._log("error","Could not create WebRTC answer",e),n.end("failed-application");r.jingle.contents.forEach(i),n.send("session-accept",r.jingle),t()})},end:function(e,t){var n=this;this.streams.forEach(function(e){n.onRemoveStream({stream:e})}),this.pc.close(),c.prototype.end.call(this,e,t)},ring:function(){this._log("info","Ringing on incoming session"),this.ringing=!0,this.send("session-info",{ringing:!0})},mute:function(e,t){this._log("info","Muting",t),this.send("session-info",{mute:{creator:e,name:t}})},unmute:function(e,t){this._log("info","Unmuting",t),this.send("session-info",{unmute:{creator:e,name:t}})},hold:function(){this._log("info","Placing on hold"),this.send("session-info",{hold:!0})},resume:function(){this._log("info","Resuming from hold"),this.send("session-info",{active:!0})},addStream:function(e,t,n){var i=this;n=n||function(){},this.pc.addStream(e),t&&("object"==typeof t&&(i.constraints=t),this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(t){if(t)return i._log("error","Could not create offer for adding new stream"),n(t);i.pc.answer(i.constraints,function(t,s){if(t)return i._log("error","Could not create answer for adding new stream"),n(t);s.jingle.contents.forEach(function(t){r(t,e)}),s.jingle.contents=s.jingle.contents.filter(function(e){return"rtp"===e.application.applicationType&&e.application.sources&&e.application.sources.length}),delete s.jingle.groups,i.send("source-add",s.jingle),n()})}))},addStream2:function(e,t){this.addStream(e,!0,t)},removeStream:function(e,t,n){var i=this;if(n=n||function(){},!t)return void this.pc.removeStream(e);"object"==typeof t&&(i.constraints=t);var s=this.pc.localDescription;s.contents.forEach(function(t){r(t,e)}),s.contents=s.contents.filter(function(e){return"rtp"===e.application.applicationType&&e.application.sources&&e.application.sources.length}),delete s.groups,this.send("source-remove",s),this.pc.removeStream(e),this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(e){if(e)return i._log("error","Could not process offer for removing stream"),n(e);i.pc.answer(i.constraints,function(e){if(e)return i._log("error","Could not process answer for removing stream"),n(e);n()})})},removeStream2:function(e,t){this.removeStream(e,!0,t)},switchStream:function(e,t,n){var r=this;n=n||function(){};var i=this.pc.localDescription;i.contents.forEach(function(e){delete e.transport,delete e.application.payloads}),this.pc.removeStream(e),this.send("source-remove",i),this.pc.addStream(t),this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(e){if(e)return r._log("error","Could not process offer for switching streams"),n(e);r.pc.answer(r.constraints,function(e,t){if(e)return r._log("error","Could not process answer for switching streams"),n(e);t.jingle.contents.forEach(function(e){delete e.transport,delete e.application.payloads}),r.send("source-add",t.jingle),n()})})},onIceCandidate:function(e,t){this._log("info","Discovered new ICE candidate",t.jingle),this.send("transport-info",t.jingle),e.signalEndOfCandidates&&(this.lastCandidate=t)},onIceEndOfCandidates:function(e){if(this._log("info","ICE end of candidates"),e.signalEndOfCandidates){var t=this.lastCandidate.jingle;t.contents[0].transport={transportType:t.contents[0].transport.transportType,gatheringComplete:!0},this.lastCandidate=null,this.send("transport-info",t)}},onIceStateChange:function(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected";break;case"disconnected":"stable"===this.pc.signalingState?this.connectionState="interrupted":this.connectionState="disconnected";break;case"failed":this.connectionState="failed",this.end("failed-transport");break;case"closed":this.connectionState="disconnected"}},onAddStream:function(e){this._log("info","Stream added"),this.emit("peerStreamAdded",this,e.stream)},onRemoveStream:function(e){this._log("info","Stream removed"),this.emit("peerStreamRemoved",this,e.stream)},onSessionInitiate:function(e,t){var n=this;this._log("info","Initiating incoming session"),this.state="pending",this.pc.isInitiator=!1,this.pc.handleOffer({type:"offer",jingle:e},function(e){if(e)return n._log("error","Could not create WebRTC answer"),t({condition:"general-error"});t()})},onSessionAccept:function(e,t){var n=this;this.state="active",this.pc.handleAnswer({type:"answer",jingle:e},function(e){if(e)return n._log("error","Could not process WebRTC answer"),t({condition:"general-error"});n.emit("accepted",n),t()})},onSessionTerminate:function(e,t){var n=this;this._log("info","Terminating session"),this.streams.forEach(function(e){n.onRemoveStream({stream:e})}),this.pc.close(),c.prototype.end.call(this,e.reason,!0),t()},onSessionInfo:function(e,t){return e.ringing?(this._log("info","Outgoing session is ringing"),this.ringing=!0,this.emit("ringing",this),t()):e.hold?(this._log("info","On hold"),this.emit("hold",this),t()):e.active?(this._log("info","Resuming from hold"),this.emit("resumed",this),t()):e.mute?(this._log("info","Muting",e.mute),this.emit("mute",this,e.mute),t()):e.unmute?(this._log("info","Unmuting",e.unmute),this.emit("unmute",this,e.unmute),t()):void t()},onTransportInfo:function(e,t){this.pc.processIce(e,function(){t()})},onSourceAdd:function(e,t){var n=this;this._log("info","Adding new stream source");var r=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(t,n){var i=t.application,s=i.sources||[],o=i.sourceGroups||[];e.contents.forEach(function(e){if(t.name===e.name){var i=e.application,a=i.sources||[];s=s.concat(a),r.contents[n].application.sources=JSON.parse(JSON.stringify(s));var c=i.sourceGroups||[];o=o.concat(c),r.contents[n].application.sourceGroups=JSON.parse(JSON.stringify(o))}})}),this.pc.handleOffer({type:"offer",jingle:r},function(e){if(e)return n._log("error","Error adding new stream source"),t({condition:"general-error"});n.pc.answer(n.constraints,function(e){if(e)return n._log("error","Error adding new stream source"),t({condition:"general-error"});t()})})},onSourceRemove:function(e,t){var n=this;this._log("info","Removing stream source");var r=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(t,n){var i=t.application,s=i.sources||[],o=i.sourceGroups||[];e.contents.forEach(function(e){if(t.name===e.name){var i,a,c,u,l=e.application,d=l.sources||[],p=l.sourceGroups||[];for(a=0;a<d.length;a++){for(i=-1,c=0;c<s.length;c++)if(d[a].ssrc===s[c].ssrc){i=c;break}i>-1&&(s.splice(i,1),r.contents[n].application.sources=JSON.parse(JSON.stringify(s)))}for(a=0;a<p.length;a++){for(i=-1,c=0;c<o.length;c++)if(p[a].semantics===o[c].semantics&&p[a].sources.length===o[c].sources.length){var f=!0;for(u=0;u<p[a].sources.length;u++)if(p[a].sources[u]!==o[c].sources[u]){f=!1;break}if(f){i=c;break}}i>-1&&(o.splice(i,1),r.contents[n].application.sourceGroups=JSON.parse(JSON.stringify(o)))}}})}),this.pc.handleOffer({type:"offer",jingle:r},function(e){if(e)return n._log("error","Error removing stream source"),t({condition:"general-error"});n.pc.answer(n.constraints,function(e){if(e)return n._log("error","Error removing stream source"),t({condition:"general-error"});t()})})},onAddChannel:function(e){this.emit("addChannel",e)}}),e.exports=s},function(e,t,n){function r(e){o.call(this),e=e||{},this.jid=e.jid,this.selfID=e.selfID||this.jid&&this.jid.full||this.jid||"",this.sessions={},this.peers={},this.prepareSession=e.prepareSession||function(e){return e.applicationTypes.indexOf("rtp")>=0?new c(e):e.applicationTypes.indexOf("filetransfer")>=0?new u(e):void 0},this.performTieBreak=e.performTieBreak||function(e,t){var n=t.jingle.contents.map(function(e){if(e.application)return e.application.applicationType});return s(e.pendingApplicationTypes,n).length>0},this.config={debug:!1,peerConnectionConfig:{iceServers:e.iceServers||[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]},media:{audio:!0,video:!0}};for(var t in e)this.config[t]=e[t];this.iceServers=this.config.peerConnectionConfig.iceServers}var i=n(6),s=n(84),o=n(9),a=n(26),c=n(86),u=n(85);i.inherits(r,o),r.prototype.addICEServer=function(e){"string"==typeof e&&(e={urls:e}),this.iceServers.push(e)},r.prototype.addSession=function(e){var t=this,n=e.sid,r=e.peerID;return this.sessions[n]=e,this.peers[r]||(this.peers[r]=[]),this.peers[r].push(e),e.on("terminated",function(){var i=t.peers[r]||[];i.length&&i.splice(i.indexOf(e),1),delete t.sessions[n]}),e.on("*",function(n,r,i,s){if("send"===n){var o=r.jingle&&r.jingle.action;e.isInitiator&&"session-initiate"===o&&t.emit("outgoing",e)}!t.config.debug||"log:debug"!==n&&"log:error"!==n||console.log("Jingle:",r,i,s),0!==n.indexOf("change")&&t.emit(n,r,i,s)}),this.emit("createdSession",e),e},r.prototype.createMediaSession=function(e,t,n){var r=new c({sid:t,peer:e,initiator:!0,stream:n,parent:this,iceServers:this.iceServers,constraints:this.config.peerConnectionConstraints});return this.addSession(r),r},r.prototype.createFileTransferSession=function(e,t){var n=new u({sid:t,peer:e,initiator:!0,parent:this});return this.addSession(n),n},r.prototype.endPeerSessions=function(e,t,n){e=e.full||e;var r=this.peers[e]||[];delete this.peers[e],r.forEach(function(e){e.end(t||"gone",n)})},r.prototype.endAllSessions=function(e,t){var n=this;Object.keys(this.peers).forEach(function(r){n.endPeerSessions(r,e,t)})},r.prototype._createIncomingSession=function(e,t){var n;return this.prepareSession&&(n=this.prepareSession(e,t)),n||(n=new a(e)),this.addSession(n),n},r.prototype._sendError=function(e,t,n){n.type||(n.type="cancel"),this.emit("send",{to:e,id:t,type:"error",error:n})},r.prototype._log=function(e,t){this.emit("log:"+e,t)},r.prototype.process=function(e){var t=this,n=e.jingle?e.jingle.sid:null,r=this.sessions[n]||null,i=e.id,s=e.from.full||e.from;if("error"===e.type){var o=e.error&&"tie-break"===e.error.jingleCondition;return r&&r.pending&&o?r.end("alternative-session",!0):(r&&(r.pendingAction=!1),this.emit("error",e))}if("result"===e.type)return void(r&&(r.pendingAction=!1));var a=e.jingle.action,c=e.jingle.contents||[],u=c.map(function(e){if(e.application)return e.application.applicationType}),l=c.map(function(e){if(e.transport)return e.transport.transportType});if("session-initiate"!==a){if(!r)return this._log("error","Unknown session",n),this._sendError(s,i,{condition:"item-not-found",jingleCondition:"unknown-session"});if(r.peerID!==s||r.ended)return this._log("error","Session has ended, or action has wrong sender"),this._sendError(s,i,{condition:"item-not-found",jingleCondition:"unknown-session"});if("session-accept"===a&&!r.pending)return this._log("error","Tried to accept session twice",n),this._sendError(s,i,{condition:"unexpected-request",jingleCondition:"out-of-order"});if("session-terminate"!==a&&a===r.pendingAction&&(this._log("error","Tie break during pending request"),r.isInitiator))return this._sendError(s,i,{condition:"conflict",jingleCondition:"tie-break"})}else if(r){if(r.peerID!==s)return this._log("error","Duplicate sid from new sender"),this._sendError(s,i,{condition:"service-unavailable"});if(!r.pending)return this._log("error","Someone is doing this wrong"),this._sendError(s,i,{condition:"unexpected-request",jingleCondition:"out-of-order"});if(this.selfID>r.peerID&&this.performTieBreak(r,e))return this._log("error","Tie break new session because of duplicate sids"),this._sendError(s,i,{condition:"conflict",jingleCondition:"tie-break"})}else if(this.peers[s]&&this.peers[s].length)for(var d=0,p=this.peers[s].length;d<p;d++){var f=this.peers[s][d];if(f&&f.pending&&f.sid>n&&this.performTieBreak(f,e))return this._log("info","Tie break session-initiate"),this._sendError(s,i,{condition:"conflict",jingleCondition:"tie-break"})}if("session-initiate"===a){if(!c.length)return t._sendError(s,i,{condition:"bad-request"});r=this._createIncomingSession({sid:n,peer:e.from,peerID:s,initiator:!1,parent:this,applicationTypes:u,transportTypes:l,iceServers:this.iceServers,constraints:this.config.peerConnectionConstraints},e)}r.process(a,e.jingle,function(n){n?(t._log("error","Could not process request",e,n),t._sendError(s,i,n)):(t.emit("send",{to:s,id:i,type:"result"}),"session-initiate"===a&&t.emit("incoming",r))})},e.exports=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(89),s=r(i),o=n(90),a=r(o);t.default=function(e){e.use(a.default),e.use(s.default)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i={client:r.Namespace.CLIENT,server:r.Namespace.SERVER,component:r.Namespace.COMPONENT};t.default=function(e){e.extendMessage=function(e,t){var n=this;this.withMessage(function(r){n.extend(r,e,t)})},e.extendPresence=function(e,t){var n=this;this.withPresence(function(r){n.extend(r,e,t)})},e.extendIQ=function(e,t){var n=this;this.withIQ(function(r){n.extend(r,e,t)})},e.extendStreamFeatures=function(e){var t=this;this.withStreamFeatures(function(n){t.extend(n,e)})},e.extendPubsubItem=function(e){var t=this;this.withPubsubItem(function(n){t.extend(n,e)})},e.withIQ=function(e){this.withDefinition("iq",r.Namespace.CLIENT,e),this.withDefinition("iq",r.Namespace.COMPONENT,e)},e.withMessage=function(e){this.withDefinition("message",r.Namespace.CLIENT,e),this.withDefinition("message",r.Namespace.COMPONENT,e)},e.withPresence=function(e){this.withDefinition("presence",r.Namespace.CLIENT,e),this.withDefinition("presence",r.Namespace.COMPONENT,e)},e.withStreamFeatures=function(e){this.withDefinition("features",r.Namespace.STREAM,e)},e.withStanzaError=function(e){this.withDefinition("error",r.Namespace.CLIENT,e),this.withDefinition("error",r.Namespace.COMPONENT,e)},e.withDataForm=function(e){this.withDefinition("x",r.Namespace.DATAFORM,e)},e.withPubsubItem=function(e){this.withDefinition("item",r.Namespace.PUBSUB,e),this.withDefinition("item",r.Namespace.PUBSUB_EVENT,e)},e.getMessage=function(){var e=void 0===arguments[0]?"client":arguments[0];return this.getDefinition("message",i[e])},e.getPresence=function(){var e=void 0===arguments[0]?"client":arguments[0];return this.getDefinition("presence",i[e])},e.getIQ=function(){var e=void 0===arguments[0]?"client":arguments[0];return this.getDefinition("iq",i[e])},e.getStreamError=function(){return this.getDefinition("error",r.Namespace.STREAM)},e.getIq=e.getIQ,e.withIq=e.withIQ},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);t.default=function(e){var t=e.utils;t.jidAttribute=function(e,n){return{get:function(){var i=new r.JID(t.getAttribute(this.xml,e));return n&&(i.prepped=!0),i},set:function(n){t.setAttribute(this.xml,e,(n||"").toString())}}},t.jidSub=function(e,n,i){return{get:function(){var s=new r.JID(t.getSubText(this.xml,e,n));return i&&(s.prepped=!0),s},set:function(r){t.setSubText(this.xml,e,n,(r||"").toString())}}},t.tzoSub=t.field(function(e,n,r,i){var s=void 0,o=void 0,a=void 0,c=-1,u=t.getSubText(e,n,r);return u?("-"===u.charAt(0)&&(c=1,u=u.slice(1)),a=u.split(":"),s=parseInt(a[0],10),o=parseInt(a[1],10),(60*s+o)*c):i},function(e,n,r,i){var s=void 0,o=void 0,a="-";"number"==typeof i?(i<0&&(i=-i,a="+"),s=i/60,o=i%60,a+=(s<10?"0":"")+s+":"+(o<10?"0":"")+o):a=i,t.setSubText(e,n,r,a)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"_address",namespace:r.Namespace.ADDRESS,element:"address",fields:{jid:t.jidAttribute("jid"),uri:t.attribute("uri"),node:t.attribute("node"),description:t.attribute("desc"),delivered:t.boolAttribute("delivered"),type:t.attribute("type")}}),i=t.subMultiExtension(r.Namespace.ADDRESS,"addresses",n);e.withMessage(function(t){e.add(t,"addresses",i)}),e.withPresence(function(t){e.add(t,"addresses",i)})},e.exports=t.default},function(e,t,n){"use strict";var r=n(27).default;Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(13),o=r(s);t.default=function(e){var t=e.utils,n=e.define({name:"avatar",namespace:i.Namespace.AVATAR_METADATA,element:"info",fields:{id:t.attribute("id"),bytes:t.attribute("bytes"),height:t.attribute("height"),width:t.attribute("width"),type:t.attribute("type","image/png"),url:t.attribute("url")}}),r={get:function(){var e=t.find(this.xml,i.Namespace.AVATAR_METADATA,"metadata"),r=[];if(e.length){var s=t.find(e[0],i.Namespace.AVATAR_METADATA,"info");(0,o.default)(s,function(e){r.push(new n({},e))})}return r},set:function(e){var r=t.findOrCreate(this.xml,i.Namespace.AVATAR_METADATA,"metadata");t.setAttribute(r,"xmlns",i.Namespace.AVATAR_METADATA),(0,o.default)(e,function(e){var t=new n(e);r.appendChild(t.xml)})}};e.withPubsubItem(function(n){e.add(n,"avatars",r),e.add(n,"avatarData",t.textSub(i.Namespace.AVATAR_DATA,"data"))})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"bind",namespace:r.Namespace.BIND,element:"bind",fields:{resource:t.textSub(r.Namespace.BIND,"resource"),jid:t.jidSub(r.Namespace.BIND,"jid")}});e.extendIQ(n),e.extendStreamFeatures(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(5);t.default=function(e){var t=e.utils,n={get:function(){var e=[],n=t.find(this.xml,r.Namespace.BLOCKING,"item");return n.length?(n.forEach(function(n){e.push(new i.JID(t.getAttribute(n,"jid","")))}),e):e},set:function(e){var n=this;e.forEach(function(e){var i=t.createElement(r.Namespace.BLOCKING,"item",r.Namespace.BLOCKING);t.setAttribute(i,"jid",e.toString()),n.xml.appendChild(i)})}},s=e.define({name:"block",namespace:r.Namespace.BLOCKING,element:"block",fields:{jids:n}}),o=e.define({name:"unblock",namespace:r.Namespace.BLOCKING,element:"unblock",fields:{jids:n}}),a=e.define({name:"blockList",namespace:r.Namespace.BLOCKING,element:"blocklist",fields:{jids:n}});e.extendIQ(s),e.extendIQ(o),e.extendIQ(a)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"bob",namespace:r.Namespace.BOB,element:"data",fields:{cid:t.attribute("cid"),maxAge:t.numberAttribute("max-age"),type:t.attribute("type"),data:t.text()}});e.extendIQ(n),e.extendMessage(n),e.extendPresence(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"_conference",namespace:r.Namespace.BOOKMARKS,element:"conference",fields:{name:t.attribute("name"),autoJoin:t.boolAttribute("autojoin"),jid:t.jidAttribute("jid"),nick:t.textSub(r.Namespace.BOOKMARKS,"nick")}}),i=e.define({name:"bookmarks",namespace:r.Namespace.BOOKMARKS,element:"storage"});e.extend(i,n,"conferences"),e.withDefinition("query",r.Namespace.PRIVATE,function(t){e.extend(t,i)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils;e.define({name:"bosh",namespace:r.Namespace.BOSH,element:"body",prefixes:{xmpp:r.Namespace.BOSH_XMPP},fields:{accept:t.attribute("accept"),ack:t.numberAttribute("ack"),authid:t.attribute("authid"),charsets:t.attribute("charsets"),condition:t.attribute("condition"),content:t.attribute("content"),from:t.jidAttribute("from",!0),hold:t.numberAttribute("hold"),inactivity:t.numberAttribute("inactivity"),key:t.attribute("key"),maxpause:t.numberAttribute("maxpause"),newKey:t.attribute("newkey"),pause:t.numberAttribute("pause"),polling:t.numberAttribute("polling"),resport:t.numberAttribute("report"),requests:t.numberAttribute("requests"),rid:t.numberAttribute("rid"),sid:t.attribute("sid"),stream:t.attribute("stream"),time:t.attribute("time"),to:t.jidAttribute("to",!0),type:t.attribute("type"),ver:t.attribute("ver"),wait:t.numberAttribute("wait"),uri:t.textSub(r.Namespace.BOSH,"uri"),lang:t.langAttribute(),version:t.attribute("xmpp:version","1.0"),restart:t.attribute("xmpp:restart"),restartLogic:t.boolAttribute("xmpp:restartLogic"),payload:{get:function(){for(var t=[],n=0,r=this.xml.childNodes.length;n<r;n++){var i=e.build(this.xml.childNodes[n]);void 0!==i&&t.push(i)}return t},set:function(e){var t=this;e.forEach(function(e){t.xml.appendChild(e.xml)})}}}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"carbonSent",eventName:"carbon:sent",namespace:r.Namespace.CARBONS_2,element:"sent"}),n=e.define({name:"carbonReceived",eventName:"carbon:received",namespace:r.Namespace.CARBONS_2,element:"received"}),i=e.define({name:"carbonPrivate",eventName:"carbon:private",namespace:r.Namespace.CARBONS_2,element:"private"}),s=e.define({name:"enableCarbons",namespace:r.Namespace.CARBONS_2,element:"enable"}),o=e.define({name:"disableCarbons",namespace:r.Namespace.CARBONS_2,element:"disable"});e.withDefinition("forwarded",r.Namespace.FORWARD_0,function(r){e.extend(t,r),e.extend(n,r)}),e.extendMessage(t),e.extendMessage(n),e.extendMessage(i),e.extendIQ(s),e.extendIQ(o)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["next","prev","complete","cancel"],s=["bad-action","bad-locale","bad-payload","bad-sessionid","malformed-action","session-expired"];t.default=function(e){var t=e.utils,n=e.define({name:"command",namespace:r.Namespace.ADHOC_COMMANDS,element:"command",fields:{action:t.attribute("action"),node:t.attribute("node"),sessionid:t.attribute("sessionid"),status:t.attribute("status"),execute:t.subAttribute(r.Namespace.ADHOC_COMMANDS,"actions","execute"),actions:{get:function(){var e=[],n=t.find(this.xml,r.Namespace.ADHOC_COMMANDS,"actions");return n.length?(i.forEach(function(i){t.find(n[0],r.Namespace.ADHOC_COMMANDS,i).length&&e.push(i)}),e):[]},set:function(e){for(var n=t.findOrCreate(this.xml,r.Namespace.ADHOC_COMMANDS,"actions"),i=0,s=n.childNodes.length;i<s;i++)n.removeChild(n.childNodes[i]);e.forEach(function(e){n.appendChild(t.createElement(r.Namespace.ADHOC_COMMANDS,e.toLowerCase(),r.Namespace.ADHOC_COMMANDS))})}}}}),o=e.define({name:"_commandNote",namespace:r.Namespace.ADHOC_COMMANDS,element:"note",fields:{type:t.attribute("type"),value:t.text()}});e.extend(n,o,"notes"),e.extendIQ(n),e.withStanzaError(function(n){e.add(n,"adhocCommandCondition",t.enumSub(r.Namespace.ADHOC_COMMANDS,s))}),e.withDataForm(function(t){e.extend(n,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"clientStateIndication",namespace:r.Namespace.CSI,element:"csi"});e.define({name:"csiActive",eventName:"csi:active",namespace:r.Namespace.CSI,element:"active",topLevel:!0}),e.define({name:"csiInactive",eventName:"csi:inactive",namespace:r.Namespace.CSI,element:"inactive",topLevel:!0}),e.extendStreamFeatures(t)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(5),s=["text-single","text-private","list-single","jid-single"];t.default=function(e){var t=e.utils,n=e.define({name:"_field",namespace:r.Namespace.DATAFORM,element:"field",init:function(e){this._type=(e||{}).type||this.type},fields:{type:{get:function(){return t.getAttribute(this.xml,"type","text-single")},set:function(e){this._type=e,t.setAttribute(this.xml,"type",e)}},name:t.attribute("var"),desc:t.textSub(r.Namespace.DATAFORM,"desc"),required:t.boolSub(r.Namespace.DATAFORM,"required"),label:t.attribute("label"),value:{get:function(){var e=t.getMultiSubText(this.xml,r.Namespace.DATAFORM,"value");return"boolean"===this._type?"1"===e[0]||"true"===e[0]:e.length>1?"text-multi"===this._type?e.join("\n"):"jid-multi"===this._type?e.map(function(e){return new i.JID(e)}):e:s.indexOf(this._type)>=0?"jid-single"===this._type?new i.JID(e[0]):e[0]:e},set:function(e){if("boolean"===this._type||!0===e||!1===e){var n=!0===e||"true"===e||"1"===e,i=t.createElement(r.Namespace.DATAFORM,"value",r.Namespace.DATAFORM);i.textContent=n?"1":"0",this.xml.appendChild(i)}else"text-multi"===this._type&&"string"==typeof e&&(e=e.split("\n")),t.setMultiSubText(this.xml,r.Namespace.DATAFORM,"value",e,function(e){var n=t.createElement(r.Namespace.DATAFORM,"value",r.Namespace.DATAFORM);n.textContent=e,this.xml.appendChild(n)}.bind(this))}}}}),o=e.define({name:"_formoption",namespace:r.Namespace.DATAFORM,element:"option",fields:{label:t.attribute("label"),value:t.textSub(r.Namespace.DATAFORM,"value")}}),a=e.define({name:"_formitem",namespace:r.Namespace.DATAFORM,element:"item"}),c=e.define({name:"media",element:"media",namespace:r.Namespace.DATAFORM_MEDIA,fields:{height:t.numberAttribute("height"),width:t.numberAttribute("width")}}),u=e.define({name:"_mediaURI",element:"uri",namespace:r.Namespace.DATAFORM_MEDIA,fields:{uri:t.text(),type:t.attribute("type")}}),l=e.define({name:"validation",element:"validate",namespace:r.Namespace.DATAFORM_VALIDATION,fields:{dataType:t.attribute("datatype"),basic:t.boolSub(r.Namespace.DATAFORM_VALIDATION,"basic"),open:t.boolSub(r.Namespace.DATAFORM_VALIDATION,"open"),regex:t.textSub(r.Namespace.DATAFORM_VALIDATION,"regex")}}),d=e.define({name:"range",element:"range",namespace:r.Namespace.DATAFORM_VALIDATION,fields:{min:t.attribute("min"),max:t.attribute("max")}}),p=e.define({name:"select",element:"list-range",namespace:r.Namespace.DATAFORM_VALIDATION,fields:{min:t.numberAttribute("min"),max:t.numberAttribute("max")}}),f={get:function(){for(var e=[],t=0,n=this.xml.childNodes.length;t<n;t++){var i=this.xml.childNodes[t];if(i.namespaceURI===r.Namespace.DATAFORM_LAYOUT)switch(i.localName){case"text":e.push({text:i.textContent});break;case"fieldref":e.push({field:i.getAttribute("var")});break;case"reportedref":e.push({reported:!0});break;case"section":e.push({section:new h(null,i,this).toJSON()})}}return e},set:function(e){for(var n=0,i=e.length;n<i;n++){var s=e[n];if(s.text){var o=t.createElement(r.Namespace.DATAFORM_LAYOUT,"text",r.Namespace.DATAFORM_LAYOUT);o.textContent=s.text,this.xml.appendChild(o)}if(s.field){var a=t.createElement(r.Namespace.DATAFORM_LAYOUT,"fieldref",r.Namespace.DATAFORM_LAYOUT);a.setAttribute("var",s.field),this.xml.appendChild(a)}if(s.reported&&this.xml.appendChild(t.createElement(r.Namespace.DATAFORM_LAYOUT,"reportedref",r.Namespace.DATAFORM_LAYOUT)),s.section){var c=t.createElement(r.Namespace.DATAFORM_LAYOUT,"section",r.Namespace.DATAFORM_LAYOUT);this.xml.appendChild(c);var u=new h(null,c);u.label=s.section.label,u.contents=s.section.contents}}}},h=e.define({name:"_section",element:"section",namespace:r.Namespace.DATAFORM_LAYOUT,fields:{label:t.attribute("label"),contents:f}}),m=e.define({name:"_page",element:"page",namespace:r.Namespace.DATAFORM_LAYOUT,fields:{label:t.attribute("label"),contents:f}}),g=e.define({name:"form",namespace:r.Namespace.DATAFORM,element:"x",init:function(){if(this.reportedFields.length){var e={};this.reportedFields.forEach(function(t){e[t.name]=t.type}),this.items.forEach(function(t){t.fields.forEach(function(t){t.type=t._type=e[t.name]})})}},fields:{title:t.textSub(r.Namespace.DATAFORM,"title"),instructions:t.multiTextSub(r.Namespace.DATAFORM,"instructions"),type:t.attribute("type","form"),reportedFields:t.subMultiExtension(r.Namespace.DATAFORM,"reported",n)}});e.extend(g,n,"fields"),e.extend(g,a,"items"),e.extend(g,m,"layout"),e.extend(n,c),e.extend(n,l),e.extend(n,o,"options"),e.extend(a,n,"fields"),e.extend(c,u,"uris"),e.extend(l,d),e.extend(l,p),e.extendMessage(g)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"delay",namespace:r.Namespace.DELAY,element:"delay",fields:{from:t.jidAttribute("from"),stamp:t.dateAttribute("stamp"),reason:t.text()}});e.extendMessage(n),e.extendPresence(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"caps",namespace:r.Namespace.CAPS,element:"c",fields:{ver:t.attribute("ver"),node:t.attribute("node"),hash:t.attribute("hash"),ext:t.attribute("ext")}}),i=e.define({name:"discoInfo",namespace:r.Namespace.DISCO_INFO,element:"query",fields:{node:t.attribute("node"),features:t.multiSubAttribute(r.Namespace.DISCO_INFO,"feature","var")}}),s=e.define({name:"_discoIdentity",namespace:r.Namespace.DISCO_INFO,element:"identity",fields:{category:t.attribute("category"),type:t.attribute("type"),name:t.attribute("name"),lang:t.langAttribute()}}),o=e.define({name:"discoItems",namespace:r.Namespace.DISCO_ITEMS,element:"query",fields:{node:t.attribute("node")}}),a=e.define({name:"_discoItem",namespace:r.Namespace.DISCO_ITEMS,element:"item",fields:{jid:t.jidAttribute("jid"),node:t.attribute("node"),name:t.attribute("name")}});e.extend(o,a,"items"),e.extend(i,s,"identities"),e.extendIQ(i),e.extendIQ(o),e.extendPresence(n),e.extendStreamFeatures(n),e.withDataForm(function(t){e.extend(i,t,"extensions")}),e.withDefinition("set",r.Namespace.RSM,function(t){e.extend(o,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["bad-request","conflict","feature-not-implemented","forbidden","gone","internal-server-error","item-not-found","jid-malformed","not-acceptable","not-allowed","not-authorized","payment-required","recipient-unavailable","redirect","registration-required","remote-server-not-found","remote-server-timeout","resource-constraint","service-unavailable","subscription-required","undefined-condition","unexpected-request"];t.default=function(e){var t=e.utils,n=e.define({name:"error",namespace:r.Namespace.CLIENT,element:"error",fields:{lang:{get:function(){return(this.parent||{}).lang||""}},condition:t.enumSub(r.Namespace.STANZA_ERROR,i),gone:{get:function(){return t.getSubText(this.xml,r.Namespace.STANZA_ERROR,"gone")},set:function(e){this.condition="gone",t.setSubText(this.xml,r.Namespace.STANZA_ERROR,"gone",e)}},redirect:{get:function(){return t.getSubText(this.xml,r.Namespace.STANZA_ERROR,"redirect")},set:function(e){this.condition="redirect",t.setSubText(this.xml,r.Namespace.STANZA_ERROR,"redirect",e)}},code:t.attribute("code"),type:t.attribute("type"),by:t.jidAttribute("by"),$text:{get:function(){return t.getSubLangText(this.xml,r.Namespace.STANZA_ERROR,"text",this.lang)}},text:{get:function(){return this.$text[this.lang]||""},set:function(e){t.setSubLangText(this.xml,r.Namespace.STANZA_ERROR,"text",e,this.lang)}}}});e.extendMessage(n),e.extendPresence(n),e.extendIQ(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var n=e.utils,i=t.Services=e.define({name:"services",namespace:r.Namespace.DISCO_EXTERNAL_1,element:"services",fields:{type:n.attribute("type")}}),s=t.Credentials=e.define({name:"credentials",namespace:r.Namespace.DISCO_EXTERNAL_1,element:"credentials"}),o=e.define({name:"service",namespace:r.Namespace.DISCO_EXTERNAL_1,element:"service",fields:{host:n.attribute("host"),port:n.attribute("port"),transport:n.attribute("transport"),type:n.attribute("type"),username:n.attribute("username"),password:n.attribute("password")}});e.extend(i,o,"services"),e.extend(s,o),e.extendIQ(i),e.extendIQ(s),e.withDataForm(function(t){e.extend(o,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=r.Namespace.FILE_TRANSFER_4;t.default=function(e){var t=e.utils,n=e.define({name:"file",namespace:i,element:"file",fields:{name:t.textSub(i,"name"),description:t.textSub(i,"desc"),mediaType:t.textSub(i,"media-type"),size:t.numberSub(i,"size"),date:t.dateSub(i,"date")}}),s=e.define({name:"range",namespace:i,element:"range",fields:{offset:t.numberAttribute("offset"),length:t.numberAttribute("length")}}),o=e.define({name:"_"+i,namespace:i,element:"description",tags:["jingle-application"],fields:{applicationType:{value:i}}}),a=e.define({name:"_{"+i+"}received",namespace:i,element:"received",tags:["jingle-info"],fields:{infoType:{value:"{"+i+"}received"},creator:t.attribute("creator"),name:t.attribute("name")}}),c=e.define({name:"_{"+i+"}checksum",namespace:i,element:"checksum",tags:["jingle-info"],fields:{infoType:{value:"{"+i+"}checksum"},creator:t.attribute("creator"),name:t.attribute("name")}});e.extend(n,s),e.extend(c,n),e.extend(o,n),e.withDefinition("hash",r.Namespace.HASHES_1,function(t){e.extend(n,t,"hashes"),e.extend(s,t,"hashes")}),e.withDefinition("content",r.Namespace.JINGLE_1,function(t){e.extend(t,o)}),e.withDefinition("jingle",r.Namespace.JINGLE_1,function(t){e.extend(t,a),e.extend(t,c)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=r.Namespace.FILE_TRANSFER_3;t.default=function(e){var t=e.utils,n=e.define({name:"_file",namespace:i,element:"file",fields:{name:t.textSub(i,"name"),desc:t.textSub(i,"desc"),size:t.numberSub(i,"size"),date:t.dateSub(i,"date")}}),s=e.define({name:"range",namespace:i,element:"range",fields:{offset:t.numberAttribute("offset")}}),o=e.define({name:"thumbnail",namespace:r.Namespace.THUMBS_0,element:"thumbnail",fields:{cid:t.attribute("cid"),mimeType:t.attribute("mime-type"),width:t.numberAttribute("width"),height:t.numberAttribute("height")}}),a=e.define({name:"_filetransfer",namespace:i,element:"description",tags:["jingle-application"],fields:{applicationType:{value:"filetransfer"},offer:t.subExtension("offer",i,"offer",n),request:t.subExtension("request",i,"request",n)}});e.extend(n,s),e.extend(n,o),e.withDefinition("hash",r.Namespace.HASHES_1,function(t){e.extend(n,t,"hashes")}),e.withDefinition("content",r.Namespace.JINGLE_1,function(t){e.extend(t,a)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"forwarded",namespace:r.Namespace.FORWARD_0,element:"forwarded"});e.withMessage(function(n){e.extend(n,t),e.extend(t,n)}),e.withPresence(function(n){e.extend(n,t),e.extend(t,n)}),e.withIQ(function(n){e.extend(n,t),e.extend(t,n)}),e.withDefinition("delay",r.Namespace.DELAY,function(n){e.extend(t,n)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils;e.define({name:"openStream",namespace:r.Namespace.FRAMING,element:"open",topLevel:!0,fields:{lang:t.langAttribute(),id:t.attribute("id"),version:t.attribute("version","1.0"),to:t.jidAttribute("to",!0),from:t.jidAttribute("from",!0)}}),e.define({name:"closeStream",namespace:r.Namespace.FRAMING,element:"close",topLevel:!0,fields:{seeOtherURI:t.attribute("see-other-uri")}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"geoloc",namespace:r.Namespace.GEOLOC,element:"geoloc",fields:{accuracy:t.numberSub(r.Namespace.GEOLOC,"accuracy",!0),altitude:t.numberSub(r.Namespace.GEOLOC,"alt",!0),area:t.textSub(r.Namespace.GEOLOC,"area"),heading:t.numberSub(r.Namespace.GEOLOC,"bearing",!0),bearing:t.numberSub(r.Namespace.GEOLOC,"bearing",!0),building:t.textSub(r.Namespace.GEOLOC,"building"),country:t.textSub(r.Namespace.GEOLOC,"country"),countrycode:t.textSub(r.Namespace.GEOLOC,"countrycode"),datum:t.textSub(r.Namespace.GEOLOC,"datum"),description:t.textSub(r.Namespace.GEOLOC,"description"),error:t.numberSub(r.Namespace.GEOLOC,"error",!0),floor:t.textSub(r.Namespace.GEOLOC,"floor"),latitude:t.numberSub(r.Namespace.GEOLOC,"lat",!0),locality:t.textSub(r.Namespace.GEOLOC,"locality"),longitude:t.numberSub(r.Namespace.GEOLOC,"lon",!0),postalcode:t.textSub(r.Namespace.GEOLOC,"postalcode"),region:t.textSub(r.Namespace.GEOLOC,"region"),room:t.textSub(r.Namespace.GEOLOC,"room"),speed:t.numberSub(r.Namespace.GEOLOC,"speed",!0),street:t.textSub(r.Namespace.GEOLOC,"street"),text:t.textSub(r.Namespace.GEOLOC,"text"),timestamp:t.dateSub(r.Namespace.GEOLOC,"timestamp"),tzo:t.tzoSub(r.Namespace.GEOLOC,"tzo"),uri:t.textSub(r.Namespace.GEOLOC,"uri")}});e.extendPubsubItem(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){e.define({name:"hash",namespace:r.Namespace.HASHES_1,element:"hash",fields:{algo:e.utils.attribute("algo"),value:e.utils.text()}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"_hat",namespace:r.Namespace.HATS_0,element:"hat",fields:{lang:e.utils.langAttribute(),name:e.utils.attribute("name"),displayName:e.utils.attribute("displayName")}});e.withPresence(function(n){e.add(n,"hats",e.utils.subMultiExtension(r.Namespace.HATS_0,"hats",t))})},e.exports=t.default},function(e,t,n){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s="http://jabber.org/protocol/ibb",o="urn:xmpp:jingle:transports:ibb:1";t.default=function(e){var t=e.utils,n={get:function(){var e=t.find(this.xml,s,"data");if(e.length)return e=e[0],{action:"data",sid:t.getAttribute(e,"sid"),seq:parseInt(t.getAttribute(e,"seq")||"0",10),data:new r(t.getText(e),"base64")};var n=t.find(this.xml,s,"open");if(n.length){n=n[0];var i=t.getAttribute(n,"stanza");return i="message"!==i,{action:"open",sid:t.getAttribute(n,"sid"),blockSize:t.getAttribute(n,"block-size"),ack:i}}var o=t.find(this.xml,s,"close");return o.length?{action:"close",sid:t.getAttribute(o[0],"sid")}:void 0},set:function(e){if("data"===e.action){var n=t.createElement(s,"data");t.setAttribute(n,"sid",e.sid),t.setAttribute(n,"seq",e.seq.toString()),t.setText(n,e.data.toString("base64")),this.xml.appendChild(n)}if("open"===e.action){var r=t.createElement(s,"open");t.setAttribute(r,"sid",e.sid),t.setAttribute(r,"block-size",(e.blockSize||"4096").toString()),!1===e.ack?t.setAttribute(r,"stanza","message"):t.setAttribute(r,"stanza","iq"),this.xml.appendChild(r)}if("close"===e.action){var i=t.createElement(s,"close");t.setAttribute(i,"sid",e.sid),this.xml.appendChild(i)}}},a=e.define({name:"_"+o,namespace:o,element:"transport",tags:["jingle-transport"],fields:{transportType:{value:o},sid:t.attribute("sid"),blockSize:t.numberAttribute("block-size"),ack:{get:function(){return"message"!==t.getAttribute(this.xml,"stanza")},set:function(e){!1===e.ack?t.setAttribute(this.xml,"stanza","message"):t.setAttribute(this.xml,"stanza","iq")}}}});e.withDefinition("content",i.Namespace.JINGLE_1,function(t){e.extend(t,a)}),e.withIQ(function(t){e.add(t,"ibb",n)}),e.withMessage(function(t){e.add(t,"ibb",n)})},e.exports=t.default}).call(t,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"_iceUdp",namespace:r.Namespace.JINGLE_ICE_UDP_1,element:"transport",tags:["jingle-transport"],fields:{transportType:{value:"iceUdp"},pwd:t.attribute("pwd"),ufrag:t.attribute("ufrag")}}),i=e.define({name:"remoteCandidate",namespace:r.Namespace.JINGLE_ICE_UDP_1,element:"remote-candidate",fields:{component:t.attribute("component"),ip:t.attribute("ip"),port:t.attribute("port")}}),s=e.define({name:"_iceUdpCandidate",namespace:r.Namespace.JINGLE_ICE_UDP_1,element:"candidate",fields:{component:t.attribute("component"),foundation:t.attribute("foundation"),generation:t.attribute("generation"),id:t.attribute("id"),ip:t.attribute("ip"),network:t.attribute("network"),port:t.attribute("port"),priority:t.attribute("priority"),protocol:t.attribute("protocol"),relAddr:t.attribute("rel-addr"),relPort:t.attribute("rel-port"),tcpType:t.attribute("tcptype"),type:t.attribute("type")}}),o=e.define({name:"_iceFingerprint",namespace:r.Namespace.JINGLE_DTLS_0,element:"fingerprint",fields:{hash:t.attribute("hash"),setup:t.attribute("setup"),value:t.text(),required:t.boolAttribute("required")}}),a=e.define({name:"_sctpMap",namespace:r.Namespace.DTLS_SCTP_1,element:"sctpmap",fields:{number:t.attribute("number"),protocol:t.attribute("protocol"),streams:t.attribute("streams")}});e.extend(n,s,"candidates"),e.extend(n,i),e.extend(n,o,"fingerprints"),e.extend(n,a,"sctp"),e.withDefinition("content",r.Namespace.JINGLE_1,function(t){e.extend(t,n)})},e.exports=t.default},function(e,t,n){"use strict";var r=n(27).default;Object.defineProperty(t,"__esModule",{value:!0});var i=n(91),s=r(i),o=n(92),a=r(o),c=n(93),u=r(c),l=n(94),d=r(l),p=n(95),f=r(p),h=n(96),m=r(h),g=n(97),v=r(g),b=n(98),y=r(b),_=n(99),S=r(_),T=n(100),E=r(T),w=n(101),R=r(w),C=n(102),x=r(C),A=n(103),I=r(A),N=n(104),O=r(N),D=n(105),P=r(D),M=n(106),U=r(M),k=n(107),j=r(k),L=n(108),$=r(L),X=n(109),q=r(X),B=n(110),F=r(B),H=n(111),G=r(H),V=n(112),J=r(V),W=n(114),z=r(W),K=n(113),Y=r(K),Q=n(116),Z=r(Q),ee=n(117),te=r(ee),ne=n(118),re=r(ne),ie=n(119),se=r(ie),oe=n(120),ae=r(oe),ce=n(121),ue=r(ce),le=n(122),de=r(le),pe=n(123),fe=r(pe),he=n(124),me=r(he),ge=n(125),ve=r(ge),be=n(126),ye=r(be),_e=n(127),Se=r(_e),Te=n(128),Ee=r(Te),we=n(129),Re=r(we),Ce=n(130),xe=r(Ce),Ae=n(131),Ie=r(Ae),Ne=n(132),Oe=r(Ne),De=n(133),Pe=r(De),Me=n(134),Ue=r(Me),ke=n(135),je=r(ke),Le=n(136),$e=r(Le),Xe=n(138),qe=r(Xe),Be=n(137),Fe=r(Be),He=n(139),Ge=r(He),Ve=n(140),Je=r(Ve),We=n(141),ze=r(We),Ke=n(142),Ye=r(Ke),Qe=n(143),Ze=r(Qe),et=n(144),tt=r(et),nt=n(145),rt=r(nt),it=n(146),st=r(it),ot=n(147),at=r(ot),ct=n(148),ut=r(ct),lt=n(149),dt=r(lt),pt=n(150),ft=r(pt),ht=n(151),mt=r(ht),gt=n(152),vt=r(gt),bt=n(153),yt=r(bt),_t=n(154),St=r(_t);t.default=function(e){e.use(s.default),e.use(a.default),e.use(u.default),e.use(d.default),e.use(f.default),e.use(m.default),e.use(v.default),e.use(y.default),e.use(S.default),e.use(E.default),e.use(R.default),e.use(x.default),e.use(I.default),e.use(O.default),e.use(P.default),e.use(U.default),e.use(j.default),e.use($.default),e.use(q.default),e.use(F.default),e.use(G.default),e.use(J.default),e.use(z.default),e.use(Y.default),e.use(Z.default),e.use(te.default),e.use(re.default),e.use(se.default),e.use(ae.default),e.use(ue.default),e.use(de.default),e.use(fe.default),e.use(me.default),e.use(ve.default),e.use(ye.default),e.use(Se.default),e.use(Ee.default),e.use(Re.default),e.use(xe.default),e.use(Ie.default),e.use(Oe.default),e.use(Pe.default),e.use(Ue.default),e.use(je.default),e.use($e.default),e.use(qe.default),e.use(Fe.default),e.use(Ge.default),e.use(Je.default),e.use(ze.default),e.use(Ye.default),e.use(Ze.default),e.use(tt.default),e.use(rt.default),e.use(st.default),e.use(at.default),e.use(ut.default),e.use(dt.default),e.use(ft.default),e.use(mt.default),e.use(vt.default),e.use(yt.default),e.use(St.default)},e.exports=t.default},function(e,t,n){"use strict";var r=n(155).default;Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s={};s.defineIQ=function(e,t,n){var i=e.utils,s=e.define({name:t,namespace:n,element:"iq",topLevel:!0,fields:{lang:i.langAttribute(),id:i.attribute("id"),to:i.jidAttribute("to",!0),from:i.jidAttribute("from",!0),type:i.attribute("type")}}),o=s.prototype.toJSON;r(s.prototype,{toJSON:function(){var e=o.call(this);return e.resultReply=this.resultReply,e.errorReply=this.errorReply,e},resultReply:function(e){return e=e||{},e.to=this.from,e.id=this.id,e.type="result",new s(e)},errorReply:function(e){return e=e||{},e.to=this.from,e.id=this.id,e.type="error",new s(e)}})},t.default=function(e){s.defineIQ(e,"iq",i.Namespace.CLIENT),s.defineIQ(e,"serverIQ",i.Namespace.SERVER),s.defineIQ(e,"componentIQ",i.Namespace.COMPONENT)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(5);t.default=function(e){e.withIQ(function(t){e.add(t,"jidPrep",{get:function(){var t=e.utils.getSubText(this.xml,r.Namespace.JID_PREP_0,"jid");if(t){var n=new i.JID(t);return n.prepped=!0,n}},set:function(t){e.utils.setSubText(this.xml,r.Namespace.JID_PREP_0,"jid",(t||"").toString())}})})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["out-of-order","tie-break","unknown-session","unsupported-info"],s=["alternative-session","busy","cancel","connectivity-error","decline","expired","failed-application","failed-transport","general-error","gone","incompatible-parameters","media-error","security-error","success","timeout","unsupported-applications","unsupported-transports"];t.default=function(e){var t=e.utils,n=e.define({name:"jingle",namespace:r.Namespace.JINGLE_1,element:"jingle",fields:{action:t.attribute("action"),initiator:t.attribute("initiator"),responder:t.attribute("responder"),sid:t.attribute("sid"),info:{get:function(){for(var n=e.tagged("jingle-info").map(function(e){return e.prototype._name}),r=0,i=n.length;r<i;r++)if(this._extensions[n[r]])return this._extensions[n[r]];if("session-info"===t.getAttribute(this.xml,"action"))return 0===this.xml.children.length?{infoType:"ping"}:{infoType:"unknown"}},set:function(e){if("ping"!==e.infoType){this["_"+e.infoType]=e}}}}}),o=e.define({name:"_jingleContent",namespace:r.Namespace.JINGLE_1,element:"content",fields:{creator:t.attribute("creator"),disposition:t.attribute("disposition","session"),name:t.attribute("name"),senders:t.attribute("senders","both"),application:{get:function(){for(var t=e.tagged("jingle-application").map(function(e){return e.prototype._name}),n=0,r=t.length;n<r;n++)if(this._extensions[t[n]])return this._extensions[t[n]]},set:function(e){this["_"+e.applicationType]=e}},transport:{get:function(){for(var t=e.tagged("jingle-transport").map(function(e){return e.prototype._name}),n=0,r=t.length;n<r;n++)if(this._extensions[t[n]])return this._extensions[t[n]]},set:function(e){this["_"+e.transportType]=e}},security:{get:function(){for(var t=e.tagged("jingle-security").map(function(e){return Security.prototype._name}),n=0,r=t.length;n<r;n++)if(this._extensions[t[n]])return this._extensions[t[n]]},set:function(e){this["_"+e.securityType]=e}}}}),a=e.define({name:"reason",namespace:r.Namespace.JINGLE_1,element:"reason",fields:{condition:t.enumSub(r.Namespace.JINGLE_1,s),alternativeSession:{get:function(){return t.getSubText(this.xml,r.Namespace.JINGLE_1,"alternative-session")},set:function(e){this.condition="alternative-session",t.setSubText(this.xml,r.Namespace.JINGLE_1,"alternative-session",e)}},text:t.textSub(r.Namespace.JINGLE_1,"text")}});e.extend(n,o,"contents"),e.extend(n,a),e.extendIQ(n),e.withStanzaError(function(n){e.add(n,"jingleCondition",t.enumSub(r.Namespace.JINGLE_ERRORS_1,i))})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t={get:function(){var t=e.utils.getSubText(this.xml,r.Namespace.JSON_0,"json");if(t)return JSON.parse(t)},set:function(t){(t=JSON.stringify(t))&&e.utils.setSubText(this.xml,r.Namespace.JSON_0,"json",t)}};e.withMessage(function(n){e.add(n,"json",t)}),e.withPubsubItem(function(n){e.add(n,"json",t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"log",namespace:r.Namespace.EVENTLOG,element:"log",fields:{id:t.attribute("id"),timestamp:t.dateAttribute("timestamp"),type:t.attribute("type"),level:t.attribute("level"),object:t.attribute("object"),subject:t.attribute("subject"),facility:t.attribute("facility"),module:t.attribute("module"),message:t.textSub(r.Namespace.EVENTLOG,"message"),stackTrace:t.textSub(r.Namespace.EVENTLOG,"stackTrace")}}),i=e.define({name:"_logtag",namespace:r.Namespace.EVENTLOG,element:"tag",fields:{name:t.attribute("name"),value:t.attribute("value"),type:t.attribute("type")}});e.extend(n,i,"tags"),e.extendMessage(n),e.extendPubsubItem(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(5);t.default=function(e){var t=e.utils,n=e.define({name:"mam",namespace:r.Namespace.MAM_0,element:"query",fields:{queryid:t.attribute("queryid")}}),s=e.define({name:"mamItem",namespace:r.Namespace.MAM_0,element:"result",fields:{queryid:t.attribute("queryid"),id:t.attribute("id")}}),o=e.define({name:"mamResult",namespace:r.Namespace.MAM_0,element:"fin",fields:{queryid:t.attribute("queryid"),complete:t.boolAttribute("complete"),stable:t.boolAttribute("stable")}}),a=e.define({name:"mamPrefs",namespace:r.Namespace.MAM_0,element:"prefs",fields:{defaultCondition:t.attribute("default"),always:{get:function(){var e=[],n=t.find(this.xml,r.Namespace.MAM_0,"always");return 0===n.length?e:(n=n[0],t.getMultiSubText(n,r.Namespace.MAM_0,"jid").forEach(function(t){e.push(new i.JID(t.textContent))}),e)},set:function(e){if(e.length>0){var n=t.findOrCreate(this.xml,r.Namespace.MAM_0,"always");t.setMultiSubText(n,r.Namespace.MAM_0,"jid",e)}}},never:{get:function(){var e=[],n=t.find(this.xml,r.Namespace.MAM_0,"always");return 0===n.length?e:(n=n[0],t.getMultiSubText(n,r.Namespace.MAM_0,"jid").forEach(function(t){e.push(new i.JID(t.textContent))}),e)},set:function(e){if(e.length>0){var n=t.findOrCreate(this.xml,r.Namespace.MAM_0,"never");t.setMultiSubText(n,r.Namespace.MAM_0,"jid",e)}}}}});e.extendMessage(s),e.extendMessage(o),e.extendIQ(n),e.extendIQ(a),e.withDataForm(function(t){e.extend(n,t)}),e.withDefinition("forwarded",r.Namespace.FORWARD_0,function(t){e.extend(s,t)}),e.withDefinition("set",r.Namespace.RSM,function(t){e.extend(n,t),e.extend(o,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i={};i.defineMessage=function(e,t,n){var i=e.utils;e.define({name:t,namespace:n,element:"message",topLevel:!0,fields:{lang:i.langAttribute(),id:i.attribute("id"),to:i.jidAttribute("to",!0),from:i.jidAttribute("from",!0),type:i.attribute("type","normal"),thread:i.textSub(n,"thread"),parentThread:i.subAttribute(n,"thread","parent"),subject:i.textSub(n,"subject"),$body:{get:function(){return i.getSubLangText(this.xml,n,"body",this.lang)}},body:{get:function(){return this.$body[this.lang]||""},set:function(e){i.setSubLangText(this.xml,n,"body",e,this.lang)}},attention:i.boolSub(r.Namespace.ATTENTION_0,"attention"),chatState:i.enumSub(r.Namespace.CHAT_STATES,["active","composing","paused","inactive","gone"]),replace:i.subAttribute(r.Namespace.CORRECTION_0,"replace","id"),requestReceipt:i.boolSub(r.Namespace.RECEIPTS,"request"),receipt:i.subAttribute(r.Namespace.RECEIPTS,"received","id")}})},t.default=function(e){i.defineMessage(e,"message",r.Namespace.CLIENT),i.defineMessage(e,"serverMessage",r.Namespace.SERVER),i.defineMessage(e,"componentMessage",r.Namespace.COMPONENT)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"];t.default=function(e){var t=e.define({name:"mood",namespace:r.Namespace.MOOD,element:"mood",fields:{text:e.utils.textSub(r.Namespace.MOOD,"text"),value:e.utils.enumSub(r.Namespace.MOOD,i)}});e.extendMessage(t),e.extendPubsubItem(t)},e.exports=t.default},function(e,t,n){"use strict";function r(e,t){return{get:function(){if(this._extensions[e])return this[e][t]},set:function(n){this[e][t]=n}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"_mucUserItem",namespace:i.Namespace.MUC_USER,element:"item",fields:{affiliation:t.attribute("affiliation"),nick:t.attribute("nick"),jid:t.jidAttribute("jid"),role:t.attribute("role"),reason:t.textSub(i.Namespace.MUC_USER,"reason")}}),s=e.define({name:"_mucUserActor",namespace:i.Namespace.MUC_USER,element:"actor",fields:{nick:t.attribute("nick"),jid:t.jidAttribute("jid")}}),o=e.define({name:"destroyed",namespace:i.Namespace.MUC_USER,element:"destroy",fields:{jid:t.jidAttribute("jid"),reason:t.textSub(i.Namespace.MUC_USER,"reason")}}),a=e.define({name:"invite",namespace:i.Namespace.MUC_USER,element:"invite",fields:{to:t.jidAttribute("to"),from:t.jidAttribute("from"),reason:t.textSub(i.Namespace.MUC_USER,"reason"),thread:t.subAttribute(i.Namespace.MUC_USER,"continue","thread"),continue:t.boolSub(i.Namespace.MUC_USER,"continue")}}),c=e.define({name:"decline",namespace:i.Namespace.MUC_USER,element:"decline",fields:{to:t.jidAttribute("to"),from:t.jidAttribute("from"),reason:t.textSub(i.Namespace.MUC_USER,"reason")}}),u=e.define({name:"_mucAdminItem",namespace:i.Namespace.MUC_ADMIN,element:"item",fields:{affiliation:t.attribute("affiliation"),nick:t.attribute("nick"),jid:t.jidAttribute("jid"),role:t.attribute("role"),reason:t.textSub(i.Namespace.MUC_ADMIN,"reason")}}),l=e.define({name:"actor",namespace:i.Namespace.MUC_USER,element:"actor",fields:{nick:t.attribute("nick"),jid:t.jidAttribute("jid")}}),d=e.define({name:"destroy",namespace:i.Namespace.MUC_OWNER,element:"destroy",fields:{jid:t.jidAttribute("jid"),password:t.textSub(i.Namespace.MUC_OWNER,"password"),reason:t.textSub(i.Namespace.MUC_OWNER,"reason")}}),p=e.define({name:"muc",namespace:i.Namespace.MUC_USER,element:"x",fields:{affiliation:r("_mucUserItem","affiliation"),nick:r("_mucUserItem","nick"),jid:r("_mucUserItem","jid"),role:r("_mucUserItem","role"),actor:r("_mucUserItem","_mucUserActor"),reason:r("_mucUserItem","reason"),password:t.textSub(i.Namespace.MUC_USER,"password"),codes:{get:function(){return t.getMultiSubText(this.xml,i.Namespace.MUC_USER,"status",function(e){return t.getAttribute(e,"code")})},set:function(e){var n=this;t.setMultiSubText(this.xml,i.Namespace.MUC_USER,"status",e,function(e){var r=t.createElement(i.Namespace.MUC_USER,"status",i.Namespace.MUC_USER);t.setAttribute(r,"code",e),n.xml.appendChild(r)})}}}}),f=e.define({name:"mucAdmin",namespace:i.Namespace.MUC_ADMIN,element:"query",fields:{affiliation:r("_mucAdminItem","affiliation"),nick:r("_mucAdminItem","nick"),jid:r("_mucAdminItem","jid"),role:r("_mucAdminItem","role"),actor:r("_mucAdminItem","_mucAdminActor"),reason:r("_mucAdminItem","reason")}}),h=e.define({name:"mucOwner",namespace:i.Namespace.MUC_OWNER,element:"query"}),m=e.define({name:"joinMuc",namespace:i.Namespace.MUC,element:"x",fields:{password:t.textSub(i.Namespace.MUC,"password"),history:{get:function(){var e={},n=t.find(this.xml,i.Namespace.MUC,"history");if(!n.length)return{};n=n[0];var r=n.getAttribute("maxchars")||"",s=n.getAttribute("maxstanzas")||"",o=n.getAttribute("seconds")||"",a=n.getAttribute("since")||"";r&&(e.maxchars=parseInt(r,10)),s&&(e.maxstanzas=parseInt(s,10)),o&&(e.seconds=parseInt(o,10)),a&&(e.since=new Date(a))},set:function(e){var n=t.find(this.xml,i.Namespace.MUC,"history");if(n.length)for(var r=0;r<n.length;r++)this.xml.removeChild(n[r]);var s=t.createElement(i.Namespace.MUC,"history",i.Namespace.MUC);this.xml.appendChild(s),e.maxchars&&s.setAttribute("maxchars",""+e.maxchars),e.maxstanzas&&s.setAttribute("maxstanzas",""+e.maxstanzas),e.seconds&&s.setAttribute("seconds",""+e.seconds),e.since&&s.setAttribute("since",e.since.toISOString())}}}}),g=e.define({name:"mucInvite",namespace:i.Namespace.MUC_DIRECT_INVITE,element:"x",fields:{jid:t.jidAttribute("jid"),password:t.attribute("password"),reason:t.attribute("reason"),thread:t.attribute("thread"),continue:t.boolAttribute("continue")}});e.extend(n,s),e.extend(p,n),e.extend(p,a,"invites"),e.extend(p,c),e.extend(p,o),e.extend(u,l),e.extend(f,u,"items"),e.extend(h,d),e.extendPresence(p),e.extendPresence(m),e.extendMessage(p),e.extendMessage(g),e.withIQ(function(n){e.add(n,"mucUnique",t.textSub(i.Namespace.MUC_UNIQUE,"unique")),e.extend(n,f),e.extend(n,h)}),e.withDataForm(function(t){e.extend(h,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils.textSub(r.Namespace.NICK,"nick");e.withPubsubItem(function(n){e.add(n,"nick",t)}),e.withPresence(function(n){e.add(n,"nick",t)}),e.withMessage(function(n){e.add(n,"nick",t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"oob",element:"x",namespace:r.Namespace.OOB,fields:{url:e.utils.textSub(r.Namespace.OOB,"url"),desc:e.utils.textSub(r.Namespace.OOB,"desc")}});e.extendMessage(t,"oobURIs")},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"ping",namespace:r.Namespace.PING,element:"ping"});e.extendIQ(t)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i={};i.definePresence=function(e,t,n){var i=e.utils;e.define({name:t,namespace:n,element:"presence",topLevel:!0,fields:{lang:i.langAttribute(),id:i.attribute("id"),to:i.jidAttribute("to",!0),from:i.jidAttribute("from",!0),priority:i.numberSub(n,"priority",!1,0),show:i.textSub(n,"show"),type:{get:function(){return i.getAttribute(this.xml,"type","available")},set:function(e){"available"===e&&(e=!1),i.setAttribute(this.xml,"type",e)}},$status:{get:function(){return i.getSubLangText(this.xml,n,"status",this.lang)}},status:{get:function(){return this.$status[this.lang]||""},set:function(e){i.setSubLangText(this.xml,n,"status",e,this.lang)}},idleSince:i.dateSubAttribute(r.Namespace.IDLE_1,"idle","since"),decloak:i.subAttribute(r.Namespace.DECLOAK_0,"decloak","reason"),avatarId:{get:function(){var e=i.find(this.xml,r.Namespace.VCARD_TEMP_UPDATE,"x");return e.length?i.getSubText(e[0],r.Namespace.VCARD_TEMP_UPDATE,"photo"):""},set:function(e){var t=i.findOrCreate(this.xml,r.Namespace.VCARD_TEMP_UPDATE,"x");if(""===e)i.setBoolSub(t,r.Namespace.VCARD_TEMP_UPDATE,"photo",!0);else{if(!0===e)return;e?i.setSubText(t,r.Namespace.VCARD_TEMP_UPDATE,"photo",e):this.xml.removeChild(t)}}}}})},t.default=function(e){i.definePresence(e,"presence",r.Namespace.CLIENT),i.definePresence(e,"serverPresence",r.Namespace.SERVER),i.definePresence(e,"componentPresence",r.Namespace.COMPONENT)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"privateStorage",namespace:r.Namespace.PRIVATE,element:"query"});e.extendIQ(t)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["server-unavailable","connection-paused"];t.default=function(e){var t=e.define({name:"state",namespace:r.Namespace.PSA,element:"state-annotation",fields:{from:e.utils.jidAttribute("from"),condition:e.utils.enumSub(r.Namespace.PSA,i),description:e.utils.textSub(r.Namespace.PSA,"description")}});e.extendPresence(t)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"pubsub",namespace:r.Namespace.PUBSUB,element:"pubsub",fields:{create:{get:function(){var e=t.getSubAttribute(this.xml,r.Namespace.PUBSUB,"create","node");return e||t.getBoolSub(this.xml,r.Namespace.PUBSUB,"create")},set:function(e){!0!==e&&e?t.setSubAttribute(this.xml,r.Namespace.PUBSUB,"create","node",e):t.setBoolSub(this.xml,r.Namespace.PUBSUB,"create",e)}},publishOptions:{get:function(){var n=e.getDefinition("x",r.Namespace.DATAFORM),i=t.find(this.xml,r.Namespace.PUBSUB,"publish-options");if(i.length&&i[0].childNodes.length)return new n({},i[0].childNodes[0])},set:function(n){var i=e.getDefinition("x",r.Namespace.DATAFORM),s=t.findOrCreate(this.xml,r.Namespace.PUBSUB,"publish-options");if(n){var o=new i(n);s.appendChild(o.xml)}}}}}),i=e.define({name:"config",namespace:r.Namespace.PUBSUB,element:"configure"}),s=e.define({name:"subscribe",namespace:r.Namespace.PUBSUB,element:"subscribe",fields:{node:t.attribute("node"),jid:t.jidAttribute("jid")}}),o=e.define({name:"subscription",namespace:r.Namespace.PUBSUB,element:"subscription",fields:{node:t.attribute("node"),jid:t.jidAttribute("jid"),subid:t.attribute("subid"),type:t.attribute("subscription"),configurable:t.boolSub("subscribe-options"),configurationRequired:{get:function(){var e=t.find(this.xml,r.Namespace.PUBSUB,"subscribe-options");return!!e.length&&t.getBoolSub(e[0],r.Namespace.PUBSUB,"required")}}}}),a=e.define({name:"subscriptions",namespace:r.Namespace.PUBSUB,element:"subscriptions",fields:{node:t.attribute("node"),jid:t.jidAttribute("jid")}}),c=e.define({name:"affiliation",namespace:r.Namespace.PUBSUB,element:"affiliation",fields:{node:t.attribute("node"),type:t.attribute("affiliation")}}),u=e.define({name:"affiliations",namespace:r.Namespace.PUBSUB,element:"affiliations",fields:{node:t.attribute("node")}}),l=e.define({name:"subscriptionOptions",namespace:r.Namespace.PUBSUB,element:"options",fields:{node:t.attribute("node"),jid:t.jidAttribute("jid"),subid:t.attribute("subid")}}),d=e.define({name:"unsubscribe",namespace:r.Namespace.PUBSUB,element:"unsubscribe",fields:{node:t.attribute("node"),subid:t.attribute("subid"),jid:t.jidAttribute("jid")}}),p=e.define({name:"publish",namespace:r.Namespace.PUBSUB,element:"publish",fields:{node:t.attribute("node")}}),f=e.define({name:"retract",namespace:r.Namespace.PUBSUB,element:"retract",fields:{node:t.attribute("node"),notify:t.boolAttribute("notify"),id:t.subAttribute(r.Namespace.PUBSUB,"item","id")}}),h=e.define({name:"retrieve",namespace:r.Namespace.PUBSUB,element:"items",fields:{node:t.attribute("node"),max:t.attribute("max_items")}}),m=e.define({name:"item",namespace:r.Namespace.PUBSUB,element:"item",fields:{id:t.attribute("id"),publisher:t.jidAttribute("publisher")}});e.extend(n,i),e.extend(n,s),e.extend(n,d),e.extend(n,p),e.extend(n,f),e.extend(n,h),e.extend(n,o),e.extend(n,l),e.extend(n,a),e.extend(n,u),e.extend(p,m,"items"),e.extend(h,m,"items"),e.extend(a,o,"list"),e.extend(u,c,"list"),e.extendIQ(n),e.withDataForm(function(t){e.extend(l,t),e.extend(m,t),e.extend(i,t)}),e.withDefinition("set",r.Namespace.RSM,function(t){e.extend(n,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["closed-node","configuration-required","invalid-jid","invalid-options","invalid-payload","invalid-subid","item-forbidden","item-required","jid-required","max-items-exceeded","max-nodes-exceeded","nodeid-required","not-in-roster-group","not-subscribed","payload-too-big","payload-required","pending-subscription","presence-subscription-required","subid-required","too-many-subscriptions","unsupported","unsupported-access-model"];t.default=function(e){e.withStanzaError(function(t){e.add(t,"pubsubCondition",e.utils.enumSub(r.Namespace.PUBSUB_ERRORS,i)),e.add(t,"pubsubUnsupportedFeature",{get:function(){return e.utils.getSubAttribute(this.xml,r.Namespace.PUBSUB_ERRORS,"unsupported","feature")},set:function(t){t&&(this.pubsubCondition="unsupported"),e.utils.setSubAttribute(this.xml,r.Namespace.PUBSUB_ERRORS,"unsupported","feature",t)}})})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"event",namespace:r.Namespace.PUBSUB_EVENT,element:"event"}),i=e.define({name:"purged",namespace:r.Namespace.PUBSUB_EVENT,element:"purge",fields:{node:t.attribute("node")}}),s=e.define({name:"deleted",namespace:r.Namespace.PUBSUB_EVENT,element:"delete",fields:{node:t.attribute("node"),redirect:t.subAttribute(r.Namespace.PUBSUB_EVENT,"redirect","uri")}}),o=e.define({name:"subscriptionChanged",namespace:r.Namespace.PUBSUB_EVENT,element:"subscription",fields:{node:t.attribute("node"),jid:t.jidAttribute("jid"),type:t.attribute("subscription"),subid:t.attribute("subid"),expiry:{get:function(){var e=t.getAttribute(this.xml,"expiry");return"presence"===e?e:e?new Date(e):void 0},set:function(e){e&&("string"!=typeof e&&(e=e.toISOString()),t.setAttribute(this.xml,"expiry",e))}}}}),a=e.define({name:"configurationChanged",namespace:r.Namespace.PUBSUB_EVENT,element:"configuration",fields:{node:t.attribute("node")}}),c=e.define({name:"updated",namespace:r.Namespace.PUBSUB_EVENT,element:"items",fields:{node:t.attribute("node"),retracted:{get:function(){var e=[];return t.find(this.xml,r.Namespace.PUBSUB_EVENT,"retract").forEach(function(t){e.push(t.getAttribute("id"))}),e},set:function(e){e.forEach(function(e){var n=t.createElement(r.Namespace.PUBSUB_EVENT,"retract",r.Namespace.PUBSUB_EVENT);n.setAttribute("id",e),this.xml.appendChild(n)})}}}}),u=e.define({name:"_eventItem",namespace:r.Namespace.PUBSUB_EVENT,element:"item",fields:{id:t.attribute("id"),node:t.attribute("node"),publisher:t.jidAttribute("publisher")}});e.extend(c,u,"published"),e.extend(n,c),e.extend(n,o),e.extend(n,a),e.extend(n,s),e.extend(n,i),e.extendMessage(n),e.withDataForm(function(t){e.extend(a,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"pubsubOwner",namespace:r.Namespace.PUBSUB_OWNER,element:"pubsub",fields:{purge:t.subAttribute(r.Namespace.PUBSUB_OWNER,"purge","node"),del:t.subAttribute(r.Namespace.PUBSUB_OWNER,"delete","node"),redirect:{get:function(){var e=t.find(this.xml,r.Namespace.PUBSUB_OWNER,"delete");return e.length?t.getSubAttribute(e[0],r.Namespace.PUBSUB_OWNER,"redirect","uri"):""},set:function(e){var n=t.findOrCreate(this.xml,r.Namespace.PUBSUB_OWNER,"delete");t.setSubAttribute(n,r.Namespace.PUBSUB_OWNER,"redirect","uri",e)}}}}),i=e.define({name:"subscription",namespace:r.Namespace.PUBSUB_OWNER,element:"subscription",fields:{node:t.attribute("node"),jid:t.jidAttribute("jid"),subid:t.attribute("subid"),type:t.attribute("subscription"),configurable:t.boolSub("subscribe-options"),configurationRequired:{get:function(){var e=t.find(this.xml,r.Namespace.PUBSUB_OWNER,"subscribe-options");return!!e.length&&t.getBoolSub(e[0],r.Namespace.PUBSUB_OWNER,"required")}}}}),s=e.define({name:"subscriptions",namespace:r.Namespace.PUBSUB_OWNER,element:"subscriptions",fields:{node:t.attribute("node")}}),o=e.define({name:"affiliation",namespace:r.Namespace.PUBSUB_OWNER,element:"affiliation",fields:{jid:t.jidAttribute("jid"),type:t.attribute("affiliation")}}),a=e.define({name:"affiliations",namespace:r.Namespace.PUBSUB_OWNER,element:"affiliations",fields:{node:t.attribute("node")}}),c=e.define({name:"config",namespace:r.Namespace.PUBSUB_OWNER,element:"configure",fields:{node:t.attribute("node")}});e.extend(n,c),e.extend(n,s),e.extend(n,a),e.extend(s,i,"list"),e.extend(a,o,"list"),e.extendIQ(n),e.withDataForm(function(t){e.extend(c,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"enablePush",element:"enable",namespace:r.Namespace.PUSH_0,fields:{jid:t.jidAttribute("jid"),node:t.attribute("node")}}),i=e.define({name:"disablePush",element:"disable",namespace:r.Namespace.PUSH_0,fields:{jid:t.jidAttribute("jid"),node:t.attribute("node")}}),s=e.define({name:"pushNotification",element:"notification",namespace:r.Namespace.PUSH_0});e.withDataForm(function(t){e.extend(s,t),e.extend(n,t)}),e.extendIQ(n),e.extendIQ(i)},e.exports=t.default},function(e,t,n){"use strict";var r=n(27).default;Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(13),o=r(s);t.default=function(e){var t=e.utils,n=e.define({name:"_reachAddr",namespace:i.Namespace.REACH_0,element:"addr",fields:{uri:t.attribute("uri"),$desc:{get:function(){return t.getSubLangText(this.xml,i.Namespace.REACH_0,"desc",this.lang)}},desc:{get:function(){return this.$desc[this.lang]||""},set:function(e){t.setSubLangText(this.xml,i.Namespace.REACH_0,"desc",e,this.lang)}}}}),r={get:function(){var e=t.find(this.xml,i.Namespace.REACH_0,"reach"),r=[];if(e.length){var s=t.find(e[0],i.Namespace.REACH_0,"addr");(0,o.default)(s,function(e){r.push(new n({},e))})}return r},set:function(e){var r=t.findOrCreate(this.xml,i.Namespace.REACH_0,"reach");t.setAttribute(r,"xmlns",i.Namespace.REACH_0),(0,o.default)(e,function(e){var t=new n(e);r.appendChild(t.xml)})}};e.withPubsubItem(function(t){e.add(t,"reach",r)}),e.withPresence(function(t){e.add(t,"reach",r)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"reference",element:"reference",namespace:r.Namespace.REFERENCE_0,fields:{type:t.attribute("type"),begin:t.numberAttribute("begin"),end:t.numberAttribute("end"),uri:t.attribute("uri"),anchor:t.attribute("anchor")}}),i=t.multiExtension(n);e.withMessage(function(t){e.add(t,"references",i)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"register",namespace:r.Namespace.REGISTER,element:"query",fields:{instructions:t.textSub(r.Namespace.REGISTER,"instructions"),registered:t.boolSub(r.Namespace.REGISTER,"registered"),remove:t.boolSub(r.Namespace.REGISTER,"remove"),username:t.textSub(r.Namespace.REGISTER,"username"),nick:t.textSub(r.Namespace.REGISTER,"nick"),password:t.textSub(r.Namespace.REGISTER,"password"),name:t.textSub(r.Namespace.REGISTER,"name"),first:t.textSub(r.Namespace.REGISTER,"first"),last:t.textSub(r.Namespace.REGISTER,"last"),email:t.textSub(r.Namespace.REGISTER,"email"),address:t.textSub(r.Namespace.REGISTER,"address"),city:t.textSub(r.Namespace.REGISTER,"city"),state:t.textSub(r.Namespace.REGISTER,"state"),zip:t.textSub(r.Namespace.REGISTER,"zip"),phone:t.textSub(r.Namespace.REGISTER,"phone"),url:t.textSub(r.Namespace.REGISTER,"url"),date:t.textSub(r.Namespace.REGISTER,"date"),misc:t.textSub(r.Namespace.REGISTER,"misc"),text:t.textSub(r.Namespace.REGISTER,"text"),key:t.textSub(r.Namespace.REGISTER,"key")}});e.extendIQ(n),e.withDefinition("x",r.Namespace.OOB,function(t){e.extend(n,t)}),e.withDataForm(function(t){e.extend(n,t)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"roster",namespace:r.Namespace.ROSTER,element:"query",fields:{ver:{get:function(){return t.getAttribute(this.xml,"ver")},set:function(e){var n=""===e;t.setAttribute(this.xml,"ver",e,n)}}}}),i=e.define({name:"_rosterItem",namespace:r.Namespace.ROSTER,element:"item",fields:{jid:t.jidAttribute("jid",!0),name:t.attribute("name"),subscription:t.attribute("subscription","none"),subscriptionRequested:{get:function(){return"subscribe"===t.getAttribute(this.xml,"ask")}},preApproved:t.boolAttribute(r.Namespace.ROSTER,"approved"),groups:t.multiTextSub(r.Namespace.ROSTER,"group")}});e.extend(n,i,"items"),e.extendIQ(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils;e.define({name:"rsm",namespace:r.Namespace.RSM,element:"set",fields:{after:t.textSub(r.Namespace.RSM,"after"),before:{get:function(){return t.getSubText(this.xml,r.Namespace.RSM,"before")},set:function(e){!0===e?t.findOrCreate(this.xml,r.Namespace.RSM,"before"):t.setSubText(this.xml,r.Namespace.RSM,"before",e)}},count:t.numberSub(r.Namespace.RSM,"count",!1,0),first:t.textSub(r.Namespace.RSM,"first"),firstIndex:t.subAttribute(r.Namespace.RSM,"first","index"),index:t.textSub(r.Namespace.RSM,"index"),last:t.textSub(r.Namespace.RSM,"last"),max:t.textSub(r.Namespace.RSM,"max")}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n={get:function(){var e=t.find(this.xml,r.Namespace.JINGLE_RTP_RTCP_FB_0,"rtcp-fb"),n=[];return e.forEach(function(e){n.push({type:t.getAttribute(e,"type"),subtype:t.getAttribute(e,"subtype")})}),e=t.find(this.xml,r.Namespace.JINGLE_RTP_RTCP_FB_0,"rtcp-fb-trr-int"),e.forEach(function(e){n.push({type:t.getAttribute(e,"type"),value:t.getAttribute(e,"value")})}),n},set:function(e){var n=this,i=t.find(this.xml,r.Namespace.JINGLE_RTP_RTCP_FB_0,"rtcp-fb");i.forEach(function(e){n.xml.removeChild(e)}),i=t.find(this.xml,r.Namespace.JINGLE_RTP_RTCP_FB_0,"rtcp-fb-trr-int"),i.forEach(function(e){n.xml.removeChild(e)}),e.forEach(function(e){var i=void 0;"trr-int"===e.type?(i=t.createElement(r.Namespace.JINGLE_RTP_RTCP_FB_0,"rtcp-fb-trr-int",r.Namespace.JINGLE_RTP_1),t.setAttribute(i,"type",e.type),t.setAttribute(i,"value",e.value)):(i=t.createElement(r.Namespace.JINGLE_RTP_RTCP_FB_0,"rtcp-fb",r.Namespace.JINGLE_RTP_1),t.setAttribute(i,"type",e.type),t.setAttribute(i,"subtype",e.subtype)),n.xml.appendChild(i)})}},i=e.define({name:"bandwidth",namespace:r.Namespace.JINGLE_RTP_1,element:"bandwidth",fields:{type:t.attribute("type"),bandwidth:t.text()}}),s=e.define({name:"_rtp",namespace:r.Namespace.JINGLE_RTP_1,element:"description",tags:["jingle-application"],fields:{applicationType:{value:"rtp"},media:t.attribute("media"),ssrc:t.attribute("ssrc"),mux:t.boolSub(r.Namespace.JINGLE_RTP_1,"rtcp-mux"),encryption:{get:function(){var e=t.find(this.xml,r.Namespace.JINGLE_RTP_1,"encryption");if(!e.length)return[];e=e[0];var n=this,i=t.find(e,r.Namespace.JINGLE_RTP_1,"crypto"),s=[];return i.forEach(function(e){s.push(new a({},e,n).toJSON())}),s},set:function(e){var n=t.find(this.xml,r.Namespace.JINGLE_RTP_1,"encryption");if(n.length&&this.xml.removeChild(n),e.length){t.setBoolSubAttribute(this.xml,r.Namespace.JINGLE_RTP_1,"encryption","required",!0),n=t.find(this.xml,r.Namespace.JINGLE_RTP_1,"encryption")[0];var i=this;e.forEach(function(e){var t=new a(e,null,i);n.appendChild(t.xml)})}}},feedback:n,headerExtensions:{get:function(){var e=t.find(this.xml,r.Namespace.JINGLE_RTP_HDREXT_0,"rtp-hdrext"),n=[];return e.forEach(function(e){n.push({id:t.getAttribute(e,"id"),uri:t.getAttribute(e,"uri"),senders:t.getAttribute(e,"senders")})}),n},set:function(e){var n=this;t.find(this.xml,r.Namespace.JINGLE_RTP_HDREXT_0,"rtp-hdrext").forEach(function(e){n.xml.removeChild(e)}),e.forEach(function(e){var i=t.createElement(r.Namespace.JINGLE_RTP_HDREXT_0,"rtp-hdrext",r.Namespace.JINGLE_RTP_1);t.setAttribute(i,"id",e.id),t.setAttribute(i,"uri",e.uri),t.setAttribute(i,"senders",e.senders),n.xml.appendChild(i)})}}}}),o=e.define({name:"_payloadType",namespace:r.Namespace.JINGLE_RTP_1,element:"payload-type",fields:{channels:t.attribute("channels"),clockrate:t.attribute("clockrate"),id:t.attribute("id"),maxptime:t.attribute("maxptime"),name:t.attribute("name"),ptime:t.attribute("ptime"),feedback:n,parameters:{get:function(){var e=[];return t.find(this.xml,r.Namespace.JINGLE_RTP_1,"parameter").forEach(function(n){e.push({key:t.getAttribute(n,"name"),value:t.getAttribute(n,"value")})}),e},set:function(e){var n=this;e.forEach(function(e){var i=t.createElement(r.Namespace.JINGLE_RTP_1,"parameter");t.setAttribute(i,"name",e.key),t.setAttribute(i,"value",e.value),n.xml.appendChild(i)})}}}}),a=e.define({name:"crypto",namespace:r.Namespace.JINGLE_RTP_1,element:"crypto",fields:{cipherSuite:t.attribute("crypto-suite"),keyParams:t.attribute("key-params"),sessionParams:t.attribute("session-params"),tag:t.attribute("tag")}}),c=e.define({name:"_group",namespace:r.Namespace.JINGLE_GROUPING_0,element:"group",fields:{semantics:t.attribute("semantics"),contents:t.multiSubAttribute(r.Namespace.JINGLE_GROUPING_0,"content","name")}}),u=e.define({name:"_sourceGroup",namespace:r.Namespace.JINGLE_RTP_SSMA_0,element:"ssrc-group",fields:{semantics:t.attribute("semantics"),sources:t.multiSubAttribute(r.Namespace.JINGLE_RTP_SSMA_0,"source","ssrc")}}),l=e.define({name:"_source",namespace:r.Namespace.JINGLE_RTP_SSMA_0,element:"source",fields:{ssrc:t.attribute("ssrc"),parameters:{get:function(){var e=[];return t.find(this.xml,r.Namespace.JINGLE_RTP_SSMA_0,"parameter").forEach(function(n){e.push({key:t.getAttribute(n,"name"),value:t.getAttribute(n,"value")})}),e},set:function(e){var n=this;e.forEach(function(e){var i=t.createElement(r.Namespace.JINGLE_RTP_SSMA_0,"parameter");t.setAttribute(i,"name",e.key),t.setAttribute(i,"value",e.value),n.xml.appendChild(i)})}}}}),d=e.define({name:"mute",namespace:r.Namespace.JINGLE_RTP_INFO_1,element:"mute",fields:{creator:t.attribute("creator"),name:t.attribute("name")}}),p=e.define({name:"unmute",namespace:r.Namespace.JINGLE_RTP_INFO_1,element:"unmute",fields:{creator:t.attribute("creator"),name:t.attribute("name")}});e.extend(s,i),e.extend(s,o,"payloads"),e.extend(s,l,"sources"),e.extend(s,u,"sourceGroups"),e.withDefinition("content",r.Namespace.JINGLE_1,function(t){e.extend(t,s)}),e.withDefinition("jingle",r.Namespace.JINGLE_1,function(n){e.extend(n,d),e.extend(n,p),e.extend(n,c,"groups"),e.add(n,"ringing",t.boolSub(r.Namespace.JINGLE_RTP_INFO_1,"ringing")),e.add(n,"hold",t.boolSub(r.Namespace.JINGLE_RTP_INFO_1,"hold")),e.add(n,"active",t.boolSub(r.Namespace.JINGLE_RTP_INFO_1,"active"))})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i={insert:"t",erase:"e",wait:"w"},s={t:"insert",e:"erase",w:"wait"};t.default=function(e){var t=e.utils,n=e.define({name:"rtt",namespace:r.Namespace.RTT_0,element:"rtt",fields:{id:t.attribute("id"),event:t.attribute("event","edit"),seq:t.numberAttribute("seq"),actions:{get:function(){for(var e=[],n=0,i=this.xml.childNodes.length;n<i;n++){var o=this.xml.childNodes[n],a=o.localName,c={};if(o.namespaceURI===r.Namespace.RTT_0&&s[a]){c.type=s[a];var u=t.getAttribute(o,"p");u&&(c.pos=parseInt(u,10));var l=t.getAttribute(o,"n");l&&(c.num=parseInt(l,10));var d=t.getText(o);d&&"t"===a&&(c.text=d),e.push(c)}}return e},set:function(e){for(var n=this,s=0,o=this.xml.childNodes.length;s<o;s++)this.xml.removeChild(this.xml.childNodes[s]);e.forEach(function(e){if(i[e.type]){var s=t.createElement(r.Namespace.RTT_0,i[e.type],r.Namespace.RTT_0);void 0!==e.pos&&t.setAttribute(s,"p",e.pos.toString()),e.num&&t.setAttribute(s,"n",e.num.toString()),e.text&&t.setText(s,e.text),n.xml.appendChild(s)}})}}}});e.extendMessage(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["aborted","account-disabled","credentials-expired","encryption-required","incorrect-encoding","invalid-authzid","invalid-mechanism","malformed-request","mechanism-too-weak","not-authorized","temporary-auth-failure"];t.default=function(e){var t=e.utils,n=e.define({name:"sasl",namespace:r.Namespace.SASL,element:"mechanisms",fields:{mechanisms:t.multiTextSub(r.Namespace.SASL,"mechanism")}});e.define({name:"saslAuth",eventName:"sasl:auth",namespace:r.Namespace.SASL,element:"auth",topLevel:!0,fields:{value:t.text(),mechanism:t.attribute("mechanism")}}),e.define({name:"saslChallenge",eventName:"sasl:challenge",namespace:r.Namespace.SASL,element:"challenge",topLevel:!0,fields:{value:t.text()}}),e.define({name:"saslResponse",eventName:"sasl:response",namespace:r.Namespace.SASL,element:"response",topLevel:!0,fields:{value:t.text()}}),e.define({name:"saslAbort",eventName:"sasl:abort",namespace:r.Namespace.SASL,element:"abort",topLevel:!0}),e.define({name:"saslSuccess",eventName:"sasl:success",namespace:r.Namespace.SASL,element:"success",topLevel:!0,fields:{value:t.text()}}),e.define({name:"saslFailure",eventName:"sasl:failure",namespace:r.Namespace.SASL,element:"failure",topLevel:!0,fields:{lang:{get:function(){return this._lang||""},set:function(e){this._lang=e}},condition:t.enumSub(r.Namespace.SASL,i),$text:{get:function(){return t.getSubLangText(this.xml,r.Namespace.SASL,"text",this.lang)}},text:{get:function(){return this.$text[this.lang]||""},set:function(e){t.setSubLangText(this.xml,r.Namespace.SASL,"text",e,this.lang)}}}}),e.extendStreamFeatures(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"session",namespace:r.Namespace.SESSION,element:"session",fields:{required:e.utils.boolSub(r.Namespace.SESSION,"required"),optional:e.utils.boolSub(r.Namespace.SESSION,"optional")}});e.extendIQ(t),e.extendStreamFeatures(t)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n={get:function(){var e=t.find(this.xml,r.Namespace.SHIM,"headers");return e.length?t.getMultiSubText(e[0],r.Namespace.SHIM,"header",function(e){var n=t.getAttribute(e,"name");if(n)return{name:n,value:t.getText(e)}}):[]},set:function(n){var i=t.findOrCreate(this.xml,r.Namespace.SHIM,"headers");e.setMultiSubText(i,r.Namespace.SHIM,"header",n,function(e){var n=t.createElement(r.Namespace.SHIM,"header",r.Namespace.SHIM);t.setAttribute(n,"name",e.name),t.setText(n,e.value),i.appendChild(n)})}};e.withMessage(function(t){e.add(t,"headers",n)}),e.withPresence(function(t){e.add(t,"headers",n)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"streamManagement",namespace:r.Namespace.SMACKS_3,element:"sm"});e.define({name:"smEnable",eventName:"stream:management:enable",namespace:r.Namespace.SMACKS_3,element:"enable",topLevel:!0,fields:{resume:t.boolAttribute("resume")}}),e.define({name:"smEnabled",eventName:"stream:management:enabled",namespace:r.Namespace.SMACKS_3,element:"enabled",topLevel:!0,fields:{id:t.attribute("id"),resume:t.boolAttribute("resume")}}),e.define({name:"smResume",eventName:"stream:management:resume",namespace:r.Namespace.SMACKS_3,element:"resume",topLevel:!0,fields:{h:t.numberAttribute("h",!1,0),previd:t.attribute("previd")}}),e.define({name:"smResumed",eventName:"stream:management:resumed",namespace:r.Namespace.SMACKS_3,element:"resumed",topLevel:!0,fields:{h:t.numberAttribute("h",!1,0),previd:t.attribute("previd")}}),e.define({name:"smFailed",eventName:"stream:management:failed",namespace:r.Namespace.SMACKS_3,element:"failed",topLevel:!0}),e.define({name:"smAck",eventName:"stream:management:ack",namespace:r.Namespace.SMACKS_3,element:"a",topLevel:!0,fields:{h:t.numberAttribute("h",!1,0)}}),e.define({name:"smRequest",eventName:"stream:management:request",namespace:r.Namespace.SMACKS_3,element:"r",topLevel:!0}),e.extendStreamFeatures(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils;e.define({name:"stream",namespace:r.Namespace.STREAM,element:"stream",fields:{lang:t.langAttribute(),id:t.attribute("id"),version:t.attribute("version","1.0"),to:t.jidAttribute("to",!0),from:t.jidAttribute("from",!0)}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["bad-format","bad-namespace-prefix","conflict","connection-timeout","host-gone","host-unknown","improper-addressing","internal-server-error","invalid-from","invalid-namespace","invalid-xml","not-authorized","not-well-formed","policy-violation","remote-connection-failed","reset","resource-constraint","restricted-xml","see-other-host","system-shutdown","undefined-condition","unsupported-encoding","unsupported-feature","unsupported-stanza-type","unsupported-version"];t.default=function(e){var t=e.utils;e.define({name:"streamError",namespace:r.Namespace.STREAM,element:"error",topLevel:!0,fields:{lang:{get:function(){return this._lang||""},set:function(e){this._lang=e}},condition:t.enumSub(r.Namespace.STREAM_ERROR,i),seeOtherHost:{get:function(){return t.getSubText(this.xml,r.Namespace.STREAM_ERROR,"see-other-host")},set:function(e){this.condition="see-other-host",t.setSubText(this.xml,r.Namespace.STREAM_ERROR,"see-other-host",e)}},$text:{get:function(){return t.getSubLangText(this.xml,r.Namespace.STREAM_ERROR,"text",this.lang)}},text:{get:function(){return this.$text[this.lang]||""},set:function(e){t.setSubLangText(this.xml,r.Namespace.STREAM_ERROR,"text",e,this.lang)}}}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=(e.define({name:"streamFeatures",namespace:r.Namespace.STREAM,element:"features",topLevel:!0}),e.define({name:"rosterVersioning",namespace:r.Namespace.ROSTER_VERSIONING,element:"ver"})),n=e.define({name:"subscriptionPreApproval",namespace:r.Namespace.SUBSCRIPTION_PREAPPROVAL,element:"sub"});e.extendStreamFeatures(t),e.extendStreamFeatures(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"time",namespace:r.Namespace.TIME,element:"time",fields:{utc:e.utils.dateSub(r.Namespace.TIME,"utc"),tzo:e.utils.tzoSub(r.Namespace.TIME,"tzo",0)}});e.extendIQ(t)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"tune",namespace:r.Namespace.TUNE,element:"tune",fields:{artist:t.textSub(r.Namespace.TUNE,"artist"),length:t.numberSub(r.Namespace.TUNE,"length"),rating:t.numberSub(r.Namespace.TUNE,"rating"),source:t.textSub(r.Namespace.TUNE,"source"),title:t.textSub(r.Namespace.TUNE,"title"),track:t.textSub(r.Namespace.TUNE,"track"),uri:t.textSub(r.Namespace.TUNE,"uri")}});e.extendPubsubItem(n),e.extendMessage(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.utils,n=e.define({name:"vCardTemp",namespace:r.Namespace.VCARD_TEMP,element:"vCard",fields:{role:t.textSub(r.Namespace.VCARD_TEMP,"ROLE"),website:t.textSub(r.Namespace.VCARD_TEMP,"URL"),title:t.textSub(r.Namespace.VCARD_TEMP,"TITLE"),description:t.textSub(r.Namespace.VCARD_TEMP,"DESC"),fullName:t.textSub(r.Namespace.VCARD_TEMP,"FN"),birthday:t.dateSub(r.Namespace.VCARD_TEMP,"BDAY"),nicknames:t.multiTextSub(r.Namespace.VCARD_TEMP,"NICKNAME"),jids:t.multiTextSub(r.Namespace.VCARD_TEMP,"JABBERID")}}),i=e.define({name:"_email",namespace:r.Namespace.VCARD_TEMP,element:"EMAIL",fields:{email:t.textSub(r.Namespace.VCARD_TEMP,"USERID"),home:t.boolSub(r.Namespace.VCARD_TEMP,"HOME"),work:t.boolSub(r.Namespace.VCARD_TEMP,"WORK"),preferred:t.boolSub(r.Namespace.VCARD_TEMP,"PREF")}}),s=e.define({name:"_tel",namespace:r.Namespace.VCARD_TEMP,element:"TEL",fields:{number:t.textSub(r.Namespace.VCARD_TEMP,"NUMBER"),home:t.boolSub(r.Namespace.VCARD_TEMP,"HOME"),work:t.boolSub(r.Namespace.VCARD_TEMP,"WORK"),mobile:t.boolSub(r.Namespace.VCARD_TEMP,"CELL"),preferred:t.boolSub(r.Namespace.VCARD_TEMP,"PREF")}}),o=e.define({name:"_address",namespace:r.Namespace.VCARD_TEMP,element:"ADR",fields:{street:t.textSub(r.Namespace.VCARD_TEMP,"STREET"),street2:t.textSub(r.Namespace.VCARD_TEMP,"EXTADD"),country:t.textSub(r.Namespace.VCARD_TEMP,"CTRY"),city:t.textSub(r.Namespace.VCARD_TEMP,"LOCALITY"),region:t.textSub(r.Namespace.VCARD_TEMP,"REGION"),postalCode:t.textSub(r.Namespace.VCARD_TEMP,"PCODE"),pobox:t.textSub(r.Namespace.VCARD_TEMP,"POBOX"),home:t.boolSub(r.Namespace.VCARD_TEMP,"HOME"),work:t.boolSub(r.Namespace.VCARD_TEMP,"WORK"),preferred:t.boolSub(r.Namespace.VCARD_TEMP,"PREF")}}),a=e.define({name:"organization",namespace:r.Namespace.VCARD_TEMP,element:"ORG",fields:{name:t.textSub(r.Namespace.VCARD_TEMP,"ORGNAME"),unit:t.textSub(r.Namespace.VCARD_TEMP,"ORGUNIT")}}),c=e.define({name:"name",namespace:r.Namespace.VCARD_TEMP,element:"N",fields:{family:t.textSub(r.Namespace.VCARD_TEMP,"FAMILY"),given:t.textSub(r.Namespace.VCARD_TEMP,"GIVEN"),middle:t.textSub(r.Namespace.VCARD_TEMP,"MIDDLE"),prefix:t.textSub(r.Namespace.VCARD_TEMP,"PREFIX"),suffix:t.textSub(r.Namespace.VCARD_TEMP,"SUFFIX")}}),u=e.define({name:"photo",namespace:r.Namespace.VCARD_TEMP,element:"PHOTO",fields:{type:t.textSub(r.Namespace.VCARD_TEMP,"TYPE"),data:t.textSub(r.Namespace.VCARD_TEMP,"BINVAL"),url:t.textSub(r.Namespace.VCARD_TEMP,"EXTVAL")}});e.extend(n,i,"emails"),e.extend(n,o,"addresses"),e.extend(n,s,"phoneNumbers"),e.extend(n,a),e.extend(n,c),e.extend(n,u),e.extendIQ(n)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.define({name:"version",namespace:r.Namespace.VERSION,element:"query",fields:{name:e.utils.textSub(r.Namespace.VERSION,"name"),version:e.utils.textSub(r.Namespace.VERSION,"version"),os:e.utils.textSub(r.Namespace.VERSION,"os")}});e.extendIQ(t)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){e.withIQ(function(t){e.add(t,"visible",e.utils.boolSub(r.Namespace.INVISIBLE_0,"visible")),e.add(t,"invisible",e.utils.boolSub(r.Namespace.INVISIBLE_0,"invisible"))})},e.exports=t.default},function(e,t,n){e.exports={default:n(156),__esModule:!0}},function(e,t,n){n(168),e.exports=n(42).Object.assign},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(157);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(163),i=n(42),s=n(159),o=function(e,t,n){var a,c,u,l=e&o.F,d=e&o.G,p=e&o.S,f=e&o.P,h=e&o.B,m=e&o.W,g=d?i:i[t]||(i[t]={}),v=d?r:p?r[t]:(r[t]||{}).prototype;d&&(n=t);for(a in n)(c=!l&&v&&a in v)&&a in g||(u=c?v[a]:n[a],g[a]=d&&"function"!=typeof v[a]?n[a]:h&&c?s(u,r):m&&v[a]==u?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t.prototype=e.prototype,t}(u):f&&"function"==typeof u?s(Function.call,u):u,f&&((g.prototype||(g.prototype={}))[a]=u))};o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,e.exports=o},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var r=n(158);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(e,t,n){var r=n(165),i=n(167),s=n(164);e.exports=n(162)(function(){var e=Object.assign,t={},n={},r=Symbol(),i="abcdefghijklmnopqrst";return t[r]=7,i.split("").forEach(function(e){n[e]=e}),7!=e({},t)[r]||Object.keys(e({},n)).join("")!=i})?function(e,t){for(var n=i(e),o=arguments,a=o.length,c=1,u=r.getKeys,l=r.getSymbols,d=r.isEnum;a>c;)for(var p,f=s(o[c++]),h=l?u(f).concat(l(f)):u(f),m=h.length,g=0;m>g;)d.call(f,p=h[g++])&&(n[p]=f[p]);return n}:Object.assign},function(e,t,n){var r=n(160);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(161);r(r.S+r.F,"Object",{assign:n(166)})},function(e,t,n){"use strict";var r=n(29),i=n(12),s={constructor:!0,parent:!0,prototype:!0,toJSON:!0,toString:!0,xml:!0};e.exports=function(e,t){function n(n,s,o){var a=this,c=(s||{}).parentNode||(o||{}).xml,u=(c||{}).namespaceURI;a.xml=s||r.createElement(a._NS,a._EL,u),Object.keys(a._PREFIXES).forEach(function(e){var t=a._PREFIXES[e];a.xml.setAttribute("xmlns:"+e,t)}),a._extensions={};for(var l=0,d=a.xml.childNodes.length;l<d;l++){var p=a.xml.childNodes[l],f=e.getDefinition(p.localName,p.namespaceURI);if(void 0!==f){var h=f.prototype._name;a._extensions[h]=new f(null,p),a._extensions[h].parent=a}}return i(a,n),t.init&&t.init.apply(a,[n]),a}return n.prototype._isJXT=!0,n.prototype._name=t.name,n.prototype._eventname=t.eventName,n.prototype._NS=t.namespace,n.prototype._EL=t.element||t.name,n.prototype._PREFIXES=t.prefixes||{},n.prototype._TAGS=t.tags||[],n.prototype.toString=function(){return this.xml.toString()},n.prototype.toJSON=function(){var t,n={};for(t in this._extensions)this._extensions[t].toJSON&&"_"!==t[0]&&(n[t]=this._extensions[t].toJSON());for(t in this){var r=!s[t]&&"_"!==t[0],i=e.getExtensions(this._EL,this._NS)[t];if(r&&!i){var o=this[t];if("function"==typeof o)continue;var a=Object.prototype.toString.call(o);if(a.indexOf("Object")>=0)Object.keys(o).length>0&&(o._isJXT?n[t]=o.toJSON():n[t]=o);else if(a.indexOf("Array")>=0){if(o.length>0){for(var c=[],u=o.length,l=0;l<u;l++){var d=o[l];void 0!==d&&(d._isJXT?c.push(d.toJSON()):c.push(d))}n[t]=c}}else void 0!==o&&!1!==o&&""!==o&&(n[t]=o)}}return n},n}},function(e,t,n){"use strict";(function(e){var r=n(29),i=n(12),s=r.find,o=r.createElement,a=t.field=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return{get:function(){return e.apply(null,[this.xml].concat(n))},set:function(e){t.apply(null,[this.xml].concat(n).concat([e]))}}}};t.boolAttribute=a(r.getBoolAttribute,r.setBoolAttribute),t.subAttribute=a(r.getSubAttribute,r.setSubAttribute),t.boolSubAttribute=a(r.getSubBoolAttribute,r.setSubBoolAttribute),t.text=a(r.getText,r.setText),t.textSub=t.subText=a(r.getSubText,r.setSubText),t.multiTextSub=t.multiSubText=a(r.getMultiSubText,r.setMultiSubText),t.multiSubAttribute=a(r.getMultiSubAttribute,r.setMultiSubAttribute),t.langTextSub=t.subLangText=a(r.getSubLangText,r.setSubLangText),t.boolSub=a(r.getBoolSub,r.setBoolSub),t.langAttribute=a(function(e){return e.getAttributeNS(r.XML_NS,"lang")||""},function(e,t){e.setAttributeNS(r.XML_NS,"lang",t)}),t.b64Text=a(function(t){return t.textContent&&"="!==t.textContent?new e(t.textContent,"base64"):""},function(t,n){if("string"==typeof n){var r=new e(n).toString("base64");t.textContent=r||"="}else t.textContent=""}),t.dateAttribute=function(e,t){return{get:function(){var n=r.getAttribute(this.xml,e);return n?new Date(n):t?new Date(Date.now()):void 0},set:function(t){t&&("string"!=typeof t&&(t=t.toISOString()),r.setAttribute(this.xml,e,t))}}},t.dateSub=function(e,t,n){return{get:function(){var i=r.getSubText(this.xml,e,t);return i?new Date(i):n?new Date(Date.now()):void 0},set:function(n){n&&("string"!=typeof n&&(n=n.toISOString()),r.setSubText(this.xml,e,t,n))}}},t.dateSubAttribute=function(e,t,n,i){return{get:function(){var s=r.getSubAttribute(this.xml,e,t,n);return s?new Date(s):i?new Date(Date.now()):void 0},set:function(i){i&&("string"!=typeof i&&(i=i.toISOString()),r.setSubAttribute(this.xml,e,t,n,i))}}},t.numberAttribute=function(e,t,n){return{get:function(){var i=t?parseFloat:parseInt,s=r.getAttribute(this.xml,e,"");if(!s)return n;var o=i(s,10);return isNaN(o)?n:o},set:function(t){r.setAttribute(this.xml,e,t.toString())}}},t.numberSub=function(e,t,n,i){return{get:function(){var s=n?parseFloat:parseInt,o=r.getSubText(this.xml,e,t,"");if(!o)return i;var a=s(o,10);return isNaN(a)?i:a},set:function(n){r.setSubText(this.xml,e,t,n.toString())}}},t.attribute=function(e,t){return{get:function(){return r.getAttribute(this.xml,e,t)},set:function(t){r.setAttribute(this.xml,e,t)}}},t.attributeNS=function(e,t,n){return{get:function(){return r.getAttributeNS(this.xml,e,t,n)},set:function(n){r.setAttributeNS(this.xml,e,t,n)}}},t.extension=function(e){return{get:function(){var t=this,n=e.prototype._name;if(!this._extensions[n]){var r=s(this.xml,e.prototype._NS,e.prototype._EL);r.length?this._extensions[n]=new e(null,r[0],t):(this._extensions[n]=new e({},null,t),this.xml.appendChild(this._extensions[n].xml)),this._extensions[n].parent=this}return this._extensions[n]},set:function(t){if(t){var n=this[e.prototype._name];!0===t&&(t={}),i(n,t)}}}},t.multiExtension=function(e){return{get:function(){for(var t=this,n=s(this.xml,e.prototype._NS,e.prototype._EL),r=[],i=0,o=n.length;i<o;i++)r.push(new e({},n[i],t));return r},set:function(t){t=t||[];var n,r,i=this,o=s(this.xml,e.prototype._NS,e.prototype._EL);for(n=0,r=o.length;n<r;n++)i.xml.removeChild(o[n]);for(n=0,r=t.length;n<r;n++){var a=new e(t[n],null,i);i.xml.appendChild(a.xml)}}}},t.enumSub=function(e,t){return{get:function(){var n=this,r=[];return t.forEach(function(t){var i=s(n.xml,e,t);i.length&&r.push(i[0].nodeName)}),r[0]||""},set:function(n){var r=this,i=!1;if(t.forEach(function(t){var o=s(r.xml,e,t);o.length&&(t===n?i=!0:r.xml.removeChild(o[0]))}),n&&!i){var a=o(e,n);this.xml.appendChild(a)}}}},t.subExtension=function(e,t,n,r){return{get:function(){if(!this._extensions[e]){var i=s(this.xml,t,n);i.length?i=i[0]:(i=o(t,n,this._NS),this.xml.appendChild(i));var a=s(i,r.prototype._NS,r.prototype._EL);a.length?this._extensions[e]=new r(null,a[0],{xml:i}):(this._extensions[e]=new r({},null,{xml:i}),i.appendChild(this._extensions[e].xml)),this._extensions[e].parent=this}return this._extensions[e]},set:function(r){var o=s(this.xml,t,n);if(o.length&&!r&&this.xml.removeChild(o[0]),r){var a=this[e];!0===r&&(r={}),i(a,r)}}}},t.subMultiExtension=function(e,t,n){return{get:function(){var r=this,i=[],o=s(this.xml,e,t);return o.length?(o=o[0],s(o,n.prototype._NS,n.prototype._EL).forEach(function(e){i.push(new n({},e,r))}),i):i},set:function(r){var i=this,a=s(this.xml,e,t);a.length&&i.xml.removeChild(a[0]),r.length&&(a=o(e,t,this._NS),r.forEach(function(t){var r=new n(t,null,{xml:{namespaceURI:e}});a.appendChild(r.xml)}),i.xml.appendChild(a))}}}}).call(t,n(1).Buffer)},function(e,t){function n(e,t){for(var n=-1,r=e.length;++n<r&&!1!==t(e[n],n,e););return e}e.exports=n},function(e,t){function n(e,t){for(var n=-1,r=e.length,i=-1,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[++i]=o)}return s}e.exports=n},function(e,t,n){function r(e,t){return null==t?e:i(t,s(t),e)}var i=n(174),s=n(17);e.exports=r},function(e,t){function n(e,t,n){n||(n={});for(var r=-1,i=t.length;++r<i;){var s=t[r];n[s]=e[s]}return n}e.exports=n},function(e,t,n){function r(e,t){var n=[];return i(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}var i=n(44);e.exports=r},function(e,t){function n(e,t,n){if(t!==t)return r(e,n);for(var i=n-1,s=e.length;++i<s;)if(e[i]===t)return i;return-1}function r(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var s=e[i];if(s!==s)return i}return-1}e.exports=n},function(e,t,n){function r(e){return!!e&&"object"==typeof e}function i(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function s(e,t,n,i,a,c){return e===t||(null==e||null==t||!l(e)&&!r(t)?e!==e&&t!==t:o(e,t,s,n,i,a,c))}function o(e,t,n,r,i,s,o){var l=d(e),f=d(t),g=m,v=m;l||(g=R.call(e),g==h?g=_:g!=_&&(l=p(e))),f||(v=R.call(t),v==h?v=_:v!=_&&(f=p(t)));var b=g==_,y=v==_,S=g==v;if(S&&!l&&!b)return c(e,t,g);if(!i){var T=b&&w.call(e,"__wrapped__"),E=y&&w.call(t,"__wrapped__");if(T||E)return n(T?e.value():e,E?t.value():t,r,i,s,o)}if(!S)return!1;s||(s=[]),o||(o=[]);for(var C=s.length;C--;)if(s[C]==e)return o[C]==t;s.push(e),o.push(t);var x=(l?a:u)(e,t,n,r,i,s,o);return s.pop(),o.pop(),x}function a(e,t,n,r,s,o,a){var c=-1,u=e.length,l=t.length;if(u!=l&&!(s&&l>u))return!1;for(;++c<u;){var d=e[c],p=t[c],f=r?r(s?p:d,s?d:p,c):void 0;if(void 0!==f){if(f)continue;return!1}if(s){if(!i(t,function(e){return d===e||n(d,e,r,s,o,a)}))return!1}else if(d!==p&&!n(d,p,r,s,o,a))return!1}return!0}function c(e,t,n){switch(n){case g:case v:return+e==+t;case b:return e.name==t.name&&e.message==t.message;case y:return e!=+e?t!=+t:e==+t;case S:case T:return e==t+""}return!1}function u(e,t,n,r,i,s,o){var a=f(e),c=a.length;if(c!=f(t).length&&!i)return!1;for(var u=c;u--;){var l=a[u];if(!(i?l in t:w.call(t,l)))return!1}for(var d=i;++u<c;){l=a[u];var p=e[l],h=t[l],m=r?r(i?h:p,i?p:h,l):void 0;if(!(void 0===m?n(p,h,r,i,s,o):m))return!1;d||(d="constructor"==l)}if(!d){var g=e.constructor,v=t.constructor;if(g!=v&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof v&&v instanceof v))return!1}return!0}function l(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var d=n(14),p=n(184),f=n(17),h="[object Arguments]",m="[object Array]",g="[object Boolean]",v="[object Date]",b="[object Error]",y="[object Number]",_="[object Object]",S="[object RegExp]",T="[object String]",E=Object.prototype,w=E.hasOwnProperty,R=E.toString;e.exports=s},function(e,t,n){function r(e,t){var n=-1,r=i,c=e.length,u=!0,l=u&&c>=a,d=l?o():null,p=[];d?(r=s,u=!1):(l=!1,d=t?[]:p);e:for(;++n<c;){var f=e[n],h=t?t(f,n,e):f;if(u&&f===f){for(var m=d.length;m--;)if(d[m]===h)continue e;t&&d.push(h),p.push(f)}else r(d,h,0)<0&&((t||l)&&d.push(h),p.push(f))}return p}var i=n(176),s=n(179),o=n(181),a=200;e.exports=r},function(e,t){function n(e,t){var n=e.data;return("string"==typeof t||r(t)?n.set.has(t):n.hash[t])?0:-1}function r(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=n},function(e,t,n){function r(e){return o(function(t,n){var r=-1,o=null==t?0:n.length,a=o>2?n[o-2]:void 0,c=o>2?n[2]:void 0,u=o>1?n[o-1]:void 0;for("function"==typeof a?(a=i(a,u,5),o-=2):(a="function"==typeof u?u:void 0,o-=a?1:0),c&&s(n[0],n[1],c)&&(a=o<3?void 0:a,o=1);++r<o;){var l=n[r];l&&e(t,l,a)}return t})}var i=n(30),s=n(46),o=n(186);e.exports=r},function(e,t,n){(function(t){function r(e){var t=e?e.length:0;for(this.data={hash:u(null),set:new c};t--;)this.push(e[t])}function i(e){var t=this.data;"string"==typeof e||o(e)?t.set.add(e):t.hash[e]=!0}function s(e){return u&&c?new r(e):null}function o(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var a=n(45),c=a(t,"Set"),u=a(Object,"create");r.prototype.push=i,e.exports=s}).call(t,n(3))},function(e,t,n){(function(e,n){function r(e,t){return e.set(t[0],t[1]),e}function i(e,t){return e.add(t),e}function s(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););return e}function o(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function a(e,t,n,r){var i=-1,s=e?e.length:0;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function c(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function u(e,t){return null==e?void 0:e[t]}function l(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function d(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function p(e,t){return function(n){return e(t(n))}}function f(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function h(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function m(){this.__data__=Ut?Ut(null):{}}function g(e){return this.has(e)&&delete this.__data__[e]}function v(e){var t=this.__data__;if(Ut){var n=t[e];return n===Ie?void 0:n}return vt.call(t,e)?t[e]:void 0}function b(e){var t=this.__data__;return Ut?void 0!==t[e]:vt.call(t,e)}function y(e,t){return this.__data__[e]=Ut&&void 0===t?Ie:t,this}function _(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function S(){this.__data__=[]}function T(e){var t=this.__data__,n=X(t,e);return!(n<0)&&(n==t.length-1?t.pop():Ct.call(t,n,1),!0)}function E(e){var t=this.__data__,n=X(t,e);return n<0?void 0:t[n][1]}function w(e){return X(this.__data__,e)>-1}function R(e,t){var n=this.__data__,r=X(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function x(){this.__data__={hash:new h,map:new(Ot||_),string:new h}}function A(e){return oe(this,e).delete(e)}function I(e){return oe(this,e).get(e)}function N(e){return oe(this,e).has(e)}function O(e,t){return oe(this,e).set(e,t),this}function D(e){this.__data__=new _(e)}function P(){this.__data__=new _}function M(e){return this.__data__.delete(e)}function U(e){return this.__data__.get(e)}function k(e){return this.__data__.has(e)}function j(e,t){var n=this.__data__;if(n instanceof _){var r=n.__data__;if(!Ot||r.length<Ae-1)return r.push([e,t]),this;n=this.__data__=new C(r)}return n.set(e,t),this}function L(e,t){var n=Gt(e)||be(e)?c(e.length,String):[],r=n.length,i=!!r;for(var s in e)!t&&!vt.call(e,s)||i&&("length"==s||de(s,r))||n.push(s);return n}function $(e,t,n){var r=e[t];vt.call(e,t)&&ve(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function X(e,t){for(var n=e.length;n--;)if(ve(e[n][0],t))return n;return-1}function q(e,t){return e&&re(t,Re(t),e)}function B(e,t,n,r,i,o,a){var c;if(r&&(c=o?r(e,i,o,a):r(e)),void 0!==c)return c;if(!Ee(e))return e;var u=Gt(e);if(u){if(c=ce(e),!t)return ne(e,c)}else{var d=Ht(e),p=d==Me||d==Ue;if(Vt(e))return W(e,t);if(d==Le||d==Oe||p&&!o){if(l(e))return o?e:{};if(c=ue(p?{}:e),!t)return ie(e,q(c,e))}else{if(!it[d])return o?e:{};c=le(e,d,B,t)}}a||(a=new D);var f=a.get(e);if(f)return f;if(a.set(e,c),!u)var h=n?se(e):Re(e);return s(h||e,function(i,s){h&&(s=i,i=e[s]),$(c,s,B(i,t,n,r,s,e,a))}),c}function F(e){return Ee(e)?wt(e):{}}function H(e,t,n){var r=t(e);return Gt(e)?r:o(r,n(e))}function G(e){return bt.call(e)}function V(e){return!(!Ee(e)||fe(e))&&(Se(e)||l(e)?yt:nt).test(me(e))}function J(e){if(!he(e))return It(e);var t=[];for(var n in Object(e))vt.call(e,n)&&"constructor"!=n&&t.push(n);return t}function W(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}function z(e){var t=new e.constructor(e.byteLength);return new Tt(t).set(new Tt(e)),t}function K(e,t){var n=t?z(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Y(e,t,n){return a(t?n(d(e),!0):d(e),r,new e.constructor)}function Q(e){var t=new e.constructor(e.source,tt.exec(e));return t.lastIndex=e.lastIndex,t}function Z(e,t,n){return a(t?n(f(e),!0):f(e),i,new e.constructor)}function ee(e){return Bt?Object(Bt.call(e)):{}}function te(e,t){var n=t?z(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ne(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function re(e,t,n,r){n||(n={});for(var i=-1,s=t.length;++i<s;){var o=t[i],a=r?r(n[o],e[o],o,n,e):void 0;$(n,o,void 0===a?e[o]:a)}return n}function ie(e,t){return re(e,Ft(e),t)}function se(e){return H(e,Re,Ft)}function oe(e,t){var n=e.__data__;return pe(t)?n["string"==typeof t?"string":"hash"]:n.map}function ae(e,t){var n=u(e,t);return V(n)?n:void 0}function ce(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&vt.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ue(e){return"function"!=typeof e.constructor||he(e)?{}:F(Et(e))}function le(e,t,n,r){var i=e.constructor;switch(t){case Fe:return z(e);case De:case Pe:return new i(+e);case He:return K(e,r);case Ge:case Ve:case Je:case We:case ze:case Ke:case Ye:case Qe:case Ze:return te(e,r);case ke:return Y(e,r,n);case je:case qe:return new i(e);case $e:return Q(e);case Xe:return Z(e,r,n);case Be:return ee(e)}}function de(e,t){return!!(t=null==t?Ne:t)&&("number"==typeof e||rt.test(e))&&e>-1&&e%1==0&&e<t}function pe(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function fe(e){return!!mt&&mt in e}function he(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ft)}function me(e){if(null!=e){try{return gt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ge(e){return B(e,!0,!0)}function ve(e,t){return e===t||e!==e&&t!==t}function be(e){return _e(e)&&vt.call(e,"callee")&&(!Rt.call(e,"callee")||bt.call(e)==Oe)}function ye(e){return null!=e&&Te(e.length)&&!Se(e)}function _e(e){return we(e)&&ye(e)}function Se(e){var t=Ee(e)?bt.call(e):"";return t==Me||t==Ue}function Te(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ne}function Ee(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function we(e){return!!e&&"object"==typeof e}function Re(e){return ye(e)?L(e):J(e)}function Ce(){return[]}function xe(){return!1}var Ae=200,Ie="__lodash_hash_undefined__",Ne=9007199254740991,Oe="[object Arguments]",De="[object Boolean]",Pe="[object Date]",Me="[object Function]",Ue="[object GeneratorFunction]",ke="[object Map]",je="[object Number]",Le="[object Object]",$e="[object RegExp]",Xe="[object Set]",qe="[object String]",Be="[object Symbol]",Fe="[object ArrayBuffer]",He="[object DataView]",Ge="[object Float32Array]",Ve="[object Float64Array]",Je="[object Int8Array]",We="[object Int16Array]",ze="[object Int32Array]",Ke="[object Uint8Array]",Ye="[object Uint8ClampedArray]",Qe="[object Uint16Array]",Ze="[object Uint32Array]",et=/[\\^$.*+?()[\]{}|]/g,tt=/\w*$/,nt=/^\[object .+?Constructor\]$/,rt=/^(?:0|[1-9]\d*)$/,it={};it[Oe]=it["[object Array]"]=it[Fe]=it[He]=it[De]=it[Pe]=it[Ge]=it[Ve]=it[Je]=it[We]=it[ze]=it[ke]=it[je]=it[Le]=it[$e]=it[Xe]=it[qe]=it[Be]=it[Ke]=it[Ye]=it[Qe]=it[Ze]=!0,it["[object Error]"]=it[Me]=it["[object WeakMap]"]=!1;var st="object"==typeof e&&e&&e.Object===Object&&e,ot="object"==typeof self&&self&&self.Object===Object&&self,at=st||ot||Function("return this")(),ct="object"==typeof t&&t&&!t.nodeType&&t,ut=ct&&"object"==typeof n&&n&&!n.nodeType&&n,lt=ut&&ut.exports===ct,dt=Array.prototype,pt=Function.prototype,ft=Object.prototype,ht=at["__core-js_shared__"],mt=function(){var e=/[^.]+$/.exec(ht&&ht.keys&&ht.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),gt=pt.toString,vt=ft.hasOwnProperty,bt=ft.toString,yt=RegExp("^"+gt.call(vt).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=lt?at.Buffer:void 0,St=at.Symbol,Tt=at.Uint8Array,Et=p(Object.getPrototypeOf,Object),wt=Object.create,Rt=ft.propertyIsEnumerable,Ct=dt.splice,xt=Object.getOwnPropertySymbols,At=_t?_t.isBuffer:void 0,It=p(Object.keys,Object),Nt=ae(at,"DataView"),Ot=ae(at,"Map"),Dt=ae(at,"Promise"),Pt=ae(at,"Set"),Mt=ae(at,"WeakMap"),Ut=ae(Object,"create"),kt=me(Nt),jt=me(Ot),Lt=me(Dt),$t=me(Pt),Xt=me(Mt),qt=St?St.prototype:void 0,Bt=qt?qt.valueOf:void 0;h.prototype.clear=m,h.prototype.delete=g,h.prototype.get=v,h.prototype.has=b,h.prototype.set=y,_.prototype.clear=S,_.prototype.delete=T,_.prototype.get=E,_.prototype.has=w,_.prototype.set=R,C.prototype.clear=x,C.prototype.delete=A,C.prototype.get=I,C.prototype.has=N,C.prototype.set=O,D.prototype.clear=P,D.prototype.delete=M,D.prototype.get=U,D.prototype.has=k,D.prototype.set=j;var Ft=xt?p(xt,Object):Ce,Ht=G;(Nt&&Ht(new Nt(new ArrayBuffer(1)))!=He||Ot&&Ht(new Ot)!=ke||Dt&&"[object Promise]"!=Ht(Dt.resolve())||Pt&&Ht(new Pt)!=Xe||Mt&&"[object WeakMap]"!=Ht(new Mt))&&(Ht=function(e){var t=bt.call(e),n=t==Le?e.constructor:void 0,r=n?me(n):void 0;if(r)switch(r){case kt:return He;case jt:return ke;case Lt:return"[object Promise]";case $t:return Xe;case Xt:return"[object WeakMap]"}return t});var Gt=Array.isArray,Vt=At||xe;n.exports=ge}).call(t,n(3),n(4)(e))},function(e,t){function n(e){return i(e)&&h.call(e,"callee")&&(!g.call(e,"callee")||m.call(e)==l)}function r(e){return null!=e&&o(e.length)&&!s(e)}function i(e){return c(e)&&r(e)}function s(e){var t=a(e)?m.call(e):"";return t==d||t==p}function o(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function a(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function c(e){return!!e&&"object"==typeof e}var u=9007199254740991,l="[object Arguments]",d="[object Function]",p="[object GeneratorFunction]",f=Object.prototype,h=f.hasOwnProperty,m=f.toString,g=f.propertyIsEnumerable;e.exports=n},function(e,t){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=s}function r(e){return!!e&&"object"==typeof e}function i(e){return r(e)&&n(e.length)&&!!o[c.call(e)]}var s=9007199254740991,o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1;var a=Object.prototype,c=a.toString;e.exports=i},function(e,t,n){function r(e){return i(e)?e:Object(e)}function i(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function s(e){e=r(e);for(var t=-1,n=o(e),i=n.length,s=Array(i);++t<i;){var a=n[t];s[t]=[a,e[a]]}return s}var o=n(17);e.exports=s},function(e,t){function n(e,t){if("function"!=typeof e)throw new TypeError(r);return t=i(void 0===t?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,s=i(n.length-t,0),o=Array(s);++r<s;)o[r]=n[t+r];switch(t){case 0:return e.call(this,o);case 1:return e.call(this,n[0],o);case 2:return e.call(this,n[0],n[1],o)}var a=Array(t+1);for(r=-1;++r<t;)a[r]=n[r];return a[t]=o,e.apply(this,a)}}var r="Expected a function",i=Math.max;e.exports=n},function(e,t,n){function r(e,t){for(var n,r=-1,i=e.length,s=-1,o=[];++r<i;){var a=e[r],c=t?t(a,r,e):a;r&&n===c||(n=c,o[++s]=a)}return o}function i(e,t,n,i){return(e?e.length:0)?(null!=t&&"boolean"!=typeof t&&(i=n,n=a(e,t,i)?void 0:t,t=!1),n=null==n?n:s(n,i,3),t?r(e,n):o(e,n)):[]}var s=n(43),o=n(178),a=n(46);e.exports=i},function(e,t,n){"use strict";var r=n(51),i=n(48),s=n(20),o=n(18),a=n(50),c=n(190),u=n(194),l=n(52),d=n(191),p=n(49),f=n(193);t=e.exports=function(){return u.apply(null,arguments)},t.Element=o,t.equal=a.equal,t.nameEqual=a.name,t.attrsEqual=a.attrs,t.childrenEqual=a.children,t.isNode=d.isNode,t.isElement=d.isElement,t.isText=d.isText,t.clone=p,t.createElement=c,t.escapeXML=s.escapeXML,t.unescapeXML=s.unescapeXML,t.escapeXMLText=s.escapeXMLText,t.unescapeXMLText=s.unescapeXMLText,t.Parser=i,t.parse=r,t.tag=u,t.tagString=l,t.stringify=f},function(e,t,n){"use strict";function r(e,t){s.call(this,e,t),this.nodeType=1,this.nodeName=this.localName}var i=n(2),s=n(18);i(r,s),r.prototype._getElement=function(e,t){return new r(e,t)},Object.defineProperty(r.prototype,"localName",{get:function(){return this.getName()}}),Object.defineProperty(r.prototype,"namespaceURI",{get:function(){return this.getNS()}}),Object.defineProperty(r.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(r.prototype,"childNodes",{get:function(){return this.children}}),Object.defineProperty(r.prototype,"textContent",{get:function(){return this.getText()},set:function(e){this.children.push(e)}}),r.prototype.getElementsByTagName=function(e){return this.getChildren(e)},r.prototype.getAttribute=function(e){return this.getAttr(e)},r.prototype.setAttribute=function(e,t){this.attr(e,t)},r.prototype.getAttributeNS=function(e,t){return"http://www.w3.org/XML/1998/namespace"===e?this.getAttr(["xml",t].join(":")):this.getAttr(t,e)},r.prototype.setAttributeNS=function(e,t,n){var r;if("http://www.w3.org/XML/1998/namespace"===e)r="xml";else{r=this.getXmlns()[e]||""}r&&this.attr([r,t].join(":"),n)},r.prototype.removeAttribute=function(e){this.attr(e,null)},r.prototype.removeAttributeNS=function(e,t){var n;if("http://www.w3.org/XML/1998/namespace"===e)n="xml";else{n=this.getXmlns()[e]||""}n&&this.attr([n,t].join(":"),null)},r.prototype.appendChild=function(e){this.cnode(e)},r.prototype.removeChild=function(e){this.remove(e)},r.createElement=function(e,t){var n=new r(e,t);return Array.prototype.slice.call(arguments,2).forEach(function(e){n.appendChild(e)}),n},e.exports=r},function(e,t,n){"use strict";var r=n(18);e.exports=function(e,t){for(var n=new r(e,t),i=2;i<arguments.length;i++){var s=arguments[i];s&&n.cnode(s)}return n}},function(e,t,n){"use strict";var r=n(18);e.exports.isNode=function(e){return e instanceof r||"string"==typeof e},e.exports.isElement=function(e){return e instanceof r},e.exports.isText=function(e){return"string"==typeof e}},function(e,t,n){"use strict";var r=n(2),i=n(10).EventEmitter,s=n(20).unescapeXML,o=e.exports=function(){i.call(this);var e,t,n,r,o,a,c,u=0,l=0;this._handleTagOpening=function(e,t,n){e?this.emit("endElement",t):(this.emit("startElement",t,n),o&&this.emit("endElement",t))},this.write=function(i){function d(){if("number"==typeof l){var e=i.slice(l,p);return l=void 0,e}}"string"!=typeof i&&(i=i.toString());var p=0;for(e&&(i=e+i,p+=e.length,e=null);p<i.length;p++){var f=i.charCodeAt(p);switch(u){case 0:if(60===f){var h=d();h&&this.emit("text",s(h)),u=3,l=p+1,n={}}break;case 9:if(93===f&&"]>"===i.substr(p+1,2)){var m=d();m&&this.emit("text",m),u=1}break;case 3:47===f&&l===p?(l=p+1,r=!0):33===f?"[CDATA["===i.substr(p+1,7)?(l=p+8,u=9):(l=void 0,u=1):63===f?(l=void 0,u=2):(f<=32||47===f||62===f)&&(t=d(),p--,u=4);break;case 1:if(62===f){var g=i.charCodeAt(p-1),v=i.charCodeAt(p-2);(45===g&&45===v||93===g&&93===v)&&(u=0)}break;case 2:if(62===f){63===i.charCodeAt(p-1)&&(u=0)}break;case 4:62===f?(this._handleTagOpening(r,t,n),t=void 0,n=void 0,r=void 0,o=void 0,u=0,l=p+1):47===f?o=!0:f>32&&(l=p,u=5);break;case 5:(f<=32||61===f)&&(c=d(),p--,u=6);break;case 6:61===f&&(u=7);break;case 7:34!==f&&39!==f||(a=f,u=8,l=p+1);break;case 8:if(f===a){var b=s(d());n[c]=b,c=void 0,u=4}}}"number"==typeof l&&l<=i.length&&(e=i.slice(l),l=0)}};r(o,i),o.prototype.end=function(e){e&&this.write(e),this.write=function(){}}},function(e,t,n){"use strict";function r(e,t,n){"number"==typeof t&&(t=" ".repeat(t)),n||(n=1);var i="";return i+="<"+e.name,Object.keys(e.attrs).forEach(function(t){i+=" "+t+'="'+e.attrs[t]+'"'}),e.children.length?(i+=">",e.children.forEach(function(e,s){t&&(i+="\n"+t.repeat(n)),i+="string"==typeof e?e:r(e,t,n+1)}),t&&(i+="\n"+t.repeat(n-1)),i+="</"+e.name+">"):i+="/>",i}e.exports=r},function(e,t,n){"use strict";var r=n(52),i=n(51);e.exports=function(){return i(r.apply(null,arguments))}},function(e,t,n){var r=n(317),i=n(77),s=function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.exports=function(e){if(!e)return{};var t={};return i(r(e).split("\n"),function(e){var n=e.indexOf(":"),i=r(e.slice(0,n)).toLowerCase(),o=r(e.slice(n+1));void 0===t[i]?t[i]=o:s(t[i])?t[i].push(o):t[i]=[t[i],o]}),t}},function(e,t,n){(function(e,r){var i;!function(s){function o(e){throw new RangeError(D[e])}function a(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function c(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(O,"."),r+a(e.split("."),t).join(".")}function u(e){for(var t,n,r=[],i=0,s=e.length;i<s;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<s?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function l(e){return a(e,function(e){var t="";return e>65535&&(e-=65536,t+=U(e>>>10&1023|55296),e=56320|1023&e),t+=U(e)}).join("")}function d(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:S}function p(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function f(e,t,n){var r=0;for(e=n?M(e/R):e>>1,e+=M(e/t);e>P*E>>1;r+=S)e=M(e/P);return M(r+(P+1)*e/(e+w))}function h(e){var t,n,r,i,s,a,c,u,p,h,m=[],g=e.length,v=0,b=x,y=C;for(n=e.lastIndexOf(A),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&o("not-basic"),m.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<g;){for(s=v,a=1,c=S;i>=g&&o("invalid-input"),u=d(e.charCodeAt(i++)),(u>=S||u>M((_-v)/a))&&o("overflow"),v+=u*a,p=c<=y?T:c>=y+E?E:c-y,!(u<p);c+=S)h=S-p,a>M(_/h)&&o("overflow"),a*=h;t=m.length+1,y=f(v-s,t,0==s),M(v/t)>_-b&&o("overflow"),b+=M(v/t),v%=t,m.splice(v++,0,b)}return l(m)}function m(e){var t,n,r,i,s,a,c,l,d,h,m,g,v,b,y,w=[];for(e=u(e),g=e.length,t=x,n=0,s=C,a=0;a<g;++a)(m=e[a])<128&&w.push(U(m));for(r=i=w.length,i&&w.push(A);r<g;){for(c=_,a=0;a<g;++a)(m=e[a])>=t&&m<c&&(c=m);for(v=r+1,c-t>M((_-n)/v)&&o("overflow"),n+=(c-t)*v,t=c,a=0;a<g;++a)if(m=e[a],m<t&&++n>_&&o("overflow"),m==t){for(l=n,d=S;h=d<=s?T:d>=s+E?E:d-s,!(l<h);d+=S)y=l-h,b=S-h,w.push(U(p(h+y%b,0))),l=M(y/b);w.push(U(p(l,0))),s=f(n,v,r==i),n=0,++r}++n,++t}return w.join("")}function g(e){return c(e,function(e){return I.test(e)?h(e.slice(4).toLowerCase()):e})}function v(e){return c(e,function(e){return N.test(e)?"xn--"+m(e):e})}var b=("object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType,"object"==typeof r&&r);var y,_=2147483647,S=36,T=1,E=26,w=38,R=700,C=72,x=128,A="-",I=/^xn--/,N=/[^\x20-\x7E]/,O=/[\x2E\u3002\uFF0E\uFF61]/g,D={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},P=S-T,M=Math.floor,U=String.fromCharCode;y={version:"1.4.1",ucs2:{decode:u,encode:l},decode:h,encode:m,toASCII:v,toUnicode:g},void 0!==(i=function(){return y}.call(t,n,t,e))&&(e.exports=i)}()}).call(t,n(4)(e),n(3))},function(e,t,n){e.exports=n(11)},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}e.exports=r;var i=n(54),s=n(16);s.inherits=n(2),s.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";function r(){this.head=null,this.tail=null,this.length=0}var i=(n(1).Buffer,n(21));e.exports=r,r.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},r.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},r.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},r.prototype.clear=function(){this.head=this.tail=null,this.length=0},r.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},r.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t}},function(e,t,n){e.exports=n(34).PassThrough},function(e,t,n){e.exports=n(34).Transform},function(e,t,n){e.exports=n(33)},function(e,t,n){(function(e){!function(n,r){r(t,e)}(0,function(e,t){function n(){}n.prototype.name="ANONYMOUS",n.prototype.clientFirst=!0,n.prototype.response=function(e){return e.trace||""},n.prototype.challenge=function(e){},t.exports=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(r,i){i(t,e,n(203))}(0,function(e,t,n){e=t.exports=n,e.Mechanism=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(n,r){r(t,e)}(0,function(e,t){function n(){}n.prototype.name="EXTERNAL",n.prototype.clientFirst=!0,n.prototype.response=function(e){return e.authzid||""},n.prototype.challenge=function(e){},t.exports=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(r,i){i(t,e,n(205))}(0,function(e,t,n){e=t.exports=n,e.Mechanism=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(n,r){r(t,e)}(0,function(e,t){function n(){}n.prototype.name="PLAIN",n.prototype.clientFirst=!0,n.prototype.response=function(e){var t="";return t+=e.authzid||"",t+="\0",t+=e.username,t+="\0",t+=e.password},n.prototype.challenge=function(e){return this},t.exports=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(r,i){i(t,e,n(207))}(0,function(e,t,n){e=t.exports=n,e.Mechanism=n})}).call(t,n(4)(e))},function(e,t,n){(function(t){function r(e){e=e||{},this._genNonce=e.genNonce||s.genNonce,this._stage="initial"}var i=n(210),s=n(211),o={};r.Mechanism=r,r.prototype.name="SCRAM-SHA-1",r.prototype.clientFirst=!0,r.prototype.response=function(e){return o[this._stage](this,e)},r.prototype.challenge=function(e){var n=s.parse(e);return this._salt=new t(n.s||"","base64"),this._iterationCount=parseInt(n.i,10),this._nonce=n.r,this._verifier=n.v,this._error=n.e,this._challenge=e,this},o.initial=function(e,t){e._cnonce=e._genNonce();var n="";t.authzid&&(n="a="+s.saslname(t.authzid)),e._gs2Header="n,"+n+",";var r="r="+e._cnonce,i="n="+s.saslname(t.username||"");e._clientFirstMessageBare=i+","+r;var o=e._gs2Header+e._clientFirstMessageBare;return e._stage="challenge",o},o.challenge=function(e,n){var r=new t(e._gs2Header).toString("base64");e._clientFinalMessageWithoutProof="c="+r+",r="+e._nonce;var s,o,a;n.salt&&0===t.compare(n.salt,e._salt)?n.clientKey&&n.serverKey?(o=n.clientKey,a=n.serverKey):n.saltedPassword&&(s=n.saltedPassword,o=i.HMAC(s,"Client Key"),a=i.HMAC(s,"Server Key")):(s=i.Hi(n.password||"",e._salt,e._iterationCount),o=i.HMAC(s,"Client Key"),a=i.HMAC(s,"Server Key"));var c=i.H(o),u=e._clientFirstMessageBare+","+e._challenge+","+e._clientFinalMessageWithoutProof,l=i.HMAC(c,u),d=i.XOR(o,l).toString("base64");e._serverSignature=i.HMAC(a,u);var p=e._clientFinalMessageWithoutProof+",p="+d;return e._stage="final",e.cache={salt:e._salt,saltedPassword:s,clientKey:o,serverKey:a},p},o.final=function(){return""},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){(function(e){var r=n(23),i=n(39),s=n(72);t.XOR=s,t.H=function(e){return r("sha1").update(e).digest()},t.HMAC=function(e,t){return i("sha1",e).update(t).digest()},t.Hi=function(n,r,i){for(var s=t.HMAC(n,e.concat([r,new e([0,0,0,1],"binary")])),o=s,a=0;a<i-1;a++)s=t.HMAC(n,s),o=t.XOR(o,s);return o}}).call(t,n(1).Buffer)},function(e,t,n){var r=n(32).randomBytes||n(32);t.parse=function(e){for(var t={},n=e.split(/,(?=(?:[^"]|"[^"]*")*$)/),r=0,i=n.length;r<i;r++){var s=/(\w+)=["]?([^"]+)["]?$/.exec(n[r]);s&&(t[s[1]]=s[2])}return t},t.saslname=function(e){for(var t=[],n="",r=0;r<e.length;r++)n=e[r],","===n?t.push("=2C"):"="===n?t.push("=3D"):t.push(n);return t.join("")},t.genNonce=function(e){return r((e||32)/2).toString("hex")}},function(e,t,n){(function(e){!function(n,r){r(t,e)}(0,function(e,t){function n(){}n.prototype.name="X-OAUTH2",n.prototype.clientFirst=!0,n.prototype.response=function(e){var t="";return t+="\0",t+=e.username,t+="\0",t+=e.token},n.prototype.challenge=function(e){},t.exports=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(r,i){i(t,e,n(212))}(0,function(e,t,n){e=t.exports=n,e.Mechanism=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(n,r){r(t,e)}(0,function(e,t){function n(){this._mechs=[]}n.prototype.use=function(e,t){return t||(t=e,e=t.prototype.name),this._mechs.push({name:e,mech:t}),this},n.prototype.create=function(e){for(var t=0,n=this._mechs.length;t<n;t++)for(var r=0,i=e.length;r<i;r++){var s=this._mechs[t];if(s.name==e[r])return new s.mech}return null},t.exports=n})}).call(t,n(4)(e))},function(e,t,n){(function(e){!function(r,i){i(t,e,n(214))}(0,function(e,t,n){e=t.exports=n,e.Factory=n})}).call(t,n(4)(e))},function(e,t,n){var r=n(219),i=n(218);t.toIncomingSDPOffer=function(e){return r.toSessionSDP(e,{role:"responder",direction:"incoming"})},t.toOutgoingSDPOffer=function(e){return r.toSessionSDP(e,{role:"initiator",direction:"outgoing"})},t.toIncomingSDPAnswer=function(e){return r.toSessionSDP(e,{role:"initiator",direction:"incoming"})},t.toOutgoingSDPAnswer=function(e){return r.toSessionSDP(e,{role:"responder",direction:"outgoing"})},t.toIncomingMediaSDPOffer=function(e){return r.toMediaSDP(e,{role:"responder",direction:"incoming"})},t.toOutgoingMediaSDPOffer=function(e){return r.toMediaSDP(e,{role:"initiator",direction:"outgoing"})},t.toIncomingMediaSDPAnswer=function(e){return r.toMediaSDP(e,{role:"initiator",direction:"incoming"})},t.toOutgoingMediaSDPAnswer=function(e){return r.toMediaSDP(e,{role:"responder",direction:"outgoing"})},t.toCandidateSDP=r.toCandidateSDP,t.toMediaSDP=r.toMediaSDP,t.toSessionSDP=r.toSessionSDP,t.toIncomingJSONOffer=function(e,t){return i.toSessionJSON(e,{role:"responder",direction:"incoming",creators:t})},t.toOutgoingJSONOffer=function(e,t){return i.toSessionJSON(e,{role:"initiator",direction:"outgoing",creators:t})},t.toIncomingJSONAnswer=function(e,t){return i.toSessionJSON(e,{role:"initiator",direction:"incoming",creators:t})},t.toOutgoingJSONAnswer=function(e,t){return i.toSessionJSON(e,{role:"responder",direction:"outgoing",creators:t})},t.toIncomingMediaJSONOffer=function(e,t){return i.toMediaJSON(e,{role:"responder",direction:"incoming",creator:t})},t.toOutgoingMediaJSONOffer=function(e,t){return i.toMediaJSON(e,{role:"initiator",direction:"outgoing",creator:t})},t.toIncomingMediaJSONAnswer=function(e,t){return i.toMediaJSON(e,{role:"initiator",direction:"incoming",creator:t})},t.toOutgoingMediaJSONAnswer=function(e,t){return i.toMediaJSON(e,{role:"responder",direction:"outgoing",creator:t})},t.toCandidateJSON=i.toCandidateJSON,t.toMediaJSON=i.toMediaJSON,t.toSessionJSON=i.toSessionJSON},function(e,t){t.lines=function(e){return e.split("\r\n").filter(function(e){return e.length>0})},t.findLine=function(e,t,n){for(var r=e.length,i=0;i<t.length;i++)if(t[i].substr(0,r)===e)return t[i];if(!n)return!1;for(var s=0;s<n.length;s++)if(n[s].substr(0,r)===e)return n[s];return!1},t.findLines=function(e,t,n){for(var r=[],i=e.length,s=0;s<t.length;s++)t[s].substr(0,i)===e&&r.push(t[s]);if(r.length||!n)return r;for(var o=0;o<n.length;o++)n[o].substr(0,i)===e&&r.push(n[o]);return r},t.mline=function(e){for(var t=e.substr(2).split(" "),n={media:t[0],port:t[1],proto:t[2],formats:[]},r=3;r<t.length;r++)t[r]&&n.formats.push(t[r]);return n},t.rtpmap=function(e){var t=e.substr(9).split(" "),n={id:t.shift()};return t=t[0].split("/"),n.name=t[0],n.clockrate=t[1],n.channels=3==t.length?t[2]:"1",n},t.sctpmap=function(e){var t=e.substr(10).split(" ");return{number:t.shift(),protocol:t.shift(),streams:t.shift()}},t.fmtp=function(e){for(var t,n,r,i=e.substr(e.indexOf(" ")+1).split(";"),s=[],o=0;o<i.length;o++)t=i[o].split("="),n=t[0].trim(),r=t[1],n&&r?s.push({key:n,value:r}):n&&s.push({key:"",value:n});return s},t.crypto=function(e){var t=e.substr(9).split(" ");return{tag:t[0],cipherSuite:t[1],keyParams:t[2],sessionParams:t.slice(3).join(" ")}},t.fingerprint=function(e){var t=e.substr(14).split(" ");return{hash:t[0],value:t[1]}},t.extmap=function(e){var t=e.substr(9).split(" "),n={},r=t.shift(),i=r.indexOf("/");return i>=0?(n.id=r.substr(0,i),n.senders=r.substr(i+1)):(n.id=r,n.senders="sendrecv"),n.uri=t.shift()||"",n},t.rtcpfb=function(e){var t=e.substr(10).split(" "),n={};return n.id=t.shift(),n.type=t.shift(),"trr-int"===n.type?n.value=t.shift():n.subtype=t.shift()||"",n.parameters=t,n},t.candidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},r=8;r<t.length;r+=2)"raddr"===t[r]?n.relAddr=t[r+1]:"rport"===t[r]?n.relPort=t[r+1]:"generation"===t[r]?n.generation=t[r+1]:"tcptype"===t[r]&&(n.tcpType=t[r+1]);return n.network="1",n},t.sourceGroups=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].substr(13).split(" ");t.push({semantics:r.shift(),sources:r})}return t},t.sources=function(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r].substr(7).split(" "),s=i.shift();if(!n[s]){var o={ssrc:s,parameters:[]};t.push(o),n[s]=o}i=i.join(" ").split(":");var a=i.shift(),c=i.join(":")||null;n[s].parameters.push({key:a,value:c})}return t},t.groups=function(e){for(var t,n=[],r=0;r<e.length;r++)t=e[r].substr(8).split(" "),n.push({semantics:t.shift(),contents:t});return n},t.bandwidth=function(e){var t=e.substr(2).split(":"),n={};return n.type=t.shift(),n.bandwidth=t.shift(),n},t.msid=function(e){var t=e.substr(7),n=t.split(" ");return{msid:t,mslabel:n[0],label:n[1]}}},function(e,t,n){var r=n(59),i=n(217),s=Math.random();t._setIdCounter=function(e){s=e},t.toSessionJSON=function(e,n){var r,s=n.creators||[],o=n.role||"initiator",a=n.direction||"outgoing",c=e.split("\r\nm=");for(r=1;r<c.length;r++)c[r]="m="+c[r],r!==c.length-1&&(c[r]+="\r\n");var u=c.shift()+"\r\n",l=i.lines(u),d={},p=[];for(r=0;r<c.length;r++)p.push(t.toMediaJSON(c[r],u,{role:o,direction:a,creator:s[r]||"initiator"}));d.contents=p;var f=i.findLines("a=group:",l);return f.length&&(d.groups=i.groups(f)),d},t.toMediaJSON=function(e,n,s){var o=s.creator||"initiator",a=s.role||"initiator",c=s.direction||"outgoing",u=i.lines(e),l=i.lines(n),d=i.mline(u[0]),p={creator:o,name:d.media,application:{applicationType:"rtp",media:d.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==d.media&&(p.application={applicationType:"datachannel"},p.transport.sctp=[]);var f=p.application,h=p.transport,m=i.findLine("a=mid:",u);if(m&&(p.name=m.substr(6)),i.findLine("a=sendrecv",u,l)?p.senders="both":i.findLine("a=sendonly",u,l)?p.senders=r[a][c].sendonly:i.findLine("a=recvonly",u,l)?p.senders=r[a][c].recvonly:i.findLine("a=inactive",u,l)&&(p.senders="none"),"rtp"==f.applicationType){var g=i.findLine("b=",u);g&&(f.bandwidth=i.bandwidth(g));var v=i.findLine("a=ssrc:",u);v&&(f.ssrc=v.substr(7).split(" ")[0]);i.findLines("a=rtpmap:",u).forEach(function(e){var t=i.rtpmap(e);t.parameters=[],t.feedback=[],i.findLines("a=fmtp:"+t.id,u).forEach(function(e){t.parameters=i.fmtp(e)}),i.findLines("a=rtcp-fb:"+t.id,u).forEach(function(e){t.feedback.push(i.rtcpfb(e))}),f.payloads.push(t)});i.findLines("a=crypto:",u,l).forEach(function(e){f.encryption.push(i.crypto(e))}),i.findLine("a=rtcp-mux",u)&&(f.mux=!0);i.findLines("a=rtcp-fb:*",u).forEach(function(e){f.feedback.push(i.rtcpfb(e))});i.findLines("a=extmap:",u).forEach(function(e){var t=i.extmap(e);t.senders=r[a][c][t.senders],f.headerExtensions.push(t)});var b=i.findLines("a=ssrc-group:",u);f.sourceGroups=i.sourceGroups(b||[]);var y=i.findLines("a=ssrc:",u),_=f.sources=i.sources(y||[]),S=i.findLine("a=msid:",u);if(S){var T=i.msid(S);["msid","mslabel","label"].forEach(function(e){for(var t=0;t<_.length;t++){for(var n=!1,r=0;r<_[t].parameters.length;r++)_[t].parameters[r].key===e&&(n=!0);n||_[t].parameters.push({key:e,value:T[e]})}})}i.findLine("a=x-google-flag:conference",u,l)&&(f.googConferenceFlag=!0)}var E=i.findLines("a=fingerprint:",u,l),w=i.findLine("a=setup:",u,l);E.forEach(function(e){var t=i.fingerprint(e);w&&(t.setup=w.substr(8)),h.fingerprints.push(t)});var R=i.findLine("a=ice-ufrag:",u,l),C=i.findLine("a=ice-pwd:",u,l);if(R&&C){h.ufrag=R.substr(12),h.pwd=C.substr(10),h.candidates=[];i.findLines("a=candidate:",u,l).forEach(function(e){h.candidates.push(t.toCandidateJSON(e))})}if("datachannel"==f.applicationType){i.findLines("a=sctpmap:",u).forEach(function(e){var t=i.sctpmap(e);h.sctp.push(t)})}return p},t.toCandidateJSON=function(e){var t=i.candidate(e.split("\r\n")[0]);return t.id=(s++).toString(36).substr(0,12),t}},function(e,t,n){var r=n(59);t.toSessionSDP=function(e,n){var r=(n.role,n.direction,n.sid||e.sid||Date.now()),i=n.time||Date.now(),s=["v=0","o=- "+r+" "+i+" IN IP4 0.0.0.0","s=-","t=0 0"],o=e.contents||[],a=!1;return o.forEach(function(e){e.application.sources&&e.application.sources.length&&(a=!0)}),a&&s.push("a=msid-semantic: WMS *"),(e.groups||[]).forEach(function(e){s.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),o.forEach(function(e){s.push(t.toMediaSDP(e,n))}),s.join("\r\n")+"\r\n"},t.toMediaSDP=function(e,n){var i=[],s=n.role||"initiator",o=n.direction||"outgoing",a=e.application,c=e.transport,u=a.payloads||[],l=c&&c.fingerprints||[],d=[];if("datachannel"==a.applicationType?(d.push("application"),d.push("1"),d.push("DTLS/SCTP"),c.sctp&&c.sctp.forEach(function(e){d.push(e.number)})):(d.push(a.media),d.push("1"),l.length>0?d.push("UDP/TLS/RTP/SAVPF"):a.encryption&&a.encryption.length>0?d.push("RTP/SAVPF"):d.push("RTP/AVPF"),u.forEach(function(e){d.push(e.id)})),i.push("m="+d.join(" ")),i.push("c=IN IP4 0.0.0.0"),a.bandwidth&&a.bandwidth.type&&a.bandwidth.bandwidth&&i.push("b="+a.bandwidth.type+":"+a.bandwidth.bandwidth),"rtp"==a.applicationType&&i.push("a=rtcp:1 IN IP4 0.0.0.0"),c){c.ufrag&&i.push("a=ice-ufrag:"+c.ufrag),c.pwd&&i.push("a=ice-pwd:"+c.pwd);l.forEach(function(e){i.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&i.push("a=setup:"+e.setup)}),c.sctp&&c.sctp.forEach(function(e){i.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}return"rtp"==a.applicationType&&i.push("a="+(r[s][o][e.senders]||"sendrecv")),i.push("a=mid:"+e.name),a.sources&&a.sources.length&&(a.sources[0].parameters||[]).forEach(function(e){"msid"===e.key&&i.push("a=msid:"+e.value)}),a.mux&&i.push("a=rtcp-mux"),(a.encryption||[]).forEach(function(e){i.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),a.googConferenceFlag&&i.push("a=x-google-flag:conference"),u.forEach(function(e){var t="a=rtpmap:"+e.id+" "+e.name+"/"+e.clockrate;if(e.channels&&"1"!=e.channels&&(t+="/"+e.channels),i.push(t),e.parameters&&e.parameters.length){var n=["a=fmtp:"+e.id],r=[];e.parameters.forEach(function(e){r.push((e.key?e.key+"=":"")+e.value)}),n.push(r.join(";")),i.push(n.join(" "))}e.feedback&&e.feedback.forEach(function(t){"trr-int"===t.type?i.push("a=rtcp-fb:"+e.id+" trr-int "+(t.value?t.value:"0")):i.push("a=rtcp-fb:"+e.id+" "+t.type+(t.subtype?" "+t.subtype:""))})}),a.feedback&&a.feedback.forEach(function(e){"trr-int"===e.type?i.push("a=rtcp-fb:* trr-int "+(e.value?e.value:"0")):i.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))}),(a.headerExtensions||[]).forEach(function(e){i.push("a=extmap:"+e.id+(e.senders?"/"+r[s][o][e.senders]:"")+" "+e.uri)}),(a.sourceGroups||[]).forEach(function(e){i.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))}),(a.sources||[]).forEach(function(e){for(var t=0;t<e.parameters.length;t++){var n=e.parameters[t];i.push("a=ssrc:"+(e.ssrc||a.ssrc)+" "+n.key+(n.value?":"+n.value:""))}}),(c.candidates||[]).forEach(function(e){i.push(t.toCandidateSDP(e))}),i.join("\r\n")},t.toCandidateSDP=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"srflx"!==n&&"prflx"!==n&&"relay"!==n||e.relAddr&&e.relPort&&(t.push("raddr"),t.push(e.relAddr),t.push("rport"),t.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(t.push("tcptype"),t.push(e.tcpType)),t.push("generation"),t.push(e.generation||"0"),"a=candidate:"+t.join(" ")}},function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return n=n.concat(r.splitLines(t)),{usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),s=3;s<i.length;s++){var o=i[s],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var c=r.parseRtpMap(a),u=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(c.parameters=u.length?r.parseFmtp(u[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),s=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(r),s&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:o?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(0===l[0].indexOf("b=TIAS:")?l=parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")&&(l=parseInt(l[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=l})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var s=r.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var s=r.writeRtpDescription(e.kind,t);if(s+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),s},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},e.exports=r},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return u[c]=r,a(c),c++}function i(e){delete u[e]}function s(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function o(e){if(l)setTimeout(o,0,e);else{var t=u[e];if(t){l=!0;try{s(t)}finally{i(e),l=!1}}}}if(!e.setImmediate){var a,c=1,u={},l=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?function(){a=function(e){t.nextTick(function(){o(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),a=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},a=function(t){e.port2.postMessage(t)}}():d&&"onreadystatechange"in d.createElement("script")?function(){var e=d.documentElement;a=function(t){var n=d.createElement("script");n.onreadystatechange=function(){o(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){a=function(e){setTimeout(o,0,e)}}(),p.setImmediate=r,p.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(3),n(8))},function(e,t,n){(function(t){function r(){this.init(),this._w=l,c.call(this,64,56)}function i(e){return e<<5|e>>>27}function s(e){return e<<30|e>>>2}function o(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}var a=n(2),c=n(15),u=[1518500249,1859775393,-1894007588,-899497514],l=new Array(80);a(r,c),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,a=0|this._c,c=0|this._d,l=0|this._e,d=0;d<16;++d)t[d]=e.readInt32BE(4*d);for(;d<80;++d)t[d]=t[d-3]^t[d-8]^t[d-14]^t[d-16];for(var p=0;p<80;++p){var f=~~(p/20),h=i(n)+o(f,r,a,c)+l+t[p]+u[f]|0;l=c,c=a,a=s(r),r=n,n=h}this._a=n+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=c+this._d|0,this._e=l+this._e|0},r.prototype._hash=function(){var e=new t(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){(function(t){function r(){this.init(),this._w=d,u.call(this,64,56)}function i(e){return e<<1|e>>>31}function s(e){return e<<5|e>>>27}function o(e){return e<<30|e>>>2}function a(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}var c=n(2),u=n(15),l=[1518500249,1859775393,-1894007588,-899497514],d=new Array(80);c(r,u),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,c=0|this._c,u=0|this._d,d=0|this._e,p=0;p<16;++p)t[p]=e.readInt32BE(4*p);for(;p<80;++p)t[p]=i(t[p-3]^t[p-8]^t[p-14]^t[p-16]);for(var f=0;f<80;++f){var h=~~(f/20),m=s(n)+a(h,r,c,u)+d+t[f]+l[h]|0;d=u,u=c,c=o(r),r=n,n=m}this._a=n+this._a|0,this._b=r+this._b|0,this._c=c+this._c|0,this._d=u+this._d|0,this._e=d+this._e|0},r.prototype._hash=function(){var e=new t(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){(function(t){function r(){this.init(),this._w=a,o.call(this,64,56)}var i=n(2),s=n(61),o=n(15),a=new Array(64);i(r,s),r.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},r.prototype._hash=function(){var e=new t(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=r}).call(t,n(1).Buffer)},function(e,t,n){(function(t){function r(){this.init(),this._w=a,o.call(this,128,112)}var i=n(2),s=n(62),o=n(15),a=new Array(160);i(r,s),r.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},r.prototype._hash=function(){function e(e,t,r){n.writeInt32BE(e,r),n.writeInt32BE(t,r+4)}var n=new t(48);return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),n},e.exports=r}).call(t,n(1).Buffer)},function(e,t){e.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.7.7",main:"src/index.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"http://sipjs.com",author:"OnSIP <developer@onsip.com> (http://sipjs.com/authors/)",contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{beefy:"^2.1.5",browserify:"^4.1.8",grunt:"~0.4.0","grunt-browserify":"^4.0.1","grunt-cli":"~0.1.6","grunt-contrib-copy":"^0.5.0","grunt-contrib-jasmine":"^1.0.3","grunt-contrib-jshint":">0.5.0","grunt-contrib-uglify":"~0.2.0","grunt-peg":"~1.3.1","grunt-trimtrailingspaces":"^0.4.0",pegjs:"^0.8.0"},engines:{node:">=0.12"},license:"MIT",scripts:{repl:"beefy test/repl.js --open",build:"grunt build",prepublish:"cd src/Grammar && mkdir -p dist && pegjs --extra-options-file peg.json src/Grammar.pegjs dist/Grammar.js",test:"grunt travis --verbose"},dependencies:{ws:"^1.0.1"},optionalDependencies:{promiscuous:"^0.6.0"}}},function(e,t,n){"use strict";e.exports=function(e){var t;t=function(t,n,r,i){var s=r;if(void 0===r)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=n,!(r=t.normalizeTarget(r)))throw new TypeError("Invalid target: "+s);i=Object.create(i||Object.prototype),i.extraHeaders=(i.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,r,this.ua,i.params,i.extraHeaders),i.body&&(this.body={},this.body.body=i.body,i.contentType&&(this.body.contentType=i.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){t=t||{},t.extraHeaders=(t.extraHeaders||[]).slice();var n=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(n,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var n=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,n);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,n);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,n),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},function(e,t,n){"use strict";e.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0}}}},function(e,t,n){"use strict";e.exports=function(e){var t;return t=function(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null},t.prototype={send:function(){var t=this,n=new e.RequestSender(this,this.dialog.owner.ua);n.send(),this.request.method===e.C.INVITE&&n.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,n.clientTransaction.on("stateChanged",function n(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",n),t.dialog.uac_pending_reply=!1,!1===t.dialog.uas_pending_reply&&t.dialog.owner.onReadyToReinvite())}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout(function(){n.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(n.reattempt=!0,n.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},function(e,t,n){"use strict";e.exports=function(e){var t,r=n(229)(e),i={STATUS_EARLY:1,STATUS_CONFIRMED:2};t=function(t,n,r,s){var o;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};s=n instanceof e.IncomingResponse?n.status_code<200?i.STATUS_EARLY:i.STATUS_CONFIRMED:s||i.STATUS_CONFIRMED,o=n.parseHeader("contact"),"UAS"===r?(this.id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=s,this.remote_seqnum=n.cseq,this.local_uri=n.parseHeader("to").uri,this.remote_uri=n.parseHeader("from").uri,this.remote_target=o.uri,this.route_set=n.getHeaders("record-route"),this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq):"UAC"===r&&(this.id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=s,this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq,this.local_uri=n.parseHeader("from").uri,this.pracked=[],this.remote_uri=n.parseHeader("to").uri,this.remote_target=o.uri,this.route_set=n.getHeaders("record-route").reverse(),this.state!==i.STATUS_EARLY||t.hasOffer||(this.mediaHandler=t.mediaHandlerFactory(t))),this.logger=t.ua.getLogger("sip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+r+" dialog created with status "+(this.state===i.STATUS_EARLY?"EARLY":"CONFIRMED")),t.emit("dialog",this)},t.prototype={update:function(e,t){this.state=i.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.mediaHandler&&this.state!==i.STATUS_CONFIRMED&&this.mediaHandler.peerConnection.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,n,r){var i,s;return n=(n||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),i=t===e.C.CANCEL||t===e.C.ACK?this.invite_seqnum:this.local_seqnum+=1,s=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:i,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},n,r),s.dialog=this,s},checkInDialogRequest:function(t){var n=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),t.cseq===this.invite_seqnum;t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq)}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply){var r=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+r]),!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",function t(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",t),n.uas_pending_reply=!1,!1===n.uac_pending_reply&&n.owner.onReadyToReinvite())})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_ACCEPTED&&(n.remote_target=t.parseHeader("contact").uri)});break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_COMPLETED&&(n.remote_target=t.parseHeader("contact").uri)})}return!0},sendRequest:function(e,t,n){n=n||{};var i=(n.extraHeaders||[]).slice(),s=null;n.body&&(n.body.body?s=n.body:(s={},s.body=n.body,n.contentType&&(s.contentType=n.contentType)));var o=this.createRequest(t,i,s);return new r(this,e,o).send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=i,e.Dialog=t}},function(e,t,n){"use strict";e.exports=function(e){var t;return t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null},t.prototype.authenticate=function(t,n){if(this.algorithm=n.algorithm,this.realm=n.realm,this.nonce=n.nonce,this.opaque=n.opaque,this.stale=n.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(n.qop)if(n.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(n.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var t,n;t=e.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(n=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+n)):"auth-int"===this.qop?(n=e.calculateMD5(this.method+":"+this.uri+":"+e.calculateMD5(this.body?this.body:"")),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+n)):null===this.qop&&(n=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+n))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},function(e,t,n){"use strict";var r=n(10).EventEmitter;e.exports=function(e){function t(){r.call(this)}return t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t.prototype.off=function(t,n){var r="";return r+="SIP.EventEmitter#off is deprecated and may be removed in future SIP.js versions.\n",r+="Please use removeListener or removeAllListeners instead.\n",r+="See here for more details:\n",r+="http://nodejs.org/api/events.html#events_emitter_removelistener_event_listener",e.warn(r),arguments.length<2?this.removeAllListeners.apply(this,arguments):this.removeListener(t,n)},t}},function(e,t,n){"use strict";e.exports={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}()}},function(e,t,n){"use strict";var r=n(235);e.exports=function(e){return{parse:function(t,n){var i={startRule:n,SIP:e};try{r.parse(t,i)}catch(e){i.data=-1}return i.data}}}},function(e,t){e.exports=function(){function e(e,t,n,r,i,s){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=s,this.name="SyntaxError"}function t(t){function n(){return t.substring(b,v)}function r(){return b}function i(e){return y!==e&&(y>e&&(y=0,_={line:1,column:1,seenCR:!1}),function(e,n,r){var i,s;for(i=n;i<r;i++)s=t.charAt(i),"\n"===s?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(_,y,e),y=e),_}function s(e){v<S||(v>S&&(S=v,T=[]),T.push(e))}function o(n,r,s){var o=i(s),a=s<t.length?t.charAt(s):null;return null!==r&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(r),new e(null!==n?n:function(e,t){var n,r,i,s=new Array(e.length);for(i=0;i<e.length;i++)s[i]=e[i].description;return n=e.length>1?s.slice(0,-1).join(", ")+" or "+s[e.length-1]:s[0],r=t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input","Expected "+n+" but "+r+" found."}(r,a),r,a,s,o.line,o.column)}function a(e){var t,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=e.charCodeAt(t)-32;return n}function c(e){for(var n,r,i=g[e],o=0,a=[],u=i.length,l=[],d=[];;){for(;o<u;)switch(i[o]){case 0:d.push(function(e){return"[object Array]"===Object.prototype.toString.apply(e)?[]:e}(m[i[o+1]])),o+=2;break;case 1:d.push(v),o++;break;case 2:d.pop(),o++;break;case 3:v=d.pop(),o++;break;case 4:d.length-=i[o+1],o+=2;break;case 5:d.splice(-2,1),o++;break;case 6:d[d.length-2].push(d.pop()),o++;break;case 7:d.push(d.splice(d.length-i[o+1],i[o+1])),o+=2;break;case 8:d.pop(),d.push(t.substring(d[d.length-1],v)),o++;break;case 9:l.push(u),a.push(o+3+i[o+1]+i[o+2]),d[d.length-1]?(u=o+3+i[o+1],o+=3):(u=o+3+i[o+1]+i[o+2],o+=3+i[o+1]);break;case 10:l.push(u),a.push(o+3+i[o+1]+i[o+2]),d[d.length-1]===p?(u=o+3+i[o+1],o+=3):(u=o+3+i[o+1]+i[o+2],o+=3+i[o+1]);break;case 11:l.push(u),a.push(o+3+i[o+1]+i[o+2]),d[d.length-1]!==p?(u=o+3+i[o+1],o+=3):(u=o+3+i[o+1]+i[o+2],o+=3+i[o+1]);break;case 12:d[d.length-1]!==p?(l.push(u),a.push(o),u=o+2+i[o+1],o+=2):o+=2+i[o+1];break;case 13:l.push(u),a.push(o+3+i[o+1]+i[o+2]),t.length>v?(u=o+3+i[o+1],o+=3):(u=o+3+i[o+1]+i[o+2],o+=3+i[o+1]);break;case 14:l.push(u),a.push(o+4+i[o+2]+i[o+3]),t.substr(v,m[i[o+1]].length)===m[i[o+1]]?(u=o+4+i[o+2],o+=4):(u=o+4+i[o+2]+i[o+3],o+=4+i[o+2]);break;case 15:l.push(u),a.push(o+4+i[o+2]+i[o+3]),t.substr(v,m[i[o+1]].length).toLowerCase()===m[i[o+1]]?(u=o+4+i[o+2],o+=4):(u=o+4+i[o+2]+i[o+3],o+=4+i[o+2]);break;case 16:l.push(u),a.push(o+4+i[o+2]+i[o+3]),m[i[o+1]].test(t.charAt(v))?(u=o+4+i[o+2],o+=4):(u=o+4+i[o+2]+i[o+3],o+=4+i[o+2]);break;case 17:d.push(t.substr(v,i[o+1])),v+=i[o+1],o+=2;break;case 18:d.push(m[i[o+1]]),v+=m[i[o+1]].length,o+=2;break;case 19:d.push(p),0===E&&s(m[i[o+1]]),o+=2;break;case 20:b=d[d.length-1-i[o+1]],o+=2;break;case 21:b=v,o++;break;case 22:for(n=i.slice(o+4,o+4+i[o+3]),r=0;r<i[o+3];r++)n[r]=d[d.length-1-n[r]];d.splice(d.length-i[o+2],i[o+2],m[i[o+1]].apply(null,n)),o+=4+i[o+3];break;case 23:d.push(c(i[o+1])),o+=2;break;case 24:E++,o++;break;case 25:E--,o++;break;default:throw new Error("Invalid opcode: "+i[o]+".")}if(!(l.length>0))break;u=l.pop(),o=a.pop()}return d[0]}function u(e,t){return[e].concat(t)}var l,d=arguments.length>1?arguments[1]:{},p={},f={Contact:118,Name_Addr_Header:155,Record_Route:175,Request_Response:81,SIP_URI:45,Subscription_State:185,Supported:190,Require:181,Via:193,absoluteURI:84,Call_ID:117,Content_Disposition:129,Content_Length:134,Content_Type:135,CSeq:145,displayName:121,Event:148,From:150,host:52,Max_Forwards:153,Min_SE:212,Proxy_Authenticate:156,quoted_string:40,Refer_To:177,Replaces:178,Session_Expires:209,stun_URI:216,To:191,turn_URI:223,uuid:226,WWW_Authenticate:208,challenge:157},h=118,m=["\r\n",{type:"literal",value:"\r\n",description:'"\\r\\n"'},/^[0-9]/,{type:"class",value:"[0-9]",description:"[0-9]"},/^[a-zA-Z]/,{type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},/^[0-9a-fA-F]/,{type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},/^[\0-\xFF]/,{type:"class",value:"[\\0-\\xFF]",description:"[\\0-\\xFF]"},/^["]/,{type:"class",value:'["]',description:'["]'}," ",{type:"literal",value:" ",description:'" "'},"\t",{type:"literal",value:"\t",description:'"\\t"'},/^[a-zA-Z0-9]/,{type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},";",{type:"literal",value:";",description:'";"'},"/",{type:"literal",value:"/",description:'"/"'},"?",{type:"literal",value:"?",description:'"?"'},":",{type:"literal",value:":",description:'":"'},"@",{type:"literal",value:"@",description:'"@"'},"&",{type:"literal",value:"&",description:'"&"'},"=",{type:"literal",value:"=",description:'"="'},"+",{type:"literal",value:"+",description:'"+"'},"$",{type:"literal",value:"$",description:'"$"'},",",{type:"literal",value:",",description:'","'},"-",{type:"literal",value:"-",description:'"-"'},"_",{type:"literal",value:"_",description:'"_"'},".",{type:"literal",value:".",description:'"."'},"!",{type:"literal",value:"!",description:'"!"'},"~",{type:"literal",value:"~",description:'"~"'},"*",{type:"literal",value:"*",description:'"*"'},"'",{type:"literal",value:"'",description:'"\'"'},"(",{type:"literal",value:"(",description:'"("'},")",{type:"literal",value:")",description:'")"'},p,"%",{type:"literal",value:"%",description:'"%"'},null,[],function(){return" "},function(){return":"},/^[!-~]/,{type:"class",value:"[!-~]",description:"[!-~]"},/^[\x80-\uFFFF]/,{type:"class",value:"[\\x80-\\uFFFF]",description:"[\\x80-\\uFFFF]"},/^[\x80-\xBF]/,{type:"class",value:"[\\x80-\\xBF]",description:"[\\x80-\\xBF]"},/^[a-f]/,{type:"class",value:"[a-f]",description:"[a-f]"},"`",{type:"literal",value:"`",description:'"`"'},"<",{type:"literal",value:"<",description:'"<"'},">",{type:"literal",value:">",description:'">"'},"\\",{type:"literal",value:"\\",description:'"\\\\"'},"[",{type:"literal",value:"[",description:'"["'},"]",{type:"literal",value:"]",description:'"]"'},"{",{type:"literal",value:"{",description:'"{"'},"}",{type:"literal",value:"}",description:'"}"'},function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,{type:"class",value:"[!-']",description:"[!-']"},/^[*-[]/,{type:"class",value:"[*-[]",description:"[*-[]"},/^[\]-~]/,{type:"class",value:"[\\]-~]",description:"[\\]-~]"},function(e){return e},/^[#-[]/,{type:"class",value:"[#-[]",description:"[#-[]"},/^[\0-\t]/,{type:"class",value:"[\\0-\\t]",description:"[\\0-\\t]"},/^[\x0B-\f]/,{type:"class",value:"[\\x0B-\\f]",description:"[\\x0B-\\f]"},/^[\x0E-]/,{type:"class",value:"[\\x0E-]",description:"[\\x0E-]"},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port,delete d.data.uri_params,"SIP_URI"===d.startRule&&(d.data=d.data.uri)},"sips",{type:"literal",value:"sips",description:'"sips"'},"sip",{type:"literal",value:"sip",description:'"sip"'},function(e){d.data.scheme=e},function(){d.data.user=decodeURIComponent(n().slice(0,-1))},function(){d.data.password=n()},function(){return d.data.host=n(),d.data.host},function(){return d.data.host_type="domain",n()},/^[a-zA-Z0-9_\-]/,{type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},/^[a-zA-Z0-9\-]/,{type:"class",value:"[a-zA-Z0-9\\-]",description:"[a-zA-Z0-9\\-]"},function(){return d.data.host_type="IPv6",n()},"::",{type:"literal",value:"::",description:'"::"'},function(){return d.data.host_type="IPv6",n()},function(){return d.data.host_type="IPv4",n()},"25",{type:"literal",value:"25",description:'"25"'},/^[0-5]/,{type:"class",value:"[0-5]",description:"[0-5]"},"2",{type:"literal",value:"2",description:'"2"'},/^[0-4]/,{type:"class",value:"[0-4]",description:"[0-4]"},"1",{type:"literal",value:"1",description:'"1"'},/^[1-9]/,{type:"class",value:"[1-9]",description:"[1-9]"},function(e){return e=parseInt(e.join("")),d.data.port=e,e},"transport=",{type:"literal",value:"transport=",description:'"transport="'},"udp",{type:"literal",value:"udp",description:'"udp"'},"tcp",{type:"literal",value:"tcp",description:'"tcp"'},"sctp",{type:"literal",value:"sctp",description:'"sctp"'},"tls",{type:"literal",value:"tls",description:'"tls"'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.transport=e.toLowerCase()},"user=",{type:"literal",value:"user=",description:'"user="'},"phone",{type:"literal",value:"phone",description:'"phone"'},"ip",{type:"literal",value:"ip",description:'"ip"'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.user=e.toLowerCase()},"method=",{type:"literal",value:"method=",description:'"method="'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.method=e},"ttl=",{type:"literal",value:"ttl=",description:'"ttl="'},function(e){d.data.params||(d.data.params={}),d.data.params.ttl=e},"maddr=",{type:"literal",value:"maddr=",description:'"maddr="'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.maddr=e},"lr",{type:"literal",value:"lr",description:'"lr"'},function(){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.lr=void 0},function(e,t){d.data.uri_params||(d.data.uri_params={}),t=null===t?void 0:t[1],d.data.uri_params[e.toLowerCase()]=t&&t.toLowerCase()},function(e,t){e=e.join("").toLowerCase(),t=t.join(""),d.data.uri_headers||(d.data.uri_headers={}),d.data.uri_headers[e]?d.data.uri_headers[e].push(t):d.data.uri_headers[e]=[t]},function(){"Refer_To"===d.startRule&&(d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port,delete d.data.uri_params)},"//",{type:"literal",value:"//",description:'"//"'},function(){d.data.scheme=n()},{type:"literal",value:"SIP",description:'"SIP"'},function(){d.data.sip_version=n()},"INVITE",{type:"literal",value:"INVITE",description:'"INVITE"'},"ACK",{type:"literal",value:"ACK",description:'"ACK"'},"VXACH",{type:"literal",value:"VXACH",description:'"VXACH"'},"OPTIONS",{type:"literal",value:"OPTIONS",description:'"OPTIONS"'},"BYE",{type:"literal",value:"BYE",description:'"BYE"'},"CANCEL",{type:"literal",value:"CANCEL",description:'"CANCEL"'},"REGISTER",{type:"literal",value:"REGISTER",description:'"REGISTER"'},"SUBSCRIBE",{type:"literal",value:"SUBSCRIBE",description:'"SUBSCRIBE"'},"NOTIFY",{type:"literal",value:"NOTIFY",description:'"NOTIFY"'},"REFER",{type:"literal",value:"REFER",description:'"REFER"'},function(){return d.data.method=n(),d.data.method},function(e){d.data.status_code=parseInt(e.join(""))},function(){d.data.reason_phrase=n()},function(){d.data=n()},function(){var e,t;for(t=d.data.multi_header.length,e=0;e<t;e++)if(null===d.data.multi_header[e].parsed){d.data=null;break}null!==d.data?d.data=d.data.multi_header:d.data=-1},function(){var e;d.data.multi_header||(d.data.multi_header=[]);try{e=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,delete d.data.displayName,delete d.data.params}catch(t){e=null}d.data.multi_header.push({position:v,offset:r(),parsed:e})},function(e){e=n().trim(),'"'===e[0]&&(e=e.substring(1,e.length-1)),d.data.displayName=e},"q",{type:"literal",value:"q",description:'"q"'},function(e){d.data.params||(d.data.params={}),d.data.params.q=e},"expires",{type:"literal",value:"expires",description:'"expires"'},function(e){d.data.params||(d.data.params={}),d.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",{type:"literal",value:"0",description:'"0"'},function(){return parseFloat(n())},function(e,t){d.data.params||(d.data.params={}),t=null===t?void 0:t[1],d.data.params[e.toLowerCase()]=t},"render",{type:"literal",value:"render",description:'"render"'},"session",{type:"literal",value:"session",description:'"session"'},"icon",{type:"literal",value:"icon",description:'"icon"'},"alert",{type:"literal",value:"alert",description:'"alert"'},function(){"Content_Disposition"===d.startRule&&(d.data.type=n().toLowerCase())},"handling",{type:"literal",value:"handling",description:'"handling"'},"optional",{type:"literal",value:"optional",description:'"optional"'},"required",{type:"literal",value:"required",description:'"required"'},function(e){d.data=parseInt(e.join(""))},function(){d.data=n()},"text",{type:"literal",value:"text",description:'"text"'},"image",{type:"literal",value:"image",description:'"image"'},"audio",{type:"literal",value:"audio",description:'"audio"'},"video",{type:"literal",value:"video",description:'"video"'},"application",{type:"literal",value:"application",description:'"application"'},"message",{type:"literal",value:"message",description:'"message"'},"multipart",{type:"literal",value:"multipart",description:'"multipart"'},"x-",{type:"literal",value:"x-",description:'"x-"'},function(e){d.data.value=parseInt(e.join(""))},function(e){d.data=e},function(e){d.data.event=e.toLowerCase()},function(){var e=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),e&&d.data.setParam("tag",e)},"tag",{type:"literal",value:"tag",description:'"tag"'},function(e){d.data.tag=e},function(e){d.data=parseInt(e.join(""))},function(e){d.data=e},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params)},"digest",{type:"literal",value:"Digest",description:'"Digest"'},"realm",{type:"literal",value:"realm",description:'"realm"'},function(e){d.data.realm=e},"domain",{type:"literal",value:"domain",description:'"domain"'},"nonce",{type:"literal",value:"nonce",description:'"nonce"'},function(e){d.data.nonce=e},"opaque",{type:"literal",value:"opaque",description:'"opaque"'},function(e){d.data.opaque=e},"stale",{type:"literal",value:"stale",description:'"stale"'},"true",{type:"literal",value:"true",description:'"true"'},function(){d.data.stale=!0},"false",{type:"literal",value:"false",description:'"false"'},function(){d.data.stale=!1},"algorithm",{type:"literal",value:"algorithm",description:'"algorithm"'},"md5",{type:"literal",value:"MD5",description:'"MD5"'},"md5-sess",{type:"literal",value:"MD5-sess",description:'"MD5-sess"'},function(e){d.data.algorithm=e.toUpperCase()},"qop",{type:"literal",value:"qop",description:'"qop"'},"auth-int",{type:"literal",value:"auth-int",description:'"auth-int"'},"auth",{type:"literal",value:"auth",description:'"auth"'},function(e){d.data.qop||(d.data.qop=[]),d.data.qop.push(e.toLowerCase())},function(e){d.data.value=parseInt(e.join(""))},function(){var e,t;for(t=d.data.multi_header.length,e=0;e<t;e++)if(null===d.data.multi_header[e].parsed){d.data=null;break}null!==d.data?d.data=d.data.multi_header:d.data=-1},function(){var e;d.data.multi_header||(d.data.multi_header=[]);try{e=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,delete d.data.displayName,delete d.data.params}catch(t){e=null}d.data.multi_header.push({position:v,offset:r(),parsed:e})},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params)},function(){d.data.replaces_from_tag&&d.data.replaces_to_tag||(d.data=-1)},function(){d.data={call_id:d.data}},"from-tag",{type:"literal",value:"from-tag",description:'"from-tag"'},function(e){d.data.replaces_from_tag=e},"to-tag",{type:"literal",value:"to-tag",description:'"to-tag"'},function(e){d.data.replaces_to_tag=e},"early-only",{type:"literal",value:"early-only",description:'"early-only"'},function(){d.data.early_only=!0},function(e){return e},function(e,t){return u(e,t)},function(e){"Require"===d.startRule&&(d.data=e||[])},function(e){d.data.value=parseInt(e.join(""))},"active",{type:"literal",value:"active",description:'"active"'},"pending",{type:"literal",value:"pending",description:'"pending"'},"terminated",{type:"literal",value:"terminated",description:'"terminated"'},function(){d.data.state=n()},"reason",{type:"literal",value:"reason",description:'"reason"'},function(e){void 0!==e&&(d.data.reason=e)},function(e){void 0!==e&&(d.data.expires=e)},"retry_after",{type:"literal",value:"retry_after",description:'"retry_after"'},function(e){void 0!==e&&(d.data.retry_after=e)},"deactivated",{type:"literal",value:"deactivated",description:'"deactivated"'},"probation",{type:"literal",value:"probation",description:'"probation"'},"rejected",{type:"literal",value:"rejected",description:'"rejected"'},"timeout",{type:"literal",value:"timeout",description:'"timeout"'},"giveup",{type:"literal",value:"giveup",description:'"giveup"'},"noresource",{type:"literal",value:"noresource",description:'"noresource"'},"invariant",{type:"literal",value:"invariant",description:'"invariant"'},function(e){"Supported"===d.startRule&&(d.data=e||[])},function(){var e=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),e&&d.data.setParam("tag",e)},"ttl",{type:"literal",value:"ttl",description:'"ttl"'},function(e){d.data.ttl=e},"maddr",{type:"literal",value:"maddr",description:'"maddr"'},function(e){d.data.maddr=e},"received",{type:"literal",value:"received",description:'"received"'},function(e){d.data.received=e},"branch",{type:"literal",value:"branch",description:'"branch"'},function(e){d.data.branch=e},"rport",{type:"literal",value:"rport",description:'"rport"'},function(){"undefined"!=typeof response_port&&(d.data.rport=response_port.join(""))},function(e){d.data.protocol=e},{type:"literal",value:"UDP",description:'"UDP"'},{type:"literal",value:"TCP",description:'"TCP"'},{type:"literal",value:"TLS",description:'"TLS"'},{type:"literal",value:"SCTP",description:'"SCTP"'},function(e){d.data.transport=e},function(){d.data.host=n()},function(e){d.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===d.startRule&&(d.data.deltaSeconds=e)},"refresher",{type:"literal",value:"refresher",description:'"refresher"'},"uas",{type:"literal",value:"uas",description:'"uas"'},"uac",{type:"literal",value:"uac",description:'"uac"'},function(e){"Session_Expires"===d.startRule&&(d.data.refresher=e)},function(e){"Min_SE"===d.startRule&&(d.data=e)},"stuns",{type:"literal",value:"stuns",description:'"stuns"'},"stun",{type:"literal",value:"stun",description:'"stun"'},function(e){d.data.scheme=e},function(e){d.data.host=e},"?transport=",{type:"literal",value:"?transport=",description:'"?transport="'},"turns",{type:"literal",value:"turns",description:'"turns"'},"turn",{type:"literal",value:"turn",description:'"turn"'},function(){d.data.transport=transport},function(){d.data=n()}],g=[a('. ""2 3!'),a('0"""1!3#'),a('0$""1!3%'),a('0&""1!3\''),a("7'*# \"7("),a('0(""1!3)'),a('0*""1!3+'),a('.,""2,3-'),a('..""2.3/'),a('00""1!31'),a('.2""2233* ".4""2435*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('7)*# "7,'),a('.F""2F3G*} ".H""2H3I*q ".J""2J3K*e ".L""2L3M*Y ".N""2N3O*M ".P""2P3Q*A ".R""2R3S*5 ".T""2T3U*) ".V""2V3W'),a('!!.Y""2Y3Z+7$7#+-%7#+#%\'#%$## X$"# X"# X+! (%'),a('!! \\7$,#&7$"+-$7 +#%\'"%$"# X"# X*# " [+@$ \\7$+&$,#&7$""" X+\'%4"6]" %$"# X"# X'),a('7.*# " ['),a('! \\7\'*# "7(,)&7\'*# "7("+A$.8""2839+1%7/+\'%4#6^# %$## X$"# X"# X'),a('!! \\72+&$,#&72""" X+o$ \\! \\7.,#&7."+-$72+#%\'"%$"# X"# X,@&! \\7.,#&7."+-$72+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),a('0_""1!3`*# "73'),a('0a""1!3b'),a('0c""1!3d'),a('7!*) "0e""1!3f'),a('! \\7)* ".F""2F3G* ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+$,&7)* ".F""2F3G* ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),a('! \\7)* ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+$,&7)* ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),a('.T""2T3U*ã ".V""2V3W*× ".i""2i3j*Ë ".k""2k3l*¿ ".:""2:3;*³ ".D""2D3E*§ ".2""2233* ".8""2839* ".m""2m3n* "7&*} ".4""2435*q ".o""2o3p*e ".q""2q3r*Y ".6""2637*M ".>""2>3?*A ".s""2s3t*5 ".u""2u3v*) "7\'*# "7('),a('! \\7)*ī ".F""2F3G*ğ ".J""2J3K*ē ".L""2L3M*ć ".Y""2Y3Z*û ".P""2P3Q*ï ".H""2H3I*ã ".@""2@3A*× ".g""2g3h*Ë ".R""2R3S*¿ ".N""2N3O*³ ".T""2T3U*§ ".V""2V3W* ".i""2i3j* ".k""2k3l* ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v+Ĵ$,ı&7)*ī ".F""2F3G*ğ ".J""2J3K*ē ".L""2L3M*ć ".Y""2Y3Z*û ".P""2P3Q*ï ".H""2H3I*ã ".@""2@3A*× ".g""2g3h*Ë ".R""2R3S*¿ ".N""2N3O*³ ".T""2T3U*§ ".V""2V3W* ".i""2i3j* ".k""2k3l* ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v""" X+! (%'),a('!7/+A$.P""2P3Q+1%7/+\'%4#6w# %$## X$"# X"# X'),a('!7/+A$.4""2435+1%7/+\'%4#6x# %$## X$"# X"# X'),a('!7/+A$.>""2>3?+1%7/+\'%4#6y# %$## X$"# X"# X'),a('!7/+A$.T""2T3U+1%7/+\'%4#6z# %$## X$"# X"# X'),a('!7/+A$.V""2V3W+1%7/+\'%4#6{# %$## X$"# X"# X'),a('!.k""2k3l+1$7/+\'%4"6|" %$"# X"# X'),a('!7/+7$.i""2i3j+\'%4"6}" %$"# X"# X'),a('!7/+A$.D""2D3E+1%7/+\'%4#6~# %$## X$"# X"# X'),a('!7/+A$.2""2233+1%7/+\'%4#6# %$## X$"# X"# X'),a('!7/+A$.8""2839+1%7/+\'%4#6# %$## X$"# X"# X'),a('!7/+1$7&+\'%4"6" %$"# X"# X'),a('!7&+1$7/+\'%4"6" %$"# X"# X'),a('!7=+W$ \\7G*) "7K*# "7F,/&7G*) "7K*# "7F"+-%7>+#%\'#%$## X$"# X"# X'),a('0""1!3*A "0""1!3*5 "0""1!3*) "73*# "7.'),a('!!7/+U$7&+K% \\7J*# "7K,)&7J*# "7K"+-%7&+#%\'$%$$# X$## X$"# X"# X+! (%'),a('!7/+`$7&+V%! \\7J*# "7K,)&7J*# "7K"+! (%+2%7&+(%4$6$!!%$$# X$## X$"# X"# X'),a('7.*G ".L""2L3M*; "0""1!3*/ "0""1!3*# "73'),a('!.m""2m3n+K$0""1!3*5 "0""1!3*) "0""1!3+#%\'"%$"# X"# X'),a('!7N+Q$.8""2839+A%7O*# " [+1%7S+\'%4$6$ %$$# X$## X$"# X"# X'),a('!7N+k$.8""2839+[%7O*# " [+K%7S+A%7_+7%7l*# " [+\'%4&6& %$&# X$%# X$$# X$## X$"# X"# X'),a('!/""1$3*) "/""1#3+\' 4!6!! %'),a('!7P+b$!.8""2839+-$7R+#%\'"%$"# X"# X*# " [+7%.:""2:3;+\'%4#6# %$## X$"# X"# X'),a(' \\7+*) "7-*# "7Q+2$,/&7+*) "7-*# "7Q""" X'),a('.<""2<3=*q ".>""2>3?*e ".@""2@3A*Y ".B""2B3C*M ".D""2D3E*A ".2""2233*5 ".6""2637*) ".4""2435'),a('! \\7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E,e&7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E"+& 4!6! %'),a('!7T+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6! %'),a('! \\!7V+3$.J""2J3K+#%\'"%$"# X"# X,>&!7V+3$.J""2J3K+#%\'"%$"# X"# X"+G$7W+=%.J""2J3K*# " [+\'%4#6# %$## X$"# X"# X'),a(' \\0""1!3+,$,)&0""1!3""" X'),a('!0$""1!3%+A$ \\0""1!3,)&0""1!3"+#%\'"%$"# X"# X'),a('!.o""2o3p+A$7Y+7%.q""2q3r+\'%4#6 # %$## X$"# X"# X'),a('!!7Z+¿$.8""2839+¯%7Z+¥%.8""2839+%7Z+%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'-%$-# X$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*࠸ "!.¡""2¡3¢+¯$7Z+¥%.8""2839+%7Z+%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\',%$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*ޕ "!.¡""2¡3¢+$7Z+%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*܌ "!.¡""2¡3¢+{$7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*ڝ "!.¡""2¡3¢+a$7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'&%$&# X$%# X$$# X$## X$"# X"# X*و "!.¡""2¡3¢+G$7Z+=%.8""2839+-%7[+#%\'$%$$# X$## X$"# X"# X*؍ "!.¡""2¡3¢+-$7[+#%\'"%$"# X"# X*׬ "!.¡""2¡3¢+-$7Z+#%\'"%$"# X"# X*׋ "!7Z+¥$.¡""2¡3¢+%7Z+%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'+%$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ը "!7Z+¶$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+%.¡""2¡3¢+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ҕ "!7Z+Ç$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+q%.¡""2¡3¢+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\')%$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*ϟ "!7Z+Ø$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+­%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+W%.¡""2¡3¢+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*̙ "!7Z+é$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+¾%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.¡""2¡3¢+-%7[+#%\'\'%$\'# X$&# X$%# X$$# X$## X$"# X"# X*ɂ "!7Z+Ĕ$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+é%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+¾%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.¡""2¡3¢+-%7Z+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*ŀ "!7Z+ĵ$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Ċ%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+ß%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+´%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+^%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+3%.¡""2¡3¢+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X+& 4!6£! %'),a('!7#+S$7#*# " [+C%7#*# " [+3%7#*# " [+#%\'$%$$# X$## X$"# X"# X'),a('!7Z+=$.8""2839+-%7Z+#%\'#%$## X$"# X"# X*# "7\\'),a('!7]+u$.J""2J3K+e%7]+[%.J""2J3K+K%7]+A%.J""2J3K+1%7]+\'%4\'6¤\' %$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!.¥""2¥3¦+3$0§""1!3¨+#%\'"%$"# X"# X*  "!.©""2©3ª+=$0«""1!3¬+-%7!+#%\'#%$## X$"# X"# X*o "!.­""2­3®+7$7!+-%7!+#%\'#%$## X$"# X"# X*D "!0¯""1!3°+-$7!+#%\'"%$"# X"# X*# "7!'),a('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6±!! %'),a(' \\!.2""2233+-$7`+#%\'"%$"# X"# X,>&!.2""2233+-$7`+#%\'"%$"# X"# X"'),a('7a*A "7b*; "7c*5 "7d*/ "7e*) "7f*# "7g'),a('!/²""1*3³+b$/´""1#3µ*G "/¶""1#3·*; "/¸""1$3¹*/ "/º""1#3»*# "76+(%4"6¼"! %$"# X"# X'),a('!/½""1%3¾+J$/¿""1%3À*/ "/Á""1"3Â*# "76+(%4"6Ã"! %$"# X"# X'),a('!/Ä""1\'3Å+2$7+(%4"6Æ"! %$"# X"# X'),a('!/Ç""1$3È+2$7ï+(%4"6É"! %$"# X"# X'),a('!/Ê""1&3Ë+2$7T+(%4"6Ì"! %$"# X"# X'),a('!/Í""1"3Î+R$!.>""2>3?+-$76+#%\'"%$"# X"# X*# " [+\'%4"6Ï" %$"# X"# X'),a('!7h+T$!.>""2>3?+-$7i+#%\'"%$"# X"# X*# " [+)%4"6Ð""! %$"# X"# X'),a('! \\7j+&$,#&7j""" X+! (%'),a('! \\7j+&$,#&7j""" X+! (%'),a('7k*) "7+*# "7-'),a('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".8""2839*A ".<""2<3=*5 ".@""2@3A*) ".B""2B3C'),a('!.6""2637+u$7m+k% \\!.<""2<3=+-$7m+#%\'"%$"# X"# X,>&!.<""2<3=+-$7m+#%\'"%$"# X"# X"+#%\'#%$## X$"# X"# X'),a('!7n+C$.>""2>3?+3%7o+)%4#6Ñ#"" %$## X$"# X"# X'),a(' \\7p*) "7+*# "7-+2$,/&7p*) "7+*# "7-""" X'),a(' \\7p*) "7+*# "7-,/&7p*) "7+*# "7-"'),a('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".6""2637*A ".8""2839*5 ".@""2@3A*) ".B""2B3C'),a('7*# "7r'),a("!7+K$7'+A%7s+7%7'+-%7+#%'%%$%# X$$# X$## X$\"# X\"# X"),a('7M*# "7t'),a('!7+G$.8""2839+7%7u*# "7x+\'%4#6Ò# %$## X$"# X"# X'),a('!7v*# "7w+N$!.6""2637+-$7+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!.Ó""2Ó3Ô+=$7+3%7w*# " [+#%\'#%$## X$"# X"# X'),a('!.4""2435+-$7{+#%\'"%$"# X"# X'),a('!7z+5$ \\7y,#&7y"+#%\'"%$"# X"# X'),a('7**) "7+*# "7-'),a('7+* "7-* ".2""2233*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7|+k$ \\!.4""2435+-$7|+#%\'"%$"# X"# X,>&!.4""2435+-$7|+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! \\7~,#&7~"+k$ \\!.2""2233+-$7}+#%\'"%$"# X"# X,>&!.2""2233+-$7}+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a(' \\7~,#&7~"'),a('7+*w "7-*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7"+$ \\7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K,M&7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K"+\'%4"6Õ" %$"# X"# X'),a('7*# "7'),a('!!7O+3$.:""2:3;+#%\'"%$"# X"# X*# " [+-$7S+#%\'"%$"# X"# X*# " ['),a(' \\7+* "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A+$,&7+* "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A""" X'),a(' \\7y,#&7y"'),a('!/""1#3Ö+y$.4""2435+i% \\7!+&$,#&7!""" X+P%.J""2J3K+@% \\7!+&$,#&7!""" X+\'%4%6×% %$%# X$$# X$## X$"# X"# X'),a('.Ø""2Ø3Ù'),a('.Ú""2Ú3Û'),a('.Ü""2Ü3Ý'),a('.Þ""2Þ3ß'),a('.à""2à3á'),a('.â""2â3ã'),a('.ä""2ä3å'),a('.æ""2æ3ç'),a('.è""2è3é'),a('.ê""2ê3ë'),a('!7*S "7*M "7*G "7*A "7*; "7*5 "7*/ "7*) "7*# "76+& 4!6ì! %'),a("!7+K$7'+A%7+7%7'+-%7+#%'%%$%# X$$# X$## X$\"# X\"# X"),a("!7+' 4!6í!! %"),a('!7!+7$7!+-%7!+#%\'#%$## X$"# X"# X'),a('! \\7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7(,G&7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7("+& 4!6î! %'),a('!7µ+_$ \\!7A+-$7µ+#%\'"%$"# X"# X,8&!7A+-$7µ+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!79+R$!.:""2:3;+-$79+#%\'"%$"# X"# X*# " [+\'%4"6ï" %$"# X"# X'),a('!7:*j "!7+_$ \\!7A+-$7+#%\'"%$"# X"# X,8&!7A+-$7+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+& 4!6ð! %'),a('!7L*# "7+c$ \\!7B+-$7+#%\'"%$"# X"# X,8&!7B+-$7+#%\'"%$"# X"# X"+\'%4"6ñ" %$"# X"# X'),a('!7*# " [+A$7@+7%7M+-%7?+#%\'$%$$# X$## X$"# X"# X'),a('!!76+_$ \\!7.+-$76+#%\'"%$"# X"# X,8&!7.+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X*# "7H+\' 4!6ò!! %'),a('7*) "7*# "7'),a('!/ó""1!3ô+<$7<+2%7+(%4#6õ#! %$## X$"# X"# X'),a('!/ö""1\'3÷+<$7<+2%7+(%4#6ø#! %$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6ù!! %'),a('!.ú""2ú3û+x$!.J""2J3K+S$7!*# " [+C%7!*# " [+3%7!*# " [+#%\'$%$$# X$## X$"# X"# X*# " [+\'%4"6ü" %$"# X"# X'),a('!76+N$!7<+-$7 +#%\'"%$"# X"# X*# " [+)%4"6ý""! %$"# X"# X'),a('76*) "7T*# "7H'),a('!7¢+_$ \\!7B+-$7£+#%\'"%$"# X"# X,8&!7B+-$7£+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/þ""1&3ÿ*G "/Ā""1\'3ā*; "/Ă""1$3ă*/ "/Ą""1%3ą*# "76+& 4!6Ć! %'),a('7¤*# "7'),a('!/ć""1(3Ĉ+O$7<+E%/ĉ""1(3Ċ*/ "/ċ""1(3Č*# "76+#%\'#%$## X$"# X"# X'),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6č!! %'),a("!7¨+& 4!6Ď! %"),a('!7©+s$7;+i%7®+_% \\!7B+-$7¯+#%\'"%$"# X"# X,8&!7B+-$7¯+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7ª*# "7«'),a('/ď""1$3Đ*S "/đ""1%3Ē*G "/ē""1%3Ĕ*; "/ĕ""1%3Ė*/ "/ė""1+3Ę*# "7¬'),a('/ę""1\'3Ě*/ "/ě""1)3Ĝ*# "7¬'),a('76*# "7­'),a('!/ĝ""1"3Ğ+-$76+#%\'"%$"# X"# X'),a('7¬*# "76'),a('!76+7$7<+-%7°+#%\'#%$## X$"# X"# X'),a('76*# "7H'),a('!7²+7$7.+-%7+#%\'#%$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6ğ!! %'),a("!7+' 4!6Ġ!! %"),a('!7µ+d$ \\!7B+-$7+#%\'"%$"# X"# X,8&!7B+-$7+#%\'"%$"# X"# X"+(%4"6ġ"!!%$"# X"# X'),a('!!77+k$ \\!.J""2J3K+-$77+#%\'"%$"# X"# X,>&!.J""2J3K+-$77+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),a('!7L*# "7+c$ \\!7B+-$7·+#%\'"%$"# X"# X,8&!7B+-$7·+#%\'"%$"# X"# X"+\'%4"6Ģ" %$"# X"# X'),a('7¸*# "7'),a('!/ģ""1#3Ĥ+<$7<+2%76+(%4#6ĥ#! %$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Ħ!! %'),a("!7+' 4!6ħ!! %"),a('! \\7,#&7"+$7@+w%7M+m%7?+c% \\!7B+-$7+#%\'"%$"# X"# X,8&!7B+-$7+#%\'"%$"# X"# X"+\'%4%6Ĩ% %$%# X$$# X$## X$"# X"# X'),a("7½"),a('!/ĩ""1&3Ī+s$7.+i%7À+_% \\!7A+-$7À+#%\'"%$"# X"# X,8&!7A+-$7À+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X*# "7¾'),a('!76+s$7.+i%7¿+_% \\!7A+-$7¿+#%\'"%$"# X"# X,8&!7A+-$7¿+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('!76+=$7<+3%76*# "7H+#%\'#%$## X$"# X"# X'),a('7Á*G "7Ã*A "7Å*; "7Ç*5 "7È*/ "7É*) "7Ê*# "7¿'),a('!/ī""1%3Ĭ+7$7<+-%7Â+#%\'#%$## X$"# X"# X'),a("!7I+' 4!6ĭ!! %"),a('!/Į""1&3į+¥$7<+%7D+%7Ä+% \\! \\7\'+&$,#&7\'""" X+-$7Ä+#%\'"%$"# X"# X,G&! \\7\'+&$,#&7\'""" X+-$7Ä+#%\'"%$"# X"# X"+-%7E+#%\'&%$&# X$%# X$$# X$## X$"# X"# X'),a('7t*# "7w'),a('!/İ""1%3ı+7$7<+-%7Æ+#%\'#%$## X$"# X"# X'),a("!7I+' 4!6Ĳ!! %"),a('!/ĳ""1&3Ĵ+<$7<+2%7I+(%4#6ĵ#! %$## X$"# X"# X'),a('!/Ķ""1%3ķ+_$7<+U%!/ĸ""1$3Ĺ+& 4!6ĺ! %*4 "!/Ļ""1%3ļ+& 4!6Ľ! %+#%\'#%$## X$"# X"# X'),a('!/ľ""1)3Ŀ+T$7<+J%/ŀ""1#3Ł*/ "/ł""1(3Ń*# "76+(%4#6ń#! %$## X$"# X"# X'),a('!/Ņ""1#3ņ+$7<+%7D+%!7Ë+k$ \\!.D""2D3E+-$7Ë+#%\'"%$"# X"# X,>&!.D""2D3E+-$7Ë+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+-%7E+#%\'%%$%# X$$# X$## X$"# X"# X'),a('!/Ň""1(3ň*/ "/ŉ""1$3Ŋ*# "76+\' 4!6ŋ!! %'),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7Î+K$7.+A%7Î+7%7.+-%7+#%\'%%$%# X$$# X$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Ō!! %'),a('!7Ð+c$ \\!7A+-$7Ð+#%\'"%$"# X"# X,8&!7A+-$7Ð+#%\'"%$"# X"# X"+\'%4"6ō" %$"# X"# X'),a('!7+c$ \\!7B+-$7+#%\'"%$"# X"# X,8&!7B+-$7+#%\'"%$"# X"# X"+\'%4"6Ŏ" %$"# X"# X'),a('!7L*T "7*N "!7@*# " [+=$7t+3%7?*# " [+#%\'#%$## X$"# X"# X+c$ \\!7B+-$7+#%\'"%$"# X"# X,8&!7B+-$7+#%\'"%$"# X"# X"+\'%4"6ŏ" %$"# X"# X'),a('!7Ó+c$ \\!7B+-$7Ô+#%\'"%$"# X"# X,8&!7B+-$7Ô+#%\'"%$"# X"# X"+\'%4"6Ő" %$"# X"# X'),a("!7+& 4!6ő! %"),a('!/Œ""1(3œ+<$7<+2%76+(%4#6Ŕ#! %$## X$"# X"# X*j "!/ŕ""1&3Ŗ+<$7<+2%76+(%4#6ŗ#! %$## X$"# X"# X*: "!/Ř""1*3ř+& 4!6Ś! %*# "7'),a('!!76+o$ \\!7A+2$76+(%4"6ś"! %$"# X"# X,=&!7A+2$76+(%4"6ś"! %$"# X"# X"+)%4"6Ŝ""! %$"# X"# X*# " [+\' 4!6ŝ!! %'),a('!7×+_$ \\!7A+-$7×+#%\'"%$"# X"# X,8&!7A+-$7×+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7+_$ \\!7B+-$7+#%\'"%$"# X"# X,8&!7B+-$7+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Ş!! %'),a('!7Ú+_$ \\!7B+-$7Û+#%\'"%$"# X"# X,8&!7B+-$7Û+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/ş""1&3Š*; "/š""1\'3Ţ*/ "/ţ""1*3Ť*# "76+& 4!6ť! %'),a('!/Ŧ""1&3ŧ+<$7<+2%7Ü+(%4#6Ũ#! %$## X$"# X"# X* "!/ö""1\'3÷+<$7<+2%7+(%4#6ũ#! %$## X$"# X"# X*S "!/Ū""1+3ū+<$7<+2%7+(%4#6Ŭ#! %$## X$"# X"# X*# "7'),a('/ŭ""1+3Ů*k "/ů""1)3Ű*_ "/ű""1(3Ų*S "/ų""1\'3Ŵ*G "/ŵ""1&3Ŷ*; "/ŷ""1*3Ÿ*/ "/Ź""1)3ź*# "76'),a('71*# " ['),a('!!76+o$ \\!7A+2$76+(%4"6ś"! %$"# X"# X,=&!7A+2$76+(%4"6ś"! %$"# X"# X"+)%4"6Ŝ""! %$"# X"# X*# " [+\' 4!6Ż!! %'),a('!7L*# "7+c$ \\!7B+-$7à+#%\'"%$"# X"# X,8&!7B+-$7à+#%\'"%$"# X"# X"+\'%4"6ż" %$"# X"# X'),a('7¸*# "7'),a('!7â+_$ \\!7A+-$7â+#%\'"%$"# X"# X,8&!7A+-$7â+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7é+s$7.+i%7ì+_% \\!7B+-$7ã+#%\'"%$"# X"# X,8&!7B+-$7ã+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7ä*; "7å*5 "7æ*/ "7ç*) "7è*# "7'),a('!/Ž""1#3ž+<$7<+2%7ï+(%4#6ſ#! %$## X$"# X"# X'),a('!/ƀ""1%3Ɓ+<$7<+2%7T+(%4#6Ƃ#! %$## X$"# X"# X'),a('!/ƃ""1(3Ƅ+B$7<+8%7\\*# "7Y+(%4#6ƅ#! %$## X$"# X"# X'),a('!/Ɔ""1&3Ƈ+<$7<+2%76+(%4#6ƈ#! %$## X$"# X"# X'),a('!/Ɖ""1%3Ɗ+T$!7<+5$ \\7!,#&7!"+#%\'"%$"# X"# X*# " [+\'%4"6Ƌ" %$"# X"# X'),a('!7ê+K$7;+A%76+7%7;+-%7ë+#%\'%%$%# X$$# X$## X$"# X"# X'),a('!/""1#3Ö*# "76+\' 4!6ƌ!! %'),a('!/´""1#3ƍ*G "/¶""1#3Ǝ*; "/º""1#3Ə*/ "/¸""1$3Ɛ*# "76+\' 4!6Ƒ!! %'),a('!7í+H$!7C+-$7î+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6ƒ! %'),a('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6Ɠ!! %'),a('!!7!+C$7!*# " [+3%7!*# " [+#%\'#%$## X$"# X"# X+\' 4!6Ɣ!! %'),a("7½"),a('!7+d$ \\!7B+-$7ò+#%\'"%$"# X"# X,8&!7B+-$7ò+#%\'"%$"# X"# X"+(%4"6ƕ"!!%$"# X"# X'),a('7ó*# "7'),a('!.Ɩ""2Ɩ3Ɨ+N$7<+D%.Ƙ""2Ƙ3ƙ*) ".ƚ""2ƚ3ƛ+(%4#6Ɯ#! %$## X$"# X"# X'),a('!7+d$ \\!7B+-$7+#%\'"%$"# X"# X,8&!7B+-$7+#%\'"%$"# X"# X"+(%4"6Ɲ"!!%$"# X"# X'),a('!76+7$70+-%7ö+#%\'#%$## X$"# X"# X'),a(' \\72*) "74*# "7.,/&72*) "74*# "7."'),a(' \\7%,#&7%"'),a('!7ù+=$.8""2839+-%7ú+#%\'#%$## X$"# X"# X'),a('!/ƞ""1%3Ɵ*) "/Ơ""1$3ơ+\' 4!6Ƣ!! %'),a('!7û+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7\\*) "7X*# "7+\' 4!6ƣ!! %'),a('! \\7ý*) "7-*# "7þ,/&7ý*) "7-*# "7þ"+! (%'),a('7"*S "7!*M ".F""2F3G*A ".J""2J3K*5 ".H""2H3I*) ".N""2N3O'),a('.L""2L3M* ".B""2B3C* ".<""2<3=*} ".R""2R3S*q ".T""2T3U*e ".V""2V3W*Y ".P""2P3Q*M ".@""2@3A*A ".D""2D3E*5 ".2""2233*) ".>""2>3?'),a('!7Ā+h$.8""2839+X%7ú+N%!.Ƥ""2Ƥ3ƥ+-$7ë+#%\'"%$"# X"# X*# " [+#%\'$%$$# X$## X$"# X"# X'),a('!/Ʀ""1%3Ƨ*) "/ƨ""1$3Ʃ+\' 4!6Ƣ!! %'),a('!7ë+Q$/´""1#3µ*7 "/¶""1#3·*+ " \\7+,#&7+"+\'%4"6ƪ" %$"# X"# X'),a('!7Ą+$.F""2F3G+%7ă+u%.F""2F3G+e%7ă+[%.F""2F3G+K%7ă+A%.F""2F3G+1%7ą+\'%4)6ƫ) %$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!7#+A$7#+7%7#+-%7#+#%\'$%$$# X$## X$"# X"# X'),a('!7ă+-$7ă+#%\'"%$"# X"# X'),a('!7ă+7$7ă+-%7ă+#%\'#%$## X$"# X"# X')],v=0,b=0,y=0,_={line:1,column:1,seenCR:!1},S=0,T=[],E=0;if("startRule"in d){if(!(d.startRule in f))throw new Error("Can't start parsing from rule \""+d.startRule+'".');h=f[d.startRule]}if(d.data={},(l=c(h))!==p&&v===t.length)return l;throw l!==p&&v<t.length&&s({type:"end",description:"end of input"}),o(null,T,S)}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:t}}()},function(e,t,n){"use strict";e.exports=function(e){e=e;var t={AllBrowsers:{maskDtls:function(e){return e&&(e=e.replace(/ UDP\/TLS\/RTP\/SAVP/gim," RTP/SAVP")),e},unmaskDtls:function(e){return e.replace(/ RTP\/SAVP/gim," UDP/TLS/RTP/SAVP")}},Firefox:{isFirefox:function(){return"undefined"!=typeof mozRTCPeerConnection},cannotHandleExtraWhitespace:function(e){return this.isFirefox()&&e&&(e=e.replace(/ \r\n/g,"\r\n")),e},hasMissingCLineInSDP:function(e){var t,n;if(e.indexOf("c=")>e.indexOf("m=")){n=e.match(/m=.*\r\n.*/g);for(var r=0;r<n.length;r++)n[r].toString().search(/i=.*/)>=0?(t=e.indexOf(n[r].toString())+n[r].toString().length,"c="!==e.substr(t,2)&&(e=e.substr(0,t)+"\r\nc=IN IP4 0.0.0.0"+e.substr(t))):n[r].toString().search(/c=.*/)<0&&(t=e.indexOf(n[r].toString().match(/.*/))+n[r].toString().match(/.*/).toString().length,e=e.substr(0,t)+"\r\nc=IN IP4 0.0.0.0"+e.substr(t))}return e}},Chrome:{needsExplicitlyInactiveSDP:function(e){var n,r;return t.Firefox.isFirefox()&&-1!==(r=e.indexOf("m=video 0"))?(n=e.substr(r),n=n.replace(/\r\nc=IN IP4.*\r\n$/,"\r\nc=IN IP4 0.0.0.0\r\na=inactive\r\n"),e.substr(0,r)+n):e},getsConfusedAboutGUM:function(e){e.mediaHandler&&e.mediaHandler.close()}}};return t}},function(e,t,n){"use strict";var r={error:0,warn:1,log:2,debug:3};e.exports=function(e){function t(e,t,n){this.logger=e,this.category=t,this.label=n}var n=function(){var e,t=2,n=!0,i=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return n},set:function(t){"boolean"==typeof t?n=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(n){n>=0&&n<=3?t=n:n>3?t=3:r.hasOwnProperty(n)?t=r[n]:e.error('invalid "level" parameter value: '+JSON.stringify(n))}},connector:{get:function(){return i},set:function(t){null===t||""===t||void 0===t?i=null:"function"==typeof t?i=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};return n.prototype.print=function(t,n,r,i){if("string"==typeof i){var s=[new Date,n];r&&s.push(r),i=s.concat(i).join(" | ")}t.call(e,i)},Object.keys(r).forEach(function(i){t.prototype[i]=function(e){this.logger[i](this.category,this.label,e)},n.prototype[i]=function(t,n,s){this.level>=r[i]&&(this.builtinEnabled&&this.print(e[i],t,n,s),this.connector&&this.connector(i,t,n,s))}}),n.prototype.getLogger=function(e,n){var r;return n&&3===this.level?new t(this,e,n):this.loggers[e]?this.loggers[e]:(r=new t(this,e),this.loggers[e]=r,r)},n}},function(e,t,n){"use strict";e.exports=function(e){var t=function(e,t){e=e,t=t};return t.prototype=Object.create(e.prototype,{isReady:{value:function(){}},close:{value:function(){}},getDescription:{value:function(e){e=e}},hasDescription:{value:function(e){e=e}},setDescription:{value:function(e){e=e}}}),t}},function(e,t,n){"use strict";e.exports=function(e){var t;t=function(t,n,r){var i;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=t,this.parameters={};for(i in r)this.setParam(i,r[i]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return n},set:function(e){n=0===e?"0":e}}})},t.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">";for(t in this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return t=e.Grammar.parse(t,"Name_Addr_Header"),-1!==t?t:void 0},e.NameAddrHeader=t}},function(e,t,n){"use strict";e.exports=function(e){function t(e,t){var n=t,r=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(i=e.indexOf("\r\n",n)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:r=i}return r}function n(t,n,r,i){var s,o,a,c,u=n.indexOf(":",r),l=n.substring(r,u).trim(),d=n.substring(u+1,i).trim();switch(l.toLowerCase()){case"via":case"v":t.addHeader("via",d),1===t.getHeaders("via").length?(c=t.parseHeader("Via"))&&(t.via=c,t.via_branch=c.branch):c=0;break;case"from":case"f":t.setHeader("from",d),c=t.parseHeader("from"),c&&(t.from=c,t.from_tag=c.getParam("tag"));break;case"to":case"t":t.setHeader("to",d),c=t.parseHeader("to"),c&&(t.to=c,t.to_tag=c.getParam("tag"));break;case"record-route":if(-1===(c=e.Grammar.parse(d,"Record_Route"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)s=c[o],t.addHeader("record-route",d.substring(s.position,s.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=s.parsed;break;case"call-id":case"i":t.setHeader("call-id",d),c=t.parseHeader("call-id"),c&&(t.call_id=d);break;case"contact":case"m":if(-1===(c=e.Grammar.parse(d,"Contact"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)s=c[o],t.addHeader("contact",d.substring(s.position,s.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=s.parsed;break;case"content-length":case"l":t.setHeader("content-length",d),c=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",d),c=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",d),c=t.parseHeader("cseq"),c&&(t.cseq=c.value),t instanceof e.IncomingResponse&&(t.method=c.method);break;case"max-forwards":t.setHeader("max-forwards",d),c=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",d),c=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",d),c=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",d),c=t.parseHeader("refer-to"),c&&(t.refer_to=c);break;default:t.setHeader(l,d),c=0}return void 0!==c||{error:'error parsing header "'+l+'"'}}var r;r={},r.parseMessage=function(r,i){var s,o,a,c,u,l=0,d=r.indexOf("\r\n"),p=i.getLogger("sip.parser");if(-1===d)return void p.warn("no CRLF found, not a SIP message, discarded");if(o=r.substring(0,d),-1===(u=e.Grammar.parse(o,"Request_Response")))return void p.warn('error parsing first line of SIP message: "'+o+'"');for(u.status_code?(s=new e.IncomingResponse(i),s.status_code=u.status_code,s.reason_phrase=u.reason_phrase):(s=new e.IncomingRequest(i),s.method=u.method,s.ruri=u.uri),s.data=r,l=d+2;;){if(-2===(d=t(r,l))){c=l+2;break}if(-1===d)return void p.error("malformed message");if(!0!==(u=n(s,r,l,d)))return void p.error(u.error);l=d+2}return s.hasHeader("content-length")?(a=s.getHeader("content-length"),s.body=r.substr(c,a)):s.body=r.substring(c),s},e.Parser=r}},function(e,t,n){"use strict";e.exports=function(e){var t;t=function(t){var n={};this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"',this.call_id=e.Utils.createRandomToken(22),this.cseq=80,this.to_uri=t.configuration.uri,n.to_uri=this.to_uri,n.to_displayName=t.configuration.displayName,n.call_id=this.call_id,n.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:n}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext")},t.prototype={register:function(t){var n,r=this;this.options=t||{},n=(this.options.extraHeaders||[]).slice(),n.push("Contact: "+this.contact+";expires="+this.expires),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var n,i,s,o=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(i=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!o){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;o--;){if(n=t.parseHeader("contact",o),n.uri.user===this.ua.contact.uri.user){i=n.getParam("expires");break}n=null}if(!n){this.logger.warn("no Contact header pointing to us, response ignored");break}i||(i=this.expires),this.registrationTimer=e.Timers.setTimeout(function(){r.registrationTimer=null,r.register(r.options)},1e3*i-3e3),this.registrationExpiredTimer=e.Timers.setTimeout(function(){r.logger.warn("registration expired"),r.registered&&r.unregistered(null,e.C.causes.EXPIRES)},1e3*i),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(n.getParam("temp-gruu").replace(/"/g,""))),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(n.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:s=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,s)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()},registrationFailure:function(e,t){this.emit("failed",e||null,t||null)},onTransportClosed:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)},onTransportConnected:function(){this.register(this.options)},close:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.unregister(e)},unregister:function(t){var n;if(t=t||{},!this.registered&&!t.all)return void this.logger.warn("already unregistered");n=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(n.push("Contact: *"),n.push("Expires: 0")):n.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:n=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,n)}},this.onRequestTimeout=function(){},this.onTransportError=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()},unregistered:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}},e.RegisterContext=t}},function(e,t,n){"use strict";e.exports=function(e){var t;t=function(t,n){this.logger=n.getLogger("sip.requestsender"),this.ua=n,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,n.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()},t.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n,r,i,s=t.status_code;if(401===s||407===s){if(401===t.status_code?(r=t.parseHeader("www-authenticate"),i="authorization"):(r=t.parseHeader("proxy-authenticate"),i="proxy-authorization"),!r)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===r.stale){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,r))return void this.applicant.receiveResponse(t);this.challenged=!0,r.stale&&(this.staled=!0),t.method===e.C.REGISTER?n=this.applicant.cseq+=1:this.request.dialog?n=this.request.dialog.local_seqnum+=1:(n=this.request.cseq+1,this.request.cseq=n),this.request.setHeader("cseq",n+" "+this.method),this.request.setHeader(i,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},function(e,t,n){"use strict";e.exports=function(e){var t=n(226),r=Object.defineProperties({},{version:{get:function(){return t.version}},name:{get:function(){return t.title}}});return n(255)(r,e),r.LoggerFactory=n(237)(e.console),r.EventEmitter=n(232)(e.console),r.C=n(228)(r.name,r.version),r.Exceptions=n(233),r.Timers=n(250)(e.timers),r.Transport=e.Transport(r,e.WebSocket),n(240)(r),n(244)(r),n(254)(r),n(239)(r),n(251)(r),n(230)(r),n(242)(r),n(241)(r),r.MediaHandler=n(238)(r.EventEmitter),n(227)(r),n(246)(r),n(247)(r,e),n(249)(r),r.WebRTC=n(256)(r,e),n(253)(r,e),r.Hacks=n(236)(r),n(245)(r),r.DigestAuthentication=n(231)(r.Utils),r.Grammar=n(234)(r),r}},function(e,t,n){"use strict";e.exports=function(e){function t(t){var n=t.ua.configuration.hackAllowUnregisteredOptionTags,r=[],i={};return t.method===e.C.REGISTER?r.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&r.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&r.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&r.push("replaces"),r.push("outbound"),r=r.concat(t.ua.configuration.extraSupported),r=r.filter(function(t){var r=e.C.OPTION_TAGS[t],s=!i[t];return i[t]=!0,(r||n)&&s}),"Supported: "+r.join(", ")+"\r\n"}var n,r,i,s;n=function(t,n,r,i,s,o){var a,c,u,l,d,p;if(i=i||{},!t||!n||!r)return null;this.logger=r.getLogger("sip.sipmessage"),this.ua=r,this.headers={},this.method=t,this.ruri=n,this.body=o,this.extraHeaders=(s||[]).slice(),this.statusCode=i.status_code,this.reasonPhrase=i.reason_phrase,i.route_set?this.setHeader("route",i.route_set):r.configuration.usePreloadedRoute&&this.setHeader("route",r.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),d=i.to_uri||n,a=i.to_displayName||0===i.to_displayName?'"'+i.to_displayName+'" ':"",a+="<"+(d&&d.toRaw?d.toRaw():d)+">",a+=i.to_tag?";tag="+i.to_tag:"",this.to=new e.NameAddrHeader.parse(a),this.setHeader("to",a),p=i.from_uri||r.configuration.uri,c=i.from_displayName||0===i.from_displayName?'"'+i.from_displayName+'" ':r.configuration.displayName?'"'+r.configuration.displayName+'" ':"",c+="<"+(p&&p.toRaw?p.toRaw():p)+">;tag=",c+=i.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(c),this.setHeader("from",c),u=i.call_id||r.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=u,this.setHeader("call-id",u),l=i.cseq||Math.floor(1e4*Math.random()),this.cseq=l,this.setHeader("cseq",l+" "+t)},n.prototype={setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){var n,r,i=this.extraHeaders.length,s=this.headers[e.Utils.headerize(t)];if(s){if(s[0])return s[0]}else for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<i;r++)if(s=this.extraHeaders[r],n.test(s))return s.substring(s.indexOf(":")+1).trim()},getHeaders:function(t){var n,r,i,s=this.headers[e.Utils.headerize(t)],o=[];if(s){for(r=s.length,n=0;n<r;n++)o.push(s[n]);return o}for(r=this.extraHeaders.length,i=new RegExp("^\\s*"+t+"\\s*:","i"),n=0;n<r;n++)s=this.extraHeaders[n],i.test(s)&&o.push(s.substring(s.indexOf(":")+1).trim());return o},hasHeader:function(t){var n,r,i=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<i;r++)if(n.test(this.extraHeaders[r]))return!0;return!1},toString:function(){var n,r,i,s="";s+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n";for(n in this.headers)for(r=this.headers[n].length,i=0;i<r;i++)s+=n+": "+this.headers[n][i]+"\r\n";for(r=this.extraHeaders.length,i=0;i<r;i++)s+=this.extraHeaders[i].trim()+"\r\n";return s+=t(this),s+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(r=e.Utils.str_utf8_length(this.body),s+="Content-Length: "+r+"\r\n\r\n",s+=this.body):this.body.body&&this.body.contentType?(r=e.Utils.str_utf8_length(this.body.body),s+="Content-Type: "+this.body.contentType+"\r\n",s+="Content-Length: "+r+"\r\n\r\n",s+=this.body.body):s+="Content-Length: 0\r\n\r\n":s+="Content-Length: 0\r\n\r\n",s}},r=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null},r.prototype={addHeader:function(t,n){var r={raw:n};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(r):this.headers[t]=[r]},getHeader:function(t){var n=this.headers[e.Utils.headerize(t)];if(n)return n[0]?n[0].raw:void 0},getHeaders:function(t){var n,r,i=this.headers[e.Utils.headerize(t)],s=[];if(!i)return[];for(r=i.length,n=0;n<r;n++)s.push(i[n].raw);return s},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,n){var r,i,s;return t=e.Utils.headerize(t),n=n||0,this.headers[t]?n>=this.headers[t].length?void this.logger.log('not so many "'+t+'" headers present'):(r=this.headers[t][n],i=r.raw,r.parsed?r.parsed:(s=e.Grammar.parse(i,t.replace(/-/g,"_")),-1===s?(this.headers[t].splice(n,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+i+'"')):(r.parsed=s,s))):void this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,n){var r={raw:n};this.headers[e.Utils.headerize(t)]=[r]},toString:function(){return this.data}},i=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null},i.prototype=new r,i.prototype.reply=function(n,r,i,s,o,a){var c,u,l,d,p,f=this.getHeader("To"),h=0,m=0;if(p=e.Utils.buildStatusLine(n,r),i=(i||[]).slice(),this.method===e.C.INVITE&&n>100&&n<=200)for(c=this.getHeaders("record-route"),l=c.length,h;h<l;h++)p+="Record-Route: "+c[h]+"\r\n";for(u=this.getHeaders("via"),l=u.length,m;m<l;m++)p+="Via: "+u[m]+"\r\n";for(!this.to_tag&&n>100?f+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(f+=";tag="+this.to_tag),p+="To: "+f+"\r\n",p+="From: "+this.getHeader("From")+"\r\n",p+="Call-ID: "+this.call_id+"\r\n",p+="CSeq: "+this.cseq+" "+this.method+"\r\n",l=i.length,d=0;d<l;d++)p+=i[d].trim()+"\r\n";return p+=t(this),p+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",s?"string"==typeof s?(l=e.Utils.str_utf8_length(s),p+="Content-Type: application/sdp\r\n",p+="Content-Length: "+l+"\r\n\r\n",p+=s):s.body&&s.contentType?(l=e.Utils.str_utf8_length(s.body),p+="Content-Type: "+s.contentType+"\r\n",p+="Content-Length: "+l+"\r\n\r\n",p+=s.body):p+="Content-Length: 0\r\n\r\n":p+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(n,p).then(o,a),p},i.prototype.reply_sl=function(t,n){var r,i,s=0,o=this.getHeaders("via"),a=o.length;for(i=e.Utils.buildStatusLine(t,n),s;s<a;s++)i+="Via: "+o[s]+"\r\n";r=this.getHeader("To"),!this.to_tag&&t>100?r+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.to_tag),i+="To: "+r+"\r\n",i+="From: "+this.getHeader("From")+"\r\n",i+="Call-ID: "+this.call_id+"\r\n",i+="CSeq: "+this.cseq+" "+this.method+"\r\n",i+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",i+="Content-Length: 0\r\n\r\n",this.transport.send(i)},s=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null},s.prototype=new r,e.OutgoingRequest=n,e.IncomingRequest=i,e.IncomingResponse=s}},function(e,t,n){"use strict";e.exports=function(e){function t(t){var n,r=e.Utils.buildStatusLine(t),i=p.getHeaders("via"),s=i.length,o=0;for(o;o<s;o++)r+="Via: "+i[o]+"\r\n";n=p.getHeader("To"),p.to_tag||(n+=";tag="+e.Utils.newTag()),r+="To: "+n+"\r\n",r+="From: "+p.getHeader("From")+"\r\n",r+="Call-ID: "+p.call_id+"\r\n",r+="CSeq: "+p.cseq+" "+p.method+"\r\n",r+="\r\n",h.send(r)}function n(){if(!p.ruri||"sip"!==p.ruri.scheme)return t(416),!1}function r(){if(!p.to_tag&&p.call_id.substr(0,5)===f.configuration.sipjsId)return t(482),!1}function i(){if(e.Utils.str_utf8_length(p.body)<p.getHeader("content-length"))return t(400),!1}function s(){var n,r,i=p.from_tag,s=p.call_id,o=p.cseq;if(!p.to_tag)if(p.method===e.C.INVITE){if(n=f.transactions.ist[p.via_branch])return;for(r in f.transactions.ist)if(n=f.transactions.ist[r],n.request.from_tag===i&&n.request.call_id===s&&n.request.cseq===o)return t(482),!1}else{if(n=f.transactions.nist[p.via_branch])return;for(r in f.transactions.nist)if(n=f.transactions.nist[r],n.request.from_tag===i&&n.request.call_id===s&&n.request.cseq===o)return t(482),!1}}function o(){if(p.getHeaders("via").length>1)return d.warn("More than one Via header field present in the response. Dropping the response"),!1}function a(){var e=f.configuration.viaHost;if(p.via.host!==e||void 0!==p.via.port)return d.warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1}function c(){if(e.Utils.str_utf8_length(p.body)<p.getHeader("content-length"))return d.warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1}function u(){for(var e=["from","to","call_id","cseq","via"],t=e.length;t--;)if(!p.hasHeader(e[t]))return d.warn("Missing mandatory header field : "+e[t]+". Dropping the response"),!1}var l,d,p,f,h,m=[],g=[],v=[];m.push(n),m.push(r),m.push(i),m.push(s),g.push(o),g.push(a),g.push(c),v.push(u),l=function(t,n,r){var i;for(p=t,f=n,h=r,d=f.getLogger("sip.sanitycheck"),i=v.length;i--;)if(!1===v[i](p))return!1;if(p instanceof e.IncomingRequest){for(i=m.length;i--;)if(!1===m[i](p))return!1}else if(p instanceof e.IncomingResponse)for(i=g.length;i--;)if(!1===g[i](p))return!1;return!0},e.sanityCheck=l}},function(e,t,n){"use strict";e.exports=function(e){var t;t=function(t,n){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=n,n.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(n,t):this.transaction=new e.Transactions.NonInviteServerTransaction(n,t),n.body&&(this.body=n.body),n.hasHeader("Content-Type")&&(this.contentType=n.getHeader("Content-Type")),this.method=n.method,this.data={},this.localIdentity=n.to,this.remoteIdentity=n.from},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.progress=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){t=t||{};var n,r=t.statusCode||100,i=t.minCode||100,s=t.maxCode||699,o=e.Utils.getReasonPhrase(r,t.reasonPhrase),a=t.extraHeaders||[],c=t.body,u=t.events||[];if(r<i||r>s)throw new TypeError("Invalid statusCode: "+r);return n=this.request.reply(r,o,a,c),u.forEach(function(e){this.emit(e,n,o)},this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},function(e,t,n){"use strict";e.exports=function(e,t){var r,i,s,o=n(248)(e),a={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};r=function(t){this.status=a.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.mediaHandlerFactory=t||e.WebRTC.MediaHandler.defaultFactory,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.remote_hold=!1,this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(e){var t=0,n=this.actions.length;for(t;t<n;t++)if(this.actions[t].name===e)return!0;return!1},shift:function(){return this.actions.shift()},push:function(e){this.actions.push({name:e})},pop:function(e){var t=0,n=this.actions.length;for(t;t<n;t++)this.actions[t].name===e&&(this.actions.splice(t,1),n--,t--)}},this.early_sdp=null,this.rel100=e.C.supported.UNSUPPORTED},r.prototype={dtmf:function(t,n){var r=[],i=this;if(n=n||{},void 0===t)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("string"!=typeof t&&"number"!=typeof t||!t.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);for(t=t.toString().split("");t.length>0;)r.push(new o(this,t.shift(),n));if(this.tones)return this.tones=this.tones.concat(r),this;var s=function(){var t,r;if(i.status===a.STATUS_TERMINATED||!i.tones||0===i.tones.length)return i.tones=null,this;t=i.tones.shift(),t.on("failed",function(){i.tones=null}),t.send(n),r=t.duration+t.interToneGap,e.Timers.setTimeout(s,r)};return this.tones=r,s(),this},bye:function(t){t=Object.create(t||Object.prototype);var n=t.statusCode;if(this.status===a.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),n&&(n<200||n>=700))throw new TypeError("Invalid statusCode: "+n);return t.receiveResponse=function(){},this.sendRequest(e.C.BYE,t).terminated()},refer:function(t,n){n=n||{};var r=(n.extraHeaders||[]).slice(),i=t instanceof e.InviteServerContext||t instanceof e.InviteClientContext,s=t;if(void 0===t)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(i)t='"'+t.remoteIdentity.friendlyName+'" <'+t.dialog.remote_target.toString()+"?Replaces="+t.dialog.id.call_id+"%3Bto-tag%3D"+t.dialog.id.remote_tag+"%3Bfrom-tag%3D"+t.dialog.id.local_tag+">";else{try{t=e.Grammar.parse(t,"Refer_To").uri||t}catch(e){this.logger.debug(".refer() cannot parse Refer_To from",t),this.logger.debug("...falling through to normalizeTarget()")}if(!(t=this.ua.normalizeTarget(t)))throw new TypeError("Invalid target: "+s)}return r.push("Contact: "+this.contact),r.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),r.push("Refer-To: "+t),this.sendRequest(e.C.REFER,{extraHeaders:r,body:n.body,receiveResponse:function(e){/^2[0-9]{2}$/.test(e.status_code)&&(i||t.scheme&&t.scheme.match("^sips?$"))&&this.terminate()}.bind(this)}),this},followRefer:function(n){return function(n,r){var i=r.parseHeader("refer-to"),s=i.uri;if(!s.scheme.match("^sips?$")){var o=s.toString();return void("function"==typeof t.open?t.open(o):this.logger.warn("referred to non-SIP URI but `open` isn't in the environment: "+o))}var a=[],c=s.getHeader("Replaces");void 0!==c&&a.push("Replaces: "+decodeURIComponent(c)),s.clearHeaders();var u=this.mediaHandler.getReferMedia,l=u?u.call(this.mediaHandler):this.mediaHint;e.Hacks.Chrome.getsConfusedAboutGUM(this);var d=this.ua.invite(s,{media:l,params:{to_displayName:i.friendlyName},extraHeaders:a});n.call(this,r,d),this.terminate()}.bind(this,n)},sendRequest:function(t,n){n=n||{};var r=this,i=new e.OutgoingRequest(t,this.dialog.remote_target,this.ua,{cseq:n.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:n.statusCode,reasonPhrase:n.reasonPhrase},n.extraHeaders||[],n.body);return new e.RequestSender({request:i,onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},receiveResponse:n.receiveResponse||function(e){r.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(t.toLowerCase(),i),this},close:function(){var t;if(this.status===a.STATUS_TERMINATED)return this;this.logger.log("closing INVITE session "+this.id),this.mediaHandler&&this.mediaHandler.close();for(t in this.timers)e.Timers.clearTimeout(this.timers[t]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(t in this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];return this.status=a.STATUS_TERMINATED,delete this.ua.sessions[this.id],this},createDialog:function(t,n,r){var i,s,o=t["UAS"===n?"to_tag":"from_tag"],a=t["UAS"===n?"from_tag":"to_tag"],c=t.call_id+o+a;if(s=this.earlyDialogs[c],r)return!!s||(s=new e.Dialog(this,t,n,e.Dialog.C.STATUS_EARLY),s.error?(this.logger.error(s.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[c]=s,!0));if(s){s.update(t,n),this.dialog=s,delete this.earlyDialogs[c];for(var u in this.earlyDialogs)this.earlyDialogs[u].terminate(),delete this.earlyDialogs[u];return!0}return i=new e.Dialog(this,t,n),i.error?(this.logger.error(i.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=i,!0)},isReadyToReinvite:function(){return this.mediaHandler.isReady()&&!this.dialog.uac_pending_reply&&!this.dialog.uas_pending_reply},mute:function(e){var t=this.mediaHandler.mute(e);t&&this.onmute(t)},unmute:function(e){var t=this.mediaHandler.unmute(e);t&&this.onunmute(t)},hold:function(){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(this.mediaHandler.hold(),!this.isReadyToReinvite())return void(this.pending_actions.isPending("unhold")?this.pending_actions.pop("unhold"):this.pending_actions.isPending("hold")||this.pending_actions.push("hold"));!0!==this.local_hold&&(this.onhold("local"),this.sendReinvite())},unhold:function(t){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(this.mediaHandler.unhold(),!this.isReadyToReinvite())return void(this.pending_actions.isPending("hold")?this.pending_actions.pop("hold"):this.pending_actions.isPending("unhold")||this.pending_actions.push("unhold"));!1!==this.local_hold&&(this.onunhold("local"),this.sendReinvite(t))},isOnHold:function(){return{local:this.local_hold,remote:this.remote_hold}},receiveReinvite:function(t){var n=this;if(!this.mediaHandler.hasDescription(t))return this.logger.warn("invalid Content-Type"),void t.reply(415);this.mediaHandler.setDescription(t).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(e){var r=["Contact: "+n.contact];t.reply(200,null,r,e,function(){n.status=a.STATUS_WAITING_FOR_ACK,n.setInvite2xxTimer(t,e),n.setACKTimer(),n.remote_hold&&!n.mediaHandler.remote_hold?n.onunhold("remote"):!n.remote_hold&&n.mediaHandler.remote_hold&&n.onhold("remote")})}).catch(function(r){var i;r instanceof e.Exceptions.GetDescriptionError?i=500:(n.logger.error(r),i=488),t.reply(i)})},sendReinvite:function(t){t=t||{};var n,r=this,i=(t.extraHeaders||[]).slice(),s=t.eventHandlers||{};s.succeeded&&(n=s.succeeded),this.reinviteSucceeded=function(){e.Timers.clearTimeout(r.timers.ackTimer),e.Timers.clearTimeout(r.timers.invite2xxTimer),r.status=a.STATUS_CONFIRMED,n&&n.apply(this,arguments)},this.reinviteFailed=s.failed?s.failed:function(){},i.push("Contact: "+this.contact),i.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=this.receiveReinviteResponse,this.mediaHandler.getDescription(r.mediaHint).then(function(t){r.dialog.sendRequest(r,e.C.INVITE,{extraHeaders:i,body:t})},function(){r.isReadyToReinvite()&&r.onReadyToReinvite(),r.reinviteFailed()})},receiveRequest:function(t){switch(t.method){case e.C.BYE:t.reply(200),this.status===a.STATUS_CONFIRMED&&(this.emit("bye",t),this.terminated(t,e.C.causes.BYE));break;case e.C.INVITE:this.status===a.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:if(this.status===a.STATUS_CONFIRMED||this.status===a.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(t);var n,r,i,s=t.getHeader("content-type"),c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,u=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;s&&(s.match(/^application\/dtmf-relay/i)?(t.body&&(n=t.body.split("\r\n",2),2===n.length&&(c.test(n[0])&&(r=n[0].replace(c,"$2")),u.test(n[1])&&(i=parseInt(n[1].replace(u,"$2"),10)))),new o(this,r,{duration:i}).init_incoming(t)):t.reply(415,null,["Accept: application/dtmf-relay"]))}break;case e.C.REFER:if(this.status===a.STATUS_CONFIRMED){this.logger.log("REFER received");var l,d=this.listeners("refer").length;d?(t.reply(202,"Accepted"),l="SIP/2.0 100 Trying",this.sendRequest(e.C.NOTIFY,{extraHeaders:["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],body:l,receiveResponse:function(){}}),this.emit("refer",t)):t.reply(603,"Declined")}break;case e.C.NOTIFY:t.reply(200,"OK"),this.emit("notify",t)}},receiveReinviteResponse:function(t){var n=this;if(this.status!==a.STATUS_TERMINATED)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=a.STATUS_CONFIRMED,this.sendRequest(e.C.ACK,{cseq:t.cseq}),!this.mediaHandler.hasDescription(t)){this.reinviteFailed();break}this.mediaHandler.setDescription(t).then(function(){n.reinviteSucceeded()},function(){n.reinviteFailed()});break;default:this.reinviteFailed()}},acceptAndTerminate:function(t,n,r){var i=[];return n&&i.push("Reason: "+e.Utils.getReasonHeaderValue(n,r)),(this.dialog||this.createDialog(t,"UAC"))&&(this.sendRequest(e.C.ACK,{cseq:t.cseq}),this.sendRequest(e.C.BYE,{extraHeaders:i})),this},setInvite2xxTimer:function(t,n){var r=this,i=e.Timers.T1;this.timers.invite2xxTimer=e.Timers.setTimeout(function s(){if(r.status===a.STATUS_WAITING_FOR_ACK){r.logger.log("no ACK received, attempting to retransmit OK");var o=["Contact: "+r.contact];t.reply(200,null,o,n),i=Math.min(2*i,e.Timers.T2),r.timers.invite2xxTimer=e.Timers.setTimeout(s,i)}},i)},setACKTimer:function(){var t=this;this.timers.ackTimer=e.Timers.setTimeout(function(){t.status===a.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received for an extended period of time, terminating the call"),e.Timers.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.terminated(null,e.C.causes.NO_ACK))},e.Timers.TIMER_H)},onReadyToReinvite:function(){var e=this.pending_actions.shift();e&&this[e.name]&&this[e.name]()},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))},onDialogError:function(t){this.status===a.STATUS_CONFIRMED?this.terminated(t,e.C.causes.DIALOG_ERROR):this.status!==a.STATUS_TERMINATED&&(this.failed(t,e.C.causes.DIALOG_ERROR),this.terminated(t,e.C.causes.DIALOG_ERROR))},onhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!0,this.emit("hold",{originator:e})},onunhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!1,this.emit("unhold",{originator:e})},onmute:function(e){this.emit("muted",{audio:e.audio,video:e.video})},onunmute:function(e){this.emit("unmuted",{audio:e.audio,video:e.video})},failed:function(e,t){return this.status===a.STATUS_TERMINATED?this:(this.emit("failed",e||null,t||null),this)},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.emit("cancel"),this},accepted:function(t,n){return n=e.Utils.getReasonPhrase(t&&t.status_code,n),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",t,n),this},terminated:function(e,t){return this.status===a.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null),this)},connecting:function(e){return this.emit("connecting",{request:e}),this}},r.desugar=function(e){return t.HTMLMediaElement&&e instanceof t.HTMLMediaElement&&(e={media:{constraints:{audio:!0,video:"VIDEO"===e.tagName},render:{remote:e}}}),e||{}},r.C=a,e.Session=r,i=function(t,n){function r(e,t){n.hasHeader(e)&&n.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(o.rel100=t)}function i(){var t={extraHeaders:["Contact: "+o.contact]};o.rel100!==e.C.supported.REQUIRED&&o.progress(t),o.status=a.STATUS_WAITING_FOR_ANSWER,o.timers.userNoAnswerTimer=e.Timers.setTimeout(function(){n.reply(408),o.failed(n,e.C.causes.NO_ANSWER),o.terminated(n,e.C.causes.NO_ANSWER)},o.ua.configuration.noAnswerTimeout),s&&(o.timers.expiresTimer=e.Timers.setTimeout(function(){o.status===a.STATUS_WAITING_FOR_ANSWER&&(n.reply(487),o.failed(n,e.C.causes.EXPIRES),o.terminated(n,e.C.causes.EXPIRES))},s)),o.emit("invite",n)}var s,o=this,c=n.getHeader("Content-Type"),u=n.parseHeader("Content-Disposition");if(e.Utils.augment(this,e.ServerContext,[t,n]),e.Utils.augment(this,e.Session,[t.configuration.mediaHandlerFactory]),this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"true"}]}}),!u&&!this.mediaHandler.hasDescription(n)||u&&"render"===u.type)this.renderbody=n.body,this.rendertype=c;else if(!this.mediaHandler.hasDescription(n)&&u&&"session"===u.type)return void n.reply(415);if(this.status=a.STATUS_INVITE_RECEIVED,this.from_tag=n.from_tag,this.id=n.call_id+this.from_tag,this.request=n,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=t.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,n.hasHeader("expires")&&(s=1e3*n.getHeader("expires")),r("require",e.C.supported.REQUIRED),r("supported",e.C.supported.SUPPORTED),n.to_tag=e.Utils.newTag(),!this.createDialog(n,"UAS",!0))return void n.reply(500,"Missing Contact header field");this.mediaHandler&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),!this.mediaHandler.hasDescription(n)||this.renderbody?e.Timers.setTimeout(i,0):(this.hasOffer=!0,this.mediaHandler.setDescription(n).then(i,function(e){o.logger.warn("invalid description"),o.logger.warn(e),n.reply(488)}))},i.prototype={reject:function(t){if(this.status===a.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),e.ServerContext.prototype.reject.call(this,t),this.terminated()},terminate:function(t){t=t||{};var n,r=(t.extraHeaders||[]).slice(),i=t.body,s=this;return this.status===a.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:r,body:i}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new e.OutgoingRequest(e.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},r,i),new e.RequestSender({request:this.request,onRequestTimeout:function(){s.onRequestTimeout()},onTransportError:function(){s.onTransportError()},receiveResponse:function(){}},this.ua).send(),n.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):this.status===a.STATUS_CONFIRMED?this.bye(t):this.reject(t),this},progress:function(t){function n(){o=t.statusCode||183,this.status=a.STATUS_WAITING_FOR_PRACK,u.push("Contact: "+this.contact),u.push("Require: 100rel"),u.push("RSeq: "+Math.floor(1e4*Math.random())),this.mediaHint=t.media,this.mediaHandler.getDescription(t.media).then(function(t){if(!this.isCanceled&&this.status!==a.STATUS_TERMINATED){this.early_sdp=t.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var n=e.Timers.T1;this.timers.rel1xxTimer=e.Timers.setTimeout(function r(){this.request.reply(o,null,u,t),n*=2,this.timers.rel1xxTimer=e.Timers.setTimeout(r.bind(this),n)}.bind(this),n),this.timers.prackTimer=e.Timers.setTimeout(function(){this.status===a.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),e.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,e.C.causes.NO_PRACK))}.bind(this),64*e.Timers.T1),s=this.request.reply(o,c,u,t),this.emit("progress",s,c)}}.bind(this),function(){this.request.reply(480),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))}function r(){s=this.request.reply(o,c,u,p),this.emit("progress",s,c)}t=t||{};var i,s,o=t.statusCode||180,c=t.reasonPhrase,u=(t.extraHeaders||[]).slice(),l=t.stunServers||null,d=t.turnServers||null,p=t.body;if(o<100||o>199)throw new TypeError("Invalid statusCode: "+o);if(this.isCanceled||this.status===a.STATUS_TERMINATED)return this;if(l||d){if(l){if(!(i=e.UA.configuration_check.optional.stunServers(l)))throw new TypeError("Invalid stunServers: "+l);this.stunServers=i}if(d){if(!(i=e.UA.configuration_check.optional.turnServers(d)))throw new TypeError("Invalid turnServers: "+d);this.turnServers=i}this.mediaHandler.updateIceServers({stunServers:this.stunServers,turnServers:this.turnServers})}return 100!==t.statusCode&&(this.rel100===e.C.supported.REQUIRED||this.rel100===e.C.supported.SUPPORTED&&t.rel100||this.rel100===e.C.supported.SUPPORTED&&this.ua.configuration.rel100===e.C.supported.REQUIRED)?n.apply(this):r.apply(this),this},accept:function(t){t=Object.create(r.desugar(t)),e.Utils.optionsOverride(t,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media),this.mediaHint=t.media,this.onInfo=t.onInfo;var n,i=this,s=this.request,o=(t.extraHeaders||[]).slice(),c=t.stunServers||null,u=t.turnServers||null,l=function(t){var n,r=function(){i.status=a.STATUS_WAITING_FOR_ACK,i.setInvite2xxTimer(s,t),i.setACKTimer()},c=function(){i.failed(null,e.C.causes.CONNECTION_ERROR),i.terminated(null,e.C.causes.CONNECTION_ERROR)};i.mediaHandler.render(),o.push("Contact: "+i.contact),o.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),i.hasOffer?i.hasAnswer=!0:i.hasOffer=!0,n=s.reply(200,null,o,t,r,c),i.status!==a.STATUS_TERMINATED&&i.accepted(n,e.Utils.getReasonPhrase(200))},d=function(){i.status!==a.STATUS_TERMINATED&&(i.request.reply(480),i.failed(null,e.C.causes.WEBRTC_ERROR),i.terminated(null,e.C.causes.WEBRTC_ERROR))};if(this.status===a.STATUS_WAITING_FOR_PRACK)return this.status=a.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===a.STATUS_WAITING_FOR_ANSWER)this.status=a.STATUS_ANSWERED;else if(this.status!==a.STATUS_EARLY_MEDIA)throw new e.Exceptions.InvalidStateError(this.status);if((c||u)&&this.status!==a.STATUS_EARLY_MEDIA&&this.status!==a.STATUS_ANSWERED_WAITING_FOR_PRACK){if(c){if(!(n=e.UA.configuration_check.optional.stunServers(c)))throw new TypeError("Invalid stunServers: "+c);this.stunServers=n}if(u){if(!(n=e.UA.configuration_check.optional.turnServers(u)))throw new TypeError("Invalid turnServers: "+u);this.turnServers=n}this.mediaHandler.updateIceServers({stunServers:this.stunServers,turnServers:this.turnServers})}return this.createDialog(s,"UAS")?(e.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===a.STATUS_EARLY_MEDIA?l({}):this.mediaHandler.getDescription(i.mediaHint).then(l,d),this):(s.reply(500,"Missing Contact header field"),this)},receiveRequest:function(t){function n(){var n;e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=a.STATUS_CONFIRMED,this.unmute(),n=t.getHeader("Content-Type"),this.mediaHandler.hasDescription(t)||(this.renderbody=t.body,this.rendertype=n),this.emit("confirmed",t)}switch(t.method){case e.C.CANCEL:this.status!==a.STATUS_WAITING_FOR_ANSWER&&this.status!==a.STATUS_WAITING_FOR_PRACK&&this.status!==a.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==a.STATUS_EARLY_MEDIA&&this.status!==a.STATUS_ANSWERED||(this.status=a.STATUS_CANCELED,this.request.reply(487),this.canceled(t),this.rejected(t,e.C.causes.CANCELED),this.failed(t,e.C.causes.CANCELED),this.terminated(t,e.C.causes.CANCELED));break;case e.C.ACK:this.status===a.STATUS_WAITING_FOR_ACK&&(this.hasAnswer?n.apply(this):this.mediaHandler.hasDescription(t)?(this.hasAnswer=!0,this.mediaHandler.setDescription(t).then(n.bind(this),function(n){this.logger.warn(n),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):this.early_sdp?n.apply(this):(this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)));break;case e.C.PRACK:this.status===a.STATUS_WAITING_FOR_PRACK||this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),t.reply(200),this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept()),this.status=a.STATUS_EARLY_MEDIA,this.mute()):this.mediaHandler.hasDescription(t)?(this.hasAnswer=!0,this.mediaHandler.setDescription(t).then(function(){e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),t.reply(200),this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept()),this.status=a.STATUS_EARLY_MEDIA,this.mute()}.bind(this),function(n){this.logger.warn(n),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)):this.status===a.STATUS_EARLY_MEDIA&&t.reply(200);break;default:r.prototype.receiveRequest.apply(this,[t])}},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}},e.InviteServerContext=i,s=function(t,n,i){i=Object.create(r.desugar(i)),i.params=Object.create(i.params||Object.prototype);var s,o=(i.extraHeaders||[]).slice(),c=i.stunServers||null,u=i.turnServers||null,l=i.mediaHandlerFactory||t.configuration.mediaHandlerFactory,d=l.isSupported;if(d&&!d())throw new e.Exceptions.NotSupportedError("Media not supported");if(this.RTCConstraints=i.RTCConstraints||{},this.inviteWithoutSdp=i.inviteWithoutSdp||!1,this.anonymous=i.anonymous||!1,this.renderbody=i.renderbody||null,this.rendertype=i.rendertype||"text/plain",i.params.from_tag=this.from_tag,this.contact=t.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!t.contact.temp_gruu:!t.contact.pub_gruu}),this.anonymous&&(i.params.from_displayName="Anonymous",i.params.from_uri="sip:anonymous@anonymous.invalid",o.push("P-Preferred-Identity: "+t.configuration.uri.toString()),o.push("Privacy: id")),o.push("Contact: "+this.contact),o.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(o.push("Content-Type: "+this.rendertype),o.push("Content-Disposition: render;handling=optional")),t.configuration.rel100===e.C.supported.REQUIRED&&o.push("Require: 100rel"),t.configuration.replaces===e.C.supported.REQUIRED&&o.push("Require: replaces"),i.extraHeaders=o,e.Utils.augment(this,e.ClientContext,[t,e.C.INVITE,n,i]),e.Utils.augment(this,e.Session,[l]),this.status!==a.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);if(this.from_tag=e.Utils.newTag(),this.isCanceled=!1,this.received_100=!1,this.method=e.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=t.getLogger("sip.inviteclientcontext"),c){if(!(s=e.UA.configuration_check.optional.stunServers(c)))throw new TypeError("Invalid stunServers: "+c);this.stunServers=s}if(u){if(!(s=e.UA.configuration_check.optional.turnServers(u)))throw new TypeError("Invalid turnServers: "+u);this.turnServers=s}t.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:this.RTCConstraints,stunServers:this.stunServers,turnServers:this.turnServers}),this.mediaHandler&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),e.Utils.optionsOverride(i,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media),this.mediaHint=i.media,this.onInfo=i.onInfo},s.prototype={invite:function(){var t=this;return this.ua.sessions[this.id]=this,this.inviteWithoutSdp?(this.request.body=t.renderbody,this.status=a.STATUS_INVITE_SENT,this.send()):this.mediaHandler.getDescription(t.mediaHint).then(function(e){t.isCanceled||t.status===a.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=a.STATUS_INVITE_SENT,t.send())},function(){t.status!==a.STATUS_TERMINATED&&(t.failed(null,e.C.causes.WEBRTC_ERROR),t.terminated(null,e.C.causes.WEBRTC_ERROR))}),this},receiveInviteResponse:function(t){var n,r=this,i=t.call_id+t.from_tag+t.to_tag,s=[],o={};if(this.status!==a.STATUS_TERMINATED&&t.method===e.C.INVITE){if(this.dialog&&t.status_code>=200&&t.status_code<=299){if(i!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",!0))return;return this.earlyDialogs[i].sendRequest(this,e.C.ACK,{body:e.Utils.generateFakeSDP(t.body)}),this.earlyDialogs[i].sendRequest(this,e.C.BYE),void(this.status!==a.STATUS_CONFIRMED&&(this.failed(t,e.C.causes.WEBRTC_ERROR),this.terminated(t,e.C.causes.WEBRTC_ERROR)))}if(this.status===a.STATUS_CONFIRMED)return void this.sendRequest(e.C.ACK,{cseq:t.cseq});if(!this.hasAnswer)return}if(this.dialog&&t.status_code<200){if(-1!==this.dialog.pracked.indexOf(t.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=t.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[i]&&!this.createDialog(t,"UAC",!0))return;if(-1!==this.earlyDialogs[i].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[i].pracked[this.earlyDialogs[i].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[i].pracked.length>0)return;return s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[i].pracked.push(t.getHeader("rseq")),void this.earlyDialogs[i].sendRequest(this,e.C.PRACK,{extraHeaders:s,body:e.Utils.generateFakeSDP(t.body)})}if(this.isCanceled)return void(t.status_code>=100&&t.status_code<200?(this.request.cancel(this.cancelReason,s),this.canceled(null)):t.status_code>=200&&t.status_code<299?(this.acceptAndTerminate(t),this.emit("bye",this.request)):t.status_code>=300&&(n=e.C.REASON_PHRASE[t.status_code]||e.C.causes.CANCELED,this.rejected(t,n),this.failed(t,n),this.terminated(t,n)));switch(!0){case/^100$/.test(t.status_code):this.received_100=!0,this.emit("progress",t);break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(this.status=a.STATUS_1XX_RECEIVED,t.hasHeader("require")&&-1!==t.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[i])break;if(-1!==this.earlyDialogs[i].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[i].pracked[this.earlyDialogs[i].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[i].pracked.length>0)return;if(this.mediaHandler.hasDescription(t))if(this.hasOffer){if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(t.getHeader("rseq")),this.mediaHandler.setDescription(t).then(function(){s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),r.sendRequest(e.C.PRACK,{extraHeaders:s,receiveResponse:function(){}}),r.status=a.STATUS_EARLY_MEDIA,r.mute(),r.emit("progress",t)},function(n){r.logger.warn(n),r.acceptAndTerminate(t,488,"Not Acceptable Here"),r.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var c=this.earlyDialogs[i],u=c.mediaHandler;c.pracked.push(t.getHeader("rseq")),u.setDescription(t).then(u.getDescription.bind(u,r.mediaHint)).then(function(n){s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),c.sendRequest(r,e.C.PRACK,{extraHeaders:s,body:n}),r.status=a.STATUS_EARLY_MEDIA,r.emit("progress",t)}).catch(function(n){if(n instanceof e.Exceptions.GetDescriptionError){if(c.pracked.push(t.getHeader("rseq")),r.status===a.STATUS_TERMINATED)return;r.failed(null,e.C.causes.WEBRTC_ERROR),r.terminated(null,e.C.causes.WEBRTC_ERROR)}else c.pracked.splice(c.pracked.indexOf(t.getHeader("rseq")),1),r.logger.warn("invalid description"),r.logger.warn(n)})}else s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[i].pracked.push(t.getHeader("rseq")),this.earlyDialogs[i].sendRequest(this,e.C.PRACK,{extraHeaders:s}),this.emit("progress",t)}else this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.request.cseq+" "+this.request.method!==t.getHeader("cseq"))break;if(this.status===a.STATUS_EARLY_MEDIA&&this.dialog){this.status=a.STATUS_CONFIRMED,this.unmute(),o={},this.renderbody&&(s.push("Content-Type: "+this.rendertype),o.extraHeaders=s,o.body=this.renderbody),o.cseq=t.cseq,this.sendRequest(e.C.ACK,o),this.accepted(t);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(s.push("Content-Type: "+r.rendertype),o.extraHeaders=s,o.body=this.renderbody),this.sendRequest(e.C.ACK,o);else{if(!this.mediaHandler.hasDescription(t)){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.mediaHandler.setDescription(t).then(function(){var n={};r.status=a.STATUS_CONFIRMED,r.unmute(),r.renderbody&&(s.push("Content-Type: "+r.rendertype),n.extraHeaders=s,n.body=r.renderbody),n.cseq=t.cseq,r.sendRequest(e.C.ACK,n),r.accepted(t)},function(n){r.logger.warn(n),r.acceptAndTerminate(t,488,"Not Acceptable Here"),r.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[i]&&this.earlyDialogs[i].mediaHandler.localMedia){if(this.hasOffer=!0,this.hasAnswer=!0,this.mediaHandler=this.earlyDialogs[i].mediaHandler,!this.createDialog(t,"UAC"))break;this.status=a.STATUS_CONFIRMED,this.sendRequest(e.C.ACK,{cseq:t.cseq}),this.unmute(),this.accepted(t)}else{if(!this.mediaHandler.hasDescription(t)){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasOffer=!0,this.mediaHandler.setDescription(t).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(n){r.isCanceled||r.status===a.STATUS_TERMINATED||(r.status=a.STATUS_CONFIRMED,r.hasAnswer=!0,r.unmute(),r.sendRequest(e.C.ACK,{body:n,cseq:t.cseq}),r.accepted(t))}).catch(function(n){n instanceof e.Exceptions.GetDescriptionError?r.logger.warn("there was a problem"):(r.logger.warn("invalid description"),r.logger.warn(n),t.reply(488))})}break;default:n=e.Utils.sipErrorCause(t.status_code),this.rejected(t,n),this.failed(t,n),this.terminated(t,n)}}},cancel:function(t){if(t=t||{},t.extraHeaders=(t.extraHeaders||[]).slice(),this.status===a.STATUS_TERMINATED||this.status===a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession");var n=e.Utils.getCancelReason(t.status_code,t.reason_phrase);return this.status===a.STATUS_NULL||this.status===a.STATUS_INVITE_SENT&&!this.received_100?(this.isCanceled=!0,this.cancelReason=n):this.status!==a.STATUS_INVITE_SENT&&this.status!==a.STATUS_1XX_RECEIVED&&this.status!==a.STATUS_EARLY_MEDIA||this.request.cancel(n,t.extraHeaders),this.canceled()},terminate:function(e){return this.status===a.STATUS_TERMINATED?this:(this.status===a.STATUS_WAITING_FOR_ACK||this.status===a.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)},receiveRequest:function(t){return t.method,e.C.CANCEL,t.method===e.C.ACK&&this.status===a.STATUS_WAITING_FOR_ACK&&(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=a.STATUS_CONFIRMED,this.unmute(),this.accepted()),r.prototype.receiveRequest.apply(this,[t])},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}},e.InviteClientContext=s}},function(e,t,n){"use strict";e.exports=function(e){var t,n={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return t=function(n,r,i){var s,o;if(void 0===r)throw new TypeError("Not enough arguments");if(this.logger=n.ua.getLogger("sip.invitecontext.dtmf",n.id),this.owner=n,this.direction=null,i=i||{},s=i.duration||null,o=i.interToneGap||null,"string"==typeof r)r=r.toUpperCase();else{if("number"!=typeof r)throw new TypeError("Invalid tone: "+r);r=r.toString()}if(!r.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+r);if(this.tone=r,s&&!e.Utils.isDecimal(s))throw new TypeError("Invalid tone duration: "+s);if(s?s<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),s=t.C.MIN_DURATION):s>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),s=t.C.MAX_DURATION):s=Math.abs(s):s=t.C.DEFAULT_DURATION,this.duration=s,o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid interToneGap: "+o);o?o<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),o=t.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=o},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var n,r={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],r.contentType="application/dtmf-relay",r.body="Signal= "+this.tone+"\r\n",r.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:n,body:r}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:n=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C=n,t}},function(e,t,n){"use strict";e.exports=function(e){e.Subscription=function(t,n,r,i){if(i=Object.create(i||Object.prototype),this.extraHeaders=i.extraHeaders=(i.extraHeaders||[]).slice(),this.id=null,this.state="init",!r)throw new TypeError("Event necessary to create a subscription.");this.event=r,"number"!=typeof i.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=i.expires,i.extraHeaders.push("Event: "+this.event),i.extraHeaders.push("Expires: "+this.expires),i.body&&(this.body=i.body),this.contact=t.contact.toString(),i.extraHeaders.push("Contact: "+this.contact),i.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,n,i]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){var t=this;return"active"===this.state?(this.refresh(),this):"notify_wait"===this.state?this:(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(t.timer_fire.bind(t),e.Timers.TIMER_N),this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]=this,this.send(),this.state="notify_wait",this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var n,r=this,i=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(t.status_code)?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)?(this.emit("accepted",t,i),n=t.getHeader("Expires"),n&&n<=this.expires?(this.expires=n,this.timers.sub_duration=e.Timers.setTimeout(r.refresh.bind(r),900*n)):n?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING))):t.statusCode>300&&(this.emit("failed",t,i),this.emit("rejected",t,i))},unsubscribe:function(){var t=[],n=this;this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(n.timer_fire.bind(n),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},close:function(){"notify_wait"===this.state?(this.state="terminated",e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),this.receiveResponse=function(){},delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]):"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,n){var r;return this.terminateDialog(),r=new e.Dialog(this,t,n),r.invite_seqnum=this.request.cseq,r.local_seqnum=this.request.cseq,!r.error&&(this.dialog=r,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){function n(){r.expires&&(e.Timers.clearTimeout(i.timers.sub_duration),r.expires=Math.min(i.expires,Math.max(r.expires,0)),i.timers.sub_duration=e.Timers.setTimeout(i.refresh.bind(i),900*r.expires))}var r,i=this;if(!this.matchEvent(t))return void t.reply(489);if(this.dialog||this.createConfirmedDialog(t,"UAS")&&(this.id=this.dialog.id.toString(),delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id]=this),r=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"===this.state)return void("terminated"===r.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]));switch(r.state){case"active":this.state="active",n();break;case"pending":"notify_wait"===this.state&&n(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),r.reason)switch(this.logger.log("terminating subscription with reason "+r.reason),r.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(r.params&&r.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(i.subscribe.bind(i),r.params["retry-after"]):this.subscribe())}this.close()}},failed:function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},function(e,t,n){"use strict";var r=500;e.exports=function(e){var t={T1:r,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(n){t[n]=function(){return e[n].apply(e,arguments)}}),t}},function(e,t,n){"use strict";e.exports=function(e){function t(e,t,n){var r;return r="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),r+=" "+e.ua.configuration.viaHost+";branch="+n,e.ua.configuration.forceRport&&(r+=";rport"),r}var n={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},r=function(e,r,i){var s;this.type=n.NON_INVITE_CLIENT,this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),s=t(e,i,this.id),this.request.setHeader("via",s),this.request_sender.ua.newTransaction(this)};r.prototype=Object.create(e.EventEmitter.prototype),r.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){var t=this;this.stateChanged(n.STATUS_TRYING),this.F=e.Timers.setTimeout(t.timer_F.bind(t),e.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){this.logger.log("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(t){var r=this,i=t.status_code;if(i<200)switch(this.state){case n.STATUS_TRYING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_PROCEEDING),this.request_sender.receiveResponse(t)}else switch(this.state){case n.STATUS_TRYING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===i?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(t),this.K=e.Timers.setTimeout(r.timer_K.bind(r),e.Timers.TIMER_K)}};var i=function(e,r,i){var s,o=this;this.type=n.INVITE_CLIENT,this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),s=t(e,i,this.id),this.request.setHeader("via",s),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){t=(t||[]).slice();for(var n=t.length,r=null,i=0;i<n;i++)r=(r||"")+t[i].trim()+"\r\n";o.cancel_request(o,e,r)}};i.prototype=Object.create(e.EventEmitter.prototype),i.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){var t=this;this.stateChanged(n.STATUS_CALLING),this.B=e.Timers.setTimeout(t.timer_B.bind(t),e.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==n.STATUS_ACCEPTED&&this.request_sender.onTransportError()},i.prototype.timer_M=function(){this.logger.log("Timer M expired for INVITE client transaction "+this.id),this.state===n.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},i.prototype.timer_B=function(){this.logger.log("Timer B expired for INVITE client transaction "+this.id),this.state===n.STATUS_CALLING&&(this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},i.prototype.timer_D=function(){this.logger.log("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.sendACK=function(t){var n=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+t.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="Content-Length: 0\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n\r\n",this.D=e.Timers.setTimeout(n.timer_D.bind(n),e.Timers.TIMER_D),this.transport.send(this.ack)},i.prototype.cancel_request=function(t,r,i){var s=t.request;this.cancel=e.C.CANCEL+" "+s.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+s.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+s.headers.Route.toString()+"\r\n"),this.cancel+="To: "+s.headers.To.toString()+"\r\n",this.cancel+="From: "+s.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+s.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+s.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",r&&(this.cancel+="Reason: "+r+"\r\n"),i&&(this.cancel+=i),this.cancel+="Content-Length: 0\r\n\r\n",this.state===n.STATUS_PROCEEDING&&this.transport.send(this.cancel)},i.prototype.receiveResponse=function(t){var r=this,i=t.status_code;if(i>=100&&i<=199)switch(this.state){case n.STATUS_CALLING:this.stateChanged(n.STATUS_PROCEEDING),this.request_sender.receiveResponse(t),this.cancel&&this.transport.send(this.cancel);break;case n.STATUS_PROCEEDING:this.request_sender.receiveResponse(t)}else if(i>=200&&i<=299)switch(this.state){case n.STATUS_CALLING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(r.timer_M.bind(r),e.Timers.TIMER_M),this.request_sender.receiveResponse(t);break;case n.STATUS_ACCEPTED:this.request_sender.receiveResponse(t)}else if(i>=300&&i<=699)switch(this.state){case n.STATUS_CALLING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_COMPLETED),this.sendACK(t),this.request_sender.receiveResponse(t);break;case n.STATUS_COMPLETED:this.sendACK(t)}};var s=function(e,n,r){var i;this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=n,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),i=t(e,r,this.id),this.request.setHeader("via",i)};s.prototype=Object.create(e.EventEmitter.prototype),s.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},s.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var o=function(e,t){this.type=n.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.nist",this.id),this.state=n.STATUS_TRYING,t.newTransaction(this)};o.prototype=Object.create(e.EventEmitter.prototype),o.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_J=function(){this.logger.log("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.receiveResponse=function(t,r){var i=this,s=e.Utils.defer();if(100===t)switch(this.state){case n.STATUS_TRYING:this.stateChanged(n.STATUS_PROCEEDING),this.transport.send(r)||this.onTransportError();break;case n.STATUS_PROCEEDING:this.last_response=r,this.transport.send(r)?s.resolve():(this.onTransportError(),s.reject())}else if(t>=200&&t<=699)switch(this.state){case n.STATUS_TRYING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_COMPLETED),this.last_response=r,this.J=e.Timers.setTimeout(i.timer_J.bind(i),e.Timers.TIMER_J),this.transport.send(r)?s.resolve():(this.onTransportError(),s.reject())}return s.promise};var a=function(e,t){this.type=n.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.ist",this.id),this.state=n.STATUS_PROCEEDING,t.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};a.prototype=Object.create(e.EventEmitter.prototype),a.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){this.logger.log("Timer H expired for INVITE server transaction "+this.id),this.state===n.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_L=function(){this.logger.log("Timer L expired for INVITE server transaction "+this.id),this.state===n.STATUS_ACCEPTED&&(this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},a.prototype.receiveResponse=function(t,r){var i=this,s=e.Utils.defer();if(t>=100&&t<=199)switch(this.state){case n.STATUS_PROCEEDING:this.transport.send(r)||this.onTransportError(),this.last_response=r}if(t>100&&t<=199&&this.state===n.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(i.resend_provisional.bind(i),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(t>=200&&t<=299)switch(this.state){case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_ACCEPTED),this.last_response=r,this.L=e.Timers.setTimeout(i.timer_L.bind(i),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case n.STATUS_ACCEPTED:this.transport.send(r)?s.resolve():(this.onTransportError(),s.reject())}else if(t>=300&&t<=699)switch(this.state){case n.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(r)?(this.stateChanged(n.STATUS_COMPLETED),this.H=e.Timers.setTimeout(i.timer_H.bind(i),e.Timers.TIMER_H),s.resolve()):(this.onTransportError(),s.reject())}return s.promise};var c=function(t,r){var i;switch(r.method){case e.C.INVITE:if(i=t.transactions.ist[r.via_branch]){switch(i.state){case n.STATUS_PROCEEDING:i.transport.send(i.last_response)}return!0}break;case e.C.ACK:if(!(i=t.transactions.ist[r.via_branch]))return!1;if(i.state===n.STATUS_ACCEPTED)return!1;if(i.state===n.STATUS_COMPLETED)return i.stateChanged(n.STATUS_CONFIRMED),i.I=e.Timers.setTimeout(i.timer_I.bind(i),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return i=t.transactions.ist[r.via_branch],i?(r.reply_sl(200),i.state!==n.STATUS_PROCEEDING):(r.reply_sl(481),!0);default:if(i=t.transactions.nist[r.via_branch]){switch(i.state){case n.STATUS_TRYING:break;case n.STATUS_PROCEEDING:case n.STATUS_COMPLETED:i.transport.send(i.last_response)}return!0}}};e.Transactions={C:n,checkTransaction:c,NonInviteClientTransaction:r,InviteClientTransaction:i,AckClientTransaction:s,NonInviteServerTransaction:o,InviteServerTransaction:a}}},function(e,t,n){"use strict";e.exports=function(e,t){function n(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)}var r,i={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};return r=function(e,t){this.logger=e.getLogger("sip.transport"),this.ua=e,this.ws=null,this.server=t,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.keepAliveInterval=e.configuration.keepAliveInterval,this.keepAliveTimeout=null,this.keepAliveTimer=null,this.ua.transport=this,this.connect()},r.prototype={send:function(e){var n=e.toString();return this.ws&&this.ws.readyState===t.OPEN?(!0===this.ua.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+n+"\n"),this.ws.send(n),!0):(this.logger.warn("unable to send message, WebSocket is not open"),!1)},sendKeepAlive:function(){if(!this.keepAliveTimeout)return this.keepAliveTimeout=e.Timers.setTimeout(function(){this.ua.emit("keepAliveTimeout")}.bind(this),1e4),this.send("\r\n\r\n")},startSendingKeepAlives:function(){this.keepAliveInterval&&!this.keepAliveTimer&&(this.keepAliveTimer=e.Timers.setTimeout(function(){this.sendKeepAlive(),this.keepAliveTimer=null,this.startSendingKeepAlives()}.bind(this),n(this.keepAliveInterval)))},stopSendingKeepAlives:function(){e.Timers.clearTimeout(this.keepAliveTimer),e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimer=null,this.keepAliveTimeout=null},disconnect:function(){this.ws&&(e.Timers.clearTimeout(this.reconnectTimer),this.stopSendingKeepAlives(),this.closed=!0,this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var e=this;if(this.ws&&(this.ws.readyState===t.OPEN||this.ws.readyState===t.CONNECTING))return this.logger.log("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new t(this.server.ws_uri,"sip")}catch(e){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+e)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(t){e.onClose(t)},this.ws.onmessage=function(t){e.onMessage(t)},this.ws.onerror=function(t){e.onError(t)}},onOpen:function(){this.connected=!0,this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this),this.startSendingKeepAlives()},onClose:function(e){var t=this.connected;this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,this.stopSendingKeepAlives(),this.reconnection_attempts>0?(this.logger.log("Reconnection attempt "+this.reconnection_attempts+" failed (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.reconnect()):(this.connected=!1,this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),!1===e.wasClean&&this.logger.warn("WebSocket abrupt disconnection"),!0===t?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reconnect()):this.ua.onTransportError(this))},onMessage:function(t){var n,r,i=t.data;if("\r\n"===i)return e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=null,void(!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if("string"!=typeof i){try{i=String.fromCharCode.apply(null,new Uint8Array(i))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+i+"\n")}else!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+i+"\n");if((n=e.Parser.parseMessage(i,this.ua))&&!(this.ua.status===e.UA.C.STATUS_USER_CLOSED&&n instanceof e.IncomingRequest)&&e.sanityCheck(n,this.ua,this))if(n instanceof e.IncomingRequest)n.transport=this,this.ua.receiveRequest(n);else if(n instanceof e.IncomingResponse)switch(n.method){case e.C.INVITE:r=this.ua.transactions.ict[n.via_branch],r&&r.receiveResponse(n);break;case e.C.ACK:break;default:r=this.ua.transactions.nict[n.via_branch],r&&r.receiveResponse(n)}},onError:function(e){this.logger.warn("WebSocket connection error: "+JSON.stringify(e))},reconnect:function(){var t=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.wsServerMaxReconnection?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):1===this.reconnection_attempts?(this.logger.log("Connection to WebSocket "+this.server.ws_uri+" severed, attempting first reconnect"),t.connect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){t.connect(),t.reconnectTimer=null},1e3*this.ua.configuration.wsServerReconnectionTimeout))}},r.C=i,r}},function(e,t,n){"use strict";(function(t){e.exports=function(e,n){function r(t){if(t instanceof Function)return t.initialize||(t.initialize=function(){return e.Utils.Promise.resolve()}),t}var i,s={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};i=function(r){function i(e){return o.emit.bind(o,e)}var o=this;s.ACCEPTED_BODY_TYPES=s.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.earlySubscriptions={},this.transport=null,this.contact=null,this.status=s.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===r?r={}:("string"==typeof r||r instanceof String)&&(r={uri:r}),r.log&&(r.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=r.log.builtinEnabled),r.log.hasOwnProperty("level")&&(this.log.level=r.log.level),r.log.hasOwnProperty("connector")&&(this.log.connector=r.log.connector));try{this.loadConfig(r)}catch(e){throw this.status=s.STATUS_NOT_READY,this.error=s.CONFIGURATION_ERROR,e}this.registerContext=new e.RegisterContext(this),this.registerContext.on("failed",i("registrationFailed")),this.registerContext.on("registered",i("registered")),this.registerContext.on("unregistered",i("unregistered")),this.configuration.autostart&&this.start(),"function"==typeof n.addEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||n.addEventListener("unload",this.stop.bind(this)))},i.prototype=Object.create(e.EventEmitter.prototype),i.prototype.register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},i.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.afterConnected(t.unregister.bind(t,e)),this},i.prototype.isRegistered=function(){return this.registerContext.registered},i.prototype.isConnected=function(){return!!this.transport&&this.transport.connected},i.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},i.prototype.invite=function(t,n){var r=new e.InviteClientContext(this,t,n);return this.afterConnected(r.invite.bind(r)),r},i.prototype.subscribe=function(t,n,r){var i=new e.Subscription(this,t,n,r);return this.afterConnected(i.subscribe.bind(i)),i},i.prototype.message=function(t,n,r){if(void 0===n)throw new TypeError("Not enough arguments");return r=Object.create(r||Object.prototype),r.contentType||(r.contentType="text/plain"),r.body=n,this.request(e.C.MESSAGE,t,r)},i.prototype.request=function(t,n,r){var i=new e.ClientContext(this,t,n,r);return this.afterConnected(i.send.bind(i)),i},i.prototype.stop=function(){function t(){0===o.nistTransactionsCount&&0===o.nictTransactionsCount&&(o.removeListener("transactionDestroyed",t),o.transport.disconnect())}var n,r,i,o=this;if(this.logger.log("user requested closure..."),this.status===s.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;e.Timers.clearTimeout(this.transportRecoveryTimer),this.logger.log("closing registerContext"),this.registerContext.close();for(n in this.sessions)this.logger.log("closing session "+n),this.sessions[n].terminate();for(r in this.subscriptions)this.logger.log("unsubscribing from subscription "+r),this.subscriptions[r].close();for(r in this.earlySubscriptions)this.logger.log("unsubscribing from early subscription "+r),this.earlySubscriptions[r].close();for(i in this.applicants)this.applicants[i].close();return this.status=s.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",t),this},i.prototype.start=function(){var t;return this.logger.log("user requested startup..."),this.status===s.STATUS_INIT?(t=this.getNextWsServer(),this.status=s.STATUS_STARTING,new e.Transport(this,t)):this.status===s.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=s.STATUS_READY,this.transport.connect()):this.status===s.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===s.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect"),this},i.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostportParams)},i.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},i.prototype.getCredentials=function(e){var t,n;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&(n=this.cache.credentials[t][e.ruri],n.method=e.method),n},i.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},i.prototype.onTransportClosed=function(t){var n,r,i,s=["nict","ict","nist","ist"];for(t.server.status=e.Transport.C.STATUS_DISCONNECTED,this.logger.log("connection state set to "+e.Transport.C.STATUS_DISCONNECTED),i=s.length,n=0;n<i;n++)for(r in this.transactions[s[n]])this.transactions[s[n]][r].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},i.prototype.onTransportError=function(t){var n;this.logger.log("transport "+t.server.ws_uri+" failed | connection state set to "+e.Transport.C.STATUS_ERROR),t.server.status=e.Transport.C.STATUS_ERROR,this.emit("disconnected",{transport:t}),this.status!==s.STATUS_USER_CLOSED&&(n=this.getNextWsServer(),n?new e.Transport(this,n):(this.closeSessionsOnTransportError(),this.error&&this.error===s.NETWORK_ERROR||(this.status=s.STATUS_NOT_READY,this.error=s.NETWORK_ERROR),this.recoverTransport()))},i.prototype.onTransportConnected=function(t){this.transport=t,this.transportRecoverAttempts=0,t.server.status=e.Transport.C.STATUS_READY,this.logger.log("connection state set to "+e.Transport.C.STATUS_READY),this.status!==s.STATUS_USER_CLOSED&&(this.status=s.STATUS_READY,this.error=null,this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this)),this.emit("connected",{transport:t}))},i.prototype.onTransportConnecting=function(e,t){this.emit("connecting",{transport:e,attempts:t})},i.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},i.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},i.prototype.receiveRequest=function(t){function n(e){return e&&e.user===t.ruri.user}var r,i,o,a,c,u,l=t.method,d=this;if(!(n(this.configuration.uri)||n(this.contact.uri)||n(this.contact.pub_gruu)||n(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme===e.C.SIPS)return void t.reply_sl(416);if(!e.Transactions.checkTransaction(this,t))if(l===e.C.OPTIONS?(new e.Transactions.NonInviteServerTransaction(t,this),t.reply(200,null,["Allow: "+e.UA.C.ALLOWED_METHODS.toString(),"Accept: "+s.ACCEPTED_BODY_TYPES])):l===e.C.MESSAGE?(o=new e.ServerContext(this,t),o.body=t.body,o.content_type=t.getHeader("Content-Type")||"text/plain",t.reply(200,null),this.emit("message",o)):l!==e.C.INVITE&&l!==e.C.ACK&&new e.ServerContext(this,t),t.to_tag)r=this.findDialog(t),r?(l===e.C.INVITE&&new e.Transactions.InviteServerTransaction(t,this),r.receiveRequest(t)):l===e.C.NOTIFY?(i=this.findSession(t),a=this.findEarlySubscription(t),i?i.receiveRequest(t):a?a.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),t.reply(481,"Subscription does not exist"))):l!==e.C.ACK&&t.reply(481);else switch(l){case e.C.INVITE:if(c=this.configuration.replaces!==e.C.supported.UNSUPPORTED&&t.parseHeader("replaces")){if(!(u=this.dialogs[c.call_id+c.replaces_to_tag+c.replaces_from_tag]))return void t.reply_sl(481,null);if(u.owner.status===e.Session.C.STATUS_TERMINATED)return void t.reply_sl(603,null);if(u.state===e.Dialog.C.STATUS_CONFIRMED&&c.early_only)return void t.reply_sl(486,null)}var p=this.configuration.mediaHandlerFactory.isSupported;!p||p()?(i=new e.InviteServerContext(this,t),i.replacee=u&&u.owner,i.on("invite",function(){d.emit("invite",this)})):(this.logger.warn("INVITE received but WebRTC is not supported"),t.reply(488));break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:i=this.findSession(t),i?i.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;case e.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(t.reply(200,null),d.emit("notify",{request:t})):t.reply(481,"Subscription does not exist");break;default:t.reply(405)}},i.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},i.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},i.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.call_id+e.to_tag+e.getHeader("event")]||null},i.prototype.getNextWsServer=function(){var t,n,r,i=[];for(n=this.configuration.wsServers.length,t=0;t<n;t++)r=this.configuration.wsServers[t],r.status!==e.Transport.C.STATUS_ERROR&&(0===i.length?i.push(r):r.weight>i[0].weight?i=[r]:r.weight===i[0].weight&&i.push(r));return t=Math.floor(Math.random()*i.length),i[t]},i.prototype.closeSessionsOnTransportError=function(){var e;for(e in this.sessions)this.sessions[e].onTransportError();this.registerContext.onTransportClosed()},i.prototype.recoverTransport=function(t){var n,r,i,s,o,a;for(t=t||this,o=t.transportRecoverAttempts,r=t.configuration.wsServers.length,n=0;n<r;n++)t.configuration.wsServers[n].status=0;a=t.getNextWsServer(),i=Math.floor(Math.random()*Math.pow(2,o)+1),s=i*t.configuration.connectionRecoveryMinInterval,s>t.configuration.connectionRecoveryMaxInterval&&(this.logger.log("time for next connection attempt exceeds connectionRecoveryMaxInterval, resetting counter"),s=t.configuration.connectionRecoveryMinInterval,o=0),this.logger.log("next connection attempt in "+s+" seconds"),this.transportRecoveryTimer=e.Timers.setTimeout(function(){t.transportRecoverAttempts=o+1,new e.Transport(t,a)},1e3*s)},i.prototype.loadConfig=function(t){function n(e,n){var r=e.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(e!==r){var i=t.hasOwnProperty(e);t.hasOwnProperty(r)&&(n.warn(r+" is deprecated, please use "+e),i&&n.warn(e+" overriding "+r)),t[e]=i?t[e]:t[r]}}var s,o,a,c,u,l={viaHost:e.Utils.createRandomToken(12)+".invalid",uri:new e.URI("sip","anonymous."+e.Utils.createRandomToken(6),"anonymous.invalid",null,null),wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",status:0,weight:0,ws_uri:"wss://edge.sip.onsip.com"}],password:null,registerExpires:600,register:!0,registrarServer:null,wsServerMaxReconnection:3,wsServerReconnectionTimeout:4,connectionRecoveryMinInterval:2,connectionRecoveryMaxInterval:30,keepAliveInterval:0,extraSupported:[],usePreloadedRoute:!1,userAgentString:e.C.USER_AGENT,iceCheckingTimeout:5e3,noAnswerTimeout:60,stunServers:["stun:stun.l.google.com:19302"],turnServers:[],traceSip:!1,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,hackCleanJitsiSdpImageattr:!1,hackStripTcp:!1,contactTransport:"ws",forceRport:!1,autostart:!0,rel100:e.C.supported.UNSUPPORTED,replaces:e.C.supported.UNSUPPORTED,mediaHandlerFactory:e.WebRTC.MediaHandler.defaultFactory,authenticationFactory:r(function(t){return new e.DigestAuthentication(t)}),allowLegacyNotifications:!1};for(s in i.configuration_check.mandatory){if(n(s,this.logger),!t.hasOwnProperty(s))throw new e.Exceptions.ConfigurationError(s);if(o=t[s],void 0===(a=i.configuration_check.mandatory[s](o)))throw new e.Exceptions.ConfigurationError(s,o);l[s]=a}e.Utils.optionsOverride(t,"rel100","reliable",!0,this.logger,e.C.supported.UNSUPPORTED);var d=["stunServers","turnServers"];for(s in i.configuration_check.optional)if(n(s,this.logger),t.hasOwnProperty(s)){if((o=t[s])instanceof Array&&0===o.length&&d.indexOf(s)<0)continue;if(null===o||""===o||void 0===o)continue;if("number"==typeof o&&isNaN(o))continue;if(void 0===(a=i.configuration_check.optional[s](o)))throw new e.Exceptions.ConfigurationError(s,o);l[s]=a}if(l.connectionRecoveryMaxInterval<l.connectionRecoveryMinInterval)throw new e.Exceptions.ConfigurationError("connectionRecoveryMaxInterval",l.connectionRecoveryMaxInterval);0===l.displayName&&(l.displayName="0"),l.instanceId||(l.instanceId=e.Utils.newUUID()),l.sipjsId=e.Utils.createRandomToken(5),c=l.uri.clone(),c.user=null,l.hostportParams=c.toRaw().replace(/^sip:/i,""),l.authorizationUser||(l.authorizationUser=l.uri.user),l.registrarServer||(u=l.uri.clone(),u.user=null,l.registrarServer=u),l.noAnswerTimeout=1e3*l.noAnswerTimeout,l.hackIpInContact&&("boolean"==typeof l.hackIpInContact?l.viaHost=e.Utils.getRandomTestNetIP():"string"==typeof l.hackIpInContact&&(l.viaHost=l.hackIpInContact)),l.hackWssInTransport&&(l.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",e.Utils.createRandomToken(8),l.viaHost,null,{transport:l.contactTransport}),toString:function(e){e=e||{};var t=e.anonymous||null,n=e.outbound||null,r="<";return r+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+l.contactTransport).toString():(this.pub_gruu||this.uri).toString(),n&&(r+=";ob"),r+=">"}},e.Utils.optionsOverride(l,"media","mediaConstraints",!0,this.logger);for(s in l)i.configuration_skeleton[s].value=l[s];Object.defineProperties(this.configuration,i.configuration_skeleton);for(s in l)i.configuration_skeleton[s].value="";this.logger.log("configuration parameters after validation:");for(s in l)switch(s){case"uri":case"registrarServer":case"mediaHandlerFactory":this.logger.log("· "+s+": "+l[s]);break;case"password":this.logger.log("· "+s+": NOT SHOWN");break;default:this.logger.log("· "+s+": "+JSON.stringify(l[s]))}},i.configuration_skeleton=function(){var e,t,n={},r=["sipjsId","hostportParams","uri","wsServers","authorizationUser","connectionRecoveryMaxInterval","connectionRecoveryMinInterval","keepAliveInterval","extraSupported","displayName","hackViaTcp","hackIpInContact","hackWssInTransport","hackAllowUnregisteredOptionTags","hackCleanJitsiSdpImageattr","hackStripTcp","contactTransport","forceRport","iceCheckingTimeout","instanceId","noAnswerTimeout","password","registerExpires","registrarServer","reliable","rel100","replaces","userAgentString","autostart","rtcpMuxPolicy","stunServers","traceSip","turnServers","usePreloadedRoute","wsServerMaxReconnection","wsServerReconnectionTimeout","mediaHandlerFactory","media","mediaConstraints","authenticationFactory","allowLegacyNotifications","via_core_value","viaHost"];for(e in r)t=r[e],n[t]={value:"",writable:!1,configurable:!1};return n.register={value:"",writable:!0,configurable:!1},n}(),i.configuration_check={mandatory:{},optional:{uri:function(t){var n;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),n=e.URI.parse(t),n&&n.user?n:void 0},wsServers:function(t){var n,r,i;if("string"==typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(r=t.length,n=0;n<r;n++)"string"==typeof t[n]&&(t[n]={ws_uri:t[n]})}if(0===t.length)return!1;for(r=t.length,n=0;n<r;n++){if(!t[n].ws_uri)return;if(t[n].weight&&!Number(t[n].weight))return;if(-1===(i=e.Grammar.parse(t[n].ws_uri,"absoluteURI")))return;if(["wss","ws","udp"].indexOf(i.scheme)<0)return;t[n].sip_uri="<sip:"+i.host+(i.port?":"+i.port:"")+";transport="+i.scheme.replace(/^wss$/i,"ws")+";lr>",t[n].weight||(t[n].weight=0),t[n].status=0,t[n].scheme=i.scheme.toUpperCase()}return t},authorizationUser:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},connectionRecoveryMaxInterval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},connectionRecoveryMinInterval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},displayName:function(t){return-1===e.Grammar.parse('"'+t+'"',"displayName")?void 0:t},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(t){return"boolean"==typeof t?t:"string"==typeof t&&-1!==e.Grammar.parse(t,"host")?t:void 0},iceCheckingTimeout:function(t){if(e.Utils.isDecimal(t))return Math.max(500,t)},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},hackCleanJitsiSdpImageattr:function(e){if("boolean"==typeof e)return e},hackStripTcp:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},forceRport:function(e){if("boolean"==typeof e)return e},instanceId:function(t){if("string"==typeof t)return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},keepAliveInterval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},extraSupported:function(e){var t,n;if(e instanceof Array){for(n=e.length,t=0;t<n;t++)if("string"!=typeof e[t])return;return e}},noAnswerTimeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},password:function(e){return String(e)},rel100:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},replaces:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerExpires:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},registrarServer:function(t){var n;if("string"==typeof t)return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),n=e.URI.parse(t),n?n.user?void 0:n:void 0},stunServers:function(t){var n,r,i;if("string"==typeof t)t=[t];else if(!(t instanceof Array))return;for(r=t.length,n=0;n<r;n++){if(i=t[n],/^stuns?:/.test(i)||(i="stun:"+i),-1===e.Grammar.parse(i,"stun_URI"))return;t[n]=i}return t},traceSip:function(e){if("boolean"==typeof e)return e},turnServers:function(t){var n,r,i,s,o,a;for(t instanceof Array||(t=[t]),i=t.length,n=0;n<i;n++){if(s=t[n],s.server&&(s.urls=[s.server]),!s.urls)return;for(s.urls instanceof Array?o=s.urls.length:(s.urls=[s.urls],o=1),r=0;r<o;r++)if(a=s.urls[r],/^turns?:/.test(a)||(a="turn:"+a),-1===e.Grammar.parse(a,"turn_URI"))return}return t},rtcpMuxPolicy:function(e){if("string"==typeof e)return e},userAgentString:function(e){if("string"==typeof e)return e},usePreloadedRoute:function(e){if("boolean"==typeof e)return e},wsServerMaxReconnection:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},wsServerReconnectionTimeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},autostart:function(e){if("boolean"==typeof e)return e},mediaHandlerFactory:function(t){if(t instanceof Function){var n=function(){function n(t){if(r[t].length>1){var n="getDescription"===t;r[t]=e.Utils.promisify(r,t,n)}}var r=t.apply(this,arguments);return n("getDescription"),n("setDescription"),r};return n.isSupported=t.isSupported,n}},authenticationFactory:r,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e}}},i.C=s,e.UA=i}}).call(t,n(3))},function(e,t,n){"use strict";e.exports=function(e){var t;t=function(t,n,r,i,s,o){var a,c,u,l;if(!r)throw new TypeError('missing or invalid "host" parameter');t=t||e.C.SIP,this.parameters={},this.headers={};for(a in s)this.setParam(a,s[a]);for(c in o)this.setHeader(c,o[c]);u={scheme:t,user:n,host:r,port:i},l={scheme:t.toLowerCase(),user:n,host:r.toLowerCase(),port:i},Object.defineProperties(this,{_normal:{get:function(){return l}},_raw:{get:function(){return u}},scheme:{get:function(){return l.scheme},set:function(e){u.scheme=e,l.scheme=e.toLowerCase()}},user:{get:function(){return l.user},set:function(e){l.user=u.user=e}},host:{get:function(){return l.host},set:function(e){u.host=e,l.host=e.toLowerCase()}},aor:{get:function(){return l.user+"@"+l.host}},port:{get:function(){return l.port},set:function(e){l.port=u.port=0===e?e:parseInt(e,10)||null}}})},t.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString().toLowerCase())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return this.headers.hasOwnProperty(e.Utils.headerize(t))&&!0||!1},deleteHeader:function(t){var n;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return n=this.headers[t],delete this.headers[t],n},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var n,r,i,s,o=[];s=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(s+="//"),t.user&&(s+=e.Utils.escapeUser(t.user)+"@"),s+=t.host,(t.port||0===t.port)&&(s+=":"+t.port);for(r in this.parameters)s+=";"+r,null!==this.parameters[r]&&(s+="="+this.parameters[r]);for(n in this.headers)for(i in this.headers[n])o.push(n+"="+this.headers[n][i]);return o.length>0&&(s+="?"+o.join("&")),s}},t.parse=function(t){return t=e.Grammar.parse(t,"SIP_URI"),-1!==t?t:void 0},e.URI=t}},function(e,t,n){"use strict";e.exports=function(e,t){var n;n={Promise:t.Promise,defer:function(){var e={};return e.promise=new n.Promise(function(t,n){e.resolve=t,e.reject=n}),e},promisify:function(e,t,r){var i=e[t];return function(t,s,o){return new n.Promise(function(n,s){var o=[t,n,s];r&&(o=[n,s,t]),i.apply(e,o)}).then(s,o)}},augment:function(e,t,n,r){var i,s;s=t.prototype;for(i in s)(r||void 0===e[i])&&(e[i]=s[i]);t.apply(e,n)},optionsOverride:function(e,t,n,r,i,s){r&&e[n]&&i.warn(n+" is deprecated, please use "+t+" instead"),e[t]&&e[n]&&i.warn(t+" overriding "+n),e[t]=e[t]||e[n]||s},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),n=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,n)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var n,r,i="";for(t=t||32,n=0;n<e;n++)r=Math.random()*t|0,i+=r.toString(t);return i},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,n){var r,i,s,o;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch(i=t.split("@"),i.length){case 1:if(!n)return;s=t,o=n;break;case 2:s=i[0],o=i[1];break;default:s=i.slice(0,i.length-1).join("@"),o=i[i.length-1]}return s=s.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(s)&&(s=s.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(s)+"@"+o,(r=e.URI.parse(t))?r:void 0}}else;},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i="",s=r.length;for(t=0;t<s;t++)0!==t&&(i+="-"),i+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[i]&&(i=n[i]),i},sipErrorCause:function(t){var n;for(n in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[n].indexOf(t))return e.C.causes[n];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,n){return n||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,n){return n=e.Utils.getReasonPhrase(t,n),"SIP ;cause="+t+' ;text="'+n+'"'},getCancelReason:function(t,n){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,n)},buildStatusLine:function(e,t){if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return t=n.getReasonPhrase(e,t),"SIP/2.0 "+e+" "+t+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(1,254)},calculateMD5:function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,s,o;return i=2147483648&e,s=2147483648&t,n=1073741824&e,r=1073741824&t,o=(1073741823&e)+(1073741823&t),n&r?2147483648^o^i^s:n|r?1073741824&o?3221225472^o^i^s:1073741824^o^i^s:o^i^s}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function a(e,i,s,o,a,c,u){return e=n(e,n(n(r(i,s,o),a),u)),n(t(e,c),i)}function c(e,r,s,o,a,c,u){return e=n(e,n(n(i(r,s,o),a),u)),n(t(e,c),r)}function u(e,r,i,o,a,c,u){return e=n(e,n(n(s(r,i,o),a),u)),n(t(e,c),r)}function l(e,r,i,s,a,c,u){return e=n(e,n(n(o(r,i,s),a),u)),n(t(e,c),r)}function d(e){var t,n,r="",i="";for(n=0;n<=3;n++)t=e>>>8*n&255,i="0"+t.toString(16),r+=i.substr(i.length-2,2);return r}var p,f,h,m,g,v,b,y,_,S=[];for(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e),S=function(e){for(var t,n=e.length,r=n+8,i=(r-r%64)/64,s=16*(i+1),o=Array(s-1),a=0,c=0;c<n;)t=(c-c%4)/4,a=c%4*8,o[t]=o[t]|e.charCodeAt(c)<<a,c++;return t=(c-c%4)/4,a=c%4*8,o[t]=o[t]|128<<a,o[s-2]=n<<3,o[s-1]=n>>>29,o}(e),v=1732584193,b=4023233417,y=2562383102,_=271733878,p=0;p<S.length;p+=16)f=v,h=b,m=y,g=_,v=a(v,b,y,_,S[p+0],7,3614090360),_=a(_,v,b,y,S[p+1],12,3905402710),y=a(y,_,v,b,S[p+2],17,606105819),b=a(b,y,_,v,S[p+3],22,3250441966),v=a(v,b,y,_,S[p+4],7,4118548399),_=a(_,v,b,y,S[p+5],12,1200080426),y=a(y,_,v,b,S[p+6],17,2821735955),b=a(b,y,_,v,S[p+7],22,4249261313),v=a(v,b,y,_,S[p+8],7,1770035416),_=a(_,v,b,y,S[p+9],12,2336552879),y=a(y,_,v,b,S[p+10],17,4294925233),b=a(b,y,_,v,S[p+11],22,2304563134),v=a(v,b,y,_,S[p+12],7,1804603682),_=a(_,v,b,y,S[p+13],12,4254626195),y=a(y,_,v,b,S[p+14],17,2792965006),b=a(b,y,_,v,S[p+15],22,1236535329),v=c(v,b,y,_,S[p+1],5,4129170786),_=c(_,v,b,y,S[p+6],9,3225465664),y=c(y,_,v,b,S[p+11],14,643717713),b=c(b,y,_,v,S[p+0],20,3921069994),v=c(v,b,y,_,S[p+5],5,3593408605),_=c(_,v,b,y,S[p+10],9,38016083),y=c(y,_,v,b,S[p+15],14,3634488961),b=c(b,y,_,v,S[p+4],20,3889429448),v=c(v,b,y,_,S[p+9],5,568446438),_=c(_,v,b,y,S[p+14],9,3275163606),y=c(y,_,v,b,S[p+3],14,4107603335),b=c(b,y,_,v,S[p+8],20,1163531501),v=c(v,b,y,_,S[p+13],5,2850285829),_=c(_,v,b,y,S[p+2],9,4243563512),y=c(y,_,v,b,S[p+7],14,1735328473),b=c(b,y,_,v,S[p+12],20,2368359562),v=u(v,b,y,_,S[p+5],4,4294588738),_=u(_,v,b,y,S[p+8],11,2272392833),y=u(y,_,v,b,S[p+11],16,1839030562),b=u(b,y,_,v,S[p+14],23,4259657740),v=u(v,b,y,_,S[p+1],4,2763975236),_=u(_,v,b,y,S[p+4],11,1272893353),y=u(y,_,v,b,S[p+7],16,4139469664),b=u(b,y,_,v,S[p+10],23,3200236656),v=u(v,b,y,_,S[p+13],4,681279174),_=u(_,v,b,y,S[p+0],11,3936430074),y=u(y,_,v,b,S[p+3],16,3572445317),b=u(b,y,_,v,S[p+6],23,76029189),v=u(v,b,y,_,S[p+9],4,3654602809),_=u(_,v,b,y,S[p+12],11,3873151461),y=u(y,_,v,b,S[p+15],16,530742520),b=u(b,y,_,v,S[p+2],23,3299628645),v=l(v,b,y,_,S[p+0],6,4096336452),_=l(_,v,b,y,S[p+7],10,1126891415),y=l(y,_,v,b,S[p+14],15,2878612391),b=l(b,y,_,v,S[p+5],21,4237533241),v=l(v,b,y,_,S[p+12],6,1700485571),_=l(_,v,b,y,S[p+3],10,2399980690),y=l(y,_,v,b,S[p+10],15,4293915773),b=l(b,y,_,v,S[p+1],21,2240044497),v=l(v,b,y,_,S[p+8],6,1873313359),_=l(_,v,b,y,S[p+15],10,4264355552),y=l(y,_,v,b,S[p+6],15,2734768916),b=l(b,y,_,v,S[p+13],21,1309151649),v=l(v,b,y,_,S[p+4],6,4149444226),_=l(_,v,b,y,S[p+11],10,3174756917),y=l(y,_,v,b,S[p+2],15,718787259),b=l(b,y,_,v,S[p+9],21,3951481745),v=n(v,f),b=n(b,h),y=n(y,m),_=n(_,g);return(d(v)+d(b)+d(y)+d(_)).toLowerCase()}},e.Utils=n}},function(e,t,n){"use strict";e.exports=function(e,t){var r;r={},r.MediaHandler=n(257)(e),r.MediaStreamManager=n(258)(e,t);var i;return r.isSupported=function(){return void 0!==i?i:(r.MediaStream=t.MediaStream,r.getUserMedia=t.getUserMedia,r.RTCPeerConnection=t.RTCPeerConnection,r.RTCSessionDescription=t.RTCSessionDescription,r.RTCPeerConnection&&r.RTCSessionDescription?(r.getUserMedia&&(r.getUserMedia=e.Utils.promisify(t,"getUserMedia")),i=!0):i=!1,i)},r}},function(e,t,n){"use strict";e.exports=function(e){var t=function(t,n){function r(e,t){e.mediaStreamManager.on&&e.mediaStreamManager.on(t,function(){e.emit.apply(e,[t].concat(Array.prototype.slice.call(arguments)))})}n=n||{},this.logger=t.ua.getLogger("sip.invitecontext.mediahandler",t.id),this.session=t,this.localMedia=null,this.ready=!0,this.mediaStreamManager=n.mediaStreamManager||new e.WebRTC.MediaStreamManager(this.logger),this.audioMuted=!1,this.videoMuted=!1,this.local_hold=!1,this.remote_hold=!1;var i=this.prepareIceServers(n.stunServers,n.turnServers);this.RTCConstraints=n.RTCConstraints||{},this.initPeerConnection(i),r(this,"userMediaRequest"),r(this,"userMedia"),r(this,"userMediaFailed")};return t.defaultFactory=function(e,n){return new t(e,n)},t.defaultFactory.isSupported=function(){return e.WebRTC.isSupported()},t.prototype=Object.create(e.MediaHandler.prototype,{isReady:{writable:!0,value:function(){return this.ready}},close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this._remoteStreams=[],this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.close(),this.localMedia&&this.mediaStreamManager.release(this.localMedia))}},getDescription:{writable:!0,value:function(t){var n=this,r=n.mediaStreamManager.acquire;r.length>1&&(r=e.Utils.promisify(this.mediaStreamManager,"acquire",!0)),t=t||{},!0===t.dataChannel&&(t.dataChannel={}),this.mediaHint=t;var i;return n.localMedia?(n.logger.log("already have local media"),i=e.Utils.Promise.resolve(n.localMedia)):(n.logger.log("acquiring local media"),i=r.call(n.mediaStreamManager,t).then(function(e){return n.logger.log("acquired local media streams"),n.localMedia=e,n.session.connecting(),e},function(e){throw n.logger.error("unable to acquire streams"),n.logger.error(e),n.session.connecting(),e}).then(this.addStreams.bind(this))),i.then(function(){return n.hasOffer("remote")?n.peerConnection.ondatachannel=function(e){n.dataChannel=e.channel,n.emit("dataChannel",n.dataChannel)}:t.dataChannel&&n.peerConnection.createDataChannel&&(n.dataChannel=n.peerConnection.createDataChannel("sipjs",t.dataChannel),n.emit("dataChannel",n.dataChannel)),n.render(),n.createOfferOrAnswer(n.RTCConstraints)}).then(function(t){return t=e.Hacks.Firefox.hasMissingCLineInSDP(t),n.local_hold&&(/a=(sendrecv|sendonly|recvonly|inactive)/.test(t)?(t=t.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),t=t.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):t=t.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n")),{body:t,contentType:"application/sdp"}})}},hasDescription:{writeable:!0,value:function(e){return"application/sdp"===e.getHeader("Content-Type")&&!!e.body}},setDescription:{writable:!0,value:function(t){var n=t.body;this.remote_hold=/a=(sendonly|inactive)/.test(n),n=e.Hacks.Firefox.cannotHandleExtraWhitespace(n),n=e.Hacks.AllBrowsers.maskDtls(n);var r={type:this.hasOffer("local")?"answer":"offer",sdp:n};this.emit("setDescription",r);var i=new e.WebRTC.RTCSessionDescription(r);return e.Utils.promisify(this.peerConnection,"setRemoteDescription")(i)}},getReferMedia:{writable:!0,value:function(){function e(e,t){return t[e]().length>0}function t(t){return this.getLocalStreams().some(e.bind(null,t))&&this.getRemoteStreams().some(e.bind(null,t))}return{constraints:{audio:t.call(this,"getAudioTracks"),video:t.call(this,"getVideoTracks")}}}},updateIceServers:{writeable:!0,value:function(e){var t=this.prepareIceServers(e.stunServers,e.turnServers);this.RTCConstraints=e.RTCConstraints||this.RTCConstraints,this.initPeerConnection(t)}},isMuted:{writable:!0,value:function(){return{audio:this.audioMuted,video:this.videoMuted}}},mute:{writable:!0,value:function(e){if(0!==this.getLocalStreams().length){e=e||{audio:this.getLocalStreams()[0].getAudioTracks().length>0,video:this.getLocalStreams()[0].getVideoTracks().length>0};var t=!1,n=!1;return e.audio&&!this.audioMuted&&(t=!0,this.audioMuted=!0,this.toggleMuteAudio(!0)),e.video&&!this.videoMuted&&(n=!0,this.videoMuted=!0,this.toggleMuteVideo(!0)),t||n?{audio:t,video:n}:void 0}}},unmute:{writable:!0,value:function(e){if(0!==this.getLocalStreams().length){e=e||{audio:this.getLocalStreams()[0].getAudioTracks().length>0,video:this.getLocalStreams()[0].getVideoTracks().length>0};var t=!1,n=!1;return e.audio&&this.audioMuted&&(t=!0,this.audioMuted=!1,this.toggleMuteAudio(!1)),e.video&&this.videoMuted&&(n=!0,this.videoMuted=!1,this.toggleMuteVideo(!1)),t||n?{audio:t,video:n}:void 0}}},hold:{writable:!0,value:function(){this.local_hold=!0,this.toggleMuteAudio(!0),this.toggleMuteVideo(!0)}},unhold:{writable:!0,value:function(){this.local_hold=!1,this.audioMuted||this.toggleMuteAudio(!1),this.videoMuted||this.toggleMuteVideo(!1)}},getLocalStreams:{writable:!0,value:function(){var e=this.peerConnection;return e&&"closed"===e.signalingState?(this.logger.warn("peerConnection is closed, getLocalStreams returning []"),[]):e.getLocalStreams&&e.getLocalStreams()||e.localStreams||[]}},getRemoteStreams:{writable:!0,value:function(){var e=this.peerConnection;return e&&"closed"===e.signalingState?(this.logger.warn("peerConnection is closed, getRemoteStreams returning this._remoteStreams"),this._remoteStreams):e.getRemoteStreams&&e.getRemoteStreams()||e.remoteStreams||[]}},render:{writable:!0,value:function(t){if(!(t=t||this.mediaHint&&this.mediaHint.render))return!1;var n={local:"getLocalStreams",remote:"getRemoteStreams"};Object.keys(n).forEach(function(r){var i=n[r],s=this[i]();e.WebRTC.MediaStreamManager.render(s,t[r])}.bind(this))}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}},prepareIceServers:{writable:!0,value:function(e,t){var n=[],r=this.session.ua.configuration;return e=e||r.stunServers,t=t||r.turnServers,[].concat(e).forEach(function(e){n.push({urls:e})}),[].concat(t).forEach(function(e){var t={urls:e.urls};e.username&&(t.username=e.username),e.password&&(t.credential=e.password),n.push(t)}),n}},initPeerConnection:{writable:!0,value:function(t){var n=this,r=this.session.ua.configuration;this.onIceCompleted=e.Utils.defer(),this.onIceCompleted.promise.then(function(t){n.emit("iceGatheringComplete",t),n.iceCheckingTimer&&(e.Timers.clearTimeout(n.iceCheckingTimer),n.iceCheckingTimer=null)}),this.peerConnection&&this.peerConnection.close();var i={iceServers:t};r.rtcpMuxPolicy&&(i.rtcpMuxPolicy=r.rtcpMuxPolicy),this.peerConnection=new e.WebRTC.RTCPeerConnection(i),this._remoteStreams=[],this.peerConnection.onaddstream=function(e){n.logger.log("stream added: "+e.stream.id),n._remoteStreams.push(e.stream),n.render(),n.emit("addStream",e)},this.peerConnection.onremovestream=function(e){n.logger.log("stream removed: "+e.stream.id)},this.startIceCheckingTimer=function(){n.iceCheckingTimer||(n.iceCheckingTimer=e.Timers.setTimeout(function(){n.logger.log("RTCIceChecking Timeout Triggered after "+r.iceCheckingTimeout+" milliseconds"),n.onIceCompleted.resolve(this)}.bind(this.peerConnection),r.iceCheckingTimeout))},this.peerConnection.onicecandidate=function(e){n.emit("iceCandidate",e),e.candidate?(n.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())),n.startIceCheckingTimer()):n.onIceCompleted.resolve(this)},this.peerConnection.onicegatheringstatechange=function(){n.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),"gathering"===this.iceGatheringState&&n.emit("iceGathering",this),"complete"===this.iceGatheringState&&n.onIceCompleted.resolve(this)},this.peerConnection.oniceconnectionstatechange=function(){var e;switch("checking"===this.iceConnectionState&&n.startIceCheckingTimer(),this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void n.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}n.emit(e,this)},this.peerConnection.onstatechange=function(){n.logger.log('PeerConnection state changed to "'+this.readyState+'"')}}},createOfferOrAnswer:{writable:!0,value:function(t){var n,r=this,i=r.peerConnection;return r.ready=!1,n=r.hasOffer("remote")?"createAnswer":"createOffer",e.Utils.promisify(i,n,!0)(t).then(e.Utils.promisify(i,"setLocalDescription")).then(function(){var t=e.Utils.defer();return"complete"!==i.iceGatheringState||"connected"!==i.iceConnectionState&&"completed"!==i.iceConnectionState?r.onIceCompleted.promise.then(t.resolve):t.resolve(),t.promise}).then(function(){var t=i.localDescription.sdp;t=e.Hacks.Chrome.needsExplicitlyInactiveSDP(t),t=e.Hacks.AllBrowsers.unmaskDtls(t);var s={type:"createOffer"===n?"offer":"answer",sdp:t};return r.emit("getDescription",s),r.session.ua.configuration.hackStripTcp&&(s.sdp=s.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,"")),r.ready=!0,s.sdp}).catch(function(t){throw r.logger.error(t),r.ready=!0,new e.Exceptions.GetDescriptionError(t)})}},addStreams:{writable:!0,value:function(t){try{t=[].concat(t),t.forEach(function(e){this.peerConnection.addStream(e)},this)}catch(t){return this.logger.error("error adding stream"),this.logger.error(t),e.Utils.Promise.reject(t)}return e.Utils.Promise.resolve()}},toggleMuteHelper:{writable:!0,value:function(e,t){this.getLocalStreams().forEach(function(n){n[e]().forEach(function(e){e.enabled=!t})})}},toggleMuteAudio:{writable:!0,value:function(e){this.toggleMuteHelper("getAudioTracks",e)}},toggleMuteVideo:{writable:!0,value:function(e){this.toggleMuteHelper("getVideoTracks",e)}}}),t}},function(e,t,n){"use strict";e.exports=function(e,t){var n=function(t,n){if(!e.WebRTC.isSupported())throw new e.Exceptions.NotSupportedError("Media not supported");this.mediaHint=n||{constraints:{audio:!0,video:!0}},this.acquisitions={}};return n.streamId=function(e){return e.getAudioTracks().concat(e.getVideoTracks()).map(function(e){return e.id}).join("")},n.render=function(n,r){function i(e,t){e.srcObject=t}function s(t){t.ensurePlayingIntervalId=e.Timers.setInterval(function(){t.paused&&t.srcObject?t.play():e.Timers.clearInterval(t.ensurePlayingIntervalId)},100)}function o(e,n,r){var o=e[r%e.length];"function"==typeof o&&(o=o()),(t.attachMediaStream||i)(o,n),s(o)}if(!r)return!1;if(Array.isArray(r)&&!r.length)throw new TypeError("elements must not be empty");r=[].concat(r),[].concat(n).forEach(o.bind(null,r))},n.prototype=Object.create(e.EventEmitter.prototype,{acquire:{writable:!0,value:function(t){t=Object.keys(t||{}).length?t:this.mediaHint;var r=function(t,r){return r=[].concat(r),r.forEach(function(e){var r=n.streamId(e);this.acquisitions[r]=!!t},this),e.Utils.Promise.resolve(r)}.bind(this);if(t.stream)return r(!0,t.stream);var i=t.constraints||this.mediaHint&&this.mediaHint.constraints||{audio:!0,video:!0},s=e.Utils.defer();return e.Timers.setTimeout(function(){this.emit("userMediaRequest",i);var t=function(e,t){var n=Array.prototype.slice.call(arguments,2),r=[e].concat(n);return this.emit.apply(this,r),t.apply(null,n)}.bind(this);i.audio||i.video?s.resolve(e.WebRTC.getUserMedia(i).then(t.bind(this,"userMedia",r.bind(null,!1)),t.bind(this,"userMediaFailed",function(e){throw e}))):s.resolve([])}.bind(this),0),s.promise}},release:{writable:!0,value:function(e){e=[].concat(e),e.forEach(function(e){var t=n.streamId(e);!1===this.acquisitions[t]&&e.getTracks().forEach(function(e){e.stop()}),delete this.acquisitions[t]},this)}}}),n}},function(e,t,n){"use strict";(function(t){function r(e,t){if(null!=e){var n=t.charAt(0).toUpperCase()+t.slice(1),r=[t,"webkit"+n,"moz"+n];for(var i in r){var s=e[r[i]];if(s)return s.bind(e)}}}var i=t.window||t;e.exports={WebSocket:i.WebSocket,Transport:n(252),open:i.open,Promise:i.Promise,timers:i,console:i.console||{debug:function(){},log:function(){},warn:function(){},error:function(){}},MediaStream:r(i,"MediaStream"),getUserMedia:r(i.navigator,"getUserMedia"),RTCPeerConnection:r(i,"RTCPeerConnection"),RTCSessionDescription:r(i,"RTCSessionDescription"),addEventListener:r(i,"addEventListener"),HTMLMediaElement:i.HTMLMediaElement,attachMediaStream:i.attachMediaStream,createObjectURL:i.URL&&i.URL.createObjectURL,revokeObjectURL:i.URL&&i.URL.revokeObjectURL}}).call(t,n(3))},function(e,t,n){"use strict";function r(e,t,n){var r;return Promise.race([e,new Promise(function(e,i){r=setTimeout(function(){i({id:t,type:"error",error:{condition:"timeout"}})},n)})]).then(function(e){return clearTimeout(r),e})}function i(e){var t=this;u.call(this),e=e||{},this._initConfig(e),this.stanzas=c.getGlobalJXT(),this.jid=new p,this.stanzas=c.createRegistry(),this.stanzas.use(n(88)),this.stanzas.use(n(115)),this.use(n(278)),this.use(n(306)),this.use(n(309)),this.use(n(263)),this.use(n(307)),this.sm=new f(this),this.transports={},this.on("stream:data",function(e){var n=e.toJSON();if("iq"===e._name&&(n._xmlChildCount=0,s(e.xml.childNodes,function(e){1===e.nodeType&&(n._xmlChildCount+=1)})),t.emit(e._eventname||e._name,n),"message"===e._name||"presence"===e._name||"iq"===e._name)t.sm.handle(n),t.emit("stanza",n);else{if("smAck"===e._name)return t.sm.process(n);if("smRequest"===e._name)return t.sm.ack()}n.id&&(t.emit("id:"+n.id,n),t.emit(e._name+":id:"+n.id,n))}),this.on("disconnected",function(){t.transport&&(t.transport.off("*"),delete t.transport),t.releaseGroup("connection")}),this.on("iq",function(e){var n=e.type,r=e._xmlChildCount;delete e._xmlChildCount;var i=Object.keys(e).filter(function(e){return"id"!==e&&"to"!==e&&"from"!==e&&"lang"!==e&&"type"!==e&&"errorReply"!==e&&"resultReply"!==e});if("get"===e.type||"set"===e.type){if(1!==r)return t.sendIq(e.errorReply({error:{type:"modify",condition:"bad-request"}}));if(!i.length)return t.sendIq(e.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}));var s="iq:"+n+":"+i[0];t.callbacks[s]?t.emit(s,e):t.sendIq(e.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}))}}),this.on("message",function(e){Object.keys(e.$body||{}).length&&("chat"===e.type||"normal"===e.type?t.emit("chat",e):"groupchat"===e.type&&t.emit("groupchat",e)),"error"===e.type&&t.emit("message:error",e)}),this.on("presence",function(e){var n=e.type||"available";"error"===n&&(n="presence:error"),t.emit(n,e)})}var s=n(13),o=n(12),a=n(14),c=n(28),u=n(9),l=n(6),d=n(36),p=n(5).JID,f=n(314),h=n(80),m=n(215),g={external:n(206),"scram-sha-1":n(209),"digest-md5":n(69),"x-oauth2":n(213),plain:n(208),anonymous:n(204)};l.inherits(i,u),Object.defineProperty(i.prototype,"stream",{get:function(){return this.transport?this.transport.stream:void 0}}),i.prototype._initConfig=function(e){var t=this,n=this.config||{};this.config=o({useStreamManagement:!0,transports:["websocket","bosh"],sasl:["external","scram-sha-1","digest-md5","plain","anonymous"]},n,e),a(this.config.sasl)||(this.config.sasl=[this.config.sasl]),this.SASLFactory=new m,this.config.sasl.forEach(function(e){if("string"==typeof e){var n=g[e.toLowerCase()];n&&t.SASLFactory.use(n)}else t.SASLFactory.use(e)}),this.config.jid=new p(this.config.jid),this.config.server||(this.config.server=this.config.jid.domain),this.config.password&&(this.config.credentials=this.config.credentials||{},this.config.credentials.password=this.config.password,delete this.config.password),this.config.transport&&(this.config.transports=[this.config.transport]),a(this.config.transports)||(this.config.transports=[this.config.transports])},i.prototype.use=function(e){e(this,this.stanzas,this.config)},i.prototype.nextId=function(){return d.v4()},i.prototype.discoverBindings=function(e,t){h(e,function(e,n){if(e)return t(e,[]);var r={websocket:[],bosh:[]};(n.links||[]).forEach(function(e){e.href&&"urn:xmpp:alt-connections:websocket"===e.rel&&r.websocket.push(e.href),e.href&&"urn:xmpp:altconnect:websocket"===e.rel&&r.websocket.push(e.href),e.href&&"urn:xmpp:alt-connections:xbosh"===e.rel&&r.bosh.push(e.href),e.href&&"urn:xmpp:altconnect:bosh"===e.rel&&r.bosh.push(e.href)}),t(!1,r)})},i.prototype._getConfiguredCredentials=function(){var e=this.config.credentials||{},t=new p(this.config.jid),n=e.username||t.local,r=e.server||t.domain,i={username:n,password:this.config.password,server:r,host:r,realm:r,serviceType:"xmpp",serviceName:r};return o(i,e)},i.prototype.getCredentials=function(e){return e(null,this._getConfiguredCredentials())},i.prototype.connect=function(e,t){var r=this;if(this._initConfig(e),t||1!==r.config.transports.length||(t={},t.name=r.config.transports[0]),t&&t.name){"websocket"!==t.name&&"old-websocket"!==t.name||(this.use(n(313)),this.use(n(294))),"bosh"===t.name&&this.use(n(267));var i=r.transport=new r.transports[t.name](r.sm,r.stanzas);return i.on("*",function(e,t){r.emit(e,t)}),i.connect(r.config)}return r.discoverBindings(r.config.server,function(e,t){if(e)return console.error("Could not find https://"+r.config.server+"/.well-known/host-meta file to discover connection endpoints for the requested transports."),r.disconnect();for(var n=0,i=r.config.transports.length;n<i;n++){var s=r.config.transports[n];console.log("Checking for %s endpoints",s);for(var o=0,a=(t[s]||[]).length;o<a;o++){var c=t[s][o];if(0===c.indexOf("wss://")||0===c.indexOf("https://"))return"websocket"===s?r.config.wsURL=c:r.config.boshURL=c,console.log("Using %s endpoint: %s",s,c),r.connect(null,{name:s,url:c});console.warn("Discovered unencrypted %s endpoint (%s). Ignoring",s,c)}}return console.error("No endpoints found for the requested transports."),r.disconnect()})},i.prototype.disconnect=function(){this.sessionStarted&&(this.releaseGroup("session"),this.sm.started||this.emit("session:end")),this.sessionStarted=!1,this.releaseGroup("connection"),this.transport?this.transport.disconnect():this.emit("disconnected")},i.prototype.send=function(e){this.sm.track(e),this.transport&&this.transport.send(e)},i.prototype.sendMessage=function(e){e=e||{},e.id||(e.id=this.nextId());var t=this.stanzas.getMessage(),n=new t(e);return this.emit("message:sent",n.toJSON()),this.send(n),e.id},i.prototype.sendPresence=function(e){e=e||{},e.id||(e.id=this.nextId());var t=this.stanzas.getPresence();return this.send(new t(e)),e.id},i.prototype.sendIq=function(e,t){var n,i,s,o,a=this;e=e||{},e.id||(e.id=this.nextId());var c=this.stanzas.getIq(),u=e.toJSON?e:new c(e);return"error"===e.type||"result"===e.type?void this.send(u):(o=new p(e.to),s={},s[""]=!0,s[o.full]=!0,s[o.bare]=!0,s[o.domain]=!0,s[a.jid.bare]=!0,s[a.jid.domain]=!0,i="iq:id:"+e.id,n=new Promise(function(e,t){var n=function(r){s[r.from.full]&&("result"!==r.type&&"error"!==r.type||(a.off(i,n),r.error?t(r):e(r)))};a.on(i,"session",n)}),this.send(u),r(n,e.id,1e3*(a.config.timeout||15)).then(function(e){return t&&t(null,e),e},function(e){if(t)return t(e);throw e}))},i.prototype.sendStreamError=function(e){e=e||{};var t=this.stanzas.getStreamError(),n=new t(e);this.emit("stream:error",n.toJSON()),this.send(n),this.disconnect()},e.exports=i},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:attention:0"),e.getAttention=function(t,n){n=n||{},n.to=t,n.type="headline",n.attention=!0,e.sendMessage(n)},e.on("message",function(t){t.attention&&e.emit("attention",t)})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:avatar:metadata+notify"),e.on("pubsub:event",function(t){t.event.updated&&"urn:xmpp:avatar:metadata"===t.event.updated.node&&e.emit("avatar",{jid:t.from,source:"pubsub",avatars:t.event.updated.published[0].avatars})}),e.on("presence",function(t){t.avatarId&&e.emit("avatar",{jid:t.from,source:"vcard",avatars:[{id:t.avatarId}]})}),e.publishAvatar=function(e,t,n){return this.publish("","urn:xmpp:avatar:data",{id:e,avatarData:t},n)},e.useAvatars=function(e,t){return this.publish("","urn:xmpp:avatar:metadata",{id:"current",avatars:e},t)},e.getAvatar=function(e,t,n){return this.getItem(e,"urn:xmpp:avatar:data",t,n)}}},function(e,t,n){"use strict";var r=n(5).JID;e.exports=function(e,t,n){e.registerFeature("bind",300,function(e,t){var r=this;r.sendIq({type:"set",bind:{resource:n.resource}},function(n,i){if(n)return r.emit("session:error",n),t("disconnect","JID binding failed");r.features.negotiated.bind=!0,r.emit("session:prebind",i.bind.jid);var s=!e.session||e.session&&e.session.optional;return!r.sessionStarted&&s&&r.emit("session:started",r.jid),t()})}),e.on("session:started",function(){e.sessionStarted=!0}),e.on("session:prebind",function(t){e.jid=new r(t),e.emit("session:bound",e.jid)}),e.on("disconnected",function(){e.sessionStarted=!1,e.features.negotiated.bind=!1})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:blocking"),e.block=function(t,n){return e.sendIq({type:"set",block:{jids:[t]}},n)},e.unblock=function(t,n){return e.sendIq({type:"set",unblock:{jids:[t]}},n)},e.getBlocked=function(t){return e.sendIq({type:"get",blockList:!0},t)},e.on("iq:set:block",function(t){e.emit("block",{jids:t.block.jids||[]}),e.sendIq(t.resultReply())}),e.on("iq:set:unblock",function(t){e.emit("unblock",{jids:t.unblock.jids||[]}),e.sendIq(t.resultReply())})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:bob"),e.getBits=function(t,n,r){return e.sendIq({to:t,type:"get",bob:{cid:n}},r)}}},function(e,t,n){"use strict";var r=n(12),i=n(47),s=n(5).JID;e.exports=function(e){e.getBookmarks=function(e){return this.getPrivateData({bookmarks:!0},e)},e.setBookmarks=function(e,t){return this.setPrivateData({bookmarks:e},t)},e.addBookmark=function(t,n){return t.jid=new s(t.jid),this.getBookmarks().then(function(n){var s=n.privateStorage.bookmarks.conferences||[],o=i(s,function(e){return e.jid.bare===t.jid.bare});return o.length?r(o[0],t):s.push(t),e.setBookmarks({conferences:s})}).then(function(e){return n&&n(null,e),e},function(e){if(!n)throw e;n(e)})},e.removeBookmark=function(t,n){return t=new s(t),this.getBookmarks().then(function(n){var r=n.privateStorage.bookmarks.conferences||[];return r=i(r,function(e){return t.bare!==e.jid.bare}),e.setBookmarks({conferences:r})}).then(function(e){n&&n(null,e)},function(e){if(!n)throw e;n(e)})}}},function(e,t,n){"use strict";var r=n(315);e.exports=function(e){e.transports.bosh=r}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:carbons:2"),e.enableCarbons=function(e){return this.sendIq({type:"set",enableCarbons:!0},e)},e.disableCarbons=function(e){return this.sendIq({type:"set",disableCarbons:!0},e)},e.on("message",function(t){return t.carbonSent?e.emit("carbon:sent",t):t.carbonReceived?e.emit("carbon:received",t):void 0}),e.on("carbon:*",function(t,n){var r=t.split(":")[1];if(n.from.bare===e.jid.bare){var i,s;"received"===r?(i=n.carbonReceived.forwarded.message,s=n.carbonReceived.forwarded.delay):(i=n.carbonSent.forwarded.message,s=n.carbonSent.forwarded.delay),i.delay||(i.delay={stamp:s?s.stamp:new Date(Date.now())}),i.carbon=!0,i.from.bare===e.jid.bare?e.emit("message:sent",i):e.emit("message",i)}})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("http://jabber.org/protocol/chatstates"),e.on("message",function(t){t.chatState&&(e.emit("chat:state",{to:t.to,from:t.from,chatState:t.chatState}),e.emit("chatState",{to:t.to,from:t.from,chatState:t.chatState}))})}},function(e,t,n){"use strict";var r="http://jabber.org/protocol/commands";e.exports=function(e){e.disco.addFeature(r),e.disco.addItem({name:"Ad-Hoc Commands",node:r}),e.getCommands=function(t,n){return e.getDiscoItems(t,r,n)}}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:message-correct:0"),e.on("message",function(t){t.replace&&(e.emit("replace",t),e.emit("replace:"+t.id,t))})}},function(e,t,n){"use strict";e.exports=function(e,t){var n=t.getDefinition("active","urn:xmpp:csi"),r=t.getDefinition("inactive","urn:xmpp:csi");e.registerFeature("clientStateIndication",400,function(e,t){this.features.negotiated.clientStateIndication=!0,t()}),e.markActive=function(){this.features.negotiated.clientStateIndication&&this.send(new n)},e.markInactive=function(){this.features.negotiated.clientStateIndication&&this.send(new r)}}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("jabber:x:data"),e.disco.addFeature("urn:xmpp:media-element"),e.disco.addFeature("http://jabber.org/protocol/xdata-validate"),e.disco.addFeature("http://jabber.org/protocol/xdata-layout"),e.on("message",function(t){t.form&&e.emit("dataform",t)})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:delay")}},function(e,t,n){"use strict";(function(t){function r(e,n){var r="",i=e.features.sort(),s=[],c={},l=[];o(e.identities,function(e){s.push([e.category||"",e.type||"",e.lang||"",e.name||""].join("/"))}),s.sort();var d=s.length,p=i.length;if(s=a(s,!0),i=a(i,!0),p!==i.length||d!==s.length)return!1;r+=s.join("<")+"<",r+=i.join("<")+"<";var f=!1;if(o(e.extensions,function(e){for(var t=e.fields,n=0,r=t.length;n<r;n++)if("FORM_TYPE"===t[n].name&&"hidden"===t[n].type){var i=t[n].value;return c[i]?void(f=!0):(c[i]=e,void l.push(i))}}),f)return!1;l.sort(),o(l,function(e){var t=c[e],n={},i=[];r+="<"+e,o(t.fields,function(e){var t=e.name;if("FORM_TYPE"!==t){var r=e.value||"";"object"!=typeof r&&(r=r.split("\n")),n[t]=r.sort(),i.push(t)}}),i.sort(),o(i,function(e){r+="<"+e,o(n[e],function(e){r+="<"+e})})});var h=u.createHash(n).update(new t(r,"utf8")).digest("base64"),m=4-h.length%4;4===m&&(m=0);for(var g=0;g<m;g++)h+="=";return h}function i(e,t,n){var i=r(e,t);return i&&i===n}function s(){this.features={},this.identities={},this.extensions={},this.items={},this.caps={}}var o=n(13),a=n(187),c=n(5).JID,u=n(25);s.prototype={constructor:{value:s},addFeature:function(e,t){t=t||"",this.features[t]||(this.features[t]=[]),this.features[t].push(e)},addIdentity:function(e,t){t=t||"",this.identities[t]||(this.identities[t]=[]),this.identities[t].push(e)},addItem:function(e,t){t=t||"",this.items[t]||(this.items[t]=[]),this.items[t].push(e)},addExtension:function(e,t){t=t||"",this.extensions[t]||(this.extensions[t]=[]),this.extensions[t].push(e)}},e.exports=function(e){e.disco=new s(e),e.disco.addFeature("http://jabber.org/protocol/disco#info"),e.disco.addFeature("http://jabber.org/protocol/disco#items"),e.disco.addIdentity({category:"client",type:"web"}),e.registerFeature("caps",100,function(t,n){this.emit("disco:caps",{from:new c(e.jid.domain||e.config.server),caps:t.caps}),this.features.negotiated.caps=!0,n()}),e.getDiscoInfo=function(e,t,n){return this.sendIq({to:e,type:"get",discoInfo:{node:t}},n)},e.getDiscoItems=function(e,t,n){return this.sendIq({to:e,type:"get",discoItems:{node:t}},n)},e.updateCaps=function(){var t=this.config.capsNode||"https://stanza.io",n=JSON.parse(JSON.stringify({identities:this.disco.identities[""],features:this.disco.features[""],extensions:this.disco.extensions[""]})),i=r(n,"sha-1");return this.disco.caps={node:t,hash:"sha-1",ver:i},t=t+"#"+i,this.disco.features[t]=n.features,this.disco.identities[t]=n.identities,this.disco.extensions[t]=n.extensions,e.getCurrentCaps()},e.getCurrentCaps=function(){var t=e.disco.caps;if(!t.ver)return{ver:null,discoInfo:null};var n=t.node+"#"+t.ver;return{ver:t.ver,discoInfo:{identities:e.disco.identities[n],features:e.disco.features[n],extensions:e.disco.extensions[n]}}},e.on("presence",function(t){t.caps&&e.emit("disco:caps",t)}),e.on("iq:get:discoInfo",function(t){var n=t.discoInfo.node||"",r=t.discoInfo.node||"";n===e.disco.caps.node+"#"+e.disco.caps.ver&&(r=n,n=""),e.sendIq(t.resultReply({discoInfo:{node:r,identities:e.disco.identities[n]||[],features:e.disco.features[n]||[],extensions:e.disco.extensions[n]||[]}}))}),e.on("iq:get:discoItems",function(t){var n=t.discoItems.node;e.sendIq(t.resultReply({discoItems:{node:n,items:e.disco.items[n]||[]}}))}),e.verifyVerString=i,e.generateVerString=r,e.updateCaps()}}).call(t,n(1).Buffer)},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("jid\\20escaping")}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:extdisco:1"),e.getServices=function(e,t,n){return this.sendIq({type:"get",to:e,services:{type:t}},n)},e.getServiceCredentials=function(e,t,n){return this.sendIq({type:"get",to:e,credentials:{service:{host:t}}},n)}}},function(e,t,n){"use strict";var r=n(19);e.exports=function(e){e.features={negotiated:{},order:[],handlers:{}},e.registerFeature=function(t,n,r){this.features.order.push({priority:n,name:t}),this.features.order.sort(function(e,t){return e.priority<t.priority?-1:e.priority>t.priority?1:0}),this.features.handlers[t]=r.bind(e)},e.on("streamFeatures",function(t){var n=[],i=e.features.negotiated,s=e.features.handlers;e.features.order.forEach(function(e){var r=e.name;t[r]&&s[r]&&!i[r]&&n.push(function(e){i[r]?e():s[r](t,e)})}),r.series(n,function(t,n){"restart"===t?e.transport.restart():"disconnect"===t&&(e.emit("stream:error",{condition:"policy-violation",text:"Failed to negotiate stream features: "+n}),e.disconnect())})})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:forward:0")}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("http://jabber.org/protocol/geoloc"),e.disco.addFeature("http://jabber.org/protocol/geoloc+notify"),e.on("pubsub:event",function(t){t.event.updated&&"http://jabber.org/protocol/geoloc"===t.event.updated.node&&e.emit("geoloc",{jid:t.from,geoloc:t.event.updated.published[0].geoloc})}),e.publishGeoLoc=function(e,t){return this.publish("","http://jabber.org/protocol/geoloc",{geoloc:e},t)}}},function(e,t,n){"use strict";var r=n(25);e.exports=function(e){e.disco.addFeature("urn:xmpp:hashes:1"),r.getHashes().forEach(function(t){e.disco.addFeature("urn:xmpp:hash-function-text-names:"+t)})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:idle:1")}},function(e,t,n){"use strict";e.exports=function(e){e.use(n(275)),e.use(n(261)),e.use(n(262)),e.use(n(264)),e.use(n(265)),e.use(n(266)),e.use(n(268)),e.use(n(269)),e.use(n(270)),e.use(n(271)),e.use(n(272)),e.use(n(273)),e.use(n(274)),e.use(n(276)),e.use(n(277)),e.use(n(279)),e.use(n(280)),e.use(n(281)),e.use(n(282)),e.use(n(284)),e.use(n(285)),e.use(n(286)),e.use(n(287)),e.use(n(288)),e.use(n(289)),e.use(n(290)),e.use(n(292)),e.use(n(291)),e.use(n(293)),e.use(n(295)),e.use(n(296)),e.use(n(297)),e.use(n(298)),e.use(n(299)),e.use(n(300)),e.use(n(301)),e.use(n(302)),e.use(n(303)),e.use(n(304)),e.use(n(305)),e.use(n(308)),e.use(n(310)),e.use(n(311)),e.use(n(312))}},function(e,t,n){"use strict";e.exports=function(e){e.goInvisible=function(e){return this.sendIq({type:"set",invisible:!0},e)},e.goVisible=function(e){return this.sendIq({type:"set",visible:!0},e)}}},function(e,t,n){"use strict";e.exports=function(e){e.prepJID=function(t,n){return e.sendIq({to:e.jid.domain,type:"get",jidPrep:t},n)}}},function(e,t,n){"use strict";(function(t){var r=n(87),i=i||t;e.exports=function(e){var t=e.jingle=new r;if(e.disco.addFeature("urn:xmpp:jingle:1"),i.RTCPeerConnection){["urn:xmpp:jingle:apps:rtp:1","urn:xmpp:jingle:apps:rtp:audio","urn:xmpp:jingle:apps:rtp:video","urn:xmpp:jingle:apps:rtp:rtcb-fb:0","urn:xmpp:jingle:apps:rtp:rtp-hdrext:0","urn:xmpp:jingle:apps:rtp:ssma:0","urn:xmpp:jingle:apps:dtls:0","urn:xmpp:jingle:apps:grouping:0","urn:xmpp:jingle:apps:file-transfer:3","urn:xmpp:jingle:transports:ice-udp:1","urn:xmpp:jingle:transports.dtls-sctp:1","urn:ietf:rfc:3264","urn:ietf:rfc:5576","urn:ietf:rfc:5888"].forEach(function(t){e.disco.addFeature(t)})}["outgoing","incoming","accepted","terminated","ringing","mute","unmute","hold","resumed"].forEach(function(n){t.on(n,function(t,r){e.emit("jingle:"+n,t,r)})}),t.on("createdSession",function(t){e.emit("jingle:created",t)}),t.on("peerStreamAdded",function(t,n){e.emit("jingle:remotestream:added",t,n)}),t.on("peerStreamRemoved",function(t,n){e.emit("jingle:remotestream:removed",t,n)}),t.on("send",function(t){e.sendIq(t,function(t){t&&e.emit("jingle:error",t)})}),e.on("session:bound",function(e){t.jid=e,t.selfID=e.full}),e.on("iq:set:jingle",function(e){t.process(e)}),e.on("unavailable",function(e){var n=e.from.full;t.endPeerSessions(n,!0)}),e.discoverICEServers=function(t){return this.getServices(e.config.server).then(function(t){for(var n=t.services.services,r=[],i=0;i<n.length;i++){var s=n[i],o={};"stun"===s.type||"stuns"===s.type?(o.urls=s.type+":"+s.host,s.port&&(o.urls+=":"+s.port),r.push(o),e.jingle.addICEServer(o)):"turn"!==s.type&&"turns"!==s.type||(o.urls=s.type+":"+s.host,s.port&&(o.urls+=":"+s.port),s.transport&&"udp"!==s.transport&&(o.urls+="?transport="+s.transport),s.username&&(o.username=s.username),s.password&&(o.credential=s.password),r.push(o),e.jingle.addICEServer(o))}return r}).then(function(e){return t&&t(null,e),e},function(e){if(!t)throw e;t(e)})}}}).call(t,n(3))},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:json:0")}},function(e,t,n){"use strict";function r(e,t){var n;return Promise.race([e,new Promise(function(e,r){n=setTimeout(function(){r()},t)})]).then(function(e){return clearTimeout(n),e})}function i(e,t){return r(new Promise(function(t,n){e.sm.started?(e.once("stream:management:ack",t),e.sm.request()):e.ping().then(t).catch(function(e){e.error&&"timeout"!==e.error.condition?t():n()})}),1e3*t||15e3)}e.exports=function(e){e.enableKeepAlive=function(t){function n(){e.sessionStarted&&i(e,t.timeout).catch(function(){e.emit("stream:error",{condition:"connection-timeout",text:"Server did not respond in "+t.timeout+" seconds"}),e.transport&&(e.transport.hasStream=!1,e.transport.disconnect())})}t=t||{},t.interval=t.interval||300,t.timeout=t.timeout||15,e._keepAliveInterval=setInterval(n,1e3*t.interval)},e.disableKeepAlive=function(){e._keepAliveInterval&&(clearInterval(e._keepAliveInterval),delete e._keepAliveInterval)},e.on("disconnected",function(){e.disableKeepAlive()})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("","urn:xmpp:eventlog"),e.sendLog=function(t,n){e.sendMessage({to:t,type:"normal",log:n})}}},function(e,t,n){"use strict";function r(e,t,n){var r;return Promise.race([e,new Promise(function(e,i){r=setTimeout(function(){i({id:t,type:"error",error:{condition:"timeout"}})},n)})]).then(function(e){return clearTimeout(r),e})}var i=n(5).JID;e.exports=function(e){e.disco.addFeature("urn:xmpp:mam:0"),e.getHistorySearchForm=function(t,n){return e.sendIq({to:t,type:"get",mam:!0},n)},e.searchHistory=function(t,n){var s=this,o=this.nextId();t=t||{},t.queryid=o;var a=t.jid||t.to||"";delete t.jid,delete t.to,t.form||(t.form={}),t.form.type="submit";var c=t.form.fields=t.form.fields||[];["FORM_TYPE","with","start","end"].forEach(function(e){if(t[e]||"FORM_TYPE"===e){var n=t[e];("start"===e||"end"===e)&&"string"!=typeof n&&(n=n.toISOString()),"FORM_TYPE"===e&&(n="urn:xmpp:mam:0");for(var r=0,i=c.length;r<i;r++)c[r].name;c.push({name:e,value:n}),delete t[e]}});var u=new i(a||e.jid.bare),l={};l[""]=!0,l[u.full]=!0,l[u.bare]=!0,l[u.domain]=!0,l[e.jid.bare]=!0,l[e.jid.domain]=!0;var d=[];this.on("mam:item:"+o,"session",function(e){l[e.from.full]&&d.push(e.mamItem)});var p=new Promise(function(e){s.once("mam:result:"+o,"session",function(t){l[t.from.full]&&(t.mamResult.items=d,e(t))})}),f=this.sendIq({type:"set",to:a,id:o,mam:t});r(Promise.all([f,p]),o,1e3*s.config.timeout||15e3).then(function(e){var t=e[1];return s.off("mam:item:"+o),s.off("mam:result:"+o),n&&n(null,t),t},function(e){if(s.off("mam:item:"+o),s.off("mam:result:"+o),!n)throw e;n(e)})},e.getHistoryPreferences=function(e){return this.sendIq({type:"get",mamPrefs:!0},e)},e.setHistoryPreferences=function(e,t){return this.sendIq({type:"set",mamPrefs:e},t)},e.on("message",function(t){t.mamItem&&e.emit("mam:item:"+t.mamItem.queryid,t),t.mamResult&&e.emit("mam:result:"+t.mamResult.queryid,t)})}},function(e,t,n){"use strict";var r="http://jabber.org/protocol/mood";e.exports=function(e){e.disco.addFeature(r),e.disco.addFeature(r+"+notify"),e.on("pubsub:event",function(t){t.event.updated&&t.event.updated.node===r&&e.emit("mood",{jid:t.from,mood:t.event.updated.published[0].mood})}),e.publishMood=function(e,t,n){return this.publish("",r,{mood:{value:e,text:t}},n)}}},function(e,t,n){"use strict";var r=n(13),i=n(5).JID;e.exports=function(e){function t(){r(e.joiningRooms,function(t,n){delete e.joiningRooms[n],e.joinRoom(n,t)}),r(e.joinedRooms,function(t,n){delete e.joinedRooms[n],e.joinRoom(n,t)})}e.disco.addFeature("http://jabber.org/protocol/muc"),e.disco.addFeature("jabber:x:conference"),e.disco.addFeature("urn:xmpp:hats:0"),e.joinedRooms={},e.joiningRooms={},e.on("session:started",t),e.on("stream:management:resumed",t),e.on("message",function(t){t.muc?(t.muc.invite&&e.emit("muc:invite",{from:t.muc.invite.from,room:t.from,reason:t.muc.invite.reason,password:t.muc.password,thread:t.muc.invite.thread,type:"mediated"}),t.muc.decline&&e.emit("muc:declined",{room:t.from,from:t.muc.decline.from,reason:t.muc.decline.reason})):t.mucInvite&&e.emit("muc:invite",{from:t.from,room:t.mucInvite.jid,reason:t.mucInvite.reason,password:t.mucInvite.password,thread:t.mucInvite.thread,type:"direct"}),"groupchat"===t.type&&t.subject&&e.emit("muc:subject",t)}),e.on("presence",function(t){if(e.joiningRooms[t.from.bare]&&"error"===t.type)delete e.joiningRooms[t.from.bare],e.emit("muc:failed",t),e.emit("muc:error",t);else if(t.muc){var n=t.muc.codes&&t.muc.codes.indexOf("110")>=0;"error"===t.type?e.emit("muc:error",t):"unavailable"===t.type?(e.emit("muc:unavailable",t),n&&(e.emit("muc:leave",t),delete e.joinedRooms[t.from.bare]),t.muc.destroyed&&e.emit("muc:destroyed",{room:t.from,newRoom:t.muc.destroyed.jid,reason:t.muc.destroyed.reason,password:t.muc.destroyed.password})):(e.emit("muc:available",t),n&&!e.joinedRooms[t.from.bare]&&(e.emit("muc:join",t),delete e.joiningRooms[t.from.bare],e.joinedRooms[t.from.bare]=t.from.resource))}}),e.joinRoom=function(e,t,n){n=n||{},n.to=e+"/"+t,n.caps=this.disco.caps,n.joinMuc=n.joinMuc||{},this.joiningRooms[e]=t,this.sendPresence(n)},e.leaveRoom=function(e,t,n){n=n||{},n.to=e+"/"+t,n.type="unavailable",this.sendPresence(n)},e.ban=function(t,n,r,i){e.setRoomAffiliation(t,n,"outcast",r,i)},e.kick=function(t,n,r,i){e.setRoomRole(t,n,"none",r,i)},e.invite=function(t,n){e.sendMessage({to:t,muc:{invites:n}})},e.directInvite=function(t,n){n.jid=t,e.sendMessage({to:n.to,mucInvite:n})},e.declineInvite=function(t,n,r){e.sendMessage({to:t,muc:{decline:{to:n,reason:r}}})},e.changeNick=function(t,n){e.sendPresence({to:new i(t).bare+"/"+n})},e.setSubject=function(t,n){e.sendMessage({to:t,type:"groupchat",subject:n})},e.discoverReservedNick=function(t,n){e.getDiscoInfo(t,"x-roomuser-item",function(e,t){if(e)return n(e);var r=t.discoInfo.identities[0]||{};n(null,r.name)})},e.requestRoomVoice=function(t){e.sendMessage({to:t,form:{fields:[{name:"FORM_TYPE",value:"http://jabber.org/protocol/muc#request"},{name:"muc#role",type:"text-single",value:"participant"}]}})},e.setRoomAffiliation=function(e,t,n,r,i){return this.sendIq({type:"set",to:e,mucAdmin:{jid:t,affiliation:n,reason:r}},i)},e.setRoomRole=function(e,t,n,r,i){return this.sendIq({type:"set",to:e,mucAdmin:{nick:t,role:n,reason:r}},i)},e.getRoomMembers=function(e,t,n){return this.sendIq({type:"get",to:e,mucAdmin:t},n)},e.getRoomConfig=function(e,t){return this.sendIq({to:e,type:"get",mucOwner:!0},t)},e.configureRoom=function(e,t,n){return t.type||(t.type="submit"),this.sendIq({to:e,type:"set",mucOwner:{form:t}},n)},e.destroyRoom=function(e,t,n){return this.sendIq({to:e,type:"set",mucOwner:{destroy:t}},n)},e.getUniqueRoomName=function(e,t){return this.sendIq({type:"get",to:e,mucUnique:!0},t)}}},function(e,t,n){"use strict";var r="http://jabber.org/protocol/nick";e.exports=function(e){e.disco.addFeature(r),e.disco.addFeature(r+"+notify"),e.on("pubsub:event",function(t){t.event.updated&&t.event.updated.node===r&&e.emit("nick",{jid:t.from,nick:t.event.updated.published[0].nick})}),e.publishNick=function(e,t){return this.publish("",r,{nick:e},t)}}},function(e,t,n){"use strict";var r=n(316);e.exports=function(e){e.transports["old-websocket"]=r}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("jabber:x:oob")}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:ping"),e.on("iq:get:ping",function(t){e.sendIq(t.resultReply())}),e.ping=function(e,t){return this.sendIq({to:e,type:"get",ping:!0},t)}}},function(e,t,n){"use strict";e.exports=function(e){e.getPrivateData=function(e,t){return this.sendIq({type:"get",privateStorage:e},t)},e.setPrivateData=function(e,t){return this.sendIq({type:"set",privateStorage:e},t)}}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:psa")}},function(e,t,n){"use strict";e.exports=function(e){e.on("message",function(t){if(t.event){if(e.emit("pubsub:event",t),e.emit("pubsubEvent",t),t.event.updated){var n=t.event.updated.published,r=t.event.updated.retracted;n&&n.length&&e.emit("pubsub:published",t),r&&r.length&&e.emit("pubsub:retracted",t)}t.event.purged&&e.emit("pubsub:purged",t),t.event.deleted&&e.emit("pubsub:deleted",t),t.event.subscriptionChanged&&e.emit("pubsub:subscription",t),t.event.configurationChanged&&e.emit("pubsub:config",t)}t.pubsub&&t.pubsub.affiliations&&e.emit("pubsub:affiliation",t)}),e.subscribeToNode=function(t,n,r){return"string"==typeof n&&(n={node:n}),n.jid=n.jid||e.jid,this.sendIq({type:"set",to:t,pubsub:{subscribe:n}},r)},e.unsubscribeFromNode=function(t,n,r){return"string"==typeof n&&(n={node:n}),n.jid=n.jid||e.jid.bare,this.sendIq({type:"set",to:t,pubsub:{unsubscribe:n}},r)},e.publish=function(e,t,n,r){return this.sendIq({type:"set",to:e,pubsub:{publish:{node:t,item:n}}},r)},e.getItem=function(e,t,n,r){return this.sendIq({type:"get",to:e,pubsub:{retrieve:{node:t,item:n}}},r)},e.getItems=function(e,t,n,r){return n=n||{},n.node=t,this.sendIq({type:"get",to:e,pubsub:{retrieve:{node:t,max:n.max},rsm:n.rsm}},r)},e.retract=function(e,t,n,r,i){return this.sendIq({type:"set",to:e,pubsub:{retract:{node:t,notify:r,id:n}}},i)},e.purgeNode=function(e,t,n){return this.sendIq({type:"set",to:e,pubsubOwner:{purge:t}},n)},e.deleteNode=function(e,t,n){return this.sendIq({type:"set",to:e,pubsubOwner:{del:t}},n)},e.createNode=function(e,t,n,r){var i={type:"set",to:e,pubsub:{create:t}};return n&&(i.pubsub.config={form:n}),this.sendIq(i,r)},e.getSubscriptions=function(e,t,n){return t=t||{},this.sendIq({type:"get",to:e,pubsub:{subscriptions:t}},n)},e.getAffiliations=function(e,t,n){return t=t||{},this.sendIq({type:"get",to:e,pubsub:{affiliations:t}},n)},e.getNodeSubscribers=function(e,t,n,r){return n=n||{},n.node=t,this.sendIq({type:"get",to:e,pubsubOwner:{subscriptions:n}},r)},e.updateNodeSubscriptions=function(e,t,n,r){return this.sendIq({type:"set",to:e,pubsubOwner:{subscriptions:{node:t,list:n}}},r)},e.getNodeAffiliations=function(e,t,n,r){return n=n||{},n.node=t,this.sendIq({type:"get",to:e,pubsubOwner:{affiliations:n}},r)},e.updateNodeAffiliations=function(e,t,n,r){return this.sendIq({type:"set",to:e,pubsubOwner:{affiliations:{node:t,list:n}}},r)}}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:reach:0"),e.disco.addFeature("urn:xmpp:reach:0+notify"),e.on("pubsub:event",function(t){t.event.updated&&"urn:xmpp:reach:0"===t.event.updated.node&&e.emit("reachability",{jid:t.from,addresses:t.event.updated.published[0].reach})}),e.on("presence",function(t){t.reach&&t.reach.length&&e.emit("reachability",{jid:t.from,addresses:t.reach})}),e.publishReachability=function(e,t){return this.publish("","urn:xmpp:reach:0",{reach:e},t)}}},function(e,t,n){"use strict";e.exports=function(e,t,n){var r=!1!==n.sendReceipts;e.disco.addFeature("urn:xmpp:receipts"),e.on("message",function(t){var n={normal:!0,chat:!0,headline:!0};r&&n[t.type]&&t.requestReceipt&&!t.receipt&&e.sendMessage({to:t.from,type:t.type,receipt:t.id,id:t.id}),t.receipt&&(e.emit("receipt",t),e.emit("receipt:"+t.receipt))})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:reference:0")}},function(e,t,n){"use strict";e.exports=function(e){e.getAccountInfo=function(e,t){return this.sendIq({type:"get",to:e,register:!0},t)},e.updateAccount=function(e,t,n){return this.sendIq({type:"set",to:e,register:t},n)},e.deleteAccount=function(e,t){return this.sendIq({type:"set",to:e,register:{remove:!0}},t)}}},function(e,t,n){"use strict";e.exports=function(e){e.on("iq:set:roster",function(t){var n={};if(n[""]=!0,n[e.jid.bare]=!0,n[e.jid.domain]=!0,!n[t.from.full])return e.sendIq(t.errorReply({error:{type:"cancel",condition:"service-unavailable"}}));e.emit("roster:update",t),e.sendIq({id:t.id,type:"result"})}),e.getRoster=function(t){var n=this;return e.sendIq({type:"get",roster:{ver:n.config.rosterVer}}).then(function(e){if(e.roster){var t=e.roster.ver;t&&(n.config.rosterVer=t,n.emit("roster:ver",t))}return e}).then(function(e){return t&&t(null,e),e},function(e){if(!t)throw e;t(e)})},e.updateRosterItem=function(t,n){return e.sendIq({type:"set",roster:{items:[t]}},n)},e.removeRosterItem=function(t,n){return e.updateRosterItem({jid:t,subscription:"remove"},n)},e.subscribe=function(t){e.sendPresence({type:"subscribe",to:t})},e.unsubscribe=function(t){e.sendPresence({type:"unsubscribe",to:t})},e.acceptSubscription=function(t){e.sendPresence({type:"subscribed",to:t})},e.denySubscription=function(t){e.sendPresence({type:"unsubscribed",to:t})}}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:rtt:0"),e.on("message",function(t){t.rtt&&(e.emit("rtt",t),e.emit("rtt:"+t.rtt.event,t))})}},function(e,t,n){"use strict";(function(t){var n="urn:ietf:params:xml:ns:xmpp-sasl";e.exports=function(e,r){var i=r.getDefinition("auth",n),s=r.getDefinition("response",n),o=r.getDefinition("abort",n);e.registerFeature("sasl",100,function(e,n){var r=this,a=r.SASLFactory.create(e.sasl.mechanisms);if(!a)return r.releaseGroup("sasl"),r.emit("auth:failed"),n("disconnect","authentication failed");r.on("sasl:success","sasl",function(){r.features.negotiated.sasl=!0,r.releaseGroup("sasl"),r.emit("auth:success",r.config.credentials),n("restart")}),r.on("sasl:challenge","sasl",function(e){return a.challenge(new t(e.value,"base64").toString()),r.getCredentials(function(e,n){if(e)return r.send(new o);var i=a.response(n);i||""===i?r.send(new s({value:new t(i).toString("base64")})):r.send(new s),a.cache&&(Object.keys(a.cache).forEach(function(e){a.cache[e]&&(r.config.credentials[e]=new t(a.cache[e]))}),r.emit("credentials:update",r.config.credentials))})}),r.on("sasl:failure","sasl",function(){r.releaseGroup("sasl"),r.emit("auth:failed"),n("disconnect","authentication failed")}),r.on("sasl:abort","sasl",function(){r.releaseGroup("sasl"),r.emit("auth:failed"),n("disconnect","authentication failed")});var c={mechanism:a.name};if(a.clientFirst)return r.getCredentials(function(e,n){if(e)return r.send(new o);c.value=new t(a.response(n)).toString("base64"),r.send(new i(c))});r.send(new i(c))}),e.on("disconnected",function(){e.features.negotiated.sasl=!1,e.releaseGroup("sasl")})}}).call(t,n(1).Buffer)},function(e,t,n){"use strict";e.exports=function(e){e.registerFeature("session",1e3,function(e,t){var n=this;if(e.session.optional||n.sessionStarted)return n.features.negotiated.session=!0,t();n.sendIq({type:"set",session:{}},function(e){if(e)return t("disconnect","session request failed");n.features.negotiated.session=!0,n.sessionStarted||(n.sessionStarted=!0,n.emit("session:started",n.jid)),t()})}),e.on("disconnected",function(){e.sessionStarted=!1,e.features.negotiated.session=!1})}},function(e,t,n){"use strict";var r="http://jabber.org/protocol/shim";e.exports=function(e){e.disco.addFeature(r),e.disco.addFeature(r+"#SubID",r)}},function(e,t,n){"use strict";e.exports=function(e,t,n){var r=function(e,t){var r=this;if(!n.useStreamManagement)return t();r.on("stream:management:enabled","sm",function(e){r.sm.enabled(e),r.features.negotiated.streamManagement=!0,r.releaseGroup("sm"),t()}),r.on("stream:management:resumed","sm",function(e){r.sm.resumed(e),r.features.negotiated.streamManagement=!0,r.features.negotiated.bind=!0,r.sessionStarted=!0,r.releaseGroup("sm"),t("break")}),r.on("stream:management:failed","sm",function(){r.sm.failed(),r.emit("session:end"),r.releaseGroup("session"),r.releaseGroup("sm"),t()}),r.sm.id?r.sm.id&&r.sm.allowResume?r.sm.resume():(r.releaseGroup("sm"),t()):r.features.negotiated.bind?r.sm.enable():(r.releaseGroup("sm"),t())};e.on("disconnected",function(){e.features.negotiated.streamManagement=!1}),e.registerFeature("streamManagement",200,r),e.registerFeature("streamManagement",500,r)}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("urn:xmpp:time"),e.getTime=function(e,t){return this.sendIq({to:e,type:"get",time:!0},t)},e.on("iq:get:time",function(t){var n=new Date;e.sendIq(t.resultReply({time:{utc:n,tzo:n.getTimezoneOffset()}}))})}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("vcard-temp"),e.getVCard=function(e,t){return this.sendIq({to:e,type:"get",vCardTemp:!0},t)},e.publishVCard=function(e,t){return this.sendIq({type:"set",vCardTemp:e},t)}}},function(e,t,n){"use strict";e.exports=function(e){e.disco.addFeature("jabber:iq:version"),e.on("iq:get:version",function(t){e.sendIq(t.resultReply({version:e.config.softwareVersion||{name:"stanza.io"}}))}),e.getSoftwareVersion=function(e,t){return this.sendIq({to:e,type:"get",version:!0},t)}}},function(e,t,n){"use strict";var r=n(63);e.exports=function(e){e.transports.websocket=r}},function(e,t,n){"use strict";function r(e,t){return(e%t+t)%t}function i(e){this.client=e,this.id=!1,this.allowResume=!0,this.started=!1,this.inboundStarted=!1,this.outboundStarted=!1,this.lastAck=0,this.handled=0,this.windowSize=1,this.unacked=[],this.pendingAck=!1;var t="urn:xmpp:sm:3";this.stanzas={Enable:e.stanzas.getDefinition("enable",t),Resume:e.stanzas.getDefinition("resume",t),Ack:e.stanzas.getDefinition("a",t),Request:e.stanzas.getDefinition("r",t)}}var s=Math.pow(2,32);i.prototype={constructor:{value:i},enable:function(){var e=new this.stanzas.Enable;e.resume=this.allowResume,this.client.send(e),this.handled=0,this.outboundStarted=!0},resume:function(){var e=new this.stanzas.Resume({h:this.handled,previd:this.id});this.client.send(e),this.outboundStarted=!0},enabled:function(e){this.id=e.id,this.handled=0,this.inboundStarted=!0},resumed:function(e){this.id=e.previd,e.h&&this.process(e,!0),this.inboundStarted=!0},failed:function(){this.inboundStarted=!1,this.outboundStarted=!1,this.id=!1,this.lastAck=0,this.handled=0,this.unacked=[]},ack:function(){this.client.send(new this.stanzas.Ack({h:this.handled}))},request:function(){this.pendingAck=!0,this.client.send(new this.stanzas.Request)},process:function(e,t){var n=this,i=r(e.h-this.lastAck,s);this.pendingAck=!1;for(var o=0;o<i&&this.unacked.length>0;o++)this.client.emit("stanza:acked",this.unacked.shift());if(this.lastAck=e.h,t){var a=this.unacked;this.unacked=[],a.forEach(function(e){n.client.send(e)})}this.needAck()&&this.request()},track:function(e){var t=e._name,n={message:!0,presence:!0,iq:!0};this.outboundStarted&&n[t]&&(this.unacked.push(e),this.needAck()&&this.request())},handle:function(){this.inboundStarted&&(this.handled=r(this.handled+1,s))},needAck:function(){return!this.pendingAck&&this.unacked.length>=this.windowSize}},Object.defineProperties(i.prototype,{started:{get:function(){return this.outboundStarted&&this.inboundStarted},set:function(e){e||(this.outboundStarted=!1,this.inboundStarted=!1)}}}),e.exports=i},function(e,t,n){"use strict";(function(t,r){function i(e,t){var n;return Promise.race([e,new Promise(function(e,r){n=setTimeout(function(){r()},t)})]).then(function(e){return clearTimeout(n),e})}function s(e){return new Promise(function(t){setTimeout(function(){t()},e)})}function o(e){return new Promise(function(t,n){p(e,function(e,r,i){return e?n(e):t([r,i])})})}function a(e,t,n){return i(o(e),1e3*(t||20)).then(function(e){var t=e[0],n=e[1];if(t.statusCode<200||t.statusCode>=400)throw new Error("HTTP Status Error"+t.statusCode);return n}).catch(function(){if(n>0)return s(1e3).then(function(){return a(e,t,n-1)});throw new Error("Dead Connection, exceeded retry limit")})}function c(e,t){var n=this;f.call(this),n.sm=e,n.stanzas={BOSH:t.getDefinition("body","http://jabber.org/protocol/httpbind"),StreamError:t.getStreamError()},n.sendQueue=[],n.requests=[],n.maxRequests=void 0,n.sid="",n.on("raw:incoming",function(e){if(""!==(e=e.trim())){var r,i;try{r=t.parse(e,n.stanzas.BOSH)}catch(e){return i=new n.stanzas.StreamError({condition:"invalid-xml"}),n.emit("stream:error",i,e),n.send(i),n.disconnect()}n.hasStream||(n.hasStream=!0,n.stream={id:r.sid||n.sid,lang:r.lang||"en",version:r.version||"1.0",to:r.to,from:r.from},n.sid=r.sid||n.sid,n.maxRequests=r.requests||n.maxRequests);r.payload.forEach(function(e){e.lang||(e.lang=n.stream.lang),n.emit("stream:data",e)}),"terminate"===r.type&&(n.rid=void 0,n.sid=void 0,n.emit("bosh:terminate",r),n.emit("stream:end"),n.emit("disconnected",n))}})}var u=n(12),l=n(47),d=n(6),p=n(66),f=n(9);d.inherits(c,f),c.prototype.connect=function(e){var t=this;if(t.config=u({rid:Math.ceil(9999999999*Math.random()),wait:30,maxRetries:5},e),t.hasStream=!1,t.sm.started=!1,t.url=e.boshURL,t.sid=t.config.sid,t.rid=t.config.rid,t.requests=[],t.sid)return t.hasStream=!0,t.stream={},t.emit("connected",t),t.emit("session:prebind",t.config.jid),void t.emit("session:started");t.rid++,t.request(new t.stanzas.BOSH({version:t.config.version||"1.0",to:t.config.server,lang:t.config.lang||"en",wait:t.config.wait,ver:"1.6",hold:1}))},c.prototype.disconnect=function(){this.hasStream?(this.rid++,this.request(new this.stanzas.BOSH({type:"terminate"}))):(this.stream=void 0,this.sid=void 0,this.rid=void 0,this.emit("disconnected",this))},c.prototype.restart=function(){var e=this;e.rid++,e.request(new e.stanzas.BOSH({to:e.config.server,lang:e.config.lang||"en",restart:"true"}))},c.prototype.send=function(e){var n=this;n.hasStream&&(n.sendQueue.push(e),t.nextTick(n.longPoll.bind(n)))},c.prototype.longPoll=function(){var e=!this.maxRequests||this.requests.length<this.maxRequests,t=!this.maxRequests||this.sendQueue.length>0&&this.requests.length<this.maxRequests;if(this.sid&&(e||t)){var n=this.sendQueue;this.sendQueue=[],this.rid++,this.request(new this.stanzas.BOSH({payload:n}))}},c.prototype.request=function(e){var n=this,i={id:n.rid,request:null};e.rid=n.rid,e.sid=n.sid;var s=new r(e.toString(),"utf8").toString();n.emit("raw:outgoing",s),n.requests.push(i);var o=a({uri:n.url,body:s,method:"POST",strictSSL:!0},1.5*n.config.wait,this.config.maxRetries).catch(function(e){n.hasStream=!1;var t=new n.stanzas.StreamError({condition:"connection-timeout"});n.emit("stream:error",t,e),n.disconnect()});return i.request=o,o.then(function(e){n.emit("raw:incoming",new r(e,"utf8").toString())}),o.then(function(){n.requests=l(n.requests,function(e){return e.id!==i.id}),"terminate"===e.type||n.requests.length||t.nextTick(function(){t.nextTick(n.longPoll.bind(n))})})},e.exports=c}).call(t,n(8),n(1).Buffer)},function(e,t,n){"use strict";function r(e,t){function n(e){return[r.streamStart,e,r.streamEnd].join("")}s.call(this,e,t);var r=this;r.on("connected",function(){r.streamStart='<stream:stream xmlns:stream="http://etherx.jabber.org/streams">',r.streamEnd="</stream:stream>"}),r.off("raw:incoming"),r.on("raw:incoming",function(e){var s,o,a;if(e=e.trim(),""!==(e=e.replace(/^(\s*<\?.*\?>\s*)*/,""))){if(e.match(r.streamEnd))return r.disconnect();if(r.hasStream)try{s=t.parse(n(e))}catch(e){return a=new this.stanzas.StreamError({condition:"invalid-xml"}),r.emit("stream:error",a,e),r.send(a),r.disconnect()}else{var c=e.match(/^<(\S+:)?(\S+) /);r.streamStart=e,r.streamEnd="</"+(c[1]||"")+c[2]+">",o=!1;try{s=t.parse(e+r.streamEnd)}catch(n){try{s=t.parse(e),o=!0}catch(e){return a=new this.stanzas.StreamError({condition:"invalid-xml"}),r.emit("stream:error",a,e),r.send(a),r.disconnect()}}r.hasStream=!0,r.stream=s,r.emit("stream:start",s)}i(s._extensions,function(e){!e.lang&&r.stream&&(e.lang=r.stream.lang),r.emit("stream:data",e)}),o&&r.emit("stream:end")}})}var i=n(13),s=n(63);n(6).inherits(r,s),r.prototype.startHeader=function(){return["<stream:stream",'xmlns:stream="http://etherx.jabber.org/streams"','xmlns="jabber:client"','version="'+(this.config.version||"1.0")+'"','xml:lang="'+(this.config.lang||"en")+'"','to="'+this.config.server+'">'].join(" ")},r.prototype.closeHeader=function(){return"</stream:stream>"},e.exports=r},function(e,t){function n(e){return e.replace(/^\s*|\s*$/g,"")}t=e.exports=n,t.left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}},function(e,t,n){(function(t){function n(e,t){function n(){if(!i){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}if(r("noDeprecation"))return e;var i=!1;return n}function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=n}).call(t,n(3))},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){(function(t){var n,r=t.crypto||t.msCrypto;if(r&&r.getRandomValues){var i=new Uint8Array(16);n=function(){return r.getRandomValues(i),i}}if(!n){var s=new Array(16);n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s}}e.exports=n}).call(t,n(3))},function(e,t,n){"use strict";!function(){var t=n(7),r=t.log,i=t.browserDetails;e.exports.browserDetails=i,e.exports.extractVersion=t.extractVersion,e.exports.disableLog=t.disableLog;var s=n(323)||null,o=n(325)||null,a=n(328)||null,c=n(330)||null;switch(i.browser){case"chrome":if(!s||!s.shimPeerConnection)return void r("Chrome shim is not included in this adapter release.");r("adapter.js shimming chrome."),e.exports.browserShim=s,s.shimGetUserMedia(),s.shimMediaStream(),t.shimCreateObjectURL(),s.shimSourceObject(),s.shimPeerConnection(),s.shimOnTrack(),s.shimGetSendersWithDtmf();break;case"firefox":if(!a||!a.shimPeerConnection)return void r("Firefox shim is not included in this adapter release.");r("adapter.js shimming firefox."),e.exports.browserShim=a,a.shimGetUserMedia(),t.shimCreateObjectURL(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void r("MS edge shim is not included in this adapter release.");r("adapter.js shimming edge."),e.exports.browserShim=o,o.shimGetUserMedia(),t.shimCreateObjectURL(),o.shimPeerConnection(),o.shimReplaceTrack();break;case"safari":if(!c)return void r("Safari shim is not included in this adapter release.");r("adapter.js shimming safari."),e.exports.browserShim=c,c.shimCallbacksAPI(),c.shimAddStream(),c.shimOnAddStream(),c.shimGetUserMedia();break;default:r("Unsupported browser!")}}()},function(e,t,n){"use strict";var r=n(7).log,i=n(7).browserDetails,s={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r;r=RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track.id===n.track.id}):{track:n.track};var i=new Event("track");i.track=n.track,i.receiver=r,i.streams=[e.stream],t.dispatchEvent(i)}),e.stream.getTracks().forEach(function(n){var r;r=RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track.id===n.id}):{track:n};var i=new Event("track");i.track=n,i.receiver=r,i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(){if("object"==typeof window&&window.RTCPeerConnection&&!("getSenders"in RTCPeerConnection.prototype)&&"createDTMFSender"in RTCPeerConnection.prototype){RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var e=RTCPeerConnection.prototype.addStream,t=RTCPeerConnection.prototype.removeStream;RTCPeerConnection.prototype.addTrack||(RTCPeerConnection.prototype.addTrack=function(e,t){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(t){return t===e}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n._senders=n._senders||[],n._senders.find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{};var i=n._streams[t.id];if(i)i.addTrack(e),n.removeStream(i),n.addStream(i);else{var s=new MediaStream([e]);n._streams[t.id]=s,n.addStream(s)}var o={track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=n.createDTMFSender(e):this._dtmf=null),this._dtmf}};return n._senders.push(o),o}),RTCPeerConnection.prototype.addStream=function(t){var n=this;n._senders=n._senders||[],e.apply(n,[t]),t.getTracks().forEach(function(e){n._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=n.createDTMFSender(e):this._dtmf=null),this._dtmf}})})},RTCPeerConnection.prototype.removeStream=function(e){var n=this;n._senders=n._senders||[],t.apply(n,[e]),e.getTracks().forEach(function(e){var t=n._senders.find(function(t){return t.track===e});t&&n._senders.splice(n._senders.indexOf(t),1)})}}},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;if(this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),!e)return void(this.src="");this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})}}))},shimPeerConnection:function(){if(window.RTCPeerConnection){var e=RTCPeerConnection;window.RTCPeerConnection=function(t,n){if(t&&t.iceServers){for(var r=[],i=0;i<t.iceServers.length;i++){var s=t.iceServers[i];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,r.push(s)):r.push(t.iceServers[i])}t.iceServers=r}return new e(t,n)},window.RTCPeerConnection.prototype=e.prototype,Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return e.generateCertificate}})}else window.RTCPeerConnection=function(e,t){return r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new webkitRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}});var t=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,n,r){var i=this,s=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){s[1](a(o(e)))};return t.apply(this,[c,arguments[0]])}return new Promise(function(e,n){t.apply(i,[function(t){e(a(o(t)))},n])}).then(n,r)},i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),i.version<52&&["createOffer","createAnswer"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var n=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:s.shimMediaStream,shimOnTrack:s.shimOnTrack,shimGetSendersWithDtmf:s.shimGetSendersWithDtmf,shimSourceObject:s.shimSourceObject,shimPeerConnection:s.shimPeerConnection,shimGetUserMedia:n(324)}},function(e,t,n){"use strict";var r=n(7).log,i=n(7).browserDetails;e.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var s={};"number"==typeof r.ideal?(s[i("min",n)]=r.ideal,t.optional.push(s),s={},s[i("max",n)]=r.ideal,t.optional.push(s)):(s[i("",n)]=r.ideal,t.optional.push(s))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var s=t.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var o=i.version<61;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||o)){delete t.video.facingMode;var a;if("environment"===s.exact||"environment"===s.ideal?a=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(a=["front"]),a)return navigator.mediaDevices.enumerateDevices().then(function(i){i=i.filter(function(e){return"videoinput"===e.kind});var o=i.find(function(e){return a.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!o&&i.length&&-1!==a.indexOf("back")&&(o=i[i.length-1]),o&&(t.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),t.video=e(t.video),r("chrome: "+JSON.stringify(t)),n(t)})}t.video=e(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{ConstraintNotSatisfiedError:"OverconstrainedError",PermissionDeniedError:"NotAllowedError",TrackStartError:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,i){t(e,function(e){navigator.webkitGetUserMedia(e,r,function(e){i(n(e))})})};navigator.getUserMedia=s;var o=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:o,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return a(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return o(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";var r=n(7).browserDetails,i=n(327);e.exports={shimGetUserMedia:n(326),shimPeerConnection:function(){if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),r.version<15025)){var e=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(t){e.set.call(this,t);var n=new Event("enabled");n.enabled=t,this.dispatchEvent(n)}})}window.RTCPeerConnection=i(r.version)},shimReplaceTrack:function(){!window.RTCRtpSender||"replaceTrack"in RTCRtpSender.prototype||(RTCRtpSender.prototype.replaceTrack=RTCRtpSender.prototype.setTrack)}}},function(e,t,n){"use strict";e.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return t(n).catch(function(t){return Promise.reject(e(t))})}}},function(e,t,n){"use strict";function r(e){var t=e.filter(function(e){return"audio"===e.kind}),n=e.filter(function(e){return"video"===e.kind});for(e=[];t.length||n.length;)t.length&&e.push(t.shift()),n.length&&e.push(n.shift());return e}function i(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393:(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}return!1})}function s(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var s=r(e.parameters.apt,n),o=r(t.parameters.apt,i);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach(function(r){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&o.parameters.apt&&!i(r,o,e.codecs,t.codecs))continue;o=JSON.parse(JSON.stringify(o)),o.numChannels=Math.min(r.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}var a=n(220);e.exports=function(e){var t=function(t){var n=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=r[e].bind(r)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return n.localStreams},this.getRemoteStreams=function(){return n.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},t&&t.iceTransportPolicy)switch(t.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=t.iceTransportPolicy}this.usingBundle=t&&"max-bundle"===t.bundlePolicy,t&&t.iceServers&&(this.iceOptions.iceServers=i(t.iceServers,e)),this._config=t||{},this.transceivers=[],this._localIceCandidatesBuffer=[]};return t.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},t.prototype._emitBufferedCandidates=function(){var e=this,t=a.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(n.candidate&&0!==Object.keys(n.candidate).length)t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n";else for(var r=1;r<t.length;r++)-1===t[r].indexOf("\r\na=end-of-candidates\r\n")&&(t[r]+="a=end-of-candidates\r\n");if(e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),!n.candidate&&"complete"!==e.iceGatheringState){e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&"complete"!==e.iceGatheringStateChange&&(e.iceGatheringState="complete",e._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},t.prototype.getConfiguration=function(){return this._config},t.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},t.prototype.addTrack=function(e,t){for(var n,r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==e.kind||(n=this.transceivers[r]);return n||(n=this._createTransceiver(e.kind)),n.track=e,n.stream=t,n.rtpSender=new RTCRtpSender(e,n.dtlsTransport),this._maybeFireNegotiationNeeded(),n.rtpSender},t.prototype.addStream=function(t){var n=this;if(e>=15025)this.localStreams.push(t),t.getTracks().forEach(function(e){n.addTrack(e,t)});else{var r=t.clone();t.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)}),this.localStreams.push(r)}this._maybeFireNegotiationNeeded()},t.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},t.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},t.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},t.prototype._createIceGatherer=function(e,t){var n=this,r=new RTCIceGatherer(n.iceOptions);return r.onlocalcandidate=function(i){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var o=i.candidate,c=!o||0===Object.keys(o).length;c?void 0===r.state&&(r.state="completed"):(o.component=1,s.candidate.candidate=a.writeCandidate(o));var u=a.splitSections(n.localDescription.sdp);u[s.candidate.sdpMLineIndex+1]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",n.localDescription.sdp=u.join("");var l=n._pendingOffer?n._pendingOffer:n.transceivers,d=l.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":c||n._localIceCandidatesBuffer.push(s),c&&d&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),c||(n.dispatchEvent(s),null!==n.onicecandidate&&n.onicecandidate(s)),d&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},r},t.prototype._createIceAndDtlsTransports=function(){var e=this,t=new RTCIceTransport(null);t.onicestatechange=function(){e._updateConnectionState()};var n=new RTCDtlsTransport(t);return n.ondtlsstatechange=function(){e._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:n}},t.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlssttatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},t.prototype._transceive=function(t,n,r){var i=s(t.localCapabilities,t.remoteCapabilities);n&&t.rtpSender&&(i.encodings=t.sendEncodingParameters,i.rtcp={cname:a.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(i.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(i)),r&&t.rtpReceiver&&("video"===t.kind&&t.recvEncodingParameters&&e<15019&&t.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=t.recvEncodingParameters,i.rtcp={cname:t.rtcpParameters.cname,compound:t.rtcpParameters.compound},t.sendEncodingParameters.length&&(i.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(i))},t.prototype.setLocalDescription=function(e){var t=this;if(!o("setLocalDescription",e.type,this.signalingState)){var n=new Error("Can not set local "+e.type+" in state "+this.signalingState);return n.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&window.setTimeout(arguments[2],0,n),Promise.reject(n)}var r,i;if("offer"===e.type)this._pendingOffer&&(r=a.splitSections(e.sdp),i=r.shift(),r.forEach(function(e,n){var r=a.parseRtpParameters(e);t._pendingOffer[n].localCapabilities=r}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){r=a.splitSections(t.remoteDescription.sdp),i=r.shift();var c=a.matchPrefix(i,"a=ice-lite").length>0;r.forEach(function(e,n){var r=t.transceivers[n],o=r.iceGatherer,u=r.iceTransport,l=r.dtlsTransport,d=r.localCapabilities,p=r.remoteCapabilities;if(!a.isRejected(e)&&!r.isDatachannel){var f=a.getIceParameters(e,i),h=a.getDtlsParameters(e,i);c&&(h.role="server"),t.usingBundle&&0!==n||(u.start(o,f,c?"controlling":"controlled"),l.start(h));var m=s(d,p);t._transceive(r,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var u=arguments.length>1&&"function"==typeof arguments[1];if(u){var l=arguments[1];window.setTimeout(function(){l(),"new"===t.iceGatheringState&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),t._emitBufferedCandidates()},0)}var d=Promise.resolve();return d.then(function(){u||("new"===t.iceGatheringState&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),window.setTimeout(t._emitBufferedCandidates.bind(t),500))}),d},t.prototype.setRemoteDescription=function(t){var n=this;if(!o("setRemoteDescription",t.type,this.signalingState)){var r=new Error("Can not set remote "+t.type+" in state "+this.signalingState);return r.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&window.setTimeout(arguments[2],0,r),Promise.reject(r)}var i={},s=[],c=a.splitSections(t.sdp),u=c.shift(),l=a.matchPrefix(u,"a=ice-lite").length>0,d=a.matchPrefix(u,"a=group:BUNDLE ").length>0;this.usingBundle=d;var p=a.matchPrefix(u,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,c.forEach(function(r,o){var c=a.splitLines(r),p=a.getKind(r),f=a.isRejected(r),h=c[0].substr(2).split(" ")[2],m=a.getDirection(r,u),g=a.parseMsid(r),v=a.getMid(r)||a.generateIdentifier();if("application"===p&&"DTLS/SCTP"===h)return void(n.transceivers[o]={mid:v,isDatachannel:!0});var b,y,_,S,T,E,w,R,C,x,A,I=a.parseRtpParameters(r);f||(x=a.getIceParameters(r,u),A=a.getDtlsParameters(r,u),A.role="client"),w=a.parseRtpEncodingParameters(r);var N=a.parseRtcpParameters(r),O=a.matchPrefix(r,"a=end-of-candidates",u).length>0,D=a.matchPrefix(r,"a=candidate:").map(function(e){return a.parseCandidate(e)}).filter(function(e){return"1"===e.component||1===e.component});"offer"!==t.type||f?"answer"!==t.type||f||(d&&o>0&&(n._disposeIceAndDtlsTransports(o),n.transceivers[o].iceGatherer=n.transceivers[0].iceGatherer,n.transceivers[o].iceTransport=n.transceivers[0].iceTransport,n.transceivers[o].dtlsTransport=n.transceivers[0].dtlsTransport,n.transceivers[o].rtpSender&&n.transceivers[o].rtpSender.setTransport(n.transceivers[0].dtlsTransport),n.transceivers[o].rtpReceiver&&n.transceivers[o].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport)),b=n.transceivers[o],y=b.iceGatherer,_=b.iceTransport,S=b.dtlsTransport,T=b.rtpReceiver,E=b.sendEncodingParameters,R=b.localCapabilities,n.transceivers[o].recvEncodingParameters=w,n.transceivers[o].remoteCapabilities=I,n.transceivers[o].rtcpParameters=N,(l||O)&&D.length&&_.setRemoteCandidates(D),d&&0!==o||(_.start(y,x,"controlling"),S.start(A)),n._transceive(b,"sendrecv"===m||"recvonly"===m,"sendrecv"===m||"sendonly"===m),!T||"sendrecv"!==m&&"sendonly"!==m?delete b.rtpReceiver:(C=T.track,g?(i[g.stream]||(i[g.stream]=new MediaStream),i[g.stream].addTrack(C),s.push([C,T,i[g.stream]])):(i.default||(i.default=new MediaStream),i.default.addTrack(C),s.push([C,T,i.default])))):(b=n.transceivers[o]||n._createTransceiver(p),b.mid=v,b.iceGatherer||(b.iceGatherer=d&&o>0?n.transceivers[0].iceGatherer:n._createIceGatherer(v,o)),!O||d&&0!==o||b.iceTransport.setRemoteCandidates(D),R=RTCRtpReceiver.getCapabilities(p),e<15019&&(R.codecs=R.codecs.filter(function(e){return"rtx"!==e.name})),E=[{ssrc:1001*(2*o+2)}],"sendrecv"!==m&&"sendonly"!==m||(T=new RTCRtpReceiver(b.dtlsTransport,p),C=T.track,g?(i[g.stream]||(i[g.stream]=new MediaStream,Object.defineProperty(i[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(C,"id",{get:function(){return g.track}}),i[g.stream].addTrack(C),s.push([C,T,i[g.stream]])):(i.default||(i.default=new MediaStream),i.default.addTrack(C),s.push([C,T,i.default]))),b.localCapabilities=R,b.remoteCapabilities=I,b.rtpReceiver=T,b.rtcpParameters=N,b.sendEncodingParameters=E,b.recvEncodingParameters=w,n._transceive(n.transceivers[o],!1,"sendrecv"===m||"sendonly"===m))}),this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return Object.keys(i).forEach(function(e){var t=i[e];if(t.getTracks().length){n.remoteStreams.push(t);var r=new Event("addstream");r.stream=t,n.dispatchEvent(r),null!==n.onaddstream&&window.setTimeout(function(){n.onaddstream(r)},0),s.forEach(function(e){var r=e[0],i=e[1];if(t.id===e[2].id){var s=new Event("track");s.track=r,s.receiver=i,s.streams=[t],n.dispatchEvent(s),null!==n.ontrack&&window.setTimeout(function(){n.ontrack(s)},0)}})}}),window.setTimeout(function(){n&&n.transceivers&&n.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},t.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},t.prototype._maybeFireNegotiationNeeded=function(){var e=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,window.setTimeout(function(){if(!1!==e.needNegotiation){e.needNegotiation=!1;var t=new Event("negotiationneeded");e.dispatchEvent(t),null!==e.onnegotiationneeded&&e.onnegotiationneeded(t)}},0))},t.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},t.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var n;1===arguments.length&&"function"!=typeof arguments[0]?n=arguments[0]:3===arguments.length&&(n=arguments[2]);var i=this.transceivers.filter(function(e){return"audio"===e.kind}).length,s=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(i=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(s=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});i>0||s>0;)i>0&&(this._createTransceiver("audio"),i--),s>0&&(this._createTransceiver("video"),s--);var o=r(this.transceivers),c=a.writeSessionBoilerplate();o.forEach(function(n,r){var i=n.track,s=n.kind,c=a.generateIdentifier();n.mid=c,n.iceGatherer||(n.iceGatherer=t.usingBundle&&r>0?o[0].iceGatherer:t._createIceGatherer(c,r));var u=RTCRtpSender.getCapabilities(s);e<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var l=[{ssrc:1001*(2*r+1)}];i&&e>=15019&&"video"===s&&(l[0].rtx={ssrc:1001*(2*r+1)+1}),n.wantReceive&&(n.rtpReceiver=new RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=u,n.sendEncodingParameters=l}),"max-compat"!==this._config.bundlePolicy&&(c+="a=group:BUNDLE "+o.map(function(e){return e.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",o.forEach(function(e,t){c+=a.writeMediaSection(e,e.localCapabilities,"offer",e.stream),c+="a=rtcp-rsize\r\n"}),this._pendingOffer=o;var u=new RTCSessionDescription({type:"offer",sdp:c});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,u),Promise.resolve(u)},t.prototype.createAnswer=function(){var t=a.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n,r){if(n.isDatachannel)return void(t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+n.mid+"\r\n");if(n.stream){var i;"audio"===n.kind?i=n.stream.getAudioTracks()[0]:"video"===n.kind&&(i=n.stream.getVideoTracks()[0]),i&&e>=15019&&"video"===n.kind&&(n.sendEncodingParameters[0].rtx={ssrc:1001*(2*r+2)+1})}var o=s(n.localCapabilities,n.remoteCapabilities);!o.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx,t+=a.writeMediaSection(n,o,"answer",n.stream),n.rtcpParameters&&n.rtcpParameters.reducedSize&&(t+="a=rtcp-rsize\r\n")});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},t.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var r=this.transceivers[t];if(r){var i=Object.keys(e.candidate).length>0?a.parseCandidate(e.candidate):{};if("tcp"===i.protocol&&(0===i.port||9===i.port))return Promise.resolve();if(i.component&&"1"!==i.component&&1!==i.component)return Promise.resolve();r.iceTransport.addRemoteCandidate(i);var s=a.splitSections(this.remoteDescription.sdp);s[t+1]+=(i.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=s.join("")}}else for(var o=0;o<this.transceivers.length;o++)if(this.transceivers[o].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],n=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(r){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=n(e[t]),i.set(t,e[t])})}),t&&window.setTimeout(t,0,i),r(i)})})},t}},function(e,t,n){"use strict";var r=n(7).browserDetails,i={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(r.version<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var s=e.iceServers[i];if(s.hasOwnProperty("urls"))for(var o=0;o<s.urls.length;o++){var a={url:s.urls[o]};0===s.urls[o].indexOf("turn")&&(a.username=s.username,a.credential=s.credential),n.push(a)}else n.push(e.iceServers[i])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,s,o){return i.apply(this,[e||null]).then(function(e){if(r.version<48&&(e=t(e)),r.version<53&&!s)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(s,o)}}}};e.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:n(329)}},function(e,t,n){"use strict";var r=n(7).log,i=n(7).browserDetails;e.exports=function(){var e=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,s){var o=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=o(t.audio)),t.video&&(t.video=o(t.video)),r("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){s(e(t))})},n=function(e){return new Promise(function(n,r){t(e,n,r)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:n,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i.version<41){var s=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return s().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return o(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,n,r){if(i.version<44)return t(e,n,r);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(n,r)}}},function(e,t,n){"use strict";var r={shimAddStream:function(){"object"!=typeof window||!window.RTCPeerConnection||"addStream"in window.RTCPeerConnection.prototype||(RTCPeerConnection.prototype.addStream=function(e){var t=this;e.getTracks().forEach(function(n){t.addTrack(n,e)})})},shimOnAddStream:function(){"object"!=typeof window||!window.RTCPeerConnection||"onaddstream"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._streams||(this._streams=[]),!(this._streams.indexOf(t)>=0)){this._streams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}})},shimCallbacksAPI:function(){if("object"==typeof window&&window.RTCPeerConnection){var e=RTCPeerConnection.prototype,t=e.createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(e,n){var r=arguments.length>=2?arguments[2]:arguments[0],i=t.apply(this,[r]);return n?(i.then(e,n),Promise.resolve()):i},e.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var o=function(e,t,n){var i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};e.setLocalDescription=o,o=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},e.setRemoteDescription=o,o=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},e.addIceCandidate=o}},shimGetUserMedia:function(){navigator.getUserMedia||(navigator.webkitGetUserMedia?navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(e,t,n){navigator.mediaDevices.getUserMedia(e).then(t,n)}.bind(navigator)))}};e.exports={shimCallbacksAPI:r.shimCallbacksAPI,shimAddStream:r.shimAddStream,shimOnAddStream:r.shimOnAddStream,shimGetUserMedia:r.shimGetUserMedia}},function(e,t){e.exports={Action:{CONTENT_ACCEPT:"content-accept",CONTENT_ADD:"content-add",CONTENT_MODIFY:"content-modify",CONTENT_REJECT:"content-reject",CONTENT_REMOVE:"content-remove",DESCRIPTION_INFO:"description-info",SECURITY_INFO:"security-info",SESSION_ACCEPT:"session-accept",SESSION_INFO:"session-info",SESSION_INITIATE:"session-initiate",SESSION_TERMINATE:"session-terminate",TRANSPORT_ACCEPT:"transport-accept",TRANSPORT_INFO:"transport-info",TRANSPORT_REJECT:"transport-reject",TRANSPORT_REPLACE:"transport-replace"},Reason:{ALTERNATIVE_SESSION:"alernative-session",BUSY:"busy",CANCEL:"cancel",CONNECTIVITY_ERROR:"connectivity-error",DECLINE:"decline",EXPIRED:"expired",FAILED_APPLICATION:"failed-application",FAILED_TRANSPORT:"failed-transport",GENERAL_ERROR:"general-error",GONE:"gone",INCOMPATIBLE_PARAMETERS:"incompatible-parameters",MEDIA_ERROR:"media-error",SECURITY_ERROR:"security-error",SUCCESS:"success",TIMEOUT:"timeout",UNSUPPORTED_APPLICATIONS:"unsupported-applications",UNSUPPORTED_TRANSPORTS:"unsupported-transports"},Condition:{OUT_OF_ORDER:"out-of-order",TIE_BREAK:"tie-break",UNKNOWN_SESSION:"unknown-session",UNSUPPORTED_INFO:"unsupported-info"}}},function(e,t){e.exports={Status:{REALJID_PUBLIC:"100",AFFILIATION_CHANGED:"101",UNAVAILABLE_SHOWN:"102",UNAVAILABLE_NOT_SHOWN:"103",CONFIGURATION_CHANGED:"104",SELF_PRESENCE:"110",LOGGING_ENABLED:"170",LOGGING_DISABLED:"171",NON_ANONYMOUS:"172",SEMI_ANONYMOUS:"173",FULLY_ANONYMOUS:"174",ROOM_CREATED:"201",NICK_ASSIGNED:"210",BANNED:"301",NEW_NICK:"303",KICKED:"307",REMOVED_AFFILIATION:"321",REMOVED_MEMBERSHIP:"322",REMOVED_SHUTDOWN:"332"},Affiliation:{ADMIN:"admin",MEMBER:"member",NONE:"none",OUTCAST:"outcast",OWNER:"owner"},Role:{MODERATOR:"moderator",NONE:"none",PARTICIPANT:"participant",VISITOR:"visitor"}}},function(e,t){e.exports={BIND:"urn:ietf:params:xml:ns:xmpp-bind",CLIENT:"jabber:client",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",SERVER:"jabber:server",SESSION:"urn:ietf:params:xml:ns:xmpp-session",STANZA_ERROR:"urn:ietf:params:xml:ns:xmpp-stanzas",STREAM:"http://etherx.jabber.org/streams",STREAM_ERROR:"urn:ietf:params:xml:ns:xmpp-streams",ROSTER:"jabber:iq:roster",ROSTER_VERSIONING:"urn:xmpp:features:rosterver",SUBSCRIPTION_PREAPPROVAL:"urn:xmpp:features:pre-approval",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",DATAFORM:"jabber:x:data",RPC:"jabber:iq:rpc",LAST_ACTIVITY:"jabber:iq:last",PRIVACY:"jabber:iq:privacy",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",ADDRESS:"http://jabber.org/protocol/address",MUC:"http://jabber.org/protocol/muc",MUC_ADMIN:"http://jabber.org/protocol/muc#admin",MUC_OWNER:"http://jabber.org/protocol/muc#owner",MUC_USER:"http://jabber.org/protocol/muc#user",IBB:"http://jabber.org/protocol/ibb",BOOKMARKS:"storage:bookmarks",PRIVATE:"jabber:iq:private",ADHOC_COMMANDS:"http://jabber.org/protocol/commands",VCARD_TEMP:"vcard-temp",SEARCH:"jabber:iq:search",RSM:"http://jabber.org/protocol/rsm",PUBSUB:"http://jabber.org/protocol/pubsub",PUBSUB_ERRORS:"http://jabber.org/protocol/pubsub#errors",PUBSUB_EVENT:"http://jabber.org/protocol/pubsub#event",PUBSUB_OWNER:"http://jabber.org/protocol/pubsub#owner",SOCKS5:"http://jabber.org/protocol/bytestreams",OOB_IQ:"jabber:iq:oob",OOB:"jabber:x:oob",HTTP_AUTH:"http://jabber.org/protocol/http-auth",XHTML_IM:"http://jabber.org/protocol/xhtml-im",REGISTER:"jabber:iq:register",AMP:"http://jabber.org/protocol/amp",GEOLOC:"http://jabber.org/protocol/geoloc",ROSTER_DELIMITER:"roster:delimiter",AVATAR_DATA:"urn:xmpp:avatar:data",AVATAR_METADATA:"urn:xmpp:avatar:metadata",CHAT_STATES:"http://jabber.org/protocol/chatstates",VERSION:"jabber:iq:version",MOOD:"http://jabber.org/protocol/mood",ACTIVITY:"http://jabber.org/protocol/activity",COMPONENT:"jabber:component:accept",CAPS:"http://jabber.org/protocol/caps",TUNE:"http://jabber.org/protocol/tune",DATAFORM_VALIDATION:"http://jabber.org/protocol/xdata-validate",BOSH:"http://jabber.org/protocol/httpbind",SHIM:"http://jabber.org/protocol/shim",COMPRESSION:"http://jabber.org/features/compress",DATAFORM_LAYOUT:"http://jabber.org/protocol/xdata-layout",ROSTER_EXCHANGE:"http://jabber.org/protocol/rosterx",ROSTER_NOTES:"storage:rosternotes",REACH_0:"urn:xmpp:reach:0",VCARD_TEMP_UPDATE:"vcard-temp:x:update",CAPTCHA:"urn:xmpp:captcha",JINGLE_1:"urn:xmpp:jingle:1",JINGLE_ERRORS_1:"urn:xmpp:jingle:errors:1",JINGLE_RTP_1:"urn:xmpp:jingle:apps:rtp:1",JINGLE_RTP_ERRORS_1:"urn:xmpp:jingle:apps:rtp:errors:1",JINGLE_RTP_INFO_1:"urn:xmpp:jingle:apps:rtp:info:1",LANG_TRANS:"urn:xmpp:langtrans",LANG_TRANS_ITEMS:"urn:xmpp:langtrans:items",NICK:"http://jabber.org/protocol/nick",JINGLE_ICE_UDP_1:"urn:xmpp:jingle:transports:ice-udp:1",JINGLE_RAW_UDP_1:"urn:xmpp:jingle:transports:raw-udp:1",RECEIPTS:"urn:xmpp:receipts",INVISIBLE_0:"urn:xmpp:invisible:0",BLOCKING:"urn:xmpp:blocking",SMACKS_3:"urn:xmpp:sm:3",PING:"urn:xmpp:ping",TIME:"urn:xmpp:time",DELAY:"urn:xmpp:delay",BOSH_XMPP:"urn:xmpp:xbosh",DISCO_EXTERNAL_1:"urn:xmpp:extdisco:1",DATAFORM_MEDIA:"urn:xmpp:media-element",ATTENTION_0:"urn:xmpp:attention:0",BOB:"urn:xmpp:bob",FILE_TRANSFER_3:"urn:xmpp:jingle:apps:file-transfer:3",FILE_TRANSFER_4:"urn:xmpp:jingle:apps:file-transfer:4",FILE_TRANSFER_5:"urn:xmpp:jingle:apps:file-transfer:5",MUC_DIRECT_INVITE:"jabber:x:conference",SEC_LABEL_0:"urn:xmpp:sec-label:0",SEC_LABEL_CATALOG_2:"urn:xmpp:sec-label:catalog:2",SEC_LABEL_ESS_0:"urn:xmpp:sec-label:ess:0",JINGLE_SOCKS5_1:"urn:xmpp:jingle:transports:s5b:1",JINGLE_IBB_1:"urn:xmpp:jingle:transports:ibb:1",JINGLE_RTP_ZRTP_1:"urn:xmpp:jingle:apps:rtp:zrtp:1",THUMBS_0:"urn:xmpp:thumbs:0",THUMBS_1:"urn:xmpp:thumbs:1",DECLOAKING_0:"urn:xmpp:decloaking:0",CARBONS_2:"urn:xmpp:carbons:2",JINGLE_RTP_RTCP_FB_0:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",JINGLE_RTP_HDREXT_0:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",FORWARD_0:"urn:xmpp:forward:0",HASHES_1:"urn:xmpp:hashes:1",RTT_0:"urn:xmpp:rtt:0",MUC_UNIQUE:"http://jabber.org/protocol/muc#unique",CORRECTION_0:"urn:xmpp:message-correct:0",PSA:"urn:xmpp:psa",MAM_TMP:"urn:xmpp:mam:tmp",MAM_0:"urn:xmpp:mam:0",MAM_1:"urn:xmpp:mam:1",MAM_2:"urn:xmpp:mam:2",HATS_0:"urn:xmpp:hats:0",IDLE_1:"urn:xmpp:idle:1",JINGLE_DTLS_0:"urn:xmpp:jingle:apps:dtls:0",JID_PREP_0:"urn:xmpp:jidprep:0",HINTS:"urn:xmpp:hints",JSON_0:"urn:xmpp:json:0",EVENTLOG:"urn:xmpp:eventlog",JINGLE_GROUPING_0:"urn:xmpp:jingle:apps:grouping:0",JINGLE_RTP_SSMA_0:"urn:xmpp:jingle:apps:rtp:ssma:0",COLIBRI:"http://jitsi.org/protocol/colibri",DTLS_SCTP_1:"urn:xmpp:jingle:transports:dtls-sctp:1",CSI:"urn:xmpp:csi",JINGLE_MSG_INITIATE_0:"urn:xmpp:jingle:jingle-message:0",PUSH_0:"urn:xmpp:push:0",JINGLE_PUB_1:"urn:xmpp:jinglepub:1",STANZA_ID_0:"urn:xmpp:sid:0",HTTP_UPLOAD_0:"urn:xmpp:http:upload:0",JINGLE_HTTP_0:"urn:xmpp:jingle:transports:http:0",JINGLE_HTTP_UPLOAD_0:"urn:xmpp:jingle:transports:http:upload:0",REFERENCE_0:"urn:xmpp:reference:0",SPOILER_0:"urn:xmppp:spoiler:0"}},function(e,t){e.exports={Type:{SUBSCRIBE:"subscribe",SUBSCRIBED:"subscribed",UNSUBSCRIBE:"unsubscribe",UNSUBSCRIBED:"unsubscribed",PROBE:"probe",UNAVAILABLE:"unavailable"},Show:{CHAT:"chat",AWAY:"away",DO_NOT_DISTURB:"dnd",EXTENDED_AWAY:"xa"}}},function(e,t){e.exports={Affiliation:{MEMBER:"member",NONE:"none",OUTCAST:"outcast",OWNER:"owner",PUBLISHER:"publisher",PUBLISH_ONLY:"publish-only"},Subscription:{NONE:"none",PENDING:"pending",UNCONFIGURED:"unconfigured",SUBSCRIBED:"subscribed"},AccessModel:{OPEN:"open",PRESENCE:"presence",ROSTER:"roster",AUTHORIZE:"authorize",WHITELIST:"whitelist"},Condition:{CONFLICT:"conflict"}}},function(e,t,n){"use strict";var r=n(196);t.available=!1,t.toUnicode=r.toUnicode,t.nameprep=function(e){return e.toLowerCase()},t.nodeprep=function(e){return e.toLowerCase()},t.resourceprep=function(e){return e}},function(e,t){function n(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e}e.exports=n;var r=Object.prototype.hasOwnProperty},function(e,t){}])});